---
title: "PWS_pink_match_analysis_P066-P067"
author: "Kristen Gruenthal and Kyle Shedd"
date: "`r Sys.Date()`"
output:
  html_notebook:
    theme: united
    toc: yes
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
rm(list=ls())

library(tidyverse)
library(lubridate)
library(DT)
library(abind)
bbind <- function(...) { abind(..., along = 3) }

source("~/R/Functions.GCL.R")
source("../../GOD/LOKI2R_ind.GCL.R")
source("../../GOD/DupCheckBetweenSillys_GOD.GCL.r")

knitr::opts_chunk$set(echo = TRUE)
```

# Objective

The purpose of this notebook is to determine whether we can successfully re-pair GTseq genotypes from otolith-derived DNA with GT-seq genotypes from heart-derived DNA for individuals of unknown origin.

# Background

During shipment of otolith samples to the MTA in Juneau for reading, a significant proportion of otoliths migrated between cells within DWPs due to poor containment of the acetate lids that were attached with rubber bands to the DWPs. This incident is known as "the great otolith debacle", aka the "GOD" incident. Since some otoliths moved from their original cells in the DWP, the paired integrity of the otolith-origin information and the rest of the paired data (genotype + field data) was lost for many individuals. In an attempt to rectify the "GOD" incident, we are extracting DNA from the otolith tissues, genotyping the otolith-derived DNA at 298 GT-seq loci, and attempting to re-pair the otolith-heart samples from their genotypes.  

# Methods

DNA was extracted from left-side or unknown otolith tissues of unknown origin using conventional Machery-Nagel DNA extraction kits. Otoliths were placed in T1 buffer for an overnight soak in clear 96 shallow-well plates (SWP). Preamp at 14 cycles. Final elution volume was 75uL. All otoliths were transferred among plates with a jig. All liquid handling was done by robot.

## LocusControl

```{r}
.username <- "kmgruenthal"
.password <- ""

loci <- dget("../../Objects/loci298.txt") # saved list of loci

CreateLocusControl.GCL(locusnames = loci, username = .username, password = .password)
loci <- LocusControl$locusnames
nalleles <- LocusControl$nalleles
ploidy <- LocusControl$ploidy
alleles <- LocusControl$alleles
```

```{r}
# Otolith SILLY
PGOD21 <- "PGOD21"
LOKI2R.GCL(sillyvec = PGOD21, username = .username, password = .password)

# read in attributes data from last round(s) and remove already processed fish_ids
attributes_PGOD21_012522 <- read_csv("attributes_PGOD21_012522.csv")
processed_PGOD21_fish_ids <- attributes_PGOD21_012522$FK_FISH_ID
RemoveIDs.GCL(silly = "PGOD21", IDs = processed_PGOD21_fish_ids)

# create a csv from the otolith transfer spreadsheet from MTAL, read in the data, and create a concatenated tray and well column
oto_xfer_data <- read_csv("otolith_transfer_111721.csv") # csv mod of MTAL final "otolith_transfer_96_template_LEFT_all trays_17Nov21.xlsx"
oto_xfer_data$DNA_TRAY_AND_WELL <- paste0(oto_xfer_data$`96_oto_tray_barcode`, "_", oto_xfer_data$`96_oto_tray_position`)
  
# download csv of PGOD21 sample data from OceanAK and append with _PGOD21_DATE
oceanak_PGOD21 <- read_csv("GEN_SAMPLED_FISH_TISSUE_PGOD21_031022.csv")

# pull the attributes table from PGOD21.gcl, create a new tray a well column, and join with the otolith transfer data
attributes_PGOD21 <- PGOD21.gcl$attributes %>%
  transform(DNA_TRAY_CODE = as.numeric(DNA_TRAY_CODE))

write_csv(attributes_PGOD21, "attributes_PGOD21_031622.csv") # use SillySource from prior dates to remove already processed IDs from PGOD21.gcl

attributes_PGOD21$DNA_TRAY_AND_WELL <- paste0(attributes_PGOD21$DNA_TRAY_CODE, "_", attributes_PGOD21$DNA_TRAY_WELL_CODE)
attributes_and_xfer_PGOD21 <- left_join(attributes_PGOD21, oto_xfer_data, by = "DNA_TRAY_AND_WELL")

# get a list of the affected DWPs
affected_DWPs <- unique(attributes_and_xfer_PGOD21$`48_DWP_tray_barcode`)

# filter OceanAK data pull for the list of affected DWPs
AHRP_oceanak_pull <- read_csv(file = "../../OceanAK/AHRP Salmon Biological Data 20220124_151655.csv") %>% # pull if date stamp is old
  transform(DNA_TRAY_CODE = as.numeric(DNA_TRAY_CODE))
oceanak_affected_DWPs <- AHRP_oceanak_pull[AHRP_oceanak_pull$DNA_TRAY_CODE %in% affected_DWPs, ]

write_csv(oceanak_affected_DWPs, "oceanak_affected_DWPs.csv")

# get SILLYs and fish IDs for affected DWPs
DWP_sillys <- unique(oceanak_affected_DWPs$SILLY_CODE)

PERB15_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PERB15") %>% 
  pull(FISH_ID)
PERB16_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PERB16") %>% 
  pull(FISH_ID)
PERB17_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PERB17") %>% 
  pull(FISH_ID)
PERB18_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PERB18") %>% 
  pull(FISH_ID)
PGILMOUR15_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR15") %>% 
  pull(FISH_ID)
PGILMOUR16_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR16") %>% 
  pull(FISH_ID)
PGILMOUR17_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR17") %>% 
  pull(FISH_ID)
PGILMOUR18_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR18") %>% 
  pull(FISH_ID)
PPADDY16_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PPADDY16") %>% 
  pull(FISH_ID)
PPADDY18_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PPADDY18") %>% 
  pull(FISH_ID)

# Project SILLYs by individuals in a SILLY per affected DWP
# Comment out those that have empty fish_ids above and SILLYs whose hearts haven't been genotyped yet 
## Empty: PERB18 and PGILMOUR18
## No heart genotypes: PERB15 and PERB17

# PERB15 <- "PERB15"
# LOKI2R_ind.GCL(sillyvec = PERB15, fish_ids = PERB15_fish_ids, username = .username, password = .password)

PERB16 <- "PERB16"
# LOKI2R_ind.GCL(sillyvec = PERB16, fish_ids = PERB16_fish_ids, username = .username, password = .password)

# conventional gcl construction (above) did not work, must either split the fish ID list and recombine or construct the full PERB16.gcl and remove blacklisted individuals
# chunk_num <- 2
# PERB16_fish_ids_split <- split(PERB16_fish_ids, cut(seq_along(PERB16_fish_ids), chunk_num, labels = FALSE))
# LOKI2R_ind.GCL(sillyvec = PERB16, fish_ids = PERB16_fish_ids_split$`1`, username = .username, password = .password)
# PERB16_1.gcl <- PERB16.gcl
# LOKI2R_ind.GCL(sillyvec = PERB16, fish_ids = PERB16_fish_ids_split$`2`, username = .username, password = .password)
# PERB16_2.gcl <- PERB16.gcl
# rm(PERB16.gcl)
# PoolCollections.GCL()

LOKI2R.GCL(sillyvec = PERB16, username = .username, password = .password)
all_PERB16_fish_ids <- PERB16.gcl$attributes$FK_FISH_ID
unused_PERB16_fish_ids <- all_PERB16_fish_ids[!(all_PERB16_fish_ids %in% PERB16_fish_ids)]
RemoveIDs.GCL(silly = "PERB16", IDs = unused_PERB16_fish_ids)

# PERB17 <- "PERB17"
# LOKI2R_ind.GCL(sillyvec = PERB17, fish_ids = PERB17_fish_ids, username = .username, password = .password)

# PERB18 <- "PERB18"
# LOKI2R_ind.GCL(sillyvec = PERB18, fish_ids = PERB18_fish_ids, username = .username, password = .password)

PGILMOUR15 <- "PGILMOUR15"
LOKI2R_ind.GCL(sillyvec = PGILMOUR15, fish_ids = PGILMOUR15_fish_ids, username = .username, password = .password)

PGILMOUR16 <- "PGILMOUR16"
LOKI2R_ind.GCL(sillyvec = PGILMOUR16, fish_ids = PGILMOUR16_fish_ids, username = .username, password = .password) 

PGILMOUR17 <- "PGILMOUR17"
LOKI2R_ind.GCL(sillyvec = PGILMOUR17, fish_ids = PGILMOUR17_fish_ids, username = .username, password = .password)

# PGILMOUR18 <- "PGILMOUR18"
# LOKI2R_ind.GCL(sillyvec = PGILMOUR18, fish_ids = PGILMOUR18_fish_ids, username = .username, password = .password)

PPADDY16 <- "PPADDY16"
LOKI2R_ind.GCL(sillyvec = PPADDY16, fish_ids = PPADDY16_fish_ids, username = .username, password = .password)

# PPADDY18 <- "PPADDY18"
# LOKI2R_ind.GCL(sillyvec = PPADDY18, fish_ids = PPADDY18_fish_ids, username = .username, password = .password)
```

```{r}
rm(.username, .password)
```


Create new directories and save objects

```{r save_locus_control_sillys}
# if(!dir.exists("../../Objects/GOD_21_Round3-4/")) {dir.create("../../Objects/GOD_21_Round3-4/")}
# save_objects(objects = c("LocusControl", "loci", "PGOD21", "PERB16", "PGILMOUR15", "PGILMOUR16", "PGILMOUR17", "PPADDY16"), path = "../../Objects/GOD_21_Round3-4/")
# 
# # need to add back in PERB16, if there's a way to recombine PERB16_1.gcl and PERB16_2.gcl into PERB16.gcl
# if(!dir.exists("../../Genotypes/GOD_21_Round3-4/")) {dir.create("../../Genotypes/GOD_21_Round3-4/")}
# save_sillys(sillyvec = c("PGOD21", "PERB16", "PGILMOUR15", "PGILMOUR16", "PGILMOUR17", "PPADDY16"), path = "../../Genotypes/GOD_21_Round3-4/")
```

Load objects if revisiting

```{r load_objects}
# load_objects(path = "../../Objects/GOD_21_Round3-4")
# load_sillys(path = "../../Genotypes/GOD_21_Round3-4")
```

### Otolith genotyping success

```{r fig.height=12}
TestQCSampleSizebyLocus <-
  SampSizeByLocus.GCL(sillyvec = PGOD21, loci = loci)

TestQCPercentbyLocus <-
  apply(TestQCSampleSizebyLocus, 1, function(row) {
    row / max(row)
  })

(locus_success_rate_qc <- TestQCPercentbyLocus %>% 
  as_tibble(rownames = "locus") %>%
  dplyr::rename(success_rate = PGOD21) %>%
  arrange(success_rate))

locus_success_rate_qc %>%
  filter(success_rate == 0)

(failed_loci_otoliths <- locus_success_rate_qc %>%
  filter(success_rate == 0) %>%
  pull(locus))

# plot of per locus genotyping success
TestQCPercentbyLocus %>%
  as_tibble(rownames = "locus") %>%
  gather(silly, percent,-locus) %>%
  ggplot(aes(x = silly, y = locus)) +
    geom_tile(aes(fill = percent), color = "white") +
    scale_fill_gradient(
      low = "black",
      high = "white",
      limits = c(0, 1)
    ) +
    ylab("Locus") +
    xlab("SILLY") +
    ggtitle("Percent genotyped by silly/locus") +
    labs(fill = "Percent\ngenotyped")
```

**0 / 298** loci failed; all rates >19% (see table).

## QA project genotypes

### Otoliths

#### Remove fails and dupes

Need to remove any particularly egregious otos, so let's see how badly they genotyped. 

```{r}
PGOD21.gcl$counts[, , 1] %>% 
  as_tibble(rownames = "fish_id") %>% 
  gather(locus, genotype, -fish_id) %>% 
  group_by(fish_id) %>% 
  summarise(proportion_missing = sum(is.na(genotype)) / length(loci)) %>% 
  arrange(desc(proportion_missing))
```

There are 2,090 total otos in PGOD21 Rounds 3 and 4, some of which clearly failed. We still need to keep as many critters as possible, and we have 298 loci, so we have wiggle room for genotyping success rate. 

Plot a histogram of proportion missing.
```{r}
PGOD21.gcl$counts[, , 1] %>% 
  as_tibble(rownames = "fish_id") %>% 
  gather(locus, genotype, -fish_id) %>% 
  group_by(fish_id) %>% 
  summarise(proportion_missing = sum(is.na(genotype)) / length(loci)) %>% 
  ggplot(aes(x = proportion_missing)) +
  geom_histogram(binwidth = 0.05) +
  theme_bw() +
  ggtitle("% Locus Failure Rate by Fish in PGOD21")
```

This looks better than the last time, I think. We will retain the 15% cutoff (85% retention) from the last round, giving us a minimum of 45 loci that must be genotyped, and keep the internal duplicate rate check at 99%. 

```{r}
PGOD21_SampleSizes <- matrix(
    data = NA,
    nrow = length(PGOD21),
    ncol = 4,
    dimnames = list(PGOD21, c("Genotyped", "Missing", "Duplicate", "Final"))
  )

PGOD21_SampleSizes[, "Genotyped"] <- sapply(paste(PGOD21, ".gcl", sep = ''), function(x)
    get(x)$n)


(MissLoci <- RemoveIndMissLoci.GCL(sillyvec = PGOD21, proportion = 0.15))

ColSizePostMissLoci <- sapply(paste(PGOD21, ".gcl", sep = ''), function(x)
    get(x)$n)

PGOD21_SampleSizes[, "Missing"] <- PGOD21_SampleSizes[, "Genotyped"] - ColSizePostMissLoci

DuplicateCheck99MinProportion <- CheckDupWithinSilly.GCL(
    sillyvec = PGOD21,
    loci = loci,
    quantile = NULL,
    minproportion = 0.99
  )

DuplicateCheckReportSummary <- sapply(PGOD21, function(x)
    DuplicateCheck99MinProportion[[x]]$report, simplify = FALSE)

DuplicateCheckReportSummary

nDupsBySilly <- sapply(DuplicateCheckReportSummary, function(silly) {
    ifelse(is.character(silly), 0, nrow(as.matrix(silly)))
  })
RemovedDups <- RemoveDups.GCL(DuplicateCheck99MinProportion)

sapply(DuplicateCheckReportSummary[nDupsBySilly >= 1], function(silly) {
  if (1 %in% abs(as.numeric(levels(silly$ID1)) - as.numeric(levels(silly$ID2)))) {
    "Sequential IDs found as duplicates, check 'DuplicateCheckReportSummary' for duplicated rows"
  } else {
    "Duplicates exist, but IDs do not appear sequential"
  }
})

DuplicateCheckReportSummary[nDupsBySilly >= 1]  # Show within silly duplicates

ColSizePostDuplicate <- ColSizePostMissLoci - nDupsBySilly
ColSizePostDuplicate <- sapply(paste(PGOD21, ".gcl", sep = ''), function(x) get(x)$n)

PGOD21_SampleSizes[, "Duplicate"] <- ColSizePostMissLoci - ColSizePostDuplicate

PGOD21_SampleSizes[, "Final"] <- ColSizePostDuplicate

PGOD21_SampleSizes
```

We have 2,020 / 2,090 otoliths remaining. None failed the duplicate rate check.

**NOTE** Similar to the normal AHRP samples, we'll want to remove **BOTH** duplicates, if they show up, since we won't know which one identifies back to the heart genotype. The function `RemoveDups.GCL` only removes 1 of the duplicates, we need to go in and manually remove the other.

**NOTE 2:** Not run; no duplicates.

```{r}
# (
#   duplicates_to_remove <- DuplicateCheckReportSummary$PGOD21 %>%
#     select(ID1, ID2) %>%
#     pivot_longer(
#       cols = everything(),
#       names_to = "trash",
#       values_to = "fish_ids"
#     ) %>%
#     pull(fish_ids)
# )
# 
# RemoveIDs.GCL(silly = "PGOD21", IDs = duplicates_to_remove)
```

There are 2,020 otos going forward.

#### Heterozygosity

Excess heterozygosity can be an indication of contamination. We already know there is some contamination among the heart-derived GT-seq genotypes, but it is a good baseline.

```{r}
Ho_qc <- function(indata1 = PGOD21.gcl$counts[ , , 1]) {
  indata1 %>% 
  as_tibble(rownames = "qc_fish_id") %>% 
  gather(locus, genotype, -qc_fish_id) %>% 
  group_by(qc_fish_id) %>% 
  summarise(Ho_qc = sum(genotype == 1, na.rm = TRUE) / length(!is.na(genotype)), .groups = "drop") %>% 
  arrange(desc(Ho_qc))
}

Ho_qc_plot <- function(indata2 = Ho_qc_PGOD21) {
  indata2 %>% 
  ggplot(aes(x = Ho_qc)) +
  geom_histogram(binwidth = 1/298) +
  theme_bw()
}

Ho_qc_PGOD21 <- Ho_qc()
Ho_qc_plot()
```

Ho is >50% for some otoliths -> contamination.

#### Genotyping success

Heterozygosity for what we got left.

```{r}
loci_intersect <- setdiff(loci, failed_loci_otoliths) # all 298 are there

qc_proportion_missing <- function(indata3 = PGOD21.gcl$counts[, , 1]) {
    indata3 %>%
    as_tibble(rownames = "fish_id") %>%
    gather(locus, genotype,-fish_id) %>%
    group_by(fish_id) %>%
    summarise(proportion_missing = sum(is.na(genotype)) / 298) %>%
    arrange(desc(proportion_missing))
}

qc_proportion_missing_plot <- function(indata4 = qc_proportion_missing_PGOD21) {
  indata4 %>% 
  ggplot(aes(x = proportion_missing)) +
  geom_histogram() +
  xlim(0, 1.1) +
  theme_bw()
}

qc_proportion_missing_PGOD21 <- qc_proportion_missing()
qc_proportion_missing_plot()
```

Cool.

### Hearts

#### Remove fails and dupes

For the other SILLYS we'll compare to, we'll leave the cutoff at 80% and perform the regular 95% duplicate rate check.

```{r}
OGSillys <- c("PERB16", "PGILMOUR15", "PGILMOUR16", "PGILMOUR17", "PPADDY16")

OGSillys_SampleSizes <- matrix(
    data = NA,
    nrow = length(OGSillys),
    ncol = 4,
    dimnames = list(OGSillys, c("Genotyped", "Missing", "Duplicate", "Final"))
  )

OGSillys_SampleSizes[, "Genotyped"] <- sapply(paste(OGSillys, ".gcl", sep = ''), function(x)
    get(x)$n)


(MissLoci <- RemoveIndMissLoci.GCL(sillyvec = OGSillys, proportion = 0.8))

ColSizePostMissLoci <- sapply(paste(OGSillys, ".gcl", sep = ''), function(x)
    get(x)$n)

OGSillys_SampleSizes[, "Missing"] <- OGSillys_SampleSizes[, "Genotyped"] - ColSizePostMissLoci

DuplicateCheck95MinProportion <- CheckDupWithinSilly.GCL(
    sillyvec = OGSillys,
    loci = loci,
    quantile = NULL,
    minproportion = 0.95
  )

DuplicateCheckReportSummary <- sapply(OGSillys, function(x)
    DuplicateCheck95MinProportion[[x]]$report, simplify = FALSE)

DuplicateCheckReportSummary

nDupsBySilly <- sapply(DuplicateCheckReportSummary, function(silly) {
    ifelse(is.character(silly), 0, nrow(as.matrix(silly)))
  })
RemovedDups <- RemoveDups.GCL(DuplicateCheck95MinProportion)

sapply(DuplicateCheckReportSummary[nDupsBySilly >= 1], function(silly) {
  if (1 %in% abs(as.numeric(levels(silly$ID1)) - as.numeric(levels(silly$ID2)))) {
    "Sequential IDs found as duplicates, check 'DuplicateCheckReportSummary' for duplicated rows"
  } else {
    "Duplicates exist, but IDs do not appear sequential"
  }
})

DuplicateCheckReportSummary[nDupsBySilly >= 1]  # Show within silly duplicates

ColSizePostDuplicate <- ColSizePostMissLoci - nDupsBySilly
ColSizePostDuplicate <- sapply(paste(OGSillys, ".gcl", sep = ''), function(x) get(x)$n)

OGSillys_SampleSizes[, "Duplicate"] <- ColSizePostMissLoci - ColSizePostDuplicate

OGSillys_SampleSizes[, "Final"] <- ColSizePostDuplicate

OGSillys_SampleSizes
```

Losing more as expected due to missingness. One dupe in each of PERB16 and PGILMOUR15.

### Final dataset sample sizes

```{r}
PGOD21.gcl$n
PERB16.gcl$n
PGILMOUR15.gcl$n
PGILMOUR16.gcl$n
PGILMOUR17.gcl$n
PPADDY16.gcl$n
```

As a reminder, PGOD21 genotyped more SILLYs and DWPs than we have heart genotypes for, which comes into play when we do the DWP-by-DWP matching.

## Duplicate rate check

### Arrange attributes by DWPs - ###PULL DWP CODES AND REVISE INDATA###
```{r}
# figure out the SILLYs associated with the DWPs and join
PGOD21_DWPs <- attributes_and_xfer_PGOD21 %>% 
  dplyr::select(`48_DWP_tray_barcode`)

write_csv(PGOD21_DWPs, "PGOD21_DWPs_031622.csv") # change date
# used this list plus SILLY_CODE and DNA_TRAY_CODE in oceanak_affected_DWPs.csv to do a vlookup in excel for the SILLY_CODE associated with the 48_DWP_tray_barcode - it's probably possible to do a vlookup type thing using join, but here we are...
 
# copied SILLY_CODE column in PGOD21_DWPs.csv to OG_SILLY_CODE, trimmed all columns to correct length, saved as new csv, and uploaded
# PGOD21_DWPs_and_SILLYs <- read_csv("PGOD21_DWPs_and_SILLYs_042721.csv") 
PGOD21_DWPs_and_SILLYs <- read_csv("PGOD21_DWPs_and_SILLYs_trimmed_031622.csv")

attributes_xfer_and_SILLY_PGOD21 <- attributes_and_xfer_PGOD21 
attributes_xfer_and_SILLY_PGOD21$OG_SILLY_CODE <- PGOD21_DWPs_and_SILLYs$OG_SILLY_CODE

new_PGOD21_attributes_and_SILLY <- left_join(PGOD21.gcl$attributes, attributes_xfer_and_SILLY_PGOD21, by = "SillySource")

# break down new_PGOD21_attributes_and_SILLY into individual DWPs
# NOTE: need to figure out a loop based on PGOD21_DWPs
PGOD21_by_DWP <- function(indata = "14331") {
  new_PGOD21_attributes_and_SILLY %>% 
    dplyr::filter(`48_DWP_tray_barcode` == indata)
}

PGOD21_DWP_3262 <- PGOD21_by_DWP(indata = "3262")
PGOD21_DWP_14037 <- PGOD21_by_DWP(indata = "14037")
PGOD21_DWP_14336 <- PGOD21_by_DWP(indata = "14336")
PGOD21_DWP_14354 <- PGOD21_by_DWP(indata = "14354")
PGOD21_DWP_14394 <- PGOD21_by_DWP(indata = "14394")
PGOD21_DWP_14402 <- PGOD21_by_DWP(indata = "14402")
PGOD21_DWP_16086 <- PGOD21_by_DWP(indata = "16086")
PGOD21_DWP_16097 <- PGOD21_by_DWP(indata = "16097")
PGOD21_DWP_16117 <- PGOD21_by_DWP(indata = "16117")
PGOD21_DWP_16118 <- PGOD21_by_DWP(indata = "16118")
PGOD21_DWP_16120 <- PGOD21_by_DWP(indata = "16120")
PGOD21_DWP_16144 <- PGOD21_by_DWP(indata = "16144")
PGOD21_DWP_16147 <- PGOD21_by_DWP(indata = "16147")
PGOD21_DWP_16174 <- PGOD21_by_DWP(indata = "16174")
PGOD21_DWP_14290 <- PGOD21_by_DWP(indata = "14290")
PGOD21_DWP_14307 <- PGOD21_by_DWP(indata = "14307")
PGOD21_DWP_14312 <- PGOD21_by_DWP(indata = "14312")
PGOD21_DWP_14326 <- PGOD21_by_DWP(indata = "14326")
PGOD21_DWP_14327 <- PGOD21_by_DWP(indata = "14327")
PGOD21_DWP_14330 <- PGOD21_by_DWP(indata = "14330")
PGOD21_DWP_14358 <- PGOD21_by_DWP(indata = "14358")
PGOD21_DWP_14367 <- PGOD21_by_DWP(indata = "14367")
PGOD21_DWP_14368 <- PGOD21_by_DWP(indata = "14368")
PGOD21_DWP_14398 <- PGOD21_by_DWP(indata = "14398")
PGOD21_DWP_14429 <- PGOD21_by_DWP(indata = "14429")
PGOD21_DWP_16090 <- PGOD21_by_DWP(indata = "16090")
PGOD21_DWP_16092 <- PGOD21_by_DWP(indata = "16092")
PGOD21_DWP_16095 <- PGOD21_by_DWP(indata = "16095")
PGOD21_DWP_16096 <- PGOD21_by_DWP(indata = "16096")
PGOD21_DWP_16101 <- PGOD21_by_DWP(indata = "16101")
PGOD21_DWP_16121 <- PGOD21_by_DWP(indata = "16121")
PGOD21_DWP_16122 <- PGOD21_by_DWP(indata = "16122")
PGOD21_DWP_16136 <- PGOD21_by_DWP(indata = "16136")
PGOD21_DWP_22163 <- PGOD21_by_DWP(indata = "22163")
PGOD21_DWP_22178 <- PGOD21_by_DWP(indata = "22178")
PGOD21_DWP_22257 <- PGOD21_by_DWP(indata = "22257")
PGOD21_DWP_2071 <- PGOD21_by_DWP(indata = "2071")
PGOD21_DWP_2081 <- PGOD21_by_DWP(indata = "2081")
PGOD21_DWP_2124 <- PGOD21_by_DWP(indata = "2124")
PGOD21_DWP_2125 <- PGOD21_by_DWP(indata = "2125")
PGOD21_DWP_2127 <- PGOD21_by_DWP(indata = "2127")
PGOD21_DWP_2160 <- PGOD21_by_DWP(indata = "2160")
PGOD21_DWP_2162 <- PGOD21_by_DWP(indata = "2162")
PGOD21_DWP_2193 <- PGOD21_by_DWP(indata = "2193")
PGOD21_DWP_2197 <- PGOD21_by_DWP(indata = "2197")
PGOD21_DWP_2233 <- PGOD21_by_DWP(indata = "2233")
PGOD21_DWP_2236 <- PGOD21_by_DWP(indata = "2236")
PGOD21_DWP_2508 <- PGOD21_by_DWP(indata = "2508")
PGOD21_DWP_2837 <- PGOD21_by_DWP(indata = "2837")
PGOD21_DWP_2926 <- PGOD21_by_DWP(indata = "2926")
PGOD21_DWP_2927 <- PGOD21_by_DWP(indata = "2927")
PGOD21_DWP_2930 <- PGOD21_by_DWP(indata = "2930")
PGOD21_DWP_2932 <- PGOD21_by_DWP(indata = "2932")
PGOD21_DWP_14528 <- PGOD21_by_DWP(indata = "14528")
PGOD21_DWP_14576 <- PGOD21_by_DWP(indata = "14576")
PGOD21_DWP_14603 <- PGOD21_by_DWP(indata = "14603")
PGOD21_DWP_14657 <- PGOD21_by_DWP(indata = "14657")
PGOD21_DWP_14659 <- PGOD21_by_DWP(indata = "14659")
PGOD21_DWP_14676 <- PGOD21_by_DWP(indata = "14676")
PGOD21_DWP_15801 <- PGOD21_by_DWP(indata = "15801")
PGOD21_DWP_15802 <- PGOD21_by_DWP(indata = "15802")
PGOD21_DWP_22465 <- PGOD21_by_DWP(indata = "22465")
PGOD21_DWP_22516 <- PGOD21_by_DWP(indata = "22516")
PGOD21_DWP_22601 <- PGOD21_by_DWP(indata = "22601")
PGOD21_DWP_22678 <- PGOD21_by_DWP(indata = "22678")
PGOD21_DWP_22720 <- PGOD21_by_DWP(indata = "22720")
PGOD21_DWP_22745 <- PGOD21_by_DWP(indata = "22745")
PGOD21_DWP_14408 <- PGOD21_by_DWP(indata = "14408")
PGOD21_DWP_16131 <- PGOD21_by_DWP(indata = "16131")

# break down OGSillys into individual DWPs
# NOTE: same here - need loops based on the SILLY_affected_DWPs
PERB16_affected_DWPs <- unique(PERB16.gcl$attributes$DNA_TRAY_CODE)
PGILMOUR15_affected_DWPs <- unique(PGILMOUR15.gcl$attributes$DNA_TRAY_CODE)
PGILMOUR16_affected_DWPs <- unique(PGILMOUR16.gcl$attributes$DNA_TRAY_CODE)
PGILMOUR17_affected_DWPs <- unique(PGILMOUR17.gcl$attributes$DNA_TRAY_CODE)
PPADDY16_affected_DWPs <- unique(PPADDY16.gcl$attributes$DNA_TRAY_CODE)

OGSilly_by_DWP <- function(indata1 = PERB16.gcl$attributes, indata2 = "0000014331") {
  indata1 %>% 
    dplyr::filter(DNA_TRAY_CODE == indata2)
}

PERB16_DWP_14290 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014290")
PERB16_DWP_14307 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014307")
PERB16_DWP_14312 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014312")
PERB16_DWP_14326 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014326")
PERB16_DWP_14327 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014327")
PERB16_DWP_14330 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014330")
PERB16_DWP_14336 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014336")
PERB16_DWP_14354 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014354")
PERB16_DWP_14358 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014358")
PERB16_DWP_14367 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014367")
PERB16_DWP_14368 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014368")
PERB16_DWP_14394 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014394")
PERB16_DWP_14398 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014398")
PERB16_DWP_14402 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014402")
PERB16_DWP_14429 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014429")
PERB16_DWP_16086 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016086")
PERB16_DWP_16090 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016090")
PERB16_DWP_16092 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016092")
PERB16_DWP_16095 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016095")
PERB16_DWP_16096 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016096")
PERB16_DWP_16097 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016097")
PERB16_DWP_16101 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016101")
PERB16_DWP_16117 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016117")
PERB16_DWP_16118 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016118")
PERB16_DWP_16120 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016120")
PERB16_DWP_16121 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016121")
PERB16_DWP_16122 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016122")
PERB16_DWP_16136 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016136")
PERB16_DWP_16144 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016144")
PERB16_DWP_16147 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016147")
PERB16_DWP_16174 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016174")

PGILMOUR15_DWP_2071 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002071")
PGILMOUR15_DWP_2081 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002081")
PGILMOUR15_DWP_2124 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002124")
PGILMOUR15_DWP_2125 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002125")
PGILMOUR15_DWP_2127 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002127")
PGILMOUR15_DWP_2160 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002160")
PGILMOUR15_DWP_2162 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002162")
PGILMOUR15_DWP_2193 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002193")
PGILMOUR15_DWP_2197 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002197")
PGILMOUR15_DWP_2233 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002233")
PGILMOUR15_DWP_2236 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002236")
PGILMOUR15_DWP_2508 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002508")
PGILMOUR15_DWP_2837 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002837")
PGILMOUR15_DWP_2926 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002926")
PGILMOUR15_DWP_2927 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002927")
PGILMOUR15_DWP_2930 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002930")
PGILMOUR15_DWP_2932 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002932")

PGILMOUR16_DWP_14528 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014528")
PGILMOUR16_DWP_14576 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014576")
PGILMOUR16_DWP_14603 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014603")
PGILMOUR16_DWP_14657 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014657")
PGILMOUR16_DWP_14659 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014659")
PGILMOUR16_DWP_14676 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014676")
PGILMOUR16_DWP_15801 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000015801")
PGILMOUR16_DWP_15802 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000015802")

PGILMOUR17_DWP_22465 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022465")
PGILMOUR17_DWP_22516 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022516")
PGILMOUR17_DWP_22601 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022601")
PGILMOUR17_DWP_22678 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022678")
PGILMOUR17_DWP_22720 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022720")
PGILMOUR17_DWP_22745 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022745")

PPADDY16_DWP_14408 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000014408")
PPADDY16_DWP_16131 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000016131")
```

### Pull DWP fish_ids for PGOD21 and the OGSillys

```{r}
# pull fish_ids for PGOD21 DWPs
PGOD21_DWP_3262_fish_ids <- PGOD21_DWP_3262 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14037_fish_ids <- PGOD21_DWP_14037 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14336_fish_ids <- PGOD21_DWP_14336 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14354_fish_ids <- PGOD21_DWP_14354 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14394_fish_ids <- PGOD21_DWP_14394 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14402_fish_ids <- PGOD21_DWP_14402 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16086_fish_ids <- PGOD21_DWP_16086 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16097_fish_ids <- PGOD21_DWP_16097 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16117_fish_ids <- PGOD21_DWP_16117 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16118_fish_ids <- PGOD21_DWP_16118 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16120_fish_ids <- PGOD21_DWP_16120 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16144_fish_ids <- PGOD21_DWP_16144 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16147_fish_ids <- PGOD21_DWP_16147 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16174_fish_ids <- PGOD21_DWP_16174 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14290_fish_ids <- PGOD21_DWP_14290 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14307_fish_ids <- PGOD21_DWP_14307 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14312_fish_ids <- PGOD21_DWP_14312 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14326_fish_ids <- PGOD21_DWP_14326 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14327_fish_ids <- PGOD21_DWP_14327 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14330_fish_ids <- PGOD21_DWP_14330 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14358_fish_ids <- PGOD21_DWP_14358 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14367_fish_ids <- PGOD21_DWP_14367 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14368_fish_ids <- PGOD21_DWP_14368 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14398_fish_ids <- PGOD21_DWP_14398 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14429_fish_ids <- PGOD21_DWP_14429 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16090_fish_ids <- PGOD21_DWP_16090 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16092_fish_ids <- PGOD21_DWP_16092 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16095_fish_ids <- PGOD21_DWP_16095 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16096_fish_ids <- PGOD21_DWP_16096 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16101_fish_ids <- PGOD21_DWP_16101 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16121_fish_ids <- PGOD21_DWP_16121 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16122_fish_ids <- PGOD21_DWP_16122 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16136_fish_ids <- PGOD21_DWP_16136 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22163_fish_ids <- PGOD21_DWP_22163 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22178_fish_ids <- PGOD21_DWP_22178 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22257_fish_ids <- PGOD21_DWP_22257 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2071_fish_ids <- PGOD21_DWP_2071 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2081_fish_ids <- PGOD21_DWP_2081 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2124_fish_ids <- PGOD21_DWP_2124 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2125_fish_ids <- PGOD21_DWP_2125 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2127_fish_ids <- PGOD21_DWP_2127 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2160_fish_ids <- PGOD21_DWP_2160 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2162_fish_ids <- PGOD21_DWP_2162 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2193_fish_ids <- PGOD21_DWP_2193 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2197_fish_ids <- PGOD21_DWP_2197 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2233_fish_ids <- PGOD21_DWP_2233 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2236_fish_ids <- PGOD21_DWP_2236 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2508_fish_ids <- PGOD21_DWP_2508 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2837_fish_ids <- PGOD21_DWP_2837 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2926_fish_ids <- PGOD21_DWP_2926 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2927_fish_ids <- PGOD21_DWP_2927 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2930_fish_ids <- PGOD21_DWP_2930 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2932_fish_ids <- PGOD21_DWP_2932 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14528_fish_ids <- PGOD21_DWP_14528 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14576_fish_ids <- PGOD21_DWP_14576 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14603_fish_ids <- PGOD21_DWP_14603 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14657_fish_ids <- PGOD21_DWP_14657 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14659_fish_ids <- PGOD21_DWP_14659 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14676_fish_ids <- PGOD21_DWP_14676 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_15801_fish_ids <- PGOD21_DWP_15801 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_15802_fish_ids <- PGOD21_DWP_15802 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22465_fish_ids <- PGOD21_DWP_22465 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22516_fish_ids <- PGOD21_DWP_22516 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22601_fish_ids <- PGOD21_DWP_22601 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22678_fish_ids <- PGOD21_DWP_22678 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22720_fish_ids <- PGOD21_DWP_22720 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22745_fish_ids <- PGOD21_DWP_22745 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14408_fish_ids <- PGOD21_DWP_14408 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16131_fish_ids <- PGOD21_DWP_16131 %>% pull(FK_FISH_ID.x)

# pull fish_ids for OGSilly DWPs
PERB16_DWP_14290_fish_ids <- PERB16_DWP_14290 %>% pull(FK_FISH_ID)
PERB16_DWP_14307_fish_ids <- PERB16_DWP_14307 %>% pull(FK_FISH_ID)
PERB16_DWP_14312_fish_ids <- PERB16_DWP_14312 %>% pull(FK_FISH_ID)
PERB16_DWP_14326_fish_ids <- PERB16_DWP_14326 %>% pull(FK_FISH_ID)
PERB16_DWP_14327_fish_ids <- PERB16_DWP_14327 %>% pull(FK_FISH_ID)
PERB16_DWP_14330_fish_ids <- PERB16_DWP_14330 %>% pull(FK_FISH_ID)
PERB16_DWP_14336_fish_ids <- PERB16_DWP_14336 %>% pull(FK_FISH_ID)
PERB16_DWP_14354_fish_ids <- PERB16_DWP_14354 %>% pull(FK_FISH_ID)
PERB16_DWP_14358_fish_ids <- PERB16_DWP_14358 %>% pull(FK_FISH_ID)
PERB16_DWP_14367_fish_ids <- PERB16_DWP_14367 %>% pull(FK_FISH_ID)
PERB16_DWP_14368_fish_ids <- PERB16_DWP_14368 %>% pull(FK_FISH_ID)
PERB16_DWP_14394_fish_ids <- PERB16_DWP_14394 %>% pull(FK_FISH_ID)
PERB16_DWP_14398_fish_ids <- PERB16_DWP_14398 %>% pull(FK_FISH_ID)
PERB16_DWP_14402_fish_ids <- PERB16_DWP_14402 %>% pull(FK_FISH_ID)
PERB16_DWP_14429_fish_ids <- PERB16_DWP_14429 %>% pull(FK_FISH_ID)
PERB16_DWP_16086_fish_ids <- PERB16_DWP_16086 %>% pull(FK_FISH_ID)
PERB16_DWP_16090_fish_ids <- PERB16_DWP_16090 %>% pull(FK_FISH_ID)
PERB16_DWP_16092_fish_ids <- PERB16_DWP_16092 %>% pull(FK_FISH_ID)
PERB16_DWP_16095_fish_ids <- PERB16_DWP_16095 %>% pull(FK_FISH_ID)
PERB16_DWP_16096_fish_ids <- PERB16_DWP_16096 %>% pull(FK_FISH_ID)
PERB16_DWP_16097_fish_ids <- PERB16_DWP_16097 %>% pull(FK_FISH_ID)
PERB16_DWP_16101_fish_ids <- PERB16_DWP_16101 %>% pull(FK_FISH_ID)
PERB16_DWP_16117_fish_ids <- PERB16_DWP_16117 %>% pull(FK_FISH_ID)
PERB16_DWP_16118_fish_ids <- PERB16_DWP_16118 %>% pull(FK_FISH_ID)
PERB16_DWP_16120_fish_ids <- PERB16_DWP_16120 %>% pull(FK_FISH_ID)
PERB16_DWP_16121_fish_ids <- PERB16_DWP_16121 %>% pull(FK_FISH_ID)
PERB16_DWP_16122_fish_ids <- PERB16_DWP_16122 %>% pull(FK_FISH_ID)
PERB16_DWP_16136_fish_ids <- PERB16_DWP_16136 %>% pull(FK_FISH_ID)
PERB16_DWP_16144_fish_ids <- PERB16_DWP_16144 %>% pull(FK_FISH_ID)
PERB16_DWP_16147_fish_ids <- PERB16_DWP_16147 %>% pull(FK_FISH_ID)
PERB16_DWP_16174_fish_ids <- PERB16_DWP_16174 %>% pull(FK_FISH_ID)

PGILMOUR15_DWP_2071_fish_ids <- PGILMOUR15_DWP_2071 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2081_fish_ids <- PGILMOUR15_DWP_2081 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2124_fish_ids <- PGILMOUR15_DWP_2124 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2125_fish_ids <- PGILMOUR15_DWP_2125 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2127_fish_ids <- PGILMOUR15_DWP_2127 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2160_fish_ids <- PGILMOUR15_DWP_2160 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2162_fish_ids <- PGILMOUR15_DWP_2162 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2193_fish_ids <- PGILMOUR15_DWP_2193 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2197_fish_ids <- PGILMOUR15_DWP_2197 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2233_fish_ids <- PGILMOUR15_DWP_2233 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2236_fish_ids <- PGILMOUR15_DWP_2236 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2508_fish_ids <- PGILMOUR15_DWP_2508 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2837_fish_ids <- PGILMOUR15_DWP_2837 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2926_fish_ids <- PGILMOUR15_DWP_2926 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2927_fish_ids <- PGILMOUR15_DWP_2927 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2930_fish_ids <- PGILMOUR15_DWP_2930 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2932_fish_ids <- PGILMOUR15_DWP_2932 %>% pull(FK_FISH_ID)

PGILMOUR16_DWP_14528_fish_ids <- PGILMOUR16_DWP_14528 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14576_fish_ids <- PGILMOUR16_DWP_14576 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14603_fish_ids <- PGILMOUR16_DWP_14603 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14657_fish_ids <- PGILMOUR16_DWP_14657 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14659_fish_ids <- PGILMOUR16_DWP_14659 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14676_fish_ids <- PGILMOUR16_DWP_14676 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_15801_fish_ids <- PGILMOUR16_DWP_15801 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_15802_fish_ids <- PGILMOUR16_DWP_15802 %>% pull(FK_FISH_ID)

PGILMOUR17_DWP_22465_fish_ids <- PGILMOUR17_DWP_22465 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22516_fish_ids <- PGILMOUR17_DWP_22516 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22601_fish_ids <- PGILMOUR17_DWP_22601 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22678_fish_ids <- PGILMOUR17_DWP_22678 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22720_fish_ids <- PGILMOUR17_DWP_22720 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22745_fish_ids <- PGILMOUR17_DWP_22745 %>% pull(FK_FISH_ID)

PPADDY16_DWP_14408_fish_ids <- PPADDY16_DWP_14408 %>% pull(FK_FISH_ID)
PPADDY16_DWP_16131_fish_ids <- PPADDY16_DWP_16131 %>% pull(FK_FISH_ID)
```

### **Duplicate rate checks by DWP**

A total of 5 PGOD21 DWPs don't have OGSilly DWP matches, presumably because they haven't been genotyped yet, leaving 64 DWPs for matching.

* PERB16: n = 31
* PGILMOUR15: n = 17
* PGILMOUR16: n = 8
* PGILMOUR17: n = 6
* PPADDY16: n = 2

#### ###############**PERB 16**###############

#### *10. PERB16_DWP_14290*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14290_fish_ids)), newname = "PERB16_DWP_14290")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14290_fish_ids)), newname = "PGOD21_DWP_14290")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14290 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14290",
      GODSillyIDs = list("PGOD21_DWP_14290" = rownames(PGOD21_DWP_14290.gcl$counts)),
      HeartSillys = "PERB16_DWP_14290",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14290_best_match <- dup_check_results_DWP_14290 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14290 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14290_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14290 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14290_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14290 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14290_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14290_1stbest <- dup_check_results_DWP_14290 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14290_2ndbest <- dup_check_results_DWP_14290 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14290_top_2 <- rbind(dup_check_results_DWP_14290_1stbest, dup_check_results_DWP_14290_2ndbest))

ggplot(data = dup_check_results_DWP_14290_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14290_pass <- dup_check_results_DWP_14290_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14290_pass)
length(unique(dup_check_results_DWP_14290_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14290_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14290_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *11. PERB16_DWP_14307*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14307_fish_ids)), newname = "PERB16_DWP_14307")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14307_fish_ids)), newname = "PGOD21_DWP_14307")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14307 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14307",
      GODSillyIDs = list("PGOD21_DWP_14307" = rownames(PGOD21_DWP_14307.gcl$counts)),
      HeartSillys = "PERB16_DWP_14307",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14307_best_match <- dup_check_results_DWP_14307 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14307 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14307_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14307 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14307_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14307 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14307_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14307_1stbest <- dup_check_results_DWP_14307 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14307_2ndbest <- dup_check_results_DWP_14307 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14307_top_2 <- rbind(dup_check_results_DWP_14307_1stbest, dup_check_results_DWP_14307_2ndbest))

ggplot(data = dup_check_results_DWP_14307_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Set cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15.

```{r}
# filtered results table
(dup_check_results_DWP_14307_pass <- dup_check_results_DWP_14307_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14307_pass)
length(unique(dup_check_results_DWP_14307_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14307_pass$otolith_fish_id))
```

##### Status: No otos passing; OK

```{r}
write.table(dup_check_results_DWP_14307_pass, "dup_check_results_pass.csv")
```

#### *12. PERB16_DWP_14312*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14312_fish_ids)), newname = "PERB16_DWP_14312")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14312_fish_ids)), newname = "PGOD21_DWP_14312")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14312 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14312",
      GODSillyIDs = list("PGOD21_DWP_14312" = rownames(PGOD21_DWP_14312.gcl$counts)),
      HeartSillys = "PERB16_DWP_14312",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14312_best_match <- dup_check_results_DWP_14312 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14312 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14312_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14312 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14312_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14312 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14312_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14312_1stbest <- dup_check_results_DWP_14312 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14312_2ndbest <- dup_check_results_DWP_14312 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14312_top_2 <- rbind(dup_check_results_DWP_14312_1stbest, dup_check_results_DWP_14312_2ndbest))

ggplot(data = dup_check_results_DWP_14312_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14312_pass <- dup_check_results_DWP_14312_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14312_pass)
length(unique(dup_check_results_DWP_14312_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14312_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
# write.table(dup_check_results_DWP_14449_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *13. PERB16_DWP_14326*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14326_fish_ids)), newname = "PERB16_DWP_14326")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14326_fish_ids)), newname = "PGOD21_DWP_14326")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14326 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14326",
      GODSillyIDs = list("PGOD21_DWP_14326" = rownames(PGOD21_DWP_14326.gcl$counts)),
      HeartSillys = "PERB16_DWP_14326",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14326_best_match <- dup_check_results_DWP_14326 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14326 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14326_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14326 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14326_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14326 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14326_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14326_1stbest <- dup_check_results_DWP_14326 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14326_2ndbest <- dup_check_results_DWP_14326 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14326_top_2 <- rbind(dup_check_results_DWP_14326_1stbest, dup_check_results_DWP_14326_2ndbest))

ggplot(data = dup_check_results_DWP_14326_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14326_pass <- dup_check_results_DWP_14326_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14326_pass)
length(unique(dup_check_results_DWP_14326_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14326_pass$otolith_fish_id))
```

##### Status: No passing otos; OK


```{r}
write.table(dup_check_results_DWP_14326_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *14. PERB16_DWP_14327*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14327_fish_ids)), newname = "PERB16_DWP_14327")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14327_fish_ids)), newname = "PGOD21_DWP_14327")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14327 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14327",
      GODSillyIDs = list("PGOD21_DWP_14327" = rownames(PGOD21_DWP_14327.gcl$counts)),
      HeartSillys = "PERB16_DWP_14327",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14327_best_match <- dup_check_results_DWP_14327 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14327 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14327_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14327 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14327_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14327 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14327_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14327_1stbest <- dup_check_results_DWP_14327 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14327_2ndbest <- dup_check_results_DWP_14327 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14327_top_2 <- rbind(dup_check_results_DWP_14327_1stbest, dup_check_results_DWP_14327_2ndbest))

ggplot(data = dup_check_results_DWP_14327_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14327_pass <- dup_check_results_DWP_14327_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14327_pass)
length(unique(dup_check_results_DWP_14327_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14327_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14327_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *15. PERB16_DWP_14330*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14330_fish_ids)), newname = "PERB16_DWP_14330")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14330_fish_ids)), newname = "PGOD21_DWP_14330")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14330 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14330",
      GODSillyIDs = list("PGOD21_DWP_14330" = rownames(PGOD21_DWP_14330.gcl$counts)),
      HeartSillys = "PERB16_DWP_14330",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14330_best_match <- dup_check_results_DWP_14330 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14330 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14330_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14330 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14330_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14330 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14330_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14330_1stbest <- dup_check_results_DWP_14330 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14330_2ndbest <- dup_check_results_DWP_14330 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14330_top_2 <- rbind(dup_check_results_DWP_14330_1stbest, dup_check_results_DWP_14330_2ndbest))

ggplot(data = dup_check_results_DWP_14330_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_14330_pass <- dup_check_results_DWP_14330_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_14330_pass)
length(unique(dup_check_results_DWP_14330_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14330_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14330_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *16. PERB16_DWP_14336*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14336_fish_ids)), newname = "PERB16_DWP_14336")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14336_fish_ids)), newname = "PGOD21_DWP_14336")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14336 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14336",
      GODSillyIDs = list("PGOD21_DWP_14336" = rownames(PGOD21_DWP_14336.gcl$counts)),
      HeartSillys = "PERB16_DWP_14336",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14336_best_match <- dup_check_results_DWP_14336 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14336 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14336_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14336 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14336_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14336 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14336_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14336_1stbest <- dup_check_results_DWP_14336 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14336_2ndbest <- dup_check_results_DWP_14336 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14336_top_2 <- rbind(dup_check_results_DWP_14336_1stbest, dup_check_results_DWP_14336_2ndbest))

ggplot(data = dup_check_results_DWP_14336_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14336_pass <- dup_check_results_DWP_14336_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14336_pass)
length(unique(dup_check_results_DWP_14336_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14336_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14336_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *17. PERB16_DWP_14354*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14354_fish_ids)), newname = "PERB16_DWP_14354")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14354_fish_ids)), newname = "PGOD21_DWP_14354")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14354 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14354",
      GODSillyIDs = list("PGOD21_DWP_14354" = rownames(PGOD21_DWP_14354.gcl$counts)),
      HeartSillys = "PERB16_DWP_14354",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14354_best_match <- dup_check_results_DWP_14354 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14354 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14354_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14354 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14354_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14354 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14354_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14354_1stbest <- dup_check_results_DWP_14354 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14354_2ndbest <- dup_check_results_DWP_14354 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14354_top_2 <- rbind(dup_check_results_DWP_14354_1stbest, dup_check_results_DWP_14354_2ndbest))

ggplot(data = dup_check_results_DWP_14354_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14354_pass <- dup_check_results_DWP_14354_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14354_pass)
length(unique(dup_check_results_DWP_14354_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14354_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
write.table(dup_check_results_DWP_14354_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *18. PERB16_DWP_14358*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14358_fish_ids)), newname = "PERB16_DWP_14358")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14358_fish_ids)), newname = "PGOD21_DWP_14358")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14358 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14358",
      GODSillyIDs = list("PGOD21_DWP_14358" = rownames(PGOD21_DWP_14358.gcl$counts)),
      HeartSillys = "PERB16_DWP_14358",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14358_best_match <- dup_check_results_DWP_14358 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14358 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14358_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14358 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14358_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14358 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14358_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14358_1stbest <- dup_check_results_DWP_14358 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14358_2ndbest <- dup_check_results_DWP_14358 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14358_top_2 <- rbind(dup_check_results_DWP_14358_1stbest, dup_check_results_DWP_14358_2ndbest))

ggplot(data = dup_check_results_DWP_14358_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14358_pass <- dup_check_results_DWP_14358_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14358_pass)
length(unique(dup_check_results_DWP_14358_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14358_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14358_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *19. PERB16_DWP_14367*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14367_fish_ids)), newname = "PERB16_DWP_14367")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14367_fish_ids)), newname = "PGOD21_DWP_14367")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14367 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14367",
      GODSillyIDs = list("PGOD21_DWP_14367" = rownames(PGOD21_DWP_14367.gcl$counts)),
      HeartSillys = "PERB16_DWP_14367",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14367_best_match <- dup_check_results_DWP_14367 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14367 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14367_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14367 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14367_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14367 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14367_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14367_1stbest <- dup_check_results_DWP_14367 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14367_2ndbest <- dup_check_results_DWP_14367 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14367_top_2 <- rbind(dup_check_results_DWP_14367_1stbest, dup_check_results_DWP_14367_2ndbest))

ggplot(data = dup_check_results_DWP_14367_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14367_pass <- dup_check_results_DWP_14367_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14367_pass)
length(unique(dup_check_results_DWP_14367_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14367_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14367_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *20. PERB16_DWP_14368*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14368_fish_ids)), newname = "PERB16_DWP_14368")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14368_fish_ids)), newname = "PGOD21_DWP_14368")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14368 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14368",
      GODSillyIDs = list("PGOD21_DWP_14368" = rownames(PGOD21_DWP_14368.gcl$counts)),
      HeartSillys = "PERB16_DWP_14368",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14368_best_match <- dup_check_results_DWP_14368 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14368 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14368_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14368 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14368_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14368 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14368_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14368_1stbest <- dup_check_results_DWP_14368 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14368_2ndbest <- dup_check_results_DWP_14368 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14368_top_2 <- rbind(dup_check_results_DWP_14368_1stbest, dup_check_results_DWP_14368_2ndbest))

ggplot(data = dup_check_results_DWP_14368_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14368_pass <- dup_check_results_DWP_14368_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14368_pass)
length(unique(dup_check_results_DWP_14368_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14368_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14368_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *21. PERB16_DWP_14394*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14394_fish_ids)), newname = "PERB16_DWP_14394")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14394_fish_ids)), newname = "PGOD21_DWP_14394")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14394 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14394",
      GODSillyIDs = list("PGOD21_DWP_14394" = rownames(PGOD21_DWP_14394.gcl$counts)),
      HeartSillys = "PERB16_DWP_14394",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14394_best_match <- dup_check_results_DWP_14394 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14394 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14394_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14394 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14394_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14394 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14394_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14394_1stbest <- dup_check_results_DWP_14394 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14394_2ndbest <- dup_check_results_DWP_14394 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14394_top_2 <- rbind(dup_check_results_DWP_14394_1stbest, dup_check_results_DWP_14394_2ndbest))

ggplot(data = dup_check_results_DWP_14394_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.8 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14394_pass <- dup_check_results_DWP_14394_1stbest %>% 
  filter(duplicate_rate >= 0.8) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14394_pass)
length(unique(dup_check_results_DWP_14394_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14394_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
write.table(dup_check_results_DWP_14394_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *22. PERB16_DWP_14398*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14398_fish_ids)), newname = "PERB16_DWP_14398")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14398_fish_ids)), newname = "PGOD21_DWP_14398")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14398 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14398",
      GODSillyIDs = list("PGOD21_DWP_14398" = rownames(PGOD21_DWP_14398.gcl$counts)),
      HeartSillys = "PERB16_DWP_14398",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14398_best_match <- dup_check_results_DWP_14398 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14398 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14398_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14398 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14398_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14398 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14398_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14398_1stbest <- dup_check_results_DWP_14398 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14398_2ndbest <- dup_check_results_DWP_14398 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14398_top_2 <- rbind(dup_check_results_DWP_14398_1stbest, dup_check_results_DWP_14398_2ndbest))

ggplot(data = dup_check_results_DWP_14398_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14398_pass <- dup_check_results_DWP_14398_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14398_pass)
length(unique(dup_check_results_DWP_14398_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14398_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_14398_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *23. PERB16_DWP_14402*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14402_fish_ids)), newname = "PERB16_DWP_14402")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14402_fish_ids)), newname = "PGOD21_DWP_14402")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14402 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14402",
      GODSillyIDs = list("PGOD21_DWP_14402" = rownames(PGOD21_DWP_14402.gcl$counts)),
      HeartSillys = "PERB16_DWP_14402",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14402_best_match <- dup_check_results_DWP_14402 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14402 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14402_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14402 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14402_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14402 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14402_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14402_1stbest <- dup_check_results_DWP_14402 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14402_2ndbest <- dup_check_results_DWP_14402 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14402_top_2 <- rbind(dup_check_results_DWP_14402_1stbest, dup_check_results_DWP_14402_2ndbest))

ggplot(data = dup_check_results_DWP_14402_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14402_pass <- dup_check_results_DWP_14402_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14402_pass)
length(unique(dup_check_results_DWP_14402_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14402_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14402_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *24. PERB16_DWP_14429*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14429_fish_ids)), newname = "PERB16_DWP_14429")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14429_fish_ids)), newname = "PGOD21_DWP_14429")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14429 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14429",
      GODSillyIDs = list("PGOD21_DWP_14429" = rownames(PGOD21_DWP_14429.gcl$counts)),
      HeartSillys = "PERB16_DWP_14429",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14429_best_match <- dup_check_results_DWP_14429 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14429 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14429_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14429 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14429_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14429 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14429_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14429_1stbest <- dup_check_results_DWP_14429 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14429_2ndbest <- dup_check_results_DWP_14429 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14429_top_2 <- rbind(dup_check_results_DWP_14429_1stbest, dup_check_results_DWP_14429_2ndbest))

ggplot(data = dup_check_results_DWP_14429_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14429_pass <- dup_check_results_DWP_14429_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14429_pass)
length(unique(dup_check_results_DWP_14429_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14429_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_14429_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *25. PERB16_DWP_16086*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16086_fish_ids)), newname = "PERB16_DWP_16086")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16086_fish_ids)), newname = "PGOD21_DWP_16086")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16086 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16086",
      GODSillyIDs = list("PGOD21_DWP_16086" = rownames(PGOD21_DWP_16086.gcl$counts)),
      HeartSillys = "PERB16_DWP_16086",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16086_best_match <- dup_check_results_DWP_16086 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16086 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16086_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16086 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16086_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16086 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16086_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16086_1stbest <- dup_check_results_DWP_16086 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16086_2ndbest <- dup_check_results_DWP_16086 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16086_top_2 <- rbind(dup_check_results_DWP_16086_1stbest, dup_check_results_DWP_16086_2ndbest))

ggplot(data = dup_check_results_DWP_16086_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_16086_pass <- dup_check_results_DWP_16086_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_16086_pass)
length(unique(dup_check_results_DWP_16086_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16086_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_16086_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *26. PERB16_DWP_16090*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16090_fish_ids)), newname = "PERB16_DWP_16090")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16090_fish_ids)), newname = "PGOD21_DWP_16090")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16090 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16090",
      GODSillyIDs = list("PGOD21_DWP_16090" = rownames(PGOD21_DWP_16090.gcl$counts)),
      HeartSillys = "PERB16_DWP_16090",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16090_best_match <- dup_check_results_DWP_16090 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16090 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16090_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16090 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16090_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16090 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16090_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16090_1stbest <- dup_check_results_DWP_16090 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16090_2ndbest <- dup_check_results_DWP_16090 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16090_top_2 <- rbind(dup_check_results_DWP_16090_1stbest, dup_check_results_DWP_16090_2ndbest))

ggplot(data = dup_check_results_DWP_16090_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16090_pass <- dup_check_results_DWP_16090_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16090_pass)
length(unique(dup_check_results_DWP_16090_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16090_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_16090_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *27. PERB16_DWP_16092*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16092_fish_ids)), newname = "PERB16_DWP_16092")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16092_fish_ids)), newname = "PGOD21_DWP_16092")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16092 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16092",
      GODSillyIDs = list("PGOD21_DWP_16092" = rownames(PGOD21_DWP_16092.gcl$counts)),
      HeartSillys = "PERB16_DWP_16092",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16092_best_match <- dup_check_results_DWP_16092 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16092 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16092_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16092 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16092_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16092 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16092_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16092_1stbest <- dup_check_results_DWP_16092 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16092_2ndbest <- dup_check_results_DWP_16092 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16092_top_2 <- rbind(dup_check_results_DWP_16092_1stbest, dup_check_results_DWP_16092_2ndbest))

ggplot(data = dup_check_results_DWP_16092_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16092_pass <- dup_check_results_DWP_16092_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16092_pass)
length(unique(dup_check_results_DWP_16092_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16092_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_16092_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *28. PERB16_DWP_16095*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16095_fish_ids)), newname = "PERB16_DWP_16095")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16095_fish_ids)), newname = "PGOD21_DWP_16095")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16095 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16095",
      GODSillyIDs = list("PGOD21_DWP_16095" = rownames(PGOD21_DWP_16095.gcl$counts)),
      HeartSillys = "PERB16_DWP_16095",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16095_best_match <- dup_check_results_DWP_16095 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16095 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16095_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16095 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16095_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16095 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16095_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16095_1stbest <- dup_check_results_DWP_16095 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16095_2ndbest <- dup_check_results_DWP_16095 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16095_top_2 <- rbind(dup_check_results_DWP_16095_1stbest, dup_check_results_DWP_16095_2ndbest))

ggplot(data = dup_check_results_DWP_16095_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16095_pass <- dup_check_results_DWP_16095_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16095_pass)
length(unique(dup_check_results_DWP_16095_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16095_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16095_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *29. PERB16_DWP_16096*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16096_fish_ids)), newname = "PERB16_DWP_16096")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16096_fish_ids)), newname = "PGOD21_DWP_16096")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16096 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16096",
      GODSillyIDs = list("PGOD21_DWP_16096" = rownames(PGOD21_DWP_16096.gcl$counts)),
      HeartSillys = "PERB16_DWP_16096",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16096_best_match <- dup_check_results_DWP_16096 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16096 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16096_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16096 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16096_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16096 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16096_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16096_1stbest <- dup_check_results_DWP_16096 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16096_2ndbest <- dup_check_results_DWP_16096 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16096_top_2 <- rbind(dup_check_results_DWP_16096_1stbest, dup_check_results_DWP_16096_2ndbest))

ggplot(data = dup_check_results_DWP_16096_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16096_pass <- dup_check_results_DWP_16096_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16096_pass)
length(unique(dup_check_results_DWP_16096_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16096_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16096_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *30. PERB16_DWP_16097*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16097_fish_ids)), newname = "PERB16_DWP_16097")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16097_fish_ids)), newname = "PGOD21_DWP_16097")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16097 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16097",
      GODSillyIDs = list("PGOD21_DWP_16097" = rownames(PGOD21_DWP_16097.gcl$counts)),
      HeartSillys = "PERB16_DWP_16097",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16097_best_match <- dup_check_results_DWP_16097 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16097 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16097_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16097 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16097_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16097 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16097_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16097_1stbest <- dup_check_results_DWP_16097 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16097_2ndbest <- dup_check_results_DWP_16097 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16097_top_2 <- rbind(dup_check_results_DWP_16097_1stbest, dup_check_results_DWP_16097_2ndbest))

ggplot(data = dup_check_results_DWP_16097_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16097_pass <- dup_check_results_DWP_16097_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16097_pass)
length(unique(dup_check_results_DWP_16097_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16097_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16097_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *31. PERB16_DWP_16101*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16101_fish_ids)), newname = "PERB16_DWP_16101")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16101_fish_ids)), newname = "PGOD21_DWP_16101")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16101 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16101",
      GODSillyIDs = list("PGOD21_DWP_16101" = rownames(PGOD21_DWP_16101.gcl$counts)),
      HeartSillys = "PERB16_DWP_16101",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16101_best_match <- dup_check_results_DWP_16101 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16101 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16101_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16101 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16101_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16101 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16101_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16101_1stbest <- dup_check_results_DWP_16101 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16101_2ndbest <- dup_check_results_DWP_16101 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16101_top_2 <- rbind(dup_check_results_DWP_16101_1stbest, dup_check_results_DWP_16101_2ndbest))

ggplot(data = dup_check_results_DWP_16101_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16101_pass <- dup_check_results_DWP_16101_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16101_pass)
length(unique(dup_check_results_DWP_16101_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16101_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16101_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *32. PERB16_DWP_16117*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16117_fish_ids)), newname = "PERB16_DWP_16117")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16117_fish_ids)), newname = "PGOD21_DWP_16117")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16117 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16117",
      GODSillyIDs = list("PGOD21_DWP_16117" = rownames(PGOD21_DWP_16117.gcl$counts)),
      HeartSillys = "PERB16_DWP_16117",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16117_best_match <- dup_check_results_DWP_16117 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16117 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16117_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16117 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16117_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16117 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16117_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16117_1stbest <- dup_check_results_DWP_16117 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16117_2ndbest <- dup_check_results_DWP_16117 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16117_top_2 <- rbind(dup_check_results_DWP_16117_1stbest, dup_check_results_DWP_16117_2ndbest))

ggplot(data = dup_check_results_DWP_16117_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16117_pass <- dup_check_results_DWP_16117_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16117_pass)
length(unique(dup_check_results_DWP_16117_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16117_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16117_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *33. PERB16_DWP_16118*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16118_fish_ids)), newname = "PERB16_DWP_16118")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16118_fish_ids)), newname = "PGOD21_DWP_16118")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16118 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16118",
      GODSillyIDs = list("PGOD21_DWP_16118" = rownames(PGOD21_DWP_16118.gcl$counts)),
      HeartSillys = "PERB16_DWP_16118",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16118_best_match <- dup_check_results_DWP_16118 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16118 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16118_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16118 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16118_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16118 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16118_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16118_1stbest <- dup_check_results_DWP_16118 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16118_2ndbest <- dup_check_results_DWP_16118 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16118_top_2 <- rbind(dup_check_results_DWP_16118_1stbest, dup_check_results_DWP_16118_2ndbest))

ggplot(data = dup_check_results_DWP_16118_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16118_pass <- dup_check_results_DWP_16118_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16118_pass)
length(unique(dup_check_results_DWP_16118_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16118_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16118_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *34. PERB16_DWP_16120*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16120_fish_ids)), newname = "PERB16_DWP_16120")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16120_fish_ids)), newname = "PGOD21_DWP_16120")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16120 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16120",
      GODSillyIDs = list("PGOD21_DWP_16120" = rownames(PGOD21_DWP_16120.gcl$counts)),
      HeartSillys = "PERB16_DWP_16120",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16120_best_match <- dup_check_results_DWP_16120 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16120 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16120_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16120 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16120_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16120 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16120_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16120_1stbest <- dup_check_results_DWP_16120 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16120_2ndbest <- dup_check_results_DWP_16120 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16120_top_2 <- rbind(dup_check_results_DWP_16120_1stbest, dup_check_results_DWP_16120_2ndbest))

ggplot(data = dup_check_results_DWP_16120_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16120_pass <- dup_check_results_DWP_16120_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16120_pass)
length(unique(dup_check_results_DWP_16120_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16120_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16120_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *35. PERB16_DWP_16121*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16121_fish_ids)), newname = "PERB16_DWP_16121")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16121_fish_ids)), newname = "PGOD21_DWP_16121")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16121 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16121",
      GODSillyIDs = list("PGOD21_DWP_16121" = rownames(PGOD21_DWP_16121.gcl$counts)),
      HeartSillys = "PERB16_DWP_16121",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16121_best_match <- dup_check_results_DWP_16121 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16121 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16121_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16121 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16121_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16121 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16121_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16121_1stbest <- dup_check_results_DWP_16121 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16121_2ndbest <- dup_check_results_DWP_16121 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16121_top_2 <- rbind(dup_check_results_DWP_16121_1stbest, dup_check_results_DWP_16121_2ndbest))

ggplot(data = dup_check_results_DWP_16121_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_16121_pass <- dup_check_results_DWP_16121_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_16121_pass)
length(unique(dup_check_results_DWP_16121_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16121_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16121_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *36. PERB16_DWP_16122*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16122_fish_ids)), newname = "PERB16_DWP_16122")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16122_fish_ids)), newname = "PGOD21_DWP_16122")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16122 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16122",
      GODSillyIDs = list("PGOD21_DWP_16122" = rownames(PGOD21_DWP_16122.gcl$counts)),
      HeartSillys = "PERB16_DWP_16122",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16122_best_match <- dup_check_results_DWP_16122 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16122 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16122_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16122 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16122_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16122 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16122_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16122_1stbest <- dup_check_results_DWP_16122 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16122_2ndbest <- dup_check_results_DWP_16122 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16122_top_2 <- rbind(dup_check_results_DWP_16122_1stbest, dup_check_results_DWP_16122_2ndbest))

ggplot(data = dup_check_results_DWP_16122_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16122_pass <- dup_check_results_DWP_16122_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16122_pass)
length(unique(dup_check_results_DWP_16122_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16122_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16122_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *37. PERB16_DWP_16136*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16136_fish_ids)), newname = "PERB16_DWP_16136")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16136_fish_ids)), newname = "PGOD21_DWP_16136")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16136 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16136",
      GODSillyIDs = list("PGOD21_DWP_16136" = rownames(PGOD21_DWP_16136.gcl$counts)),
      HeartSillys = "PERB16_DWP_16136",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16136_best_match <- dup_check_results_DWP_16136 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16136 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16136_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16136 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16136_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16136 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16136_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16136_1stbest <- dup_check_results_DWP_16136 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16136_2ndbest <- dup_check_results_DWP_16136 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16136_top_2 <- rbind(dup_check_results_DWP_16136_1stbest, dup_check_results_DWP_16136_2ndbest))

ggplot(data = dup_check_results_DWP_16136_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16136_pass <- dup_check_results_DWP_16136_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16136_pass)
length(unique(dup_check_results_DWP_16136_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16136_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16136_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *38. PERB16_DWP_16144*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16144_fish_ids)), newname = "PERB16_DWP_16144")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16144_fish_ids)), newname = "PGOD21_DWP_16144")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16144 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16144",
      GODSillyIDs = list("PGOD21_DWP_16144" = rownames(PGOD21_DWP_16144.gcl$counts)),
      HeartSillys = "PERB16_DWP_16144",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16144_best_match <- dup_check_results_DWP_16144 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16144 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16144_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16144 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16144_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16144 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16144_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16144_1stbest <- dup_check_results_DWP_16144 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16144_2ndbest <- dup_check_results_DWP_16144 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16144_top_2 <- rbind(dup_check_results_DWP_16144_1stbest, dup_check_results_DWP_16144_2ndbest))

ggplot(data = dup_check_results_DWP_16144_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16144_pass <- dup_check_results_DWP_16144_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16144_pass)
length(unique(dup_check_results_DWP_16144_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16144_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16144_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *39. PERB16_DWP_16147*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16147_fish_ids)), newname = "PERB16_DWP_16147")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16147_fish_ids)), newname = "PGOD21_DWP_16147")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16147 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16147",
      GODSillyIDs = list("PGOD21_DWP_16147" = rownames(PGOD21_DWP_16147.gcl$counts)),
      HeartSillys = "PERB16_DWP_16147",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16147_best_match <- dup_check_results_DWP_16147 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16147 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16147_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16147 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16147_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16147 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16147_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16147_1stbest <- dup_check_results_DWP_16147 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16147_2ndbest <- dup_check_results_DWP_16147 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16147_top_2 <- rbind(dup_check_results_DWP_16147_1stbest, dup_check_results_DWP_16147_2ndbest))

ggplot(data = dup_check_results_DWP_16147_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16147_pass <- dup_check_results_DWP_16147_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16147_pass)
length(unique(dup_check_results_DWP_16147_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16147_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16147_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *40. PERB16_DWP_16174*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16174_fish_ids)), newname = "PERB16_DWP_16174")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16174_fish_ids)), newname = "PGOD21_DWP_16174")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16174 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16174",
      GODSillyIDs = list("PGOD21_DWP_16174" = rownames(PGOD21_DWP_16174.gcl$counts)),
      HeartSillys = "PERB16_DWP_16174",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16174_best_match <- dup_check_results_DWP_16174 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16174 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16174_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16174 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16174_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16174 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16174_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16174_1stbest <- dup_check_results_DWP_16174 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16174_2ndbest <- dup_check_results_DWP_16174 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16174_top_2 <- rbind(dup_check_results_DWP_16174_1stbest, dup_check_results_DWP_16174_2ndbest))

ggplot(data = dup_check_results_DWP_16174_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16174_pass <- dup_check_results_DWP_16174_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16174_pass)
length(unique(dup_check_results_DWP_16174_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16174_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16174_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### ###############**PGILMOUR15**###############

#### *11. PGILMOUR15_DWP_2071*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2071_fish_ids)), newname = "PGILMOUR15_DWP_2071")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2071_fish_ids)), newname = "PGOD21_DWP_2071")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2071 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2071",
      GODSillyIDs = list("PGOD21_DWP_2071" = rownames(PGOD21_DWP_2071.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2071",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2071_best_match <- dup_check_results_DWP_2071 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2071 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2071_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2071 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2071_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2071 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2071_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2071_1stbest <- dup_check_results_DWP_2071 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2071_2ndbest <- dup_check_results_DWP_2071 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2071_top_2 <- rbind(dup_check_results_DWP_2071_1stbest, dup_check_results_DWP_2071_2ndbest))

ggplot(data = dup_check_results_DWP_2071_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.8 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_2071_pass <- dup_check_results_DWP_2071_1stbest %>% 
  filter(duplicate_rate >= 0.8) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_2071_pass)
length(unique(dup_check_results_DWP_2071_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2071_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
write.table(dup_check_results_DWP_2071_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *12. PGILMOUR15_DWP_2081*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2081_fish_ids)), newname = "PGILMOUR15_DWP_2081")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2081_fish_ids)), newname = "PGOD21_DWP_2081")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2081 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2081",
      GODSillyIDs = list("PGOD21_DWP_2081" = rownames(PGOD21_DWP_2081.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2081",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2081_best_match <- dup_check_results_DWP_2081 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2081 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2081_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2081 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2081_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2081 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2081_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2081_1stbest <- dup_check_results_DWP_2081 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2081_2ndbest <- dup_check_results_DWP_2081 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2081_top_2 <- rbind(dup_check_results_DWP_2081_1stbest, dup_check_results_DWP_2081_2ndbest))

ggplot(data = dup_check_results_DWP_2081_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2081_pass <- dup_check_results_DWP_2081_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2081_pass)
length(unique(dup_check_results_DWP_2081_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2081_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_2081_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *13. PGILMOUR15_DWP_2124*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2124_fish_ids)), newname = "PGILMOUR15_DWP_2124")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2124_fish_ids)), newname = "PGOD21_DWP_2124")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2124 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2124",
      GODSillyIDs = list("PGOD21_DWP_2124" = rownames(PGOD21_DWP_2124.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2124",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2124_best_match <- dup_check_results_DWP_2124 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2124 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2124_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2124 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2124_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2124 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2124_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2124_1stbest <- dup_check_results_DWP_2124 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2124_2ndbest <- dup_check_results_DWP_2124 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2124_top_2 <- rbind(dup_check_results_DWP_2124_1stbest, dup_check_results_DWP_2124_2ndbest))

ggplot(data = dup_check_results_DWP_2124_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2124_pass <- dup_check_results_DWP_2124_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2124_pass)
length(unique(dup_check_results_DWP_2124_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2124_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2124_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *14. PGILMOUR15_DWP_2125*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2125_fish_ids)), newname = "PGILMOUR15_DWP_2125")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2125_fish_ids)), newname = "PGOD21_DWP_2125")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2125 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2125",
      GODSillyIDs = list("PGOD21_DWP_2125" = rownames(PGOD21_DWP_2125.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2125",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2125_best_match <- dup_check_results_DWP_2125 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2125 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2125_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2125 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2125_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2125 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2125_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2125_1stbest <- dup_check_results_DWP_2125 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2125_2ndbest <- dup_check_results_DWP_2125 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2125_top_2 <- rbind(dup_check_results_DWP_2125_1stbest, dup_check_results_DWP_2125_2ndbest))

ggplot(data = dup_check_results_DWP_2125_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2125_pass <- dup_check_results_DWP_2125_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2125_pass)
length(unique(dup_check_results_DWP_2125_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2125_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2125_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *15. PGILMOUR15_DWP_2127*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2127_fish_ids)), newname = "PGILMOUR15_DWP_2127")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2127_fish_ids)), newname = "PGOD21_DWP_2127")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2127 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2127",
      GODSillyIDs = list("PGOD21_DWP_2127" = rownames(PGOD21_DWP_2127.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2127",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2127_best_match <- dup_check_results_DWP_2127 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2127 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2127_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2127 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2127_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2127 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2127_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2127_1stbest <- dup_check_results_DWP_2127 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2127_2ndbest <- dup_check_results_DWP_2127 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2127_top_2 <- rbind(dup_check_results_DWP_2127_1stbest, dup_check_results_DWP_2127_2ndbest))

ggplot(data = dup_check_results_DWP_2127_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2127_pass <- dup_check_results_DWP_2127_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2127_pass)
length(unique(dup_check_results_DWP_2127_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2127_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2127_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *16. PGILMOUR15_DWP_2160*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2160_fish_ids)), newname = "PGILMOUR15_DWP_2160")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2160_fish_ids)), newname = "PGOD21_DWP_2160")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2160 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2160",
      GODSillyIDs = list("PGOD21_DWP_2160" = rownames(PGOD21_DWP_2160.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2160",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2160_best_match <- dup_check_results_DWP_2160 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2160 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2160_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2160 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2160_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2160 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2160_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2160_1stbest <- dup_check_results_DWP_2160 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2160_2ndbest <- dup_check_results_DWP_2160 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2160_top_2 <- rbind(dup_check_results_DWP_2160_1stbest, dup_check_results_DWP_2160_2ndbest))

ggplot(data = dup_check_results_DWP_2160_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2160_pass <- dup_check_results_DWP_2160_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2160_pass)
length(unique(dup_check_results_DWP_2160_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2160_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_2160_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *17. PGILMOUR15_DWP_2162*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2162_fish_ids)), newname = "PGILMOUR15_DWP_2162")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2162_fish_ids)), newname = "PGOD21_DWP_2162")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2162 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2162",
      GODSillyIDs = list("PGOD21_DWP_2162" = rownames(PGOD21_DWP_2162.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2162",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2162_best_match <- dup_check_results_DWP_2162 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2162 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2162_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2162 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2162_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2162 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2162_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2162_1stbest <- dup_check_results_DWP_2162 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2162_2ndbest <- dup_check_results_DWP_2162 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2162_top_2 <- rbind(dup_check_results_DWP_2162_1stbest, dup_check_results_DWP_2162_2ndbest))

ggplot(data = dup_check_results_DWP_2162_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2162_pass <- dup_check_results_DWP_2162_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2162_pass)
length(unique(dup_check_results_DWP_2162_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2162_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2162_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *18. PGILMOUR15_DWP_2193*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2193_fish_ids)), newname = "PGILMOUR15_DWP_2193")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2193_fish_ids)), newname = "PGOD21_DWP_2193")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2193 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2193",
      GODSillyIDs = list("PGOD21_DWP_2193" = rownames(PGOD21_DWP_2193.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2193",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2193_best_match <- dup_check_results_DWP_2193 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2193 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2193_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2193 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2193_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2193 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2193_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2193_1stbest <- dup_check_results_DWP_2193 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2193_2ndbest <- dup_check_results_DWP_2193 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2193_top_2 <- rbind(dup_check_results_DWP_2193_1stbest, dup_check_results_DWP_2193_2ndbest))

ggplot(data = dup_check_results_DWP_2193_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_2193_pass <- dup_check_results_DWP_2193_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_2193_pass)
length(unique(dup_check_results_DWP_2193_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2193_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
write.table(dup_check_results_DWP_2193_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *19. PGILMOUR15_DWP_2197*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2197_fish_ids)), newname = "PGILMOUR15_DWP_2197")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2197_fish_ids)), newname = "PGOD21_DWP_2197")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2197 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2197",
      GODSillyIDs = list("PGOD21_DWP_2197" = rownames(PGOD21_DWP_2197.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2197",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2197_best_match <- dup_check_results_DWP_2197 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2197 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2197_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2197 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2197_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2197 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2197_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2197_1stbest <- dup_check_results_DWP_2197 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2197_2ndbest <- dup_check_results_DWP_2197 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2197_top_2 <- rbind(dup_check_results_DWP_2197_1stbest, dup_check_results_DWP_2197_2ndbest))

ggplot(data = dup_check_results_DWP_2197_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2197_pass <- dup_check_results_DWP_2197_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2197_pass)
length(unique(dup_check_results_DWP_2197_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2197_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2197_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *20. PGILMOUR15_DWP_2233*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2233_fish_ids)), newname = "PGILMOUR15_DWP_2233")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2233_fish_ids)), newname = "PGOD21_DWP_2233")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2233 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2233",
      GODSillyIDs = list("PGOD21_DWP_2233" = rownames(PGOD21_DWP_2233.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2233",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2233_best_match <- dup_check_results_DWP_2233 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2233 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2233_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2233 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2233_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2233 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2233_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2233_1stbest <- dup_check_results_DWP_2233 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2233_2ndbest <- dup_check_results_DWP_2233 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2233_top_2 <- rbind(dup_check_results_DWP_2233_1stbest, dup_check_results_DWP_2233_2ndbest))

ggplot(data = dup_check_results_DWP_2233_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2233_pass <- dup_check_results_DWP_2233_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2233_pass)
length(unique(dup_check_results_DWP_2233_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2233_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2233_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *21. PGILMOUR15_DWP_2236*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2236_fish_ids)), newname = "PGILMOUR15_DWP_2236")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2236_fish_ids)), newname = "PGOD21_DWP_2236")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2236 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2236",
      GODSillyIDs = list("PGOD21_DWP_2236" = rownames(PGOD21_DWP_2236.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2236",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2236_best_match <- dup_check_results_DWP_2236 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2236 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2236_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2236 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2236_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2236 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2236_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2236_1stbest <- dup_check_results_DWP_2236 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2236_2ndbest <- dup_check_results_DWP_2236 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2236_top_2 <- rbind(dup_check_results_DWP_2236_1stbest, dup_check_results_DWP_2236_2ndbest))

ggplot(data = dup_check_results_DWP_2236_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2236_pass <- dup_check_results_DWP_2236_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2236_pass)
length(unique(dup_check_results_DWP_2236_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2236_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2236_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *22. PGILMOUR15_DWP_2508*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2508_fish_ids)), newname = "PGILMOUR15_DWP_2508")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2508_fish_ids)), newname = "PGOD21_DWP_2508")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2508 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2508",
      GODSillyIDs = list("PGOD21_DWP_2508" = rownames(PGOD21_DWP_2508.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2508",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2508_best_match <- dup_check_results_DWP_2508 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2508 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2508_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2508 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2508_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2508 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2508_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2508_1stbest <- dup_check_results_DWP_2508 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2508_2ndbest <- dup_check_results_DWP_2508 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2508_top_2 <- rbind(dup_check_results_DWP_2508_1stbest, dup_check_results_DWP_2508_2ndbest))

ggplot(data = dup_check_results_DWP_2508_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2508_pass <- dup_check_results_DWP_2508_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2508_pass)
length(unique(dup_check_results_DWP_2508_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2508_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2508_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *23. PGILMOUR15_DWP_2837*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2837_fish_ids)), newname = "PGILMOUR15_DWP_2837")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2837_fish_ids)), newname = "PGOD21_DWP_2837")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2837 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2837",
      GODSillyIDs = list("PGOD21_DWP_2837" = rownames(PGOD21_DWP_2837.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2837",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2837_best_match <- dup_check_results_DWP_2837 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2837 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2837_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2837 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2837_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2837 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2837_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2837_1stbest <- dup_check_results_DWP_2837 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2837_2ndbest <- dup_check_results_DWP_2837 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2837_top_2 <- rbind(dup_check_results_DWP_2837_1stbest, dup_check_results_DWP_2837_2ndbest))

ggplot(data = dup_check_results_DWP_2837_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2837_pass <- dup_check_results_DWP_2837_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2837_pass)
length(unique(dup_check_results_DWP_2837_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2837_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2837_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *24. PGILMOUR15_DWP_2926*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2926_fish_ids)), newname = "PGILMOUR15_DWP_2926")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2926_fish_ids)), newname = "PGOD21_DWP_2926")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2926 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2926",
      GODSillyIDs = list("PGOD21_DWP_2926" = rownames(PGOD21_DWP_2926.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2926",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2926_best_match <- dup_check_results_DWP_2926 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2926 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2926_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2926 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2926_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2926 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2926_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2926_1stbest <- dup_check_results_DWP_2926 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2926_2ndbest <- dup_check_results_DWP_2926 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2926_top_2 <- rbind(dup_check_results_DWP_2926_1stbest, dup_check_results_DWP_2926_2ndbest))

ggplot(data = dup_check_results_DWP_2926_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2926_pass <- dup_check_results_DWP_2926_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2926_pass)
length(unique(dup_check_results_DWP_2926_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2926_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2926_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *25. PGILMOUR15_DWP_2927*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2927_fish_ids)), newname = "PGILMOUR15_DWP_2927")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2927_fish_ids)), newname = "PGOD21_DWP_2927")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2927 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2927",
      GODSillyIDs = list("PGOD21_DWP_2927" = rownames(PGOD21_DWP_2927.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2927",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2927_best_match <- dup_check_results_DWP_2927 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2927 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2927_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2927 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2927_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2927 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2927_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2927_1stbest <- dup_check_results_DWP_2927 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2927_2ndbest <- dup_check_results_DWP_2927 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2927_top_2 <- rbind(dup_check_results_DWP_2927_1stbest, dup_check_results_DWP_2927_2ndbest))

ggplot(data = dup_check_results_DWP_2927_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2927_pass <- dup_check_results_DWP_2927_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2927_pass)
length(unique(dup_check_results_DWP_2927_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2927_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2927_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *26. PGILMOUR15_DWP_2930*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2930_fish_ids)), newname = "PGILMOUR15_DWP_2930")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2930_fish_ids)), newname = "PGOD21_DWP_2930")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2930 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2930",
      GODSillyIDs = list("PGOD21_DWP_2930" = rownames(PGOD21_DWP_2930.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2930",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2930_best_match <- dup_check_results_DWP_2930 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2930 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2930_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2930 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2930_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2930 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2930_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2930_1stbest <- dup_check_results_DWP_2930 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2930_2ndbest <- dup_check_results_DWP_2930 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2930_top_2 <- rbind(dup_check_results_DWP_2930_1stbest, dup_check_results_DWP_2930_2ndbest))

ggplot(data = dup_check_results_DWP_2930_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2930_pass <- dup_check_results_DWP_2930_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2930_pass)
length(unique(dup_check_results_DWP_2930_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2930_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2930_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *27. PGILMOUR15_DWP_2932*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2932_fish_ids)), newname = "PGILMOUR15_DWP_2932")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2932_fish_ids)), newname = "PGOD21_DWP_2932")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2932 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2932",
      GODSillyIDs = list("PGOD21_DWP_2932" = rownames(PGOD21_DWP_2932.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2932",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2932_best_match <- dup_check_results_DWP_2932 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2932 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2932_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2932 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2932_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2932 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2932_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2932_1stbest <- dup_check_results_DWP_2932 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2932_2ndbest <- dup_check_results_DWP_2932 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2932_top_2 <- rbind(dup_check_results_DWP_2932_1stbest, dup_check_results_DWP_2932_2ndbest))

ggplot(data = dup_check_results_DWP_2932_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2932_pass <- dup_check_results_DWP_2932_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2932_pass)
length(unique(dup_check_results_DWP_2932_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2932_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2932_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### ###############**PGILMOUR16**###############

#### *14. PGILMOUR16_DWP_14528*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14528_fish_ids)), newname = "PGILMOUR16_DWP_14528")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14528_fish_ids)), newname = "PGOD21_DWP_14528")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14528 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14528",
      GODSillyIDs = list("PGOD21_DWP_14528" = rownames(PGOD21_DWP_14528.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14528",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14528_best_match <- dup_check_results_DWP_14528 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14528 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14528_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14528 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14528_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14528 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14528_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14528_1stbest <- dup_check_results_DWP_14528 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14528_2ndbest <- dup_check_results_DWP_14528 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14528_top_2 <- rbind(dup_check_results_DWP_14528_1stbest, dup_check_results_DWP_14528_2ndbest))

ggplot(data = dup_check_results_DWP_14528_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14528_pass <- dup_check_results_DWP_14528_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14528_pass)
length(unique(dup_check_results_DWP_14528_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14528_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14528_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *15. PGILMOUR16_DWP_14576*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14576_fish_ids)), newname = "PGILMOUR16_DWP_14576")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14576_fish_ids)), newname = "PGOD21_DWP_14576")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14576 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14576",
      GODSillyIDs = list("PGOD21_DWP_14576" = rownames(PGOD21_DWP_14576.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14576",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14576_best_match <- dup_check_results_DWP_14576 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14576 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14576_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14576 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14576_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14576 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14576_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14576_1stbest <- dup_check_results_DWP_14576 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14576_2ndbest <- dup_check_results_DWP_14576 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14576_top_2 <- rbind(dup_check_results_DWP_14576_1stbest, dup_check_results_DWP_14576_2ndbest))

ggplot(data = dup_check_results_DWP_14576_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14576_pass <- dup_check_results_DWP_14576_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14576_pass)
length(unique(dup_check_results_DWP_14576_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14576_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14576_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *16. PGILMOUR16_DWP_14603*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14603_fish_ids)), newname = "PGILMOUR16_DWP_14603")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14603_fish_ids)), newname = "PGOD21_DWP_14603")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14603 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14603",
      GODSillyIDs = list("PGOD21_DWP_14603" = rownames(PGOD21_DWP_14603.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14603",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14603_best_match <- dup_check_results_DWP_14603 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14603 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14603_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14603 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14603_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14603 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14603_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14603_1stbest <- dup_check_results_DWP_14603 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14603_2ndbest <- dup_check_results_DWP_14603 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14603_top_2 <- rbind(dup_check_results_DWP_14603_1stbest, dup_check_results_DWP_14603_2ndbest))

ggplot(data = dup_check_results_DWP_14603_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14603_pass <- dup_check_results_DWP_14603_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14603_pass)
length(unique(dup_check_results_DWP_14603_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14603_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14603_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *17. PGILMOUR16_DWP_14657* 

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14657_fish_ids)), newname = "PGILMOUR16_DWP_14657")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14657_fish_ids)), newname = "PGOD21_DWP_14657")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14657 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14657",
      GODSillyIDs = list("PGOD21_DWP_14657" = rownames(PGOD21_DWP_14657.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14657",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14657_best_match <- dup_check_results_DWP_14657 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14657 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14657_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14657 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14657_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14657 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14657_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14657_1stbest <- dup_check_results_DWP_14657 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14657_2ndbest <- dup_check_results_DWP_14657 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14657_top_2 <- rbind(dup_check_results_DWP_14657_1stbest, dup_check_results_DWP_14657_2ndbest))

ggplot(data = dup_check_results_DWP_14657_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14657_pass <- dup_check_results_DWP_14657_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14657_pass)
length(unique(dup_check_results_DWP_14657_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14657_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14657_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *18. PGILMOUR16_DWP_14659* 

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14659_fish_ids)), newname = "PGILMOUR16_DWP_14659")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14659_fish_ids)), newname = "PGOD21_DWP_14659")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14659 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14659",
      GODSillyIDs = list("PGOD21_DWP_14659" = rownames(PGOD21_DWP_14659.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14659",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14659_best_match <- dup_check_results_DWP_14659 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14659 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14659_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14659 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14659_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14659 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14659_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14659_1stbest <- dup_check_results_DWP_14659 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14659_2ndbest <- dup_check_results_DWP_14659 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14659_top_2 <- rbind(dup_check_results_DWP_14659_1stbest, dup_check_results_DWP_14659_2ndbest))

ggplot(data = dup_check_results_DWP_14659_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14659_pass <- dup_check_results_DWP_14659_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14659_pass)
length(unique(dup_check_results_DWP_14659_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14659_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14659_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *19. PGILMOUR16_DWP_14676*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14676_fish_ids)), newname = "PGILMOUR16_DWP_14676")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14676_fish_ids)), newname = "PGOD21_DWP_14676")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14676 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14676",
      GODSillyIDs = list("PGOD21_DWP_14676" = rownames(PGOD21_DWP_14676.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14676",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14676_best_match <- dup_check_results_DWP_14676 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14676 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14676_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14676 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14676_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14676 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14676_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14676_1stbest <- dup_check_results_DWP_14676 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14676_2ndbest <- dup_check_results_DWP_14676 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14676_top_2 <- rbind(dup_check_results_DWP_14676_1stbest, dup_check_results_DWP_14676_2ndbest))

ggplot(data = dup_check_results_DWP_14676_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14676_pass <- dup_check_results_DWP_14676_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14676_pass)
length(unique(dup_check_results_DWP_14676_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14676_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14676_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *20. PGILMOUR16_DWP_15801*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_15801_fish_ids)), newname = "PGILMOUR16_DWP_15801")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_15801_fish_ids)), newname = "PGOD21_DWP_15801")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_15801 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_15801",
      GODSillyIDs = list("PGOD21_DWP_15801" = rownames(PGOD21_DWP_15801.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_15801",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_15801_best_match <- dup_check_results_DWP_15801 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_15801 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15801_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_15801 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15801_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_15801 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_15801_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_15801_1stbest <- dup_check_results_DWP_15801 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_15801_2ndbest <- dup_check_results_DWP_15801 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_15801_top_2 <- rbind(dup_check_results_DWP_15801_1stbest, dup_check_results_DWP_15801_2ndbest))

ggplot(data = dup_check_results_DWP_15801_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_15801_pass <- dup_check_results_DWP_15801_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_15801_pass)
length(unique(dup_check_results_DWP_15801_pass$heart_fish_id))
length(unique(dup_check_results_DWP_15801_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_15801_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *21. PGILMOUR16_DWP_15802*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_15802_fish_ids)), newname = "PGILMOUR16_DWP_15802")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_15802_fish_ids)), newname = "PGOD21_DWP_15802")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_15802 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_15802",
      GODSillyIDs = list("PGOD21_DWP_15802" = rownames(PGOD21_DWP_15802.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_15802",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_15802_best_match <- dup_check_results_DWP_15802 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_15802 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15802_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_15802 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15802_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_15802 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_15802_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_15802_1stbest <- dup_check_results_DWP_15802 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_15802_2ndbest <- dup_check_results_DWP_15802 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_15802_top_2 <- rbind(dup_check_results_DWP_15802_1stbest, dup_check_results_DWP_15802_2ndbest))

ggplot(data = dup_check_results_DWP_15802_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_15802_pass <- dup_check_results_DWP_15802_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_15802_pass)
length(unique(dup_check_results_DWP_15802_pass$heart_fish_id))
length(unique(dup_check_results_DWP_15802_pass$otolith_fish_id))
```

##### Status: RERUN

```{r}
write.table(dup_check_results_DWP_15802_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### ###############**PGILMOUR17**###############

#### *16. PGILMOUR17_DWP_22465*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22465_fish_ids)), newname = "PGILMOUR17_DWP_22465")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22465_fish_ids)), newname = "PGOD21_DWP_22465")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22465 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22465",
      GODSillyIDs = list("PGOD21_DWP_22465" = rownames(PGOD21_DWP_22465.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22465",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22465_best_match <- dup_check_results_DWP_22465 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22465 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22465_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22465 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22465_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22465 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22465_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22465_1stbest <- dup_check_results_DWP_22465 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22465_2ndbest <- dup_check_results_DWP_22465 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22465_top_2 <- rbind(dup_check_results_DWP_22465_1stbest, dup_check_results_DWP_22465_2ndbest))

ggplot(data = dup_check_results_DWP_22465_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22465_pass <- dup_check_results_DWP_22465_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22465_pass)
length(unique(dup_check_results_DWP_22465_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22465_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22465_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *17. PGILMOUR17_DWP_22516*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22516_fish_ids)), newname = "PGILMOUR17_DWP_22516")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22516_fish_ids)), newname = "PGOD21_DWP_22516")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22516 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22516",
      GODSillyIDs = list("PGOD21_DWP_22516" = rownames(PGOD21_DWP_22516.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22516",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22516_best_match <- dup_check_results_DWP_22516 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22516 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22516_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22516 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22516_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22516 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22516_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22516_1stbest <- dup_check_results_DWP_22516 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22516_2ndbest <- dup_check_results_DWP_22516 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22516_top_2 <- rbind(dup_check_results_DWP_22516_1stbest, dup_check_results_DWP_22516_2ndbest))

ggplot(data = dup_check_results_DWP_22516_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22516_pass <- dup_check_results_DWP_22516_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22516_pass)
length(unique(dup_check_results_DWP_22516_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22516_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22516_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *18. PGILMOUR17_DWP_22601*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22601_fish_ids)), newname = "PGILMOUR17_DWP_22601")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22601_fish_ids)), newname = "PGOD21_DWP_22601")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22601 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22601",
      GODSillyIDs = list("PGOD21_DWP_22601" = rownames(PGOD21_DWP_22601.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22601",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22601_best_match <- dup_check_results_DWP_22601 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22601 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22601_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22601 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22601_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22601 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22601_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22601_1stbest <- dup_check_results_DWP_22601 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22601_2ndbest <- dup_check_results_DWP_22601 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22601_top_2 <- rbind(dup_check_results_DWP_22601_1stbest, dup_check_results_DWP_22601_2ndbest))

ggplot(data = dup_check_results_DWP_22601_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22601_pass <- dup_check_results_DWP_22601_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22601_pass)
length(unique(dup_check_results_DWP_22601_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22601_pass$otolith_fish_id))
```

##### Purge multi-matching otos

```{r}
# dup_check_results_DWP_22601_pass_dup <- dup_check_results_DWP_22601_pass[duplicated(dup_check_results_DWP_22601_pass$otolith_fish_id), ]
# dup_check_results_DWP_22601_pass_dup <- dup_check_results_DWP_22601_pass_dup$otolith_fish_id
# 
# (dup_check_results_DWP_22601_pass_purged <- dup_check_results_DWP_22601_pass[!(dup_check_results_DWP_22601_pass$otolith_fish_id == dup_check_results_DWP_22601_pass_dup), ])
# 
# length(unique(dup_check_results_DWP_22601_pass_purged$otolith_fish_id)) == nrow(dup_check_results_DWP_22601_pass_purged)
```

##### Status: RERUN

```{r}
write.table(dup_check_results_DWP_22601_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *19. PGILMOUR17_DWP_22678*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22678_fish_ids)), newname = "PGILMOUR17_DWP_22678")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22678_fish_ids)), newname = "PGOD21_DWP_22678")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22678 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22678",
      GODSillyIDs = list("PGOD21_DWP_22678" = rownames(PGOD21_DWP_22678.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22678",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22678_best_match <- dup_check_results_DWP_22678 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22678 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22678_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22678 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22678_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22678 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22678_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22678_1stbest <- dup_check_results_DWP_22678 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22678_2ndbest <- dup_check_results_DWP_22678 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22678_top_2 <- rbind(dup_check_results_DWP_22678_1stbest, dup_check_results_DWP_22678_2ndbest))

ggplot(data = dup_check_results_DWP_22678_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22678_pass <- dup_check_results_DWP_22678_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22678_pass)
length(unique(dup_check_results_DWP_22678_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22678_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22678_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *20. PGILMOUR17_DWP_22720*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22720_fish_ids)), newname = "PGILMOUR17_DWP_22720")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22720_fish_ids)), newname = "PGOD21_DWP_22720")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22720 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22720",
      GODSillyIDs = list("PGOD21_DWP_22720" = rownames(PGOD21_DWP_22720.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22720",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22720_best_match <- dup_check_results_DWP_22720 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22720 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22720_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22720 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22720_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22720 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22720_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22720_1stbest <- dup_check_results_DWP_22720 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22720_2ndbest <- dup_check_results_DWP_22720 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22720_top_2 <- rbind(dup_check_results_DWP_22720_1stbest, dup_check_results_DWP_22720_2ndbest))

ggplot(data = dup_check_results_DWP_22720_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.25

```{r}
# filtered results table
(dup_check_results_DWP_22720_pass <- dup_check_results_DWP_22720_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.25))

# vector lengths
nrow(dup_check_results_DWP_22720_pass)
length(unique(dup_check_results_DWP_22720_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22720_pass$otolith_fish_id))
```

##### Status: RERUN

```{r}
write.table(dup_check_results_DWP_22720_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *21. PGILMOUR17_DWP_22745*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22745_fish_ids)), newname = "PGILMOUR17_DWP_22745")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22745_fish_ids)), newname = "PGOD21_DWP_22745")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22745 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22745",
      GODSillyIDs = list("PGOD21_DWP_22745" = rownames(PGOD21_DWP_22745.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22745",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22745_best_match <- dup_check_results_DWP_22745 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22745 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22745_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22745 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22745_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22745 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22745_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22745_1stbest <- dup_check_results_DWP_22745 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22745_2ndbest <- dup_check_results_DWP_22745 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22745_top_2 <- rbind(dup_check_results_DWP_22745_1stbest, dup_check_results_DWP_22745_2ndbest))

ggplot(data = dup_check_results_DWP_22745_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22745_pass <- dup_check_results_DWP_22745_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22745_pass)
length(unique(dup_check_results_DWP_22745_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22745_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22745_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### ###############**PPADDY16**###############

#### *6. PPADDY16_DWP_14408*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_14408_fish_ids)), newname = "PPADDY16_DWP_14408")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14408_fish_ids)), newname = "PGOD21_DWP_14408")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14408 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14408",
      GODSillyIDs = list("PGOD21_DWP_14408" = rownames(PGOD21_DWP_14408.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_14408",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14408_best_match <- dup_check_results_DWP_14408 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14408 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14408_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14408 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14408_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14408 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14408_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14408_1stbest <- dup_check_results_DWP_14408 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14408_2ndbest <- dup_check_results_DWP_14408 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14408_top_2 <- rbind(dup_check_results_DWP_14408_1stbest, dup_check_results_DWP_14408_2ndbest))

ggplot(data = dup_check_results_DWP_14408_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14408_pass <- dup_check_results_DWP_14408_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14408_pass)
length(unique(dup_check_results_DWP_14408_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14408_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14408_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *7. PPADDY16_DWP_16131*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_16131_fish_ids)), newname = "PPADDY16_DWP_16131")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16131_fish_ids)), newname = "PGOD21_DWP_16131")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16131 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16131",
      GODSillyIDs = list("PGOD21_DWP_16131" = rownames(PGOD21_DWP_16131.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_16131",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16131_best_match <- dup_check_results_DWP_16131 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16131 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16131_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16131 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16131_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16131 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16131_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16131_1stbest <- dup_check_results_DWP_16131 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16131_2ndbest <- dup_check_results_DWP_16131 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16131_top_2 <- rbind(dup_check_results_DWP_16131_1stbest, dup_check_results_DWP_16131_2ndbest))

ggplot(data = dup_check_results_DWP_16131_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16131_pass <- dup_check_results_DWP_16131_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16131_pass)
length(unique(dup_check_results_DWP_16131_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16131_pass$otolith_fish_id))
```

##### Status: 

```{r}
write.table(dup_check_results_DWP_16131_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### All passing

```{r}
# read in passing data, if all objects are not in your environment
# modify appended dup_check_results_pass.csv with text to columns, remove column 1 and extra headings
# save as new csv with descriptive name
dup_check_results_P066&P067_pass <- read_csv("dup_check_results_P066&P067_pass.csv")

# alternatively, use if all objects are available
dup_check_results_P066&P067_pass <- bind_rows(
  dup_check_results_DWP_14290_pass,
  dup_check_results_DWP_14307_pass,
  dup_check_results_DWP_14312_pass,
  dup_check_results_DWP_14326_pass,
  dup_check_results_DWP_14327_pass,
  dup_check_results_DWP_14330_pass,
  dup_check_results_DWP_14336_pass,
  dup_check_results_DWP_14354_pass,
  dup_check_results_DWP_14358_pass,
  dup_check_results_DWP_14367_pass,
  dup_check_results_DWP_14368_pass,
  dup_check_results_DWP_14394_pass,
  dup_check_results_DWP_14398_pass,
  dup_check_results_DWP_14402_pass,
  dup_check_results_DWP_14429_pass,
  dup_check_results_DWP_16086_pass,
  dup_check_results_DWP_16090_pass,
  dup_check_results_DWP_16092_pass,
  dup_check_results_DWP_16095_pass,
  dup_check_results_DWP_16096_pass,
  dup_check_results_DWP_16097_pass,
  dup_check_results_DWP_16101_pass,
  dup_check_results_DWP_16117_pass,
  dup_check_results_DWP_16118_pass,
  dup_check_results_DWP_16120_pass,
  dup_check_results_DWP_16121_pass,
  dup_check_results_DWP_16122_pass,
  dup_check_results_DWP_16136_pass,
  dup_check_results_DWP_16144_pass,
  dup_check_results_DWP_16147_pass,
  dup_check_results_DWP_16174_pass,
  dup_check_results_DWP_2071_pass,
  dup_check_results_DWP_2081_pass,
  dup_check_results_DWP_2124_pass,
  dup_check_results_DWP_2125_pass,
  dup_check_results_DWP_2127_pass,
  dup_check_results_DWP_2160_pass,
  dup_check_results_DWP_2162_pass,
  dup_check_results_DWP_2193_pass,
  dup_check_results_DWP_2197_pass,
  dup_check_results_DWP_2233_pass,
  dup_check_results_DWP_2236_pass,
  dup_check_results_DWP_2508_pass,
  dup_check_results_DWP_2837_pass,
  dup_check_results_DWP_2926_pass,
  dup_check_results_DWP_2927_pass,
  dup_check_results_DWP_2930_pass,
  dup_check_results_DWP_2932_pass,
  dup_check_results_DWP_14528_pass,
  dup_check_results_DWP_14576_pass,
  dup_check_results_DWP_14603_pass,
  dup_check_results_DWP_14657_pass,
  dup_check_results_DWP_14659_pass,
  dup_check_results_DWP_14676_pass,
  dup_check_results_DWP_15801_pass,
  dup_check_results_DWP_15802_pass,
  dup_check_results_DWP_22465_pass,
  dup_check_results_DWP_22516_pass,
  dup_check_results_DWP_22601_pass,
  dup_check_results_DWP_22678_pass,
  dup_check_results_DWP_22720_pass,
  dup_check_results_DWP_22745_pass,
  dup_check_results_DWP_14408_pass,
  dup_check_results_DWP_16131_pass)

write_csv(dup_check_results_P066&P067_pass, "dup_check_results_P066&P067_pass.csv")
```

```{r}
# read in the tray position and well code key
well_location_key <- read_csv("../../GOD/KEY_WELL_CODE_tray_posn_by_col.csv")

# join with original and jumbled DWP well info
oceanak_affected_DWP_wells <- oceanak_affected_DWPs %>% 
  select(c(SILLY_CODE, FISH_ID, DNA_TRAY_CODE, DNA_TRAY_WELL_CODE)) 
oceanak_affected_DWP_wells$heart_fish_id <- paste0(oceanak_affected_DWP_wells$SILLY_CODE, "_", oceanak_affected_DWP_wells$FISH_ID)

dup_check_results_P066&P067_pass_with_wells <- attributes_and_xfer_PGOD21 %>% 
  mutate(otolith_fish_id = SillySource) %>% 
  right_join(dup_check_results_P066&P067_pass, by = "otolith_fish_id") %>% 
  select(c(otolith_fish_id, `48_DWP_tray_barcode`, `48_DWP_tray_position`, heart_fish_id)) %>% 
  right_join(oceanak_affected_DWP_wells, by = "heart_fish_id") %>% 
  select(-c(SILLY_CODE, FISH_ID, DNA_TRAY_CODE)) %>% 
  inner_join(well_location_key, by = "DNA_TRAY_WELL_CODE") %>% 
  select(`48_DWP_tray_barcode`, heart_fish_id, OG_48_DWP_tray_position, otolith_fish_id, `48_DWP_tray_position`)

write_csv(dup_check_results_P066&P067_pass_with_wells, "dup_check_results_P066&P067_pass_with_wells.csv")
```


