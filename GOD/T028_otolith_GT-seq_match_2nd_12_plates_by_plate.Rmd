---
title: "PGOD21 otolith/OG SILLY heart GT-seq DWP-by-DWP matching: Live test of 2nd set of 12 96-well otolith transfer plates"
author: "Kristen Gruenthal and Kyle Shedd"
date: "24 January 2022"
output:
  html_notebook:
    theme: united
    toc: yes
editor_options: 
  chunk_output_type: inline
---
```{r}
rm(list=ls())
```

```{r setup, message=FALSE, results='hide'}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(DT)
library(abind)
bbind <- function(...) { abind(..., along = 3) }

source("~/R/Functions.GCL.R")
source("../../GOD/LOKI2R_ind.GCL.R")
source("../../GOD/DupCheckBetweenSillys_GOD.GCL.r")
```

# README 1/7/22 Kyle Shedd

Before we finalize these "matches", there are a few modifications that I'd like to make:  
  * we need a genotyping success threshold for otoliths, it doesn't have to be very high (likely ~5-10%), but we need something to weed out matches where we only have 5 loci for an otolith
  * we need to implement a heterozygosity filter for hearts, just like we do for parentage analysis, otherwise we'll end up with some very heterozygous heart genotypes that will match *very* well to our highly contaminated (read heterozygous) otoliths 

# Objective

The purpose of this notebook is to determine whether we can successfully re-pair GTseq genotypes from otolith-derived DNA with GT-seq genotypes from heart-derived DNA for individuals of unknown origin.

# Background

During shipment of otolith samples to the MTA in Juneau for reading, a significant proportion of otoliths migrated between cells within DWPs due to poor containment of the acetate lids that were attached with rubber bands to the DWPs. This incident is known as "the great otolith debacle", aka the "GOD" incident. Since some otoliths moved from their original cells in the DWP, the paired integrity of the otolith-origin information and the rest of the paired data (genotype + field data) was lost for many individuals. In an attempt to rectify the "GOD" incident, we are extracting DNA from the otolith tissues, genotyping the otolith-derived DNA at 298 GT-seq loci, and attempting to re-pair the otolith-heart samples from their genotypes.  

# Methods

DNA was extracted from left-side or unknown otolith tissues of unknown origin using conventional Machery-Nagel DNA extraction kits. Otoliths were placed in T1 buffer for an overnight soak in clear 96 shallow-well plates (SWP). Preamp at 14 cycles. Final elution volume was 75uL. All otoliths were transferred among plates with a jig. All liquid handling was done by robot.

```{r}
.username <- "kmgruenthal"
.password <- "Loki!"
```

## LocusControl

```{r}
TestSillys <- "PGOD21"

loci <- dget("../../Objects/loci298.txt") # saved list of loci

CreateLocusControl.GCL(locusnames = loci, username = .username, password = .password)
loci <- LocusControl$locusnames
nalleles <- LocusControl$nalleles
ploidy <- LocusControl$ploidy
alleles <- LocusControl$alleles

# change sillyvec as needed
LOKI2R.GCL(sillyvec = TestSillys, username = .username, password = .password)
```

```{r}
# create a csv from the otolith transfer spreadsheet from MTAL, read in the data, and create a concatenated tray and well column
# oto_xfer_data_042721 <- read_csv("otolith_transfer_042721.csv") # mod of MTAL submitted spreadsheet "otolith_transfer_96_template_LEFT_042721_FOR GCL.xlsx"
oto_xfer_data <- read_csv("otolith_transfer_012522.csv") # mod of MTAL submitted spreadsheet "otolith_transfer_96_template_LEFT_all trays_17Nov21.xlsx"
# oto_xfer_data_042721$DNA_TRAY_AND_WELL <- paste0(oto_xfer_data_042721$`96_oto_tray_barcode`, "_", oto_xfer_data_042721$`96_oto_tray_position`)
oto_xfer_data$DNA_TRAY_AND_WELL <- paste0(oto_xfer_data$`96_oto_tray_barcode`, "_", oto_xfer_data$`96_oto_tray_position`)
  
# download csv of PGOD21 sample data from OceanAK and append with _PGOD21_DATE
# oceanak_PGOD21 <- read_csv("GEN_SAMPLED_FISH_TISSUE_PGOD21_091721.csv")
oceanak_PGOD21 <- read_csv("GEN_SAMPLED_FISH_TISSUE_PGOD21_012422.csv")

# pull the attributes table from PGOD21.gcl, create a new tray a well column, and join with the otolith transfer data
attributes_PGOD21 <- PGOD21.gcl$attributes %>%
  transform(DNA_TRAY_CODE = as.numeric(DNA_TRAY_CODE))
attributes_PGOD21$DNA_TRAY_AND_WELL <- paste0(attributes_PGOD21$DNA_TRAY_CODE, "_", attributes_PGOD21$DNA_TRAY_WELL_CODE)
# attributes_and_xfer_PGOD21 <- left_join(attributes_PGOD21, oto_xfer_data_042721, by = "DNA_TRAY_AND_WELL")
attributes_and_xfer_PGOD21 <- left_join(attributes_PGOD21, oto_xfer_data, by = "DNA_TRAY_AND_WELL")

# get a list of the affected DWPs
affected_DWPs <- unique(attributes_and_xfer_PGOD21$`48_DWP_tray_barcode`)

# filter OceanAK data pull for the list of affected DWPs
AHRP_oceanak_pull <- read_csv(file = "../../OceanAK/AHRP Salmon Biological Data 20220124_151655.csv") %>% # do a new pull if latest date stamp is old
  transform(DNA_TRAY_CODE = as.numeric(DNA_TRAY_CODE))
oceanak_affected_DWPs <- AHRP_oceanak_pull[AHRP_oceanak_pull$DNA_TRAY_CODE %in% affected_DWPs, ]
write_csv(oceanak_affected_DWPs, "oceanak_affected_DWPs.csv")

# get SILLYs and fish IDs for affected DWPs
DWP_sillys <- unique(oceanak_affected_DWPs$SILLY_CODE)

DWP_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::select(SILLY_CODE, FISH_ID) 

PERB15_fish_ids <- DWP_fish_ids %>% 
  dplyr::filter(SILLY_CODE == "PERB15") %>% 
  pull(FISH_ID)
PERB16_fish_ids <- DWP_fish_ids %>% 
  dplyr::filter(SILLY_CODE == "PERB16") %>% 
  pull(FISH_ID)
PERB17_fish_ids <- DWP_fish_ids %>% 
  dplyr::filter(SILLY_CODE == "PERB17") %>% 
  pull(FISH_ID)
PERB18_fish_ids <- DWP_fish_ids %>% 
  dplyr::filter(SILLY_CODE == "PERB18") %>% 
  pull(FISH_ID)
PGILMOUR15_fish_ids <- DWP_fish_ids %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR15") %>% 
  pull(FISH_ID)
PGILMOUR16_fish_ids <- DWP_fish_ids %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR16") %>% 
 pull(FISH_ID)
PGILMOUR17_fish_ids <- DWP_fish_ids %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR17") %>% 
  pull(FISH_ID)
PGILMOUR18_fish_ids <- DWP_fish_ids %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR18") %>% 
  pull(FISH_ID)
PPADDY16_fish_ids <- DWP_fish_ids %>% 
  dplyr::filter(SILLY_CODE == "PPADDY16") %>% 
  pull(FISH_ID)
PPADDY18_fish_ids <- DWP_fish_ids %>% 
  dplyr::filter(SILLY_CODE == "PPADDY18") %>% 
  pull(FISH_ID)

# Project SILLYs by individuals in a SILLY per affected DWP
# Comment out those that have empty fish_ids above and SILLYs whose hearts haven't been genotyped yet (e.g., PERB15 and PERB17)

# PERB15 <- "PERB15"
# LOKI2R_ind.GCL(sillyvec = PERB15, fish_ids = PERB15_fish_ids, username = .username, password = .password)

PERB16 <- "PERB16"
LOKI2R_ind.GCL(sillyvec = PERB16, fish_ids = PERB16_fish_ids, username = .username, password = .password)

# PERB17 <- "PERB17"
# LOKI2R_ind.GCL(sillyvec = PERB17, fish_ids = PERB17_fish_ids, username = .username, password = .password)

# PERB18 <- "PERB18"
# LOKI2R_ind.GCL(sillyvec = PERB18, fish_ids = PERB18_fish_ids, username = .username, password = .password)

PGILMOUR15 <- "PGILMOUR15"
LOKI2R_ind.GCL(sillyvec = PGILMOUR15, fish_ids = PGILMOUR15_fish_ids, username = .username, password = .password)

PGILMOUR16 <- "PGILMOUR16"
LOKI2R_ind.GCL(sillyvec = PGILMOUR16, fish_ids = PGILMOUR16_fish_ids, username = .username, password = .password)

PGILMOUR17 <- "PGILMOUR17"
LOKI2R_ind.GCL(sillyvec = PGILMOUR17, fish_ids = PGILMOUR17_fish_ids, username = .username, password = .password)

PGILMOUR18 <- "PGILMOUR18"
LOKI2R_ind.GCL(sillyvec = PGILMOUR18, fish_ids = PGILMOUR18_fish_ids, username = .username, password = .password)

PPADDY16 <- "PPADDY16"
LOKI2R_ind.GCL(sillyvec = PPADDY16, fish_ids = PPADDY16_fish_ids, username = .username, password = .password)

# PPADDY18 <- "PPADDY18"
# LOKI2R_ind.GCL(sillyvec = PPADDY18, fish_ids = PPADDY18_fish_ids, username = .username, password = .password)

rm(.username, .password)
```

Create new directories and save objects

```{r save_locus_control_sillys}
if(!dir.exists("../../Objects/GOD_21_Round2/")) {dir.create("../../Objects/GOD_21_Round2/")}
save_objects(objects = c("LocusControl", "loci", "TestSillys", "PERB16", "PGILMOUR15", "PGILMOUR16", "PGILMOUR17", "PGILMOUR18", "PPADDY16"), path = "../../Objects/GOD_21_Round2/")

if(!dir.exists("../../Genotypes/GOD_21_Round2/")) {dir.create("../../Genotypes/GOD_21_Round2/")}
save_sillys(sillyvec = c("PGOD21", "PERB16", "PGILMOUR15", "PGILMOUR16", "PGILMOUR17", "PGILMOUR18", "PPADDY16"), path = "../../Genotypes/GOD_21_Round2/")
```

Load objects if revisiting

```{r load_objects}
load_objects(path = "../../Objects/GOD_21_Round2")
load_sillys(path = "../../Genotypes/GOD_21_Round2")
```

### Otolith genotyping success

```{r fig.height=12}
TestQCSampleSizebyLocus <-
  SampSizeByLocus.GCL(sillyvec = TestSillys, loci = loci)

TestQCPercentbyLocus <-
  apply(TestQCSampleSizebyLocus, 1, function(row) {
    row / max(row)
  })

(locus_success_rate_qc <- TestQCPercentbyLocus %>% 
  as_tibble(rownames = "locus") %>%
  dplyr::rename(success_rate = PGOD21) %>%
  arrange(success_rate))

locus_success_rate_qc %>%
  filter(success_rate == 0)

(failed_loci_otoliths <- locus_success_rate_qc %>%
  filter(success_rate == 0) %>%
  pull(locus))

# Added by Chase Jalbert on 4/2020. This version of a levelplot has WAY more features and actually works with large datasets. You can zoom, click things, scroll, save image, etc. so you can actually see whats going on...
# plotly::ggplotly(
#   ggplot(
#     TestQCPercentbyLocus %>%
#       as_tibble(rownames = "locus") %>%
#       gather(silly, percent,-locus),
#     aes(x = silly, y = locus)
#   ) +
#     geom_tile(aes(fill = percent), color = "white") +
#     scale_fill_gradient(
#       low = "black",
#       high = "white",
#       limits = c(0, 1)
#     ) +
#     ylab("Locus") +
#     xlab("SILLY") +
#     ggtitle("Percent PGOD21 genotyped by Locus") +
#     labs(fill = "Percent\ngenotyped")
# )

# ...but it keeps failing me ("Error in dirname(to) : path too long") and I'm not in the mood to move things around, so back to normal ggplot...
TestQCPercentbyLocus %>%
  as_tibble(rownames = "locus") %>%
  gather(silly, percent,-locus) %>%
  ggplot(aes(x = silly, y = locus)) +
    geom_tile(aes(fill = percent), color = "white") +
    scale_fill_gradient(
      low = "black",
      high = "white",
      limits = c(0, 1)
    ) +
    ylab("Locus") +
    xlab("SILLY") +
    ggtitle("Percent genotyped by silly/locus") +
    labs(fill = "Percent\ngenotyped")
```

**0 / 298** loci failed; all rates >12% (see table). Some loci aren't too pretty, though.

## QA project genotypes

### Otoliths

#### Remove fails and dupes

Need to remove any particularly egregious otos, so let's see how badly they genotyped. 

```{r}
PGOD21.gcl$counts[, , 1] %>% 
  as_tibble(rownames = "fish_id") %>% 
  gather(locus, genotype, -fish_id) %>% 
  group_by(fish_id) %>% 
  summarise(proportion_missing = sum(is.na(genotype)) / length(loci)) %>% 
  arrange(desc(proportion_missing))
```

*Here's where we can start deciding our genotyping rate cutoff, if any.* There are 2,164 total otos in PGOD21 at this stage after the 2nd set. We still need to keep as many critters as possible within reason. We're dealing with 298 loci, so we should have wiggle room. Consider that the original panel was 96 (32% of loci) and we though of paring that down to 24 (8% of loci), but we also have to remember that the info content of each locus is not the same. 

Plot a histogram of proportion missing.
```{r}
PGOD21.gcl$counts[, , 1] %>% 
  as_tibble(rownames = "fish_id") %>% 
  gather(locus, genotype, -fish_id) %>% 
  group_by(fish_id) %>% 
  summarise(proportion_missing = sum(is.na(genotype)) / length(loci)) %>% 
  ggplot(aes(x = proportion_missing)) +
  geom_histogram(binwidth = 0.05) +
  theme_bw() +
  ggtitle("% Locus Failure Rate by Fish in PGOD21")
```

For a first pass, we tried a 1% cutoff giving us a minimum of 3 loci that must be genotyped, and we largely skipped the duplicate check (set at 99% matching), since it probably wouldn't do us much good because we have (1) a low potential to identify true dupes, if only a few loci are genotyped, and (2) both lefts and unknowns are in PGOD21, which could come from the same fish. This didn't work well; it retained some fish that really needed to be deleted because you can generate a high duplicated rate with very few loci genotyped. Here, we tested a 15% cutoff giving us a minimum of 45 loci that must be genotyped, and kept the internal duplicate rate check at 99%. 

```{r}
TestSillys_SampleSizes <- matrix(
    data = NA,
    nrow = length(TestSillys),
    ncol = 4,
    dimnames = list(TestSillys, c("Genotyped", "Missing", "Duplicate", "Final"))
  )

TestSillys_SampleSizes[, "Genotyped"] <- sapply(paste(TestSillys, ".gcl", sep = ''), function(x)
    get(x)$n)


(MissLoci <- RemoveIndMissLoci.GCL(sillyvec = TestSillys, proportion = 0.15))

ColSizePostMissLoci <- sapply(paste(TestSillys, ".gcl", sep = ''), function(x)
    get(x)$n)

TestSillys_SampleSizes[, "Missing"] <- TestSillys_SampleSizes[, "Genotyped"] - ColSizePostMissLoci

DuplicateCheck99MinProportion <- CheckDupWithinSilly.GCL(
    sillyvec = TestSillys,
    loci = loci,
    quantile = NULL,
    minproportion = 0.99
  )

DuplicateCheckReportSummary <- sapply(TestSillys, function(x)
    DuplicateCheck99MinProportion[[x]]$report, simplify = FALSE)

DuplicateCheckReportSummary

nDupsBySilly <- sapply(DuplicateCheckReportSummary, function(silly) {
    ifelse(is.character(silly), 0, nrow(as.matrix(silly)))
  })
RemovedDups <- RemoveDups.GCL(DuplicateCheck99MinProportion)

sapply(DuplicateCheckReportSummary[nDupsBySilly >= 1], function(silly) {
  if (1 %in% abs(as.numeric(levels(silly$ID1)) - as.numeric(levels(silly$ID2)))) {
    "Sequential IDs found as duplicates, check 'DuplicateCheckReportSummary' for duplicated rows"
  } else {
    "Duplicates exist, but IDs do not appear sequential"
  }
})

DuplicateCheckReportSummary[nDupsBySilly >= 1]  # Show within silly duplicates

ColSizePostDuplicate <- ColSizePostMissLoci - nDupsBySilly
ColSizePostDuplicate <- sapply(paste(TestSillys, ".gcl", sep = ''), function(x) get(x)$n)

TestSillys_SampleSizes[, "Duplicate"] <- ColSizePostMissLoci - ColSizePostDuplicate

TestSillys_SampleSizes[, "Final"] <- ColSizePostDuplicate

TestSillys_SampleSizes
```

We have 2017 / 2164 otoliths remaining. One pairwise comparison failed our duplicate rate check.

**NOTE** Similar to the normal AHRP samples, we'll want to remove **BOTH** duplicates, if they show up, since we won't know which one identifies back to the heart genotype. The function `RemoveDups.GCL` only removes 1 of the duplicates, we need to go in and manually remove the other.

```{r}
(
  duplicates_to_remove <- DuplicateCheckReportSummary$PGOD21 %>%
    select(ID1, ID2) %>%
    pivot_longer(
      cols = everything(),
      names_to = "trash",
      values_to = "fish_ids"
    ) %>%
    pull(fish_ids)
)

RemoveIDs.GCL(silly = "PGOD21", IDs = duplicates_to_remove)
```

There are 2016 otos going forward.

#### Heterozygosity

Excess heterozygosity can be an indication of contamination. We already know there is some contamination among the heart-derived GT-seq genotypes, but it is a good baseline.

```{r}
Ho_qc <- function(indata1 = PGOD21.gcl$counts[ , , 1]) {
  indata1 %>% 
  as_tibble(rownames = "qc_fish_id") %>% 
  gather(locus, genotype, -qc_fish_id) %>% 
  group_by(qc_fish_id) %>% 
  summarise(Ho_qc = sum(genotype == 1, na.rm = TRUE) / length(!is.na(genotype)), .groups = "drop") %>% 
  arrange(desc(Ho_qc))
}

Ho_qc_plot <- function(indata2 = Ho_qc_PGOD21) {
  indata2 %>% 
  ggplot(aes(x = Ho_qc)) +
  geom_histogram(binwidth = 1/298) +
  theme_bw()
}

Ho_qc_PGOD21 <- Ho_qc()
Ho_qc_plot()
```

Ho is >50% for some otoliths; definitely some contamination.

#### Genotyping success

Let's look again at heterozygosity for what we got left.

```{r}
loci_intersect <- setdiff(loci, failed_loci_otoliths) # all 298 are there

qc_proportion_missing <- function(indata3 = PGOD21.gcl$counts[, , 1]) {
    indata3 %>%
    as_tibble(rownames = "fish_id") %>%
    gather(locus, genotype,-fish_id) %>%
    group_by(fish_id) %>%
    summarise(proportion_missing = sum(is.na(genotype)) / 298) %>%
    arrange(desc(proportion_missing))
}

qc_proportion_missing_plot <- function(indata4 = qc_proportion_missing_PGOD21) {
  indata4 %>% 
  ggplot(aes(x = proportion_missing)) +
  geom_histogram() +
  xlim(0, 1.1) +
  theme_bw()
}

qc_proportion_missing_PGOD21 <- qc_proportion_missing()
qc_proportion_missing_plot()
```

Yeah, it's still not going to be pretty, but we knew that.

### Hearts

#### Remove fails and dupes

For the other SILLYS we'll compare to, we'll leave the cutoff at 80% and perform the regular 95% duplicate rate check.

```{r}
OGSillys <- c("PERB16", "PGILMOUR15", "PGILMOUR16", "PGILMOUR17", "PGILMOUR18", "PPADDY16")

OGSillys_SampleSizes <- matrix(
    data = NA,
    nrow = length(OGSillys),
    ncol = 4,
    dimnames = list(OGSillys, c("Genotyped", "Missing", "Duplicate", "Final"))
  )

OGSillys_SampleSizes[, "Genotyped"] <- sapply(paste(OGSillys, ".gcl", sep = ''), function(x)
    get(x)$n)


(MissLoci <- RemoveIndMissLoci.GCL(sillyvec = OGSillys, proportion = 0.8))

ColSizePostMissLoci <- sapply(paste(OGSillys, ".gcl", sep = ''), function(x)
    get(x)$n)

OGSillys_SampleSizes[, "Missing"] <- OGSillys_SampleSizes[, "Genotyped"] - ColSizePostMissLoci

DuplicateCheck95MinProportion <- CheckDupWithinSilly.GCL(
    sillyvec = OGSillys,
    loci = loci,
    quantile = NULL,
    minproportion = 0.95
  )

DuplicateCheckReportSummary <- sapply(OGSillys, function(x)
    DuplicateCheck95MinProportion[[x]]$report, simplify = FALSE)

DuplicateCheckReportSummary

nDupsBySilly <- sapply(DuplicateCheckReportSummary, function(silly) {
    ifelse(is.character(silly), 0, nrow(as.matrix(silly)))
  })
RemovedDups <- RemoveDups.GCL(DuplicateCheck95MinProportion)

sapply(DuplicateCheckReportSummary[nDupsBySilly >= 1], function(silly) {
  if (1 %in% abs(as.numeric(levels(silly$ID1)) - as.numeric(levels(silly$ID2)))) {
    "Sequential IDs found as duplicates, check 'DuplicateCheckReportSummary' for duplicated rows"
  } else {
    "Duplicates exist, but IDs do not appear sequential"
  }
})

DuplicateCheckReportSummary[nDupsBySilly >= 1]  # Show within silly duplicates

ColSizePostDuplicate <- ColSizePostMissLoci - nDupsBySilly
ColSizePostDuplicate <- sapply(paste(OGSillys, ".gcl", sep = ''), function(x) get(x)$n)

OGSillys_SampleSizes[, "Duplicate"] <- ColSizePostMissLoci - ColSizePostDuplicate

OGSillys_SampleSizes[, "Final"] <- ColSizePostDuplicate

OGSillys_SampleSizes
```

Losing a few more here as expected in terms of missingness, and there are three dupes in PGILMOUR16. This is what we'd filter in a normal project anyway.

### Final dataset sample sizes

```{r}
PGOD21.gcl$n
PERB16.gcl$n
PGILMOUR15.gcl$n
PGILMOUR16.gcl$n
PGILMOUR17.gcl$n
PGILMOUR18.gcl$n
PPADDY16.gcl$n
```

We have a handful o' possible fishy hearts to match back to. As a reminder, PGOD21 genotyped more SILLYs and DWPs than we have heart genotypes for, which comes into play when we do the DWP-by-DWP matching.

## Duplicate rate check

### Arrange attributes by DWPs
```{r}
# figure out the SILLYs associated with the DWPs and join
PGOD21_DWPs <- attributes_and_xfer_PGOD21 %>% 
  dplyr::select(`48_DWP_tray_barcode`) 
# write_csv(PGOD21_DWPs, "PGOD21_DWPs_042721.csv") 
write_csv(PGOD21_DWPs, "PGOD21_DWPs_012622.csv")
# used this list plus SILLY_CODE and DNA_TRAY_CODE in oceanak_affected_DWPs.csv to do a vlookup in excel for the SILLY_CODE associated with the 48_DWP_tray_barcode - it's probably possible to do a vlookup type thing using join, but here we are...
 
# copied SILLY_CODE column in PGOD21_DWPs.csv to OG_SILLY_CODE, trimmed all columns to correct length, saved as new csv, and uploaded
# PGOD21_DWPs_and_SILLYs <- read_csv("PGOD21_DWPs_and_SILLYs_042721.csv") 
PGOD21_DWPs_and_SILLYs <- read_csv("Copy of PGOD21_DWPs_and_SILLYs_012622.csv")

attributes_xfer_and_SILLY_PGOD21 <- attributes_and_xfer_PGOD21 
attributes_xfer_and_SILLY_PGOD21$OG_SILLY_CODE <- PGOD21_DWPs_and_SILLYs$OG_SILLY_CODE

new_PGOD21_attributes_and_SILLY <- left_join(PGOD21.gcl$attributes, attributes_xfer_and_SILLY_PGOD21, by = "SillySource")

# break down new_PGOD21_attributes_and_SILLY into individual DWPs
# NOTE: need to figure out a loop based on PGOD21_DWPs
PGOD21_by_DWP <- function(indata = "14331") {
  new_PGOD21_attributes_and_SILLY %>% 
    dplyr::filter(`48_DWP_tray_barcode` == indata)
}

PGOD21_DWP_14331 <- PGOD21_by_DWP(indata = "14331")
PGOD21_DWP_21941 <- PGOD21_by_DWP(indata = "21941")
PGOD21_DWP_14376 <- PGOD21_by_DWP(indata = "14376")
PGOD21_DWP_14334 <- PGOD21_by_DWP(indata = "14334")
PGOD21_DWP_14332 <- PGOD21_by_DWP(indata = "14332")
PGOD21_DWP_22174 <- PGOD21_by_DWP(indata = "22174")
PGOD21_DWP_14395 <- PGOD21_by_DWP(indata = "14395")
PGOD21_DWP_16104 <- PGOD21_by_DWP(indata = "16104")
PGOD21_DWP_16164 <- PGOD21_by_DWP(indata = "16164")
PGOD21_DWP_14463 <- PGOD21_by_DWP(indata = "14463")
PGOD21_DWP_28807 <- PGOD21_by_DWP(indata = "28807")
PGOD21_DWP_21900 <- PGOD21_by_DWP(indata = "21900")
PGOD21_DWP_14297 <- PGOD21_by_DWP(indata = "14297")
PGOD21_DWP_22108 <- PGOD21_by_DWP(indata = "22108")
PGOD21_DWP_22221 <- PGOD21_by_DWP(indata = "22221")
PGOD21_DWP_22104 <- PGOD21_by_DWP(indata = "22104")
PGOD21_DWP_2287 <- PGOD21_by_DWP(indata = "2287")
PGOD21_DWP_22107 <- PGOD21_by_DWP(indata = "22107")
PGOD21_DWP_14573 <- PGOD21_by_DWP(indata = "14573")
PGOD21_DWP_21938 <- PGOD21_by_DWP(indata = "21938")
PGOD21_DWP_15826 <- PGOD21_by_DWP(indata = "15826")
PGOD21_DWP_22050 <- PGOD21_by_DWP(indata = "22050")
PGOD21_DWP_21940 <- PGOD21_by_DWP(indata = "21940")
PGOD21_DWP_22710 <- PGOD21_by_DWP(indata = "22710")
PGOD21_DWP_22595 <- PGOD21_by_DWP(indata = "22595")
PGOD21_DWP_22569 <- PGOD21_by_DWP(indata = "22569")
PGOD21_DWP_22701 <- PGOD21_by_DWP(indata = "22701")
PGOD21_DWP_28929 <- PGOD21_by_DWP(indata = "28929")
PGOD21_DWP_16130 <- PGOD21_by_DWP(indata = "16130")
PGOD21_DWP_2228 <- PGOD21_by_DWP(indata = "2228")
PGOD21_DWP_28829 <- PGOD21_by_DWP(indata = "28829")
PGOD21_DWP_21937 <- PGOD21_by_DWP(indata = "21937")
PGOD21_DWP_21939 <- PGOD21_by_DWP(indata = "21939")
PGOD21_DWP_22260 <- PGOD21_by_DWP(indata = "22260")
PGOD21_DWP_14282 <- PGOD21_by_DWP(indata = "14282")
PGOD21_DWP_22218 <- PGOD21_by_DWP(indata = "22218")
PGOD21_DWP_14662 <- PGOD21_by_DWP(indata = "14662")
PGOD21_DWP_14663 <- PGOD21_by_DWP(indata = "14663")
PGOD21_DWP_22162 <- PGOD21_by_DWP(indata = "22162")
PGOD21_DWP_22591 <- PGOD21_by_DWP(indata = "22591")
PGOD21_DWP_22751 <- PGOD21_by_DWP(indata = "22751")
PGOD21_DWP_28812 <- PGOD21_by_DWP(indata = "28812")
PGOD21_DWP_22105 <- PGOD21_by_DWP(indata = "22105")
PGOD21_DWP_16132 <- PGOD21_by_DWP(indata = "16132")
PGOD21_DWP_28864 <- PGOD21_by_DWP(indata = "28864")
PGOD21_DWP_2288 <- PGOD21_by_DWP(indata = "2288")
PGOD21_DWP_22006 <- PGOD21_by_DWP(indata = "22006")
PGOD21_DWP_2232 <- PGOD21_by_DWP(indata = "2232")
PGOD21_DWP_14595 <- PGOD21_by_DWP(indata = "14595")
PGOD21_DWP_22558 <- PGOD21_by_DWP(indata = "22558")
PGOD21_DWP_14640 <- PGOD21_by_DWP(indata = "14640")
PGOD21_DWP_2234 <- PGOD21_by_DWP(indata = "2234")
PGOD21_DWP_15855 <- PGOD21_by_DWP(indata = "15855")
PGOD21_DWP_14629 <- PGOD21_by_DWP(indata = "14629")
PGOD21_DWP_14601 <- PGOD21_by_DWP(indata = "14601")
PGOD21_DWP_14641 <- PGOD21_by_DWP(indata = "14641")
PGOD21_DWP_22682 <- PGOD21_by_DWP(indata = "22682")
PGOD21_DWP_2161 <- PGOD21_by_DWP(indata = "2161")
PGOD21_DWP_14607 <- PGOD21_by_DWP(indata = "14607")
PGOD21_DWP_14570 <- PGOD21_by_DWP(indata = "14570")
PGOD21_DWP_22623 <- PGOD21_by_DWP(indata = "22623")
PGOD21_DWP_22593 <- PGOD21_by_DWP(indata = "22593")
PGOD21_DWP_2505 <- PGOD21_by_DWP(indata = "2505")
PGOD21_DWP_2129 <- PGOD21_by_DWP(indata = "2129")
PGOD21_DWP_22759 <- PGOD21_by_DWP(indata = "22759")
PGOD21_DWP_22622 <- PGOD21_by_DWP(indata = "22622")
PGOD21_DWP_22694 <- PGOD21_by_DWP(indata = "22694")
PGOD21_DWP_22464 <- PGOD21_by_DWP(indata = "22464")
PGOD21_DWP_2195 <- PGOD21_by_DWP(indata = "2195")
PGOD21_DWP_15797 <- PGOD21_by_DWP(indata = "15797")
PGOD21_DWP_22693 <- PGOD21_by_DWP(indata = "22693")
PGOD21_DWP_2123 <- PGOD21_by_DWP(indata = "2123")
PGOD21_DWP_2192 <- PGOD21_by_DWP(indata = "2192")
PGOD21_DWP_14449 <- PGOD21_by_DWP(indata = "14449")
PGOD21_DWP_2838 <- PGOD21_by_DWP(indata = "2838")
PGOD21_DWP_14448 <- PGOD21_by_DWP(indata = "14448")

# break down OGSillys into individual DWPs
# NOTE: same here - need loops based on the SILLY_affected_DWPs
PERB16_affected_DWPs <- unique(PERB16.gcl$attributes$DNA_TRAY_CODE)
PGILMOUR15_affected_DWPs <- unique(PGILMOUR15.gcl$attributes$DNA_TRAY_CODE)
PGILMOUR16_affected_DWPs <- unique(PGILMOUR16.gcl$attributes$DNA_TRAY_CODE)
PGILMOUR17_affected_DWPs <- unique(PGILMOUR17.gcl$attributes$DNA_TRAY_CODE)
PGILMOUR18_affected_DWPs <- unique(PGILMOUR18.gcl$attributes$DNA_TRAY_CODE)
PPADDY16_affected_DWPs <- unique(PPADDY16.gcl$attributes$DNA_TRAY_CODE)

OGSilly_by_DWP <- function(indata1 = PERB16.gcl$attributes, indata2 = "0000014331") {
  indata1 %>% 
    dplyr::filter(DNA_TRAY_CODE == indata2)
}

PERB16_DWP_14395 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014395")
PERB16_DWP_14449 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014449")
PERB16_DWP_14448 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014448")
PERB16_DWP_14334 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014334")
PERB16_DWP_14331 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014331")
PERB16_DWP_14376 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014376")
PERB16_DWP_14297 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014297")
PERB16_DWP_14282 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014282")
PERB16_DWP_14332 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014332")

PGILMOUR15_DWP_2123 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002123")
PGILMOUR15_DWP_2129 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002129")
PGILMOUR15_DWP_2161 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002161")
PGILMOUR15_DWP_2192 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002192")
PGILMOUR15_DWP_2195 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002195")
PGILMOUR15_DWP_2228 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002228")
PGILMOUR15_DWP_2232 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002232")
PGILMOUR15_DWP_2234 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002234")
PGILMOUR15_DWP_2505 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002505")
PGILMOUR15_DWP_2838 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002838")

PGILMOUR16_DWP_15797 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000015797")
PGILMOUR16_DWP_14570 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014570")
PGILMOUR16_DWP_14573 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014573")
PGILMOUR16_DWP_14662 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014662")
PGILMOUR16_DWP_14663 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014663")
PGILMOUR16_DWP_15826 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000015826")
PGILMOUR16_DWP_14641 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014641")
PGILMOUR16_DWP_14601 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014601")
PGILMOUR16_DWP_14629 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014629")
PGILMOUR16_DWP_14595 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014595")
PGILMOUR16_DWP_14640 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014640")
PGILMOUR16_DWP_15855 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000015855")
PGILMOUR16_DWP_14607 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014607")

PGILMOUR17_DWP_22694 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022694")
PGILMOUR17_DWP_22759 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022759")
PGILMOUR17_DWP_22593 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022593")
PGILMOUR17_DWP_22569 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022569")
PGILMOUR17_DWP_22623 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022623")
PGILMOUR17_DWP_22693 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022693")
PGILMOUR17_DWP_22464 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022464")
PGILMOUR17_DWP_22558 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022558")
PGILMOUR17_DWP_22682 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022682")
PGILMOUR17_DWP_22591 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022591")
PGILMOUR17_DWP_22622 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022622")
PGILMOUR17_DWP_22595 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022595")
PGILMOUR17_DWP_22710 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022710")
PGILMOUR17_DWP_22751 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022751")
PGILMOUR17_DWP_22701 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022701")

PGILMOUR18_DWP_28929 <- OGSilly_by_DWP(indata1 = PGILMOUR18.gcl$attributes, indata2 = "0000028929")
PGILMOUR18_DWP_28864 <- OGSilly_by_DWP(indata1 = PGILMOUR18.gcl$attributes, indata2 = "0000028864")
PGILMOUR18_DWP_28829 <- OGSilly_by_DWP(indata1 = PGILMOUR18.gcl$attributes, indata2 = "0000028829")
PGILMOUR18_DWP_28807 <- OGSilly_by_DWP(indata1 = PGILMOUR18.gcl$attributes, indata2 = "0000028807")
PGILMOUR18_DWP_28812 <- OGSilly_by_DWP(indata1 = PGILMOUR18.gcl$attributes, indata2 = "0000028812")

PPADDY16_DWP_16104 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000016104")
PPADDY16_DWP_14463 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000014463")
PPADDY16_DWP_16130 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000016130")
PPADDY16_DWP_16164 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000016164")
PPADDY16_DWP_16132 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000016132")
```

### Pull DWP fish_ids for PGOD21 and the OGSillys

```{r}
# pull fish_ids for PGOD21 DWPs
PGOD21_DWP_14331_fish_ids <- PGOD21_DWP_14331 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21941_fish_ids <- PGOD21_DWP_21941 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14376_fish_ids <- PGOD21_DWP_14376 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14334_fish_ids <- PGOD21_DWP_14334 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14332_fish_ids <- PGOD21_DWP_14332 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22174_fish_ids <- PGOD21_DWP_22174 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14395_fish_ids <- PGOD21_DWP_14395 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16104_fish_ids <- PGOD21_DWP_16104 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16164_fish_ids <- PGOD21_DWP_16164 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14463_fish_ids <- PGOD21_DWP_14463 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_28807_fish_ids <- PGOD21_DWP_28807 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21900_fish_ids <- PGOD21_DWP_21900 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14297_fish_ids <- PGOD21_DWP_14297 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22108_fish_ids <- PGOD21_DWP_22108 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22221_fish_ids <- PGOD21_DWP_22221 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22104_fish_ids <- PGOD21_DWP_22104 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2287_fish_ids <- PGOD21_DWP_2287 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22107_fish_ids <- PGOD21_DWP_22107 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14573_fish_ids <- PGOD21_DWP_14573 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21938_fish_ids <- PGOD21_DWP_21938 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_15826_fish_ids <- PGOD21_DWP_15826 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22050_fish_ids <- PGOD21_DWP_22050 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21940_fish_ids <- PGOD21_DWP_21940 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22710_fish_ids <- PGOD21_DWP_22710 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22595_fish_ids <- PGOD21_DWP_22595 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22569_fish_ids <- PGOD21_DWP_22569 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22701_fish_ids <- PGOD21_DWP_22701 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_28929_fish_ids <- PGOD21_DWP_28929 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16130_fish_ids <- PGOD21_DWP_16130 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2228_fish_ids <- PGOD21_DWP_2228 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_28829_fish_ids <- PGOD21_DWP_28829 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21937_fish_ids <- PGOD21_DWP_21937 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21939_fish_ids <- PGOD21_DWP_21939 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22260_fish_ids <- PGOD21_DWP_22260 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14282_fish_ids <- PGOD21_DWP_14282 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22218_fish_ids <- PGOD21_DWP_22218 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14662_fish_ids <- PGOD21_DWP_14662 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14663_fish_ids <- PGOD21_DWP_14663 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22162_fish_ids <- PGOD21_DWP_22162 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22591_fish_ids <- PGOD21_DWP_22591 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22751_fish_ids <- PGOD21_DWP_22751 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_28812_fish_ids <- PGOD21_DWP_28812 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22105_fish_ids <- PGOD21_DWP_22105 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16132_fish_ids <- PGOD21_DWP_16132 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_28864_fish_ids <- PGOD21_DWP_28864 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2288_fish_ids <- PGOD21_DWP_2288 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22006_fish_ids <- PGOD21_DWP_22006 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2232_fish_ids <- PGOD21_DWP_2232 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14595_fish_ids <- PGOD21_DWP_14595 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22558_fish_ids <- PGOD21_DWP_22558 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14640_fish_ids <- PGOD21_DWP_14640 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2234_fish_ids <- PGOD21_DWP_2234 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_15855_fish_ids <- PGOD21_DWP_15855 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14629_fish_ids <- PGOD21_DWP_14629 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14601_fish_ids <- PGOD21_DWP_14601 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14641_fish_ids <- PGOD21_DWP_14641 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22682_fish_ids <- PGOD21_DWP_22682 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2161_fish_ids <- PGOD21_DWP_2161 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14607_fish_ids <- PGOD21_DWP_14607 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14570_fish_ids <- PGOD21_DWP_14570 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22623_fish_ids <- PGOD21_DWP_22623 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22593_fish_ids <- PGOD21_DWP_22593 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2505_fish_ids <- PGOD21_DWP_2505 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2129_fish_ids <- PGOD21_DWP_2129 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22759_fish_ids <- PGOD21_DWP_22759 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22622_fish_ids <- PGOD21_DWP_22622 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22694_fish_ids <- PGOD21_DWP_22694 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22464_fish_ids <- PGOD21_DWP_22464 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2195_fish_ids <- PGOD21_DWP_2195 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_15797_fish_ids <- PGOD21_DWP_15797 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22693_fish_ids <- PGOD21_DWP_22693 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2123_fish_ids <- PGOD21_DWP_2123 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2192_fish_ids <- PGOD21_DWP_2192 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14449_fish_ids <- PGOD21_DWP_14449 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2838_fish_ids <- PGOD21_DWP_2838 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14448_fish_ids <- PGOD21_DWP_14448 %>% pull(FK_FISH_ID.x)

# pull fish_ids for OGSilly DWPs
PERB16_DWP_14395_fish_ids <- PERB16_DWP_14395 %>% pull(FK_FISH_ID)
PERB16_DWP_14449_fish_ids <- PERB16_DWP_14449 %>% pull(FK_FISH_ID)
PERB16_DWP_14448_fish_ids <- PERB16_DWP_14448 %>% pull(FK_FISH_ID)
PERB16_DWP_14334_fish_ids <- PERB16_DWP_14334 %>% pull(FK_FISH_ID)
PERB16_DWP_14331_fish_ids <- PERB16_DWP_14331 %>% pull(FK_FISH_ID)
PERB16_DWP_14376_fish_ids <- PERB16_DWP_14376 %>% pull(FK_FISH_ID)
PERB16_DWP_14297_fish_ids <- PERB16_DWP_14297 %>% pull(FK_FISH_ID)
PERB16_DWP_14282_fish_ids <- PERB16_DWP_14282 %>% pull(FK_FISH_ID)
PERB16_DWP_14332_fish_ids <- PERB16_DWP_14332 %>% pull(FK_FISH_ID)

PGILMOUR15_DWP_2123_fish_ids <- PGILMOUR15_DWP_2123 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2129_fish_ids <- PGILMOUR15_DWP_2129 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2161_fish_ids <- PGILMOUR15_DWP_2161 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2192_fish_ids <- PGILMOUR15_DWP_2192 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2195_fish_ids <- PGILMOUR15_DWP_2195 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2228_fish_ids <- PGILMOUR15_DWP_2228 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2232_fish_ids <- PGILMOUR15_DWP_2232 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2234_fish_ids <- PGILMOUR15_DWP_2234 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2505_fish_ids <- PGILMOUR15_DWP_2505 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2838_fish_ids <- PGILMOUR15_DWP_2838 %>% pull(FK_FISH_ID)

PGILMOUR16_DWP_15797_fish_ids <- PGILMOUR16_DWP_15797 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14570_fish_ids <- PGILMOUR16_DWP_14570 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14573_fish_ids <- PGILMOUR16_DWP_14573 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14662_fish_ids <- PGILMOUR16_DWP_14662 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14663_fish_ids <- PGILMOUR16_DWP_14663 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_15826_fish_ids <- PGILMOUR16_DWP_15826 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14641_fish_ids <- PGILMOUR16_DWP_14641 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14601_fish_ids <- PGILMOUR16_DWP_14601 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14629_fish_ids <- PGILMOUR16_DWP_14629 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14595_fish_ids <- PGILMOUR16_DWP_14595 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14640_fish_ids <- PGILMOUR16_DWP_14640 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_15855_fish_ids <- PGILMOUR16_DWP_15855 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14607_fish_ids <- PGILMOUR16_DWP_14607 %>% pull(FK_FISH_ID)

PGILMOUR17_DWP_22694_fish_ids <- PGILMOUR17_DWP_22694 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22759_fish_ids <- PGILMOUR17_DWP_22759 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22593_fish_ids <- PGILMOUR17_DWP_22593 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22569_fish_ids <- PGILMOUR17_DWP_22569 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22623_fish_ids <- PGILMOUR17_DWP_22623 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22693_fish_ids <- PGILMOUR17_DWP_22693 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22464_fish_ids <- PGILMOUR17_DWP_22464 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22558_fish_ids <- PGILMOUR17_DWP_22558 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22682_fish_ids <- PGILMOUR17_DWP_22682 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22591_fish_ids <- PGILMOUR17_DWP_22591 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22622_fish_ids <- PGILMOUR17_DWP_22622 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22595_fish_ids <- PGILMOUR17_DWP_22595 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22710_fish_ids <- PGILMOUR17_DWP_22710 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22751_fish_ids <- PGILMOUR17_DWP_22751 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22701_fish_ids <- PGILMOUR17_DWP_22701 %>% pull(FK_FISH_ID)

PGILMOUR18_DWP_28929_fish_ids <- PGILMOUR18_DWP_28929 %>% pull(FK_FISH_ID)
PGILMOUR18_DWP_28864_fish_ids <- PGILMOUR18_DWP_28864 %>% pull(FK_FISH_ID)
PGILMOUR18_DWP_28829_fish_ids <- PGILMOUR18_DWP_28829 %>% pull(FK_FISH_ID)
PGILMOUR18_DWP_28807_fish_ids <- PGILMOUR18_DWP_28807 %>% pull(FK_FISH_ID)
PGILMOUR18_DWP_28812_fish_ids <- PGILMOUR18_DWP_28812 %>% pull(FK_FISH_ID)

PPADDY16_DWP_16104_fish_ids <- PPADDY16_DWP_16104 %>% pull(FK_FISH_ID)
PPADDY16_DWP_14463_fish_ids <- PPADDY16_DWP_14463 %>% pull(FK_FISH_ID)
PPADDY16_DWP_16130_fish_ids <- PPADDY16_DWP_16130 %>% pull(FK_FISH_ID)
PPADDY16_DWP_16164_fish_ids <- PPADDY16_DWP_16164 %>% pull(FK_FISH_ID)
PPADDY16_DWP_16132_fish_ids <- PPADDY16_DWP_16132 %>% pull(FK_FISH_ID)
```

### **Duplicate rate checks by DWP**

A total of 19 PGOD21 DWPs still don't have OGSilly DWP matches, presumably because they haven't been genotyped yet, leaving 58 DWPs for matching.

* PERB16: n = 9
* PGILMOUR15: n = 10
* PGILMOUR16: n = 13
* PGILMOUR17: n = 15
* PGILMOUR18: n = 5
* PPADDY16: n = 5

#### **PERB 16**

#### *1. PERB16_DWP_14395*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14395_fish_ids)), newname = "PERB16_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PERB16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Set cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15.

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14395_pass, "dup_check_results_pass.csv")
```

#### *2. PERB16_DWP_14449*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14449_fish_ids)), newname = "PERB16_DWP_14449")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14449_fish_ids)), newname = "PGOD21_DWP_14449")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14449 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14449",
      GODSillyIDs = list("PGOD21_DWP_14449" = rownames(PGOD21_DWP_14449.gcl$counts)),
      HeartSillys = "PERB16_DWP_14449",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14449_best_match <- dup_check_results_DWP_14449 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14449 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14449_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14449 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14449_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14449 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14449_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14449_1stbest <- dup_check_results_DWP_14449 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14449_2ndbest <- dup_check_results_DWP_14449 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14449_top_2 <- rbind(dup_check_results_DWP_14449_1stbest, dup_check_results_DWP_14449_2ndbest))

ggplot(data = dup_check_results_DWP_14449_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14449_pass <- dup_check_results_DWP_14449_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14449_pass)
length(unique(dup_check_results_DWP_14449_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14449_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14449_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *3. PERB16_DWP_14448*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14448_fish_ids)), newname = "PERB16_DWP_14448")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14448_fish_ids)), newname = "PGOD21_DWP_14448")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14448 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14448",
      GODSillyIDs = list("PGOD21_DWP_14448" = rownames(PGOD21_DWP_14448.gcl$counts)),
      HeartSillys = "PERB16_DWP_14448",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14448_best_match <- dup_check_results_DWP_14448 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14448 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14448_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14448 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14448_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14448 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14448_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14448_1stbest <- dup_check_results_DWP_14448 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14448_2ndbest <- dup_check_results_DWP_14448 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14448_top_2 <- rbind(dup_check_results_DWP_14448_1stbest, dup_check_results_DWP_14448_2ndbest))

ggplot(data = dup_check_results_DWP_14448_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14448_pass <- dup_check_results_DWP_14448_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14448_pass)
length(unique(dup_check_results_DWP_14448_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14448_pass$otolith_fish_id))
```

##### Status: OK


```{r}
write.table(dup_check_results_DWP_14448_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *4. PERB16_DWP_14334*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14334_fish_ids)), newname = "PERB16_DWP_14334")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14334_fish_ids)), newname = "PGOD21_DWP_14334")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14334 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14334",
      GODSillyIDs = list("PGOD21_DWP_14334" = rownames(PGOD21_DWP_14334.gcl$counts)),
      HeartSillys = "PERB16_DWP_14334",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14334_best_match <- dup_check_results_DWP_14334 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14334 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14334_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14334 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14334_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14334 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14334_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14334_1stbest <- dup_check_results_DWP_14334 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14334_2ndbest <- dup_check_results_DWP_14334 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14334_top_2 <- rbind(dup_check_results_DWP_14334_1stbest, dup_check_results_DWP_14334_2ndbest))

ggplot(data = dup_check_results_DWP_14334_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14334_pass <- dup_check_results_DWP_14334_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14334_pass)
length(unique(dup_check_results_DWP_14334_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14334_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14334_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *5. PERB16_DWP_14331*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14331_fish_ids)), newname = "PERB16_DWP_14331")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14331_fish_ids)), newname = "PGOD21_DWP_14331")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14331 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14331",
      GODSillyIDs = list("PGOD21_DWP_14331" = rownames(PGOD21_DWP_14331.gcl$counts)),
      HeartSillys = "PERB16_DWP_14331",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14331_best_match <- dup_check_results_DWP_14331 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14331 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14331_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14331 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14331_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14331 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14331_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14331_1stbest <- dup_check_results_DWP_14331 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14331_2ndbest <- dup_check_results_DWP_14331 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14331_top_2 <- rbind(dup_check_results_DWP_14331_1stbest, dup_check_results_DWP_14331_2ndbest))

ggplot(data = dup_check_results_DWP_14331_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_14331_pass <- dup_check_results_DWP_14331_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_14331_pass)
length(unique(dup_check_results_DWP_14331_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14331_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_14331_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *6. PERB16_DWP_14376*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14376_fish_ids)), newname = "PERB16_DWP_14376")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14376_fish_ids)), newname = "PGOD21_DWP_14376")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14376 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14376",
      GODSillyIDs = list("PGOD21_DWP_14376" = rownames(PGOD21_DWP_14376.gcl$counts)),
      HeartSillys = "PERB16_DWP_14376",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14376_best_match <- dup_check_results_DWP_14376 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14376 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14376_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14376 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14376_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14376 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14376_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14376_1stbest <- dup_check_results_DWP_14376 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14376_2ndbest <- dup_check_results_DWP_14376 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14376_top_2 <- rbind(dup_check_results_DWP_14376_1stbest, dup_check_results_DWP_14376_2ndbest))

ggplot(data = dup_check_results_DWP_14376_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14376_pass <- dup_check_results_DWP_14376_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14376_pass)
length(unique(dup_check_results_DWP_14376_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14376_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14376_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *7. PERB16_DWP_14297*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14297_fish_ids)), newname = "PERB16_DWP_14297")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14297_fish_ids)), newname = "PGOD21_DWP_14297")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14297 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14297",
      GODSillyIDs = list("PGOD21_DWP_14297" = rownames(PGOD21_DWP_14297.gcl$counts)),
      HeartSillys = "PERB16_DWP_14297",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14297_best_match <- dup_check_results_DWP_14297 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14297 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14297_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14297 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14297_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14297 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14297_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14297_1stbest <- dup_check_results_DWP_14297 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14297_2ndbest <- dup_check_results_DWP_14297 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14297_top_2 <- rbind(dup_check_results_DWP_14297_1stbest, dup_check_results_DWP_14297_2ndbest))

ggplot(data = dup_check_results_DWP_14297_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14297_pass <- dup_check_results_DWP_14297_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14297_pass)
length(unique(dup_check_results_DWP_14297_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14297_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14297_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *8. PERB16_DWP_14282*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14282_fish_ids)), newname = "PERB16_DWP_14282")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14282_fish_ids)), newname = "PGOD21_DWP_14282")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14282 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14282",
      GODSillyIDs = list("PGOD21_DWP_14282" = rownames(PGOD21_DWP_14282.gcl$counts)),
      HeartSillys = "PERB16_DWP_14282",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14282_best_match <- dup_check_results_DWP_14282 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14282 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14282_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14282 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14282_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14282 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14282_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14282_1stbest <- dup_check_results_DWP_14282 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14282_2ndbest <- dup_check_results_DWP_14282 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14282_top_2 <- rbind(dup_check_results_DWP_14282_1stbest, dup_check_results_DWP_14282_2ndbest))

ggplot(data = dup_check_results_DWP_14282_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14282_pass <- dup_check_results_DWP_14282_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14282_pass)
length(unique(dup_check_results_DWP_14282_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14282_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_14282_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *9. PERB16_DWP_14332*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14332_fish_ids)), newname = "PERB16_DWP_14332")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14332_fish_ids)), newname = "PGOD21_DWP_14332")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14332 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14332",
      GODSillyIDs = list("PGOD21_DWP_14332" = rownames(PGOD21_DWP_14332.gcl$counts)),
      HeartSillys = "PERB16_DWP_14332",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14332_best_match <- dup_check_results_DWP_14332 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14332 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14332_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14332 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14332_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14332 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14332_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14332_1stbest <- dup_check_results_DWP_14332 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14332_2ndbest <- dup_check_results_DWP_14332 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14332_top_2 <- rbind(dup_check_results_DWP_14332_1stbest, dup_check_results_DWP_14332_2ndbest))

ggplot(data = dup_check_results_DWP_14332_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14332_pass <- dup_check_results_DWP_14332_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14332_pass)
length(unique(dup_check_results_DWP_14332_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14332_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_14332_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### **PGILMOUR15**

#### *1. PGILMOUR15_DWP_2123*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2123_fish_ids)), newname = "PGILMOUR15_DWP_2123")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2123_fish_ids)), newname = "PGOD21_DWP_2123")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2123 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2123",
      GODSillyIDs = list("PGOD21_DWP_2123" = rownames(PGOD21_DWP_2123.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2123",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2123_best_match <- dup_check_results_DWP_2123 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2123 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2123_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2123 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2123_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2123 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2123_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2123_1stbest <- dup_check_results_DWP_2123 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2123_2ndbest <- dup_check_results_DWP_2123 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2123_top_2 <- rbind(dup_check_results_DWP_2123_1stbest, dup_check_results_DWP_2123_2ndbest))

ggplot(data = dup_check_results_DWP_2123_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2123_pass <- dup_check_results_DWP_2123_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2123_pass)
length(unique(dup_check_results_DWP_2123_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2123_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2123_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *2. PGILMOUR15_DWP_2129*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2129_fish_ids)), newname = "PGILMOUR15_DWP_2129")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2129_fish_ids)), newname = "PGOD21_DWP_2129")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2129 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2129",
      GODSillyIDs = list("PGOD21_DWP_2129" = rownames(PGOD21_DWP_2129.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2129",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2129_best_match <- dup_check_results_DWP_2129 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2129 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2129_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2129 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2129_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2129 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2129_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2129_1stbest <- dup_check_results_DWP_2129 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2129_2ndbest <- dup_check_results_DWP_2129 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2129_top_2 <- rbind(dup_check_results_DWP_2129_1stbest, dup_check_results_DWP_2129_2ndbest))

ggplot(data = dup_check_results_DWP_2129_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2129_pass <- dup_check_results_DWP_2129_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2129_pass)
length(unique(dup_check_results_DWP_2129_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2129_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_2129_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *3. PGILMOUR15_DWP_2161*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2161_fish_ids)), newname = "PGILMOUR15_DWP_2161")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2161_fish_ids)), newname = "PGOD21_DWP_2161")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2161 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2161",
      GODSillyIDs = list("PGOD21_DWP_2161" = rownames(PGOD21_DWP_2161.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2161",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2161_best_match <- dup_check_results_DWP_2161 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2161 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2161_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2161 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2161_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2161 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2161_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2161_1stbest <- dup_check_results_DWP_2161 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2161_2ndbest <- dup_check_results_DWP_2161 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2161_top_2 <- rbind(dup_check_results_DWP_2161_1stbest, dup_check_results_DWP_2161_2ndbest))

ggplot(data = dup_check_results_DWP_2161_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2161_pass <- dup_check_results_DWP_2161_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2161_pass)
length(unique(dup_check_results_DWP_2161_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2161_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2161_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *4. PGILMOUR15_DWP_2192*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2192_fish_ids)), newname = "PGILMOUR15_DWP_2192")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2192_fish_ids)), newname = "PGOD21_DWP_2192")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2192 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2192",
      GODSillyIDs = list("PGOD21_DWP_2192" = rownames(PGOD21_DWP_2192.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2192",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2192_best_match <- dup_check_results_DWP_2192 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2192 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2192_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2192 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2192_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2192 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2192_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2192_1stbest <- dup_check_results_DWP_2192 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2192_2ndbest <- dup_check_results_DWP_2192 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2192_top_2 <- rbind(dup_check_results_DWP_2192_1stbest, dup_check_results_DWP_2192_2ndbest))

ggplot(data = dup_check_results_DWP_2192_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2192_pass <- dup_check_results_DWP_2192_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2192_pass)
length(unique(dup_check_results_DWP_2192_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2192_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2192_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *5. PGILMOUR15_DWP_2195*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2195_fish_ids)), newname = "PGILMOUR15_DWP_2195")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2195_fish_ids)), newname = "PGOD21_DWP_2195")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2195 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2195",
      GODSillyIDs = list("PGOD21_DWP_2195" = rownames(PGOD21_DWP_2195.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2195",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2195_best_match <- dup_check_results_DWP_2195 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2195 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2195_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2195 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2195_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2195 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2195_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2195_1stbest <- dup_check_results_DWP_2195 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2195_2ndbest <- dup_check_results_DWP_2195 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2195_top_2 <- rbind(dup_check_results_DWP_2195_1stbest, dup_check_results_DWP_2195_2ndbest))

ggplot(data = dup_check_results_DWP_2195_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_2195_pass <- dup_check_results_DWP_2195_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_2195_pass)
length(unique(dup_check_results_DWP_2195_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2195_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_2195_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *6. PGILMOUR15_DWP_2228*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2228_fish_ids)), newname = "PGILMOUR15_DWP_2228")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2228_fish_ids)), newname = "PGOD21_DWP_2228")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2228 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2228",
      GODSillyIDs = list("PGOD21_DWP_2228" = rownames(PGOD21_DWP_2228.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2228",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2228_best_match <- dup_check_results_DWP_2228 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2228 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2228_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2228 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2228_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2228 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2228_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2228_1stbest <- dup_check_results_DWP_2228 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2228_2ndbest <- dup_check_results_DWP_2228 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2228_top_2 <- rbind(dup_check_results_DWP_2228_1stbest, dup_check_results_DWP_2228_2ndbest))

ggplot(data = dup_check_results_DWP_2228_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2228_pass <- dup_check_results_DWP_2228_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2228_pass)
length(unique(dup_check_results_DWP_2228_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2228_pass$otolith_fish_id))
```

##### Status: Changed cutoffs; OK

```{r}
write.table(dup_check_results_DWP_2228_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *7. PGILMOUR15_DWP_2232*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2232_fish_ids)), newname = "PGILMOUR15_DWP_2232")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2232_fish_ids)), newname = "PGOD21_DWP_2232")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2232 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2232",
      GODSillyIDs = list("PGOD21_DWP_2232" = rownames(PGOD21_DWP_2232.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2232",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2232_best_match <- dup_check_results_DWP_2232 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2232 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2232_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2232 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2232_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2232 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2232_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2232_1stbest <- dup_check_results_DWP_2232 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2232_2ndbest <- dup_check_results_DWP_2232 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2232_top_2 <- rbind(dup_check_results_DWP_2232_1stbest, dup_check_results_DWP_2232_2ndbest))

ggplot(data = dup_check_results_DWP_2232_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2232_pass <- dup_check_results_DWP_2232_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2232_pass)
length(unique(dup_check_results_DWP_2232_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2232_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2232_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *8. PGILMOUR15_DWP_2234*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2234_fish_ids)), newname = "PGILMOUR15_DWP_2234")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2234_fish_ids)), newname = "PGOD21_DWP_2234")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2234 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2234",
      GODSillyIDs = list("PGOD21_DWP_2234" = rownames(PGOD21_DWP_2234.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2234",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2234_best_match <- dup_check_results_DWP_2234 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2234 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2234_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2234 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2234_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2234 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2234_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2234_1stbest <- dup_check_results_DWP_2234 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2234_2ndbest <- dup_check_results_DWP_2234 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2234_top_2 <- rbind(dup_check_results_DWP_2234_1stbest, dup_check_results_DWP_2234_2ndbest))

ggplot(data = dup_check_results_DWP_2234_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2234_pass <- dup_check_results_DWP_2234_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2234_pass)
length(unique(dup_check_results_DWP_2234_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2234_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2234_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *9. PGILMOUR15_DWP_2505*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2505_fish_ids)), newname = "PGILMOUR15_DWP_2505")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2505_fish_ids)), newname = "PGOD21_DWP_2505")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2505 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2505",
      GODSillyIDs = list("PGOD21_DWP_2505" = rownames(PGOD21_DWP_2505.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2505",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2505_best_match <- dup_check_results_DWP_2505 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2505 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2505_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2505 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2505_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2505 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2505_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2505_1stbest <- dup_check_results_DWP_2505 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2505_2ndbest <- dup_check_results_DWP_2505 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2505_top_2 <- rbind(dup_check_results_DWP_2505_1stbest, dup_check_results_DWP_2505_2ndbest))

ggplot(data = dup_check_results_DWP_2505_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2505_pass <- dup_check_results_DWP_2505_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2505_pass)
length(unique(dup_check_results_DWP_2505_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2505_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2505_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *10. PGILMOUR15_DWP_2838*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2838_fish_ids)), newname = "PGILMOUR15_DWP_2838")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2838_fish_ids)), newname = "PGOD21_DWP_2838")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2838 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2838",
      GODSillyIDs = list("PGOD21_DWP_2838" = rownames(PGOD21_DWP_2838.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2838",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2838_best_match <- dup_check_results_DWP_2838 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2838 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2838_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2838 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2838_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2838 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2838_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2838_1stbest <- dup_check_results_DWP_2838 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2838_2ndbest <- dup_check_results_DWP_2838 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2838_top_2 <- rbind(dup_check_results_DWP_2838_1stbest, dup_check_results_DWP_2838_2ndbest))

ggplot(data = dup_check_results_DWP_2838_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2838_pass <- dup_check_results_DWP_2838_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2838_pass)
length(unique(dup_check_results_DWP_2838_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2838_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2838_pass, "dup_check_results_pass.csv", append = TRUE)
```

# ##########################################

#### **PGILMOUR16**

#### *1.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14395_fish_ids)), newname = "PGILMOUR16_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *2.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14395_fish_ids)), newname = "PGILMOUR16_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```


#### *3. PGILMOUR16 DWP 14573*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14573_fish_ids)), newname = "PGILMOUR16_DWP_14573")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14573_fish_ids)), newname = "PGOD21_DWP_14573")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14573 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14573",
      GODSillyIDs = list("PGOD21_DWP_14573" = rownames(PGOD21_DWP_14573.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14573",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14573_best_match <- dup_check_results_DWP_14573 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14573 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14573_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14573 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14573_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14573_1stbest <- dup_check_results_DWP_14573 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14573_2ndbest <- dup_check_results_DWP_14573 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14573_top_2 <- rbind(dup_check_results_DWP_14573_1stbest, dup_check_results_DWP_14573_2ndbest))

ggplot(data = dup_check_results_DWP_14573_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14573_pass <- dup_check_results_DWP_14573_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14573_pass)
length(unique(dup_check_results_DWP_14573_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14573_pass$otolith_fish_id))
```

#### *4. PGILMOUR16 DWP 14662*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14662_fish_ids)), newname = "PGILMOUR16_DWP_14662")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14662_fish_ids)), newname = "PGOD21_DWP_14662")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14662 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14662",
      GODSillyIDs = list("PGOD21_DWP_14662" = rownames(PGOD21_DWP_14662.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14662",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14662_best_match <- dup_check_results_DWP_14662 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14662 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14662_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14662 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14662_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14662_1stbest <- dup_check_results_DWP_14662 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14662_2ndbest <- dup_check_results_DWP_14662 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14662_top_2 <- rbind(dup_check_results_DWP_14662_1stbest, dup_check_results_DWP_14662_2ndbest))

ggplot(data = dup_check_results_DWP_14662_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14662_pass <- dup_check_results_DWP_14662_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14662_pass)
length(unique(dup_check_results_DWP_14662_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14662_pass$otolith_fish_id))
```

#### *5. PGILMOUR16 DWP 14663*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14663_fish_ids)), newname = "PGILMOUR16_DWP_14663")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14663_fish_ids)), newname = "PGOD21_DWP_14663")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14663 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14663",
      GODSillyIDs = list("PGOD21_DWP_14663" = rownames(PGOD21_DWP_14663.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14663",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14663_best_match <- dup_check_results_DWP_14663 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14663 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14663_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14663 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14663_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14663_1stbest <- dup_check_results_DWP_14663 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14663_2ndbest <- dup_check_results_DWP_14663 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14663_top_2 <- rbind(dup_check_results_DWP_14663_1stbest, dup_check_results_DWP_14663_2ndbest))

ggplot(data = dup_check_results_DWP_14663_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14663_pass <- dup_check_results_DWP_14663_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14663_pass)
length(unique(dup_check_results_DWP_14663_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14663_pass$otolith_fish_id))
```

#### *6. PGILMOUR16 DWP 15826*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_15826_fish_ids)), newname = "PGILMOUR16_DWP_15826")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_15826_fish_ids)), newname = "PGOD21_DWP_15826")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_15826 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_15826",
      GODSillyIDs = list("PGOD21_DWP_15826" = rownames(PGOD21_DWP_15826.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_15826",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_15826_best_match <- dup_check_results_DWP_15826 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_15826 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15826_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_15826 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15826_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_15826_1stbest <- dup_check_results_DWP_15826 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_15826_2ndbest <- dup_check_results_DWP_15826 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_15826_top_2 <- rbind(dup_check_results_DWP_15826_1stbest, dup_check_results_DWP_15826_2ndbest))

ggplot(data = dup_check_results_DWP_15826_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

And, here we are again...

##### Status: OK; changed cutoffs

Duplicate_rate >= 0.7 and diff >= 0.25

```{r}
# filtered results table
(dup_check_results_DWP_15826_pass <- dup_check_results_DWP_15826_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.25))

# vector lengths
nrow(dup_check_results_DWP_15826_pass)
length(unique(dup_check_results_DWP_15826_pass$heart_fish_id))
length(unique(dup_check_results_DWP_15826_pass$otolith_fish_id))
```

#### *7.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14395_fish_ids)), newname = "PGILMOUR16_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *8.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14395_fish_ids)), newname = "PGILMOUR16_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *9.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14395_fish_ids)), newname = "PGILMOUR16_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *10.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14395_fish_ids)), newname = "PGILMOUR16_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *11.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14395_fish_ids)), newname = "PGILMOUR16_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *12.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14395_fish_ids)), newname = "PGILMOUR16_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *13.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14395_fish_ids)), newname = "PGILMOUR16_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### **PGILMOUR17**

#### *1.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_14395_fish_ids)), newname = "PGILMOUR17_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *2.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_14395_fish_ids)), newname = "PGILMOUR17_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *3.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_14395_fish_ids)), newname = "PGILMOUR17_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *4. PGILMOUR17 DWP 22569*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22569_fish_ids)), newname = "PGILMOUR17_DWP_22569")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22569_fish_ids)), newname = "PGOD21_DWP_22569")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22569 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22569",
      GODSillyIDs = list("PGOD21_DWP_22569" = rownames(PGOD21_DWP_22569.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22569",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22569_best_match <- dup_check_results_DWP_22569 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22569 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22569_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22569 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22569_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22569_1stbest <- dup_check_results_DWP_22569 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22569_2ndbest <- dup_check_results_DWP_22569 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22569_top_2 <- rbind(dup_check_results_DWP_22569_1stbest, dup_check_results_DWP_22569_2ndbest))

ggplot(data = dup_check_results_DWP_22569_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22569_pass <- dup_check_results_DWP_22569_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22569_pass)
length(unique(dup_check_results_DWP_22569_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22569_pass$otolith_fish_id))
```

#### *5.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_14395_fish_ids)), newname = "PGILMOUR17_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *6.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_14395_fish_ids)), newname = "PGILMOUR17_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *7.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_14395_fish_ids)), newname = "PGILMOUR17_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *8.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_14395_fish_ids)), newname = "PGILMOUR17_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *9.

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_14395_fish_ids)), newname = "PGILMOUR17_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This will require careful cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15? 

##### Status: TBD

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

#### *10. PGILMOUR17 DWP 22591*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22591_fish_ids)), newname = "PGILMOUR17_DWP_22591")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22591_fish_ids)), newname = "PGOD21_DWP_22591")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22591 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22591",
      GODSillyIDs = list("PGOD21_DWP_22591" = rownames(PGOD21_DWP_22591.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22591",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22591_best_match <- dup_check_results_DWP_22591 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22591 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22591_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22591 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22591_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22591_1stbest <- dup_check_results_DWP_22591 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22591_2ndbest <- dup_check_results_DWP_22591 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22591_top_2 <- rbind(dup_check_results_DWP_22591_1stbest, dup_check_results_DWP_22591_2ndbest))

ggplot(data = dup_check_results_DWP_22591_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: not OK; changed cutoffs but PGOD21_860 still matches 2 otos

Duplicate_rate >= 0.7 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_22591_pass <- dup_check_results_DWP_22591_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_22591_pass)
length(unique(dup_check_results_DWP_22591_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22591_pass$otolith_fish_id))
```

##### Purge multi-matching otos

```{r}
dup_check_results_DWP_22591_pass_dup <- dup_check_results_DWP_22591_pass[duplicated(dup_check_results_DWP_22591_pass$otolith_fish_id), ]
dup_check_results_DWP_22591_pass_dup <- dup_check_results_DWP_22591_pass_dup$otolith_fish_id

(dup_check_results_DWP_22591_pass_purged <- dup_check_results_DWP_22591_pass[!(dup_check_results_DWP_22591_pass$otolith_fish_id == dup_check_results_DWP_22591_pass_dup), ])

length(unique(dup_check_results_DWP_22591_pass_purged$otolith_fish_id)) == nrow(dup_check_results_DWP_22591_pass_purged)
```

#### *11.

#### *12. PGILMOUR17 DWP 22595*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22595_fish_ids)), newname = "PGILMOUR17_DWP_22595")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22595_fish_ids)), newname = "PGOD21_DWP_22595")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22595 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22595",
      GODSillyIDs = list("PGOD21_DWP_22595" = rownames(PGOD21_DWP_22595.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22595",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22595_best_match <- dup_check_results_DWP_22595 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22595 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22595_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22595 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22595_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22595_1stbest <- dup_check_results_DWP_22595 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22595_2ndbest <- dup_check_results_DWP_22595 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22595_top_2 <- rbind(dup_check_results_DWP_22595_1stbest, dup_check_results_DWP_22595_2ndbest))

ggplot(data = dup_check_results_DWP_22595_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22595_pass <- dup_check_results_DWP_22595_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22595_pass)
length(unique(dup_check_results_DWP_22595_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22595_pass$otolith_fish_id))
```

#### *13. PGILMOUR17 DWP 22710*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22710_fish_ids)), newname = "PGILMOUR17_DWP_22710")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22710_fish_ids)), newname = "PGOD21_DWP_22710")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22710 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22710",
      GODSillyIDs = list("PGOD21_DWP_22710" = rownames(PGOD21_DWP_22710.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22710",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22710_best_match <- dup_check_results_DWP_22710 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22710 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22710_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22710 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22710_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22710_1stbest <- dup_check_results_DWP_22710 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22710_2ndbest <- dup_check_results_DWP_22710 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22710_top_2 <- rbind(dup_check_results_DWP_22710_1stbest, dup_check_results_DWP_22710_2ndbest))

ggplot(data = dup_check_results_DWP_22710_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22710_pass <- dup_check_results_DWP_22710_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22710_pass)
length(unique(dup_check_results_DWP_22710_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22710_pass$otolith_fish_id))
```

#### *14. PGILMOUR17 DWP 22751*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22751_fish_ids)), newname = "PGILMOUR17_DWP_22751")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22751_fish_ids)), newname = "PGOD21_DWP_22751")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22751 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22751",
      GODSillyIDs = list("PGOD21_DWP_22751" = rownames(PGOD21_DWP_22751.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22751",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22751_best_match <- dup_check_results_DWP_22751 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22751 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22751_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22751 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22751_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22751_1stbest <- dup_check_results_DWP_22751 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22751_2ndbest <- dup_check_results_DWP_22751 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22751_top_2 <- rbind(dup_check_results_DWP_22751_1stbest, dup_check_results_DWP_22751_2ndbest))

ggplot(data = dup_check_results_DWP_22751_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22751_pass <- dup_check_results_DWP_22751_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22751_pass)
length(unique(dup_check_results_DWP_22751_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22751_pass$otolith_fish_id))
```

#### *15. PGILMOUR17 DWP 22701*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22701_fish_ids)), newname = "PGILMOUR17_DWP_22701")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22701_fish_ids)), newname = "PGOD21_DWP_22701")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22701 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22701",
      GODSillyIDs = list("PGOD21_DWP_22701" = rownames(PGOD21_DWP_22701.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22701",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22701_best_match <- dup_check_results_DWP_22701 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22701 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22701_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22701 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22701_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22701_1stbest <- dup_check_results_DWP_22701 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22701_2ndbest <- dup_check_results_DWP_22701 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22701_top_2 <- rbind(dup_check_results_DWP_22701_1stbest, dup_check_results_DWP_22701_2ndbest))

ggplot(data = dup_check_results_DWP_22701_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

This is a good one. 

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22701_pass <- dup_check_results_DWP_22701_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22701_pass)
length(unique(dup_check_results_DWP_22701_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22701_pass$otolith_fish_id))
```

#### **PGILMOUR18**

#### *1. PGILMOUR18 DWP 28929*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR18", loci = loci, IDs = list("PGILMOUR18" = as.character(PGILMOUR18_DWP_28929_fish_ids)), newname = "PGILMOUR18_DWP_28929")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_28929_fish_ids)), newname = "PGOD21_DWP_28929")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_28929 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_28929",
      GODSillyIDs = list("PGOD21_DWP_28929" = rownames(PGOD21_DWP_28929.gcl$counts)),
      HeartSillys = "PGILMOUR18_DWP_28929",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_28929_best_match <- dup_check_results_DWP_28929 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_28929 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28929_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_28929 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28929_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_28929_1stbest <- dup_check_results_DWP_28929 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_28929_2ndbest <- dup_check_results_DWP_28929 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_28929_top_2 <- rbind(dup_check_results_DWP_28929_1stbest, dup_check_results_DWP_28929_2ndbest))

ggplot(data = dup_check_results_DWP_28929_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_28929_pass <- dup_check_results_DWP_28929_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_28929_pass)
length(unique(dup_check_results_DWP_28929_pass$heart_fish_id))
length(unique(dup_check_results_DWP_28929_pass$otolith_fish_id))
```

#### *2. PGILMOUR18 DWP 28864*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR18", loci = loci, IDs = list("PGILMOUR18" = as.character(PGILMOUR18_DWP_28864_fish_ids)), newname = "PGILMOUR18_DWP_28864")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_28864_fish_ids)), newname = "PGOD21_DWP_28864")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_28864 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_28864",
      GODSillyIDs = list("PGOD21_DWP_28864" = rownames(PGOD21_DWP_28864.gcl$counts)),
      HeartSillys = "PGILMOUR18_DWP_28864",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_28864_best_match <- dup_check_results_DWP_28864 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_28864 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28864_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_28864 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28864_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_28864_1stbest <- dup_check_results_DWP_28864 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_28864_2ndbest <- dup_check_results_DWP_28864 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_28864_top_2 <- rbind(dup_check_results_DWP_28864_1stbest, dup_check_results_DWP_28864_2ndbest))

ggplot(data = dup_check_results_DWP_28864_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_28864_pass <- dup_check_results_DWP_28864_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_28864_pass)
length(unique(dup_check_results_DWP_28864_pass$heart_fish_id))
length(unique(dup_check_results_DWP_28864_pass$otolith_fish_id))
```

#### *3. PGILMOUR18 DWP 28829*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR18", loci = loci, IDs = list("PGILMOUR18" = as.character(PGILMOUR18_DWP_28829_fish_ids)), newname = "PGILMOUR18_DWP_28829")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_28829_fish_ids)), newname = "PGOD21_DWP_28829")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_28829 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_28829",
      GODSillyIDs = list("PGOD21_DWP_28829" = rownames(PGOD21_DWP_28829.gcl$counts)),
      HeartSillys = "PGILMOUR18_DWP_28829",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_28829_best_match <- dup_check_results_DWP_28829 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_28829 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28829_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_28829 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28829_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_28829_1stbest <- dup_check_results_DWP_28829 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_28829_2ndbest <- dup_check_results_DWP_28829 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_28829_top_2 <- rbind(dup_check_results_DWP_28829_1stbest, dup_check_results_DWP_28829_2ndbest))

ggplot(data = dup_check_results_DWP_28829_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK; changed cutoffs

Duplicate_rate >= 0.7 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_28829_pass <- dup_check_results_DWP_28829_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_28829_pass)
length(unique(dup_check_results_DWP_28829_pass$heart_fish_id))
length(unique(dup_check_results_DWP_28829_pass$otolith_fish_id))
```

#### *4. PGILMOUR18 DWP 28807*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR18", loci = loci, IDs = list("PGILMOUR18" = as.character(PGILMOUR18_DWP_28807_fish_ids)), newname = "PGILMOUR18_DWP_28807")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_28807_fish_ids)), newname = "PGOD21_DWP_28807")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_28807 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_28807",
      GODSillyIDs = list("PGOD21_DWP_28807" = rownames(PGOD21_DWP_28807.gcl$counts)),
      HeartSillys = "PGILMOUR18_DWP_28807",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_28807_best_match <- dup_check_results_DWP_28807 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_28807 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28807_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_28807 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28807_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_28807_1stbest <- dup_check_results_DWP_28807 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_28807_2ndbest <- dup_check_results_DWP_28807 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_28807_top_2 <- rbind(dup_check_results_DWP_28807_1stbest, dup_check_results_DWP_28807_2ndbest))

ggplot(data = dup_check_results_DWP_28807_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK; changed cutoffs

Duplicate_rate >= 0.8 and diff >= 0.25

```{r}
# filtered results table
(dup_check_results_DWP_28807_pass <- dup_check_results_DWP_28807_1stbest %>% 
  filter(duplicate_rate >= 0.8) %>% 
  filter(diff >= 0.25))

# vector lengths
nrow(dup_check_results_DWP_28807_pass)
length(unique(dup_check_results_DWP_28807_pass$heart_fish_id))
length(unique(dup_check_results_DWP_28807_pass$otolith_fish_id))
```

#### *5. PGILMOUR18 DWP 28812*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR18", loci = loci, IDs = list("PGILMOUR18" = as.character(PGILMOUR18_DWP_28812_fish_ids)), newname = "PGILMOUR18_DWP_28812")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_28812_fish_ids)), newname = "PGOD21_DWP_28812")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_28812 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_28812",
      GODSillyIDs = list("PGOD21_DWP_28812" = rownames(PGOD21_DWP_28812.gcl$counts)),
      HeartSillys = "PGILMOUR18_DWP_28812",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_28812_best_match <- dup_check_results_DWP_28812 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_28812 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28812_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_28812 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28812_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_28812_1stbest <- dup_check_results_DWP_28812 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_28812_2ndbest <- dup_check_results_DWP_28812 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_28812_top_2 <- rbind(dup_check_results_DWP_28812_1stbest, dup_check_results_DWP_28812_2ndbest))

ggplot(data = dup_check_results_DWP_28812_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK; changed cutoffs

Duplicate_rate >= 0.7 and diff >= 0.25

```{r}
# filtered results table
(dup_check_results_DWP_28812_pass <- dup_check_results_DWP_28812_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.25))

# vector lengths
nrow(dup_check_results_DWP_28812_pass)
length(unique(dup_check_results_DWP_28812_pass$heart_fish_id))
length(unique(dup_check_results_DWP_28812_pass$otolith_fish_id))
```

#### **PPADDY16**

#### *1. PPADDY16 DWP 16104*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_16104_fish_ids)), newname = "PPADDY16_DWP_16104")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16104_fish_ids)), newname = "PGOD21_DWP_16104")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16104 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16104",
      GODSillyIDs = list("PGOD21_DWP_16104" = rownames(PGOD21_DWP_16104.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_16104",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16104_best_match <- dup_check_results_DWP_16104 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16104 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16104_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16104 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16104_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16104_1stbest <- dup_check_results_DWP_16104 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16104_2ndbest <- dup_check_results_DWP_16104 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16104_top_2 <- rbind(dup_check_results_DWP_16104_1stbest, dup_check_results_DWP_16104_2ndbest))

ggplot(data = dup_check_results_DWP_16104_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16104_pass <- dup_check_results_DWP_16104_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16104_pass)
length(unique(dup_check_results_DWP_16104_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16104_pass$otolith_fish_id))
```

#### *2. PPADDY16 DWP 14463*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_14463_fish_ids)), newname = "PPADDY16_DWP_14463")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14463_fish_ids)), newname = "PGOD21_DWP_14463")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14463 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14463",
      GODSillyIDs = list("PGOD21_DWP_14463" = rownames(PGOD21_DWP_14463.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_14463",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14463_best_match <- dup_check_results_DWP_14463 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14463 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14463_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14463 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14463_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14463_1stbest <- dup_check_results_DWP_14463 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14463_2ndbest <- dup_check_results_DWP_14463 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14463_top_2 <- rbind(dup_check_results_DWP_14463_1stbest, dup_check_results_DWP_14463_2ndbest))

ggplot(data = dup_check_results_DWP_14463_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14463_pass <- dup_check_results_DWP_14463_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14463_pass)
length(unique(dup_check_results_DWP_14463_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14463_pass$otolith_fish_id))
```

#### *3. PPADDY16 DWP 16130*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_16130_fish_ids)), newname = "PPADDY16_DWP_16130")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16130_fish_ids)), newname = "PGOD21_DWP_16130")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16130 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16130",
      GODSillyIDs = list("PGOD21_DWP_16130" = rownames(PGOD21_DWP_16130.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_16130",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16130_best_match <- dup_check_results_DWP_16130 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16130 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16130_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16130 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16130_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16130_1stbest <- dup_check_results_DWP_16130 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16130_2ndbest <- dup_check_results_DWP_16130 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16130_top_2 <- rbind(dup_check_results_DWP_16130_1stbest, dup_check_results_DWP_16130_2ndbest))

ggplot(data = dup_check_results_DWP_16130_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK; changed cutoffs

Duplicate_rate >= 0.8 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16130_pass <- dup_check_results_DWP_16130_1stbest %>% 
  filter(duplicate_rate >= 0.8) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16130_pass)
length(unique(dup_check_results_DWP_16130_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16130_pass$otolith_fish_id))
```

#### *4. PPADDY16 DWP 16164*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_16164_fish_ids)), newname = "PPADDY16_DWP_16164")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16164_fish_ids)), newname = "PGOD21_DWP_16164")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16164 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16164",
      GODSillyIDs = list("PGOD21_DWP_16164" = rownames(PGOD21_DWP_16164.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_16164",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16164_best_match <- dup_check_results_DWP_16164 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16164 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16164_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16164 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16164_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16164_1stbest <- dup_check_results_DWP_16164 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16164_2ndbest <- dup_check_results_DWP_16164 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16164_top_2 <- rbind(dup_check_results_DWP_16164_1stbest, dup_check_results_DWP_16164_2ndbest))

ggplot(data = dup_check_results_DWP_16164_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16164_pass <- dup_check_results_DWP_16164_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16164_pass)
length(unique(dup_check_results_DWP_16164_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16164_pass$otolith_fish_id))
```

#### *5. PPADDY16 DWP 16132*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_16132_fish_ids)), newname = "PPADDY16_DWP_16132")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16132_fish_ids)), newname = "PGOD21_DWP_16132")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16132 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16132",
      GODSillyIDs = list("PGOD21_DWP_16132" = rownames(PGOD21_DWP_16132.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_16132",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16132_best_match <- dup_check_results_DWP_16132 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16132 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16132_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16132 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16132_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16132_1stbest <- dup_check_results_DWP_16132 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16132_2ndbest <- dup_check_results_DWP_16132 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16132_top_2 <- rbind(dup_check_results_DWP_16132_1stbest, dup_check_results_DWP_16132_2ndbest))

ggplot(data = dup_check_results_DWP_16132_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

##### Status: OK

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16132_pass <- dup_check_results_DWP_16132_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16132_pass)
length(unique(dup_check_results_DWP_16132_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16132_pass$otolith_fish_id))
```

#### ~~~~~~~~~~~~~~~~~~~~~~All passing

```{r}
dup_check_results_DWP_1st12_pass <- bind_rows(
dup_check_results_DWP_14395_pass,
dup_check_results_DWP_14334_pass,
dup_check_results_DWP_14331_pass,
dup_check_results_DWP_14376_pass,
dup_check_results_DWP_14297_pass,
dup_check_results_DWP_14282_pass,
dup_check_results_DWP_14332_pass,
dup_check_results_DWP_2228_pass_purged,
dup_check_results_DWP_2232_pass,
dup_check_results_DWP_14573_pass,
dup_check_results_DWP_14662_pass,
dup_check_results_DWP_14663_pass,
dup_check_results_DWP_15826_pass,
dup_check_results_DWP_22569_pass,
dup_check_results_DWP_22591_pass_purged,
dup_check_results_DWP_22595_pass,
dup_check_results_DWP_22710_pass,
dup_check_results_DWP_22751_pass,
dup_check_results_DWP_22701_pass,
dup_check_results_DWP_28929_pass,
dup_check_results_DWP_28864_pass,
dup_check_results_DWP_28829_pass,
dup_check_results_DWP_28807_pass,
dup_check_results_DWP_28812_pass,
dup_check_results_DWP_16104_pass,
dup_check_results_DWP_14463_pass,
dup_check_results_DWP_16130_pass,
dup_check_results_DWP_16164_pass,
dup_check_results_DWP_16132_pass)

write_csv(dup_check_results_DWP_1st12_pass, "dup_check_results_DWP_1st12_pass.csv")
```

```{r}
# read in the tray position and well code key
well_location_key <- read_csv("../../GOD/KEY_WELL_CODE_tray_posn_by_col.csv")

# join with original and jumbled DWP well info
oceanak_affected_DWP_wells <- oceanak_affected_DWPs %>% 
  select(c(SILLY_CODE, FISH_ID, DNA_TRAY_CODE, DNA_TRAY_WELL_CODE)) 
oceanak_affected_DWP_wells$heart_fish_id <- paste0(oceanak_affected_DWP_wells$SILLY_CODE, "_", oceanak_affected_DWP_wells$FISH_ID)

dup_check_results_DWP_1st12_pass_with_wells <- attributes_and_xfer_PGOD21 %>% 
  mutate(otolith_fish_id = SillySource) %>% 
  right_join(dup_check_results_DWP_1st12_pass, by = "otolith_fish_id") %>% 
  select(c(otolith_fish_id, `48_DWP_tray_barcode`, `48_DWP_tray_position`, heart_fish_id)) %>% 
  right_join(oceanak_affected_DWP_wells, by = "heart_fish_id") %>% 
  select(-c(SILLY_CODE, FISH_ID, DNA_TRAY_CODE)) %>% 
  inner_join(well_location_key, by = "DNA_TRAY_WELL_CODE") %>% 
  select(`48_DWP_tray_barcode`, heart_fish_id, OG_48_DWP_tray_position, otolith_fish_id, `48_DWP_tray_position`)

write_csv(dup_check_results_DWP_1st12_pass_with_wells, "dup_check_results_DWP_1st12_pass_with_wells.csv")
```

# Investigating instances with multiple otos matching the same heart

Bind duplicate check results from all DWPs
```{r}
dup_check_results_DWP_1st12_all <- bind_rows(
dup_check_results_DWP_14395,
dup_check_results_DWP_14334,
dup_check_results_DWP_14331,
dup_check_results_DWP_14376,
dup_check_results_DWP_14297,
dup_check_results_DWP_14282,
dup_check_results_DWP_14332,
dup_check_results_DWP_2228,
dup_check_results_DWP_2232,
dup_check_results_DWP_14573,
dup_check_results_DWP_14662,
dup_check_results_DWP_14663,
dup_check_results_DWP_15826,
dup_check_results_DWP_22569,
dup_check_results_DWP_22591,
dup_check_results_DWP_22595,
dup_check_results_DWP_22710,
dup_check_results_DWP_22751,
dup_check_results_DWP_22701,
dup_check_results_DWP_28929,
dup_check_results_DWP_28864,
dup_check_results_DWP_28829,
dup_check_results_DWP_28807,
dup_check_results_DWP_28812,
dup_check_results_DWP_16104,
dup_check_results_DWP_14463,
dup_check_results_DWP_16130,
dup_check_results_DWP_16164,
dup_check_results_DWP_16132)
```

Filter for hearts that have multiple otos matching at > 0.70 duplicate rate
We never went below 0.70 duplicate rate, so that is what I went with ;)
```{r}
(
  hearts_with_multiple_matchy_otos <-
    dup_check_results_DWP_1st12_all %>%
    filter(duplicate_rate > 0.7) %>%
    count(heart_fish_id) %>%
    filter(n > 1) %>%
    pull(heart_fish_id)
)
```

Plot otolith genotyping success vs. duplicate rate for these multiple matchers
```{r fig.width=10, fig.height=20}
# facet by heart ID
dup_check_results_DWP_1st12_all %>% 
  filter(heart_fish_id %in% hearts_with_multiple_matchy_otos) %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id), ncol = 7) +
  theme_bw()
```

## Investigate heterozygosity

WTF is going on with some of these fish, like PGILMOUR15_2951? Must have lots of hets due to contamination, right???

Create function
```{r}
Ho_ind <- function(silly = "PGILMOUR15") {
  
  indata1 <- get(paste0(silly, ".gcl"))$counts[ , , 1]
  
  indata1 %>% 
  as_tibble(rownames = "fish_id") %>% 
  gather(locus, genotype, -fish_id) %>% 
  group_by(fish_id) %>% 
  summarise(Ho = sum(genotype == 1, na.rm = TRUE) / length(!is.na(genotype)), .groups = "drop") %>% 
  arrange(desc(Ho))
}
```

### PGILMOUR15

```{r}
(Ho_PGILMOUR15 <- Ho_ind(silly = "PGILMOUR15"))
```
Oh ya, that fish is for sure contaminated. Better caclulate Ho for all hearts and just purge anything over 0.50 (overly simplified!!!) for now just to reduce the noise factor.

### All hearts

Calculate Ho
```{r}
(
  Ho_OGSillys <- sapply(OGSillys, function(silly) {
    Ho_ind(silly = silly)
  }, simplify = FALSE) %>%
    bind_rows(.id = "silly") %>% 
    unite(col = "heart_fish_id", c("silly", "fish_id"))
)
```

Get a vector of heart fish ids with Ho >0.5
```{r}
hearts_too_Ho <- Ho_OGSillys %>% 
  filter(Ho > 0.5) %>% 
  pull(heart_fish_id)
```

How many hearts does that remove?
```{r}
length(hearts_with_multiple_matchy_otos)
length(setdiff(hearts_with_multiple_matchy_otos, hearts_too_Ho))
```

Great, down to only 53 hearts with multiple matchy otoliths :)

Plot otolith genotyping success vs. duplicate rate for these multiple matchers
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_1st12_all %>% 
  filter(heart_fish_id %in% hearts_with_multiple_matchy_otos,
         !heart_fish_id %in% hearts_too_Ho) %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id), ncol = 7) +
  theme_bw()
```
