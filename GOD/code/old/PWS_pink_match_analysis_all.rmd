---
title: "PWS_pink_match_analysis_all"
author: "Kristen Gruenthal and Kyle Shedd"
date: "`r Sys.Date()`"
output:
  html_notebook:
    theme: united
    toc: yes
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
rm(list=ls())

library(tidyverse)
library(lubridate)
library(DT)
library(abind)
bbind <- function(...) { abind(..., along = 3) }

source("~/R/Functions.GCL.R")
source("../../GOD/LOKI2R_ind.GCL.R")
source("../../GOD/DupCheckBetweenSillys_GOD.GCL.r")

knitr::opts_chunk$set(echo = TRUE)
```

# Objective

The purpose of this notebook is to determine whether we can successfully re-pair GTseq genotypes from otolith-derived DNA with GT-seq genotypes from heart-derived DNA for individuals of unknown origin.

# Background

During shipment of otolith samples to the MTA in Juneau for reading, a significant proportion of otoliths migrated between cells within DWPs due to poor containment of the acetate lids that were attached with rubber bands to the DWPs. This incident is known as "the great otolith debacle", aka the "GOD" incident. Since some otoliths moved from their original cells in the DWP, the paired integrity of the otolith-origin information and the rest of the paired data (genotype + field data) was lost for many individuals. In an attempt to rectify the "GOD" incident, we are extracting DNA from the otolith tissues, genotyping the otolith-derived DNA at 298 GT-seq loci, and attempting to re-pair the otolith-heart samples from their genotypes.  

# Methods

DNA was extracted from left-side or unknown otolith tissues of unknown origin using conventional Machery-Nagel DNA extraction kits. Otoliths were placed in T1 buffer for an overnight soak in clear 96 shallow-well plates (SWP). Preamp at 14 cycles. Final elution volume was 75uL. All otoliths were transferred among plates with a jig. All liquid handling was done by robot.

## LocusControl

```{r}
.username <- ""
.password <- ""
```


```{r}
loci <- dget("../../Objects/loci298.txt") # saved list of loci

CreateLocusControl.GCL(locusnames = loci, username = .username, password = .password)
loci <- LocusControl$locusnames
nalleles <- LocusControl$nalleles
ploidy <- LocusControl$ploidy
alleles <- LocusControl$alleles
```

```{r}
# Otolith SILLY
PGOD21 <- "PGOD21"
LOKI2R.GCL(sillyvec = PGOD21, username = .username, password = .password)

# # read in attributes data from last round(s) and remove already processed fish_ids
# attributes_PGOD21_012522 <- read_csv("attributes_PGOD21_012522.csv")
# processed_PGOD21_fish_ids <- attributes_PGOD21_012522$FK_FISH_ID
# RemoveIDs.GCL(silly = "PGOD21", IDs = processed_PGOD21_fish_ids)

# create a csv from the otolith transfer spreadsheet from MTAL, read in the data, and create a concatenated tray and well column
oto_xfer_data <- read_csv("otolith_transfer_111721.csv") # csv mod of MTAL final "otolith_transfer_96_template_LEFT_all trays_17Nov21.xlsx"
oto_xfer_data$DNA_TRAY_AND_WELL <- paste0(oto_xfer_data$`96_oto_tray_barcode`, "_", oto_xfer_data$`96_oto_tray_position`)

# download csv of PGOD21 sample data from OceanAK and append with _PGOD21_DATE
oceanak_PGOD21 <- read_csv("GEN_SAMPLED_FISH_TISSUE_PGOD21_090922.csv")

# pull the attributes table from PGOD21.gcl, create a new tray a well column, and join with the otolith transfer data
attributes_PGOD21 <- PGOD21.gcl$attributes %>%
  transform(DNA_TRAY_CODE = as.numeric(DNA_TRAY_CODE))

write_csv(attributes_PGOD21, "attributes_PGOD21_090922.csv") # use SillySource from prior dates to remove already processed IDs from PGOD21.gcl

attributes_PGOD21$DNA_TRAY_AND_WELL <- paste0(attributes_PGOD21$DNA_TRAY_CODE, "_", attributes_PGOD21$DNA_TRAY_WELL_CODE)
attributes_and_xfer_PGOD21 <- left_join(attributes_PGOD21, oto_xfer_data, by = "DNA_TRAY_AND_WELL")

# get a list of the affected DWPs
affected_DWPs <- unique(attributes_and_xfer_PGOD21$`48_DWP_tray_barcode`)

# filter OceanAK data pull for the list of affected DWPs
AHRP_oceanak_pull <- read_csv(file = "../../OceanAK/AHRP Salmon Biological Data 20220124_151655.csv") %>% # pull if date stamp is old
  transform(DNA_TRAY_CODE = as.numeric(DNA_TRAY_CODE))
oceanak_affected_DWPs <- AHRP_oceanak_pull[AHRP_oceanak_pull$DNA_TRAY_CODE %in% affected_DWPs, ]

write_csv(oceanak_affected_DWPs, "oceanak_affected_DWPs.csv")

# get SILLYs and fish IDs for affected DWPs
DWP_sillys <- unique(oceanak_affected_DWPs$SILLY_CODE)

PERB15_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PERB15") %>% 
  pull(FISH_ID)
PERB16_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PERB16") %>% 
  pull(FISH_ID)
PERB17_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PERB17") %>% 
  pull(FISH_ID)
PERB18_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PERB18") %>% 
  pull(FISH_ID)
PGILMOUR15_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR15") %>% 
  pull(FISH_ID)
PGILMOUR16_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR16") %>% 
  pull(FISH_ID)
PGILMOUR17_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR17") %>% 
  pull(FISH_ID)
PGILMOUR18_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PGILMOUR18") %>% 
  pull(FISH_ID)
PPADDY15_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PPADDY15") %>% 
  pull(FISH_ID)
PPADDY16_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PPADDY16") %>% 
  pull(FISH_ID)
PPADDY17_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PPADDY17") %>% 
  pull(FISH_ID)
PPADDY18_fish_ids <- oceanak_affected_DWPs %>% 
  dplyr::filter(SILLY_CODE == "PPADDY18") %>% 
  pull(FISH_ID)
```

PERB15: 720
PERB16: 3009
PERB17: 1056
PERB18: 0
PGILMOUR15: 2946
PGILMOUR16: 2736
PGILMOUR17: 3667
PGILMOUR18: 1311
PPADDY15: 0
PPADDY16: 2137
PPADDY17: 0
PPADDY18: 0
Sum: 17,582

```{r}
# Project SILLYs by individuals in a SILLY per affected DWP
# Comment out those SILLYs that have empty fish_ids above

# If LOKI2R_ind does not work for a list with >1000 fish IDs, construct the full *.gcl and remove blacklisted individuals as follows
# LOKI2R.GCL(sillyvec = PERB16, username = .username, password = .password)
# all_PERB16_fish_ids <- PERB16.gcl$attributes$FK_FISH_ID
# unused_PERB16_fish_ids <- all_PERB16_fish_ids[!(all_PERB16_fish_ids %in% PERB16_fish_ids)]
# RemoveIDs.GCL(silly = "PERB16", IDs = unused_PERB16_fish_ids)

PERB15 <- "PERB15"
LOKI2R_ind.GCL(sillyvec = PERB15, fish_ids = PERB15_fish_ids, username = .username, password = .password)

PERB16 <- "PERB16"
# LOKI2R_ind.GCL(sillyvec = PERB16, fish_ids = PERB16_fish_ids, username = .username, password = .password)
LOKI2R.GCL(sillyvec = PERB16, username = .username, password = .password)
all_PERB16_fish_ids <- PERB16.gcl$attributes$FK_FISH_ID
unused_PERB16_fish_ids <- all_PERB16_fish_ids[!(all_PERB16_fish_ids %in% PERB16_fish_ids)]
RemoveIDs.GCL(silly = "PERB16", IDs = unused_PERB16_fish_ids)

PERB17 <- "PERB17"
# LOKI2R_ind.GCL(sillyvec = PERB17, fish_ids = PERB17_fish_ids, username = .username, password = .password)
LOKI2R.GCL(sillyvec = PERB17, username = .username, password = .password)
all_PERB17_fish_ids <- PERB17.gcl$attributes$FK_FISH_ID
unused_PERB17_fish_ids <- all_PERB17_fish_ids[!(all_PERB17_fish_ids %in% PERB17_fish_ids)]
RemoveIDs.GCL(silly = "PERB17", IDs = unused_PERB17_fish_ids)

# PERB18 <- "PERB18"
# LOKI2R_ind.GCL(sillyvec = PERB18, fish_ids = PERB18_fish_ids, username = .username, password = .password)

PGILMOUR15 <- "PGILMOUR15"
# LOKI2R_ind.GCL(sillyvec = PGILMOUR15, fish_ids = PGILMOUR15_fish_ids, username = .username, password = .password)
LOKI2R.GCL(sillyvec = PGILMOUR15, username = .username, password = .password)
all_PGILMOUR15_fish_ids <- PGILMOUR15.gcl$attributes$FK_FISH_ID
unused_PGILMOUR15_fish_ids <- all_PGILMOUR15_fish_ids[!(all_PGILMOUR15_fish_ids %in% PGILMOUR15_fish_ids)]
RemoveIDs.GCL(silly = "PGILMOUR15", IDs = unused_PGILMOUR15_fish_ids)

PGILMOUR16 <- "PGILMOUR16"
# LOKI2R_ind.GCL(sillyvec = PGILMOUR16, fish_ids = PGILMOUR16_fish_ids, username = .username, password = .password) 
LOKI2R.GCL(sillyvec = PGILMOUR16, username = .username, password = .password)
all_PGILMOUR16_fish_ids <- PGILMOUR16.gcl$attributes$FK_FISH_ID
unused_PGILMOUR16_fish_ids <- all_PGILMOUR16_fish_ids[!(all_PGILMOUR16_fish_ids %in% PGILMOUR16_fish_ids)]
RemoveIDs.GCL(silly = "PGILMOUR16", IDs = unused_PGILMOUR16_fish_ids)

PGILMOUR17 <- "PGILMOUR17"
# LOKI2R_ind.GCL(sillyvec = PGILMOUR17, fish_ids = PGILMOUR17_fish_ids, username = .username, password = .password)
LOKI2R.GCL(sillyvec = PGILMOUR17, username = .username, password = .password)
all_PGILMOUR17_fish_ids <- PGILMOUR17.gcl$attributes$FK_FISH_ID
unused_PGILMOUR17_fish_ids <- all_PGILMOUR17_fish_ids[!(all_PGILMOUR17_fish_ids %in% PGILMOUR17_fish_ids)]
RemoveIDs.GCL(silly = "PGILMOUR17", IDs = unused_PGILMOUR17_fish_ids)

PGILMOUR18 <- "PGILMOUR18"
# LOKI2R_ind.GCL(sillyvec = PGILMOUR18, fish_ids = PGILMOUR18_fish_ids, username = .username, password = .password)
LOKI2R.GCL(sillyvec = PGILMOUR18, username = .username, password = .password)
all_PGILMOUR18_fish_ids <- PGILMOUR18.gcl$attributes$FK_FISH_ID
unused_PGILMOUR18_fish_ids <- all_PGILMOUR18_fish_ids[!(all_PGILMOUR18_fish_ids %in% PGILMOUR18_fish_ids)]
RemoveIDs.GCL(silly = "PGILMOUR18", IDs = unused_PGILMOUR18_fish_ids)

# PPADDY15 <- "PPADDY15"
# LOKI2R_ind.GCL(sillyvec = PPADDY15, fish_ids = PPADDY18_fish_ids, username = .username, password = .password)

PPADDY16 <- "PPADDY16"
# LOKI2R_ind.GCL(sillyvec = PPADDY16, fish_ids = PPADDY16_fish_ids, username = .username, password = .password)
LOKI2R.GCL(sillyvec = PPADDY16, username = .username, password = .password)
all_PPADDY16_fish_ids <- PPADDY16.gcl$attributes$FK_FISH_ID
unused_PPADDY16_fish_ids <- all_PPADDY16_fish_ids[!(all_PPADDY16_fish_ids %in% PPADDY16_fish_ids)]
RemoveIDs.GCL(silly = "PPADDY16", IDs = unused_PPADDY16_fish_ids)

# PPADDY18 <- "PPADDY17"
# LOKI2R_ind.GCL(sillyvec = PPADDY17, fish_ids = PPADDY17_fish_ids, username = .username, password = .password)

# PPADDY18 <- "PPADDY18"
# LOKI2R_ind.GCL(sillyvec = PPADDY18, fish_ids = PPADDY18_fish_ids, username = .username, password = .password)
```

```{r}
rm(.username, .password)
```

Create new directories and save objects

```{r save_locus_control_sillys}
if(!dir.exists("../../Objects/GOD_21_Final-1/")) {dir.create("../../Objects/GOD_21_Final-1/")}
save_objects(objects = c("LocusControl", "loci", "PGOD21", "PERB15", "PERB16", "PERB17", "PGILMOUR15", "PGILMOUR16", "PGILMOUR17", "PGILMOUR18", "PPADDY16"), path = "../../Objects/GOD_21_Final-1/")

if(!dir.exists("../../Genotypes/GOD_21_Final-1/")) {dir.create("../../Genotypes/GOD_21_Final-1/")}
save_sillys(sillyvec = c("PGOD21", "PERB15", "PERB16", "PERB17", "PGILMOUR15", "PGILMOUR16", "PGILMOUR17", "PGILMOUR18", "PPADDY16"), path = "../../Genotypes/GOD_21_Final-1/")
```

Load objects if revisiting

```{r load_objects}
# load_objects(path = "../../Objects/GOD_21_Final-1")
# load_sillys(path = "../../Genotypes/GOD_21_Final-1")
```

### Otolith genotyping success

```{r fig.height=12}
TestQCSampleSizebyLocus <-
  SampSizeByLocus.GCL(sillyvec = PGOD21, loci = loci)

TestQCPercentbyLocus <-
  apply(TestQCSampleSizebyLocus, 1, function(row) {
    row / max(row)
  })

(locus_success_rate_qc <- TestQCPercentbyLocus %>% 
  as_tibble(rownames = "locus") %>%
  dplyr::rename(success_rate = PGOD21) %>%
  arrange(success_rate))

locus_success_rate_qc %>%
  filter(success_rate == 0)

(failed_loci_otoliths <- locus_success_rate_qc %>%
  filter(success_rate == 0) %>%
  pull(locus))

# plot of per locus genotyping success
TestQCPercentbyLocus %>%
  as_tibble(rownames = "locus") %>%
  gather(silly, percent,-locus) %>%
  ggplot(aes(x = silly, y = locus)) +
    geom_tile(aes(fill = percent), color = "white") +
    scale_fill_gradient(
      low = "black",
      high = "white",
      limits = c(0, 1)
    ) +
    ylab("Locus") +
    xlab("SILLY") +
    ggtitle("Percent genotyped by silly/locus") +
    labs(fill = "Percent\ngenotyped")
```

**0 / 298** loci failed; rates >17% (see table).

## QA project genotypes

### Otoliths

#### Remove fails and dupes

Let's see how badly the otoliths genotyped. 

```{r}
PGOD21.gcl$counts[, , 1] %>% 
  as_tibble(rownames = "fish_id") %>% 
  gather(locus, genotype, -fish_id) %>% 
  group_by(fish_id) %>% 
  summarise(proportion_missing = sum(is.na(genotype)) / length(loci)) %>% 
  arrange(desc(proportion_missing))
```

There are 10,791 total otos in PGOD21, some of which failed, although we need to keep as many as possible. 

Histogram of proportion missing
```{r}
PGOD21.gcl$counts[, , 1] %>% 
  as_tibble(rownames = "fish_id") %>% 
  gather(locus, genotype, -fish_id) %>% 
  group_by(fish_id) %>% 
  summarise(proportion_missing = sum(is.na(genotype)) / length(loci)) %>% 
  ggplot(aes(x = proportion_missing)) +
  geom_histogram(binwidth = 0.05) +
  theme_bw() +
  ggtitle("% Locus Failure Rate by Fish in PGOD21")
```

We will retain the 15% cutoff (85% retention) from the initial rounds, giving us a minimum of 45 loci that must be genotyped. The internal duplicate rate check will be 99%. 

```{r}
PGOD21_SampleSizes <- matrix(
    data = NA,
    nrow = length(PGOD21),
    ncol = 4,
    dimnames = list(PGOD21, c("Genotyped", "Missing", "Duplicate", "Final"))
  )

PGOD21_SampleSizes[, "Genotyped"] <- sapply(paste(PGOD21, ".gcl", sep = ''), function(x)
    get(x)$n)


(MissLoci <- RemoveIndMissLoci.GCL(sillyvec = PGOD21, proportion = 0.15))

ColSizePostMissLoci <- sapply(paste(PGOD21, ".gcl", sep = ''), function(x)
    get(x)$n)

PGOD21_SampleSizes[, "Missing"] <- PGOD21_SampleSizes[, "Genotyped"] - ColSizePostMissLoci

DuplicateCheck99MinProportion <- CheckDupWithinSilly.GCL(
    sillyvec = PGOD21,
    loci = loci,
    quantile = NULL,
    minproportion = 0.99
  )

DuplicateCheckReportSummary <- sapply(PGOD21, function(x)
    DuplicateCheck99MinProportion[[x]]$report, simplify = FALSE)

DuplicateCheckReportSummary

nDupsBySilly <- sapply(DuplicateCheckReportSummary, function(silly) {
    ifelse(is.character(silly), 0, nrow(as.matrix(silly)))
  })
RemovedDups <- RemoveDups.GCL(DuplicateCheck99MinProportion)

sapply(DuplicateCheckReportSummary[nDupsBySilly >= 1], function(silly) {
  if (1 %in% abs(as.numeric(levels(silly$ID1)) - as.numeric(levels(silly$ID2)))) {
    "Sequential IDs found as duplicates, check 'DuplicateCheckReportSummary' for duplicated rows"
  } else {
    "Duplicates exist, but IDs do not appear sequential"
  }
})

DuplicateCheckReportSummary[nDupsBySilly >= 1]  # Show within silly duplicates

ColSizePostDuplicate <- ColSizePostMissLoci - nDupsBySilly
ColSizePostDuplicate <- sapply(paste(PGOD21, ".gcl", sep = ''), function(x) get(x)$n)

PGOD21_SampleSizes[, "Duplicate"] <- ColSizePostMissLoci - ColSizePostDuplicate

PGOD21_SampleSizes[, "Final"] <- ColSizePostDuplicate

PGOD21_SampleSizes
```

We have 10,260 / 10,791 otoliths remaining, with 522 failing the missingness and 9 failing the duplicate rate filters.

**NOTE** We need to remove both duplicates, however, since we won't know which one is the true match to the heart genotype. The function `RemoveDups.GCL` only removes one (above), and we manually remove the other.

```{r}
(
  duplicates_to_remove <- DuplicateCheckReportSummary$PGOD21 %>%
    select(ID1, ID2) %>%
    pivot_longer(
      cols = everything(),
      names_to = "trash",
      values_to = "fish_ids"
    ) %>%
    pull(fish_ids)
)

RemoveIDs.GCL(silly = "PGOD21", IDs = duplicates_to_remove)
```

There should now be 10,251 otos going forward.

#### Final set

##### Genotyping success

```{r}
loci_intersect <- setdiff(loci, failed_loci_otoliths) # all 298 are there

qc_proportion_missing <- function(indata3 = PGOD21.gcl$counts[, , 1]) {
    indata3 %>%
    as_tibble(rownames = "fish_id") %>%
    gather(locus, genotype,-fish_id) %>%
    group_by(fish_id) %>%
    summarise(proportion_missing = sum(is.na(genotype)) / 298) %>%
    arrange(desc(proportion_missing))
}

qc_proportion_missing_plot <- function(indata4 = qc_proportion_missing_PGOD21) {
  indata4 %>% 
  ggplot(aes(x = proportion_missing)) +
  geom_histogram() +
  xlim(0, 1.1) +
  theme_bw()
}

qc_proportion_missing_PGOD21 <- qc_proportion_missing()
qc_proportion_missing_plot()
```

##### Heterozygosity

Excess heterozygosity can be an indication of contamination. We know there is some contamination among the heart-derived GT-seq genotypes, but it is good to understand the magnitude.

```{r}
Ho_qc <- function(indata1 = PGOD21.gcl$counts[ , , 1]) {
  indata1 %>% 
  as_tibble(rownames = "qc_fish_id") %>% 
  gather(locus, genotype, -qc_fish_id) %>% 
  group_by(qc_fish_id) %>% 
  summarise(Ho_qc = sum(genotype == 1, na.rm = TRUE) / length(!is.na(genotype)), .groups = "drop") %>% 
  arrange(desc(Ho_qc))
}

Ho_qc_plot <- function(indata2 = Ho_qc_PGOD21) {
  indata2 %>% 
  ggplot(aes(x = Ho_qc)) +
  geom_histogram(binwidth = 1/298) +
  theme_bw()
}

Ho_qc_PGOD21 <- Ho_qc()
Ho_qc_plot()
```

Ho is >50% for a bunch of otoliths, indicating contamination.

### Hearts

#### Remove fails and dupes

For the other SILLYS we'll compare to, we'll leave the cutoff at 80% and perform the regular 95% duplicate rate check.

```{r}
OGSillys <- c("PERB15", "PERB16", "PERB17", "PGILMOUR15", "PGILMOUR16", "PGILMOUR17", "PGILMOUR18", "PPADDY16")

OGSillys_SampleSizes <- matrix(
    data = NA,
    nrow = length(OGSillys),
    ncol = 4,
    dimnames = list(OGSillys, c("Genotyped", "Missing", "Duplicate", "Final"))
  )

OGSillys_SampleSizes[, "Genotyped"] <- sapply(paste(OGSillys, ".gcl", sep = ''), function(x)
    get(x)$n)


(MissLoci <- RemoveIndMissLoci.GCL(sillyvec = OGSillys, proportion = 0.8))

ColSizePostMissLoci <- sapply(paste(OGSillys, ".gcl", sep = ''), function(x)
    get(x)$n)

OGSillys_SampleSizes[, "Missing"] <- OGSillys_SampleSizes[, "Genotyped"] - ColSizePostMissLoci

DuplicateCheck95MinProportion <- CheckDupWithinSilly.GCL(
    sillyvec = OGSillys,
    loci = loci,
    quantile = NULL,
    minproportion = 0.95
  )

DuplicateCheckReportSummary <- sapply(OGSillys, function(x)
    DuplicateCheck95MinProportion[[x]]$report, simplify = FALSE)

DuplicateCheckReportSummary

nDupsBySilly <- sapply(DuplicateCheckReportSummary, function(silly) {
    ifelse(is.character(silly), 0, nrow(as.matrix(silly)))
  })
RemovedDups <- RemoveDups.GCL(DuplicateCheck95MinProportion)

sapply(DuplicateCheckReportSummary[nDupsBySilly >= 1], function(silly) {
  if (1 %in% abs(as.numeric(levels(silly$ID1)) - as.numeric(levels(silly$ID2)))) {
    "Sequential IDs found as duplicates, check 'DuplicateCheckReportSummary' for duplicated rows"
  } else {
    "Duplicates exist, but IDs do not appear sequential"
  }
})

DuplicateCheckReportSummary[nDupsBySilly >= 1]  # Show within silly duplicates

ColSizePostDuplicate <- ColSizePostMissLoci - nDupsBySilly
ColSizePostDuplicate <- sapply(paste(OGSillys, ".gcl", sep = ''), function(x) get(x)$n)

OGSillys_SampleSizes[, "Duplicate"] <- ColSizePostMissLoci - ColSizePostDuplicate

OGSillys_SampleSizes[, "Final"] <- ColSizePostDuplicate

OGSillys_SampleSizes
```

# ------------------REMOVE HETS----------------------------

Visualize

```{r}
Ho_qc_PERB15 <- Ho_qc(PERB15.gcl$counts[ , , 1])
Ho_qc_plot(Ho_qc_PERB15)

Ho_qc_PERB16 <- Ho_qc(PERB16.gcl$counts[ , , 1])
Ho_qc_plot(Ho_qc_PERB16)

Ho_qc_PERB17 <- Ho_qc(PERB17.gcl$counts[ , , 1])
Ho_qc_plot(Ho_qc_PERB17)

Ho_qc_PGILMOUR15 <- Ho_qc(PGILMOUR15.gcl$counts[ , , 1])
Ho_qc_plot(Ho_qc_PGILMOUR15)

Ho_qc_PGILMOUR16 <- Ho_qc(PGILMOUR16.gcl$counts[ , , 1])
Ho_qc_plot(Ho_qc_PGILMOUR16)

Ho_qc_PGILMOUR17 <- Ho_qc(PGILMOUR17.gcl$counts[ , , 1])
Ho_qc_plot(Ho_qc_PGILMOUR17)

Ho_qc_PGILMOUR18 <- Ho_qc(PGILMOUR18.gcl$counts[ , , 1])
Ho_qc_plot(Ho_qc_PGILMOUR18)

Ho_qc_PPADDY16 <- Ho_qc(PPADDY16.gcl$counts[ , , 1])
Ho_qc_plot(Ho_qc_PPADDY16)
```

Remove according to 1.5 IQR cutoff

```{r}

```


### Final sample sizes (reiterated)

```{r}
PGOD21.gcl$n
PERB15.gcl$n
PERB16.gcl$n
PERB17.gcl$n
PGILMOUR15.gcl$n
PGILMOUR16.gcl$n
PGILMOUR17.gcl$n
PGILMOUR18.gcl$n
PPADDY16.gcl$n
```

As a reminder, PGOD21 genotyped more SILLYs and DWPs than we have heart genotypes for, which comes into play when we do the DWP-by-DWP matching.

## Duplicate rate check

### Arrange attributes by DWPs - ###PULL DWP CODES AND REVISE INDATA###
```{r}
# figure out the SILLYs associated with the DWPs and join
PGOD21_DWPs <- attributes_and_xfer_PGOD21 %>% 
  dplyr::select(`48_DWP_tray_barcode`)

write_csv(PGOD21_DWPs, "PGOD21_DWPs_091222.csv") # change date
# used this list plus SILLY_CODE and DNA_TRAY_CODE in oceanak_affected_DWPs.csv to do a vlookup in excel for the SILLY_CODE associated with the 48_DWP_tray_barcode - it's probably possible to do a vlookup type thing using join, but here we are...
 
# copied SILLY_CODE column in PGOD21_DWPs.csv to OG_SILLY_CODE, trimmed all columns to correct length, saved as new csv, and uploaded
# PGOD21_DWPs_and_SILLYs <- read_csv("PGOD21_DWPs_and_SILLYs_042721.csv") 
PGOD21_DWPs_and_SILLYs <- read_csv("PGOD21_DWPs_and_SILLYs_trimmed_091322.csv")

attributes_xfer_and_SILLY_PGOD21 <- attributes_and_xfer_PGOD21 
attributes_xfer_and_SILLY_PGOD21$OG_SILLY_CODE <- PGOD21_DWPs_and_SILLYs$OG_SILLY_CODE

new_PGOD21_attributes_and_SILLY <- left_join(PGOD21.gcl$attributes, attributes_xfer_and_SILLY_PGOD21, by = "SillySource")

write_csv(new_PGOD21_attributes_and_SILLY, "new_PGOD21_attributes_and_SILLY_091322.csv")

# break down new_PGOD21_attributes_and_SILLY into individual DWPs
# NOTE: need to figure out a loop based on PGOD21_DWPs
PGOD21_by_DWP <- function(indata = "14331") {
  new_PGOD21_attributes_and_SILLY %>% 
    dplyr::filter(`48_DWP_tray_barcode` == indata)
}

PGOD21_DWP_14331 <- PGOD21_by_DWP(indata = "14331")
PGOD21_DWP_21941 <- PGOD21_by_DWP(indata = "21941")
PGOD21_DWP_14376 <- PGOD21_by_DWP(indata = "14376")
PGOD21_DWP_14334 <- PGOD21_by_DWP(indata = "14334")
PGOD21_DWP_14332 <- PGOD21_by_DWP(indata = "14332")
PGOD21_DWP_22174 <- PGOD21_by_DWP(indata = "22174")
PGOD21_DWP_14395 <- PGOD21_by_DWP(indata = "14395")
PGOD21_DWP_16104 <- PGOD21_by_DWP(indata = "16104")
PGOD21_DWP_16164 <- PGOD21_by_DWP(indata = "16164")
PGOD21_DWP_14463 <- PGOD21_by_DWP(indata = "14463")
PGOD21_DWP_28807 <- PGOD21_by_DWP(indata = "28807")
PGOD21_DWP_21900 <- PGOD21_by_DWP(indata = "21900")
PGOD21_DWP_14297 <- PGOD21_by_DWP(indata = "14297")
PGOD21_DWP_22108 <- PGOD21_by_DWP(indata = "22108")
PGOD21_DWP_22221 <- PGOD21_by_DWP(indata = "22221")
PGOD21_DWP_22104 <- PGOD21_by_DWP(indata = "22104")
PGOD21_DWP_2287 <- PGOD21_by_DWP(indata = "2287")
PGOD21_DWP_22107 <- PGOD21_by_DWP(indata = "22107")
PGOD21_DWP_14573 <- PGOD21_by_DWP(indata = "14573")
PGOD21_DWP_21938 <- PGOD21_by_DWP(indata = "21938")
PGOD21_DWP_15826 <- PGOD21_by_DWP(indata = "15826")
PGOD21_DWP_22050 <- PGOD21_by_DWP(indata = "22050")
PGOD21_DWP_21940 <- PGOD21_by_DWP(indata = "21940")
PGOD21_DWP_22710 <- PGOD21_by_DWP(indata = "22710")
PGOD21_DWP_22595 <- PGOD21_by_DWP(indata = "22595")
PGOD21_DWP_22569 <- PGOD21_by_DWP(indata = "22569")
PGOD21_DWP_22701 <- PGOD21_by_DWP(indata = "22701")
PGOD21_DWP_28929 <- PGOD21_by_DWP(indata = "28929")
PGOD21_DWP_16130 <- PGOD21_by_DWP(indata = "16130")
PGOD21_DWP_2228 <- PGOD21_by_DWP(indata = "2228")
PGOD21_DWP_28829 <- PGOD21_by_DWP(indata = "28829")
PGOD21_DWP_21937 <- PGOD21_by_DWP(indata = "21937")
PGOD21_DWP_21939 <- PGOD21_by_DWP(indata = "21939")
PGOD21_DWP_22260 <- PGOD21_by_DWP(indata = "22260")
PGOD21_DWP_14282 <- PGOD21_by_DWP(indata = "14282")
PGOD21_DWP_22218 <- PGOD21_by_DWP(indata = "22218")
PGOD21_DWP_14662 <- PGOD21_by_DWP(indata = "14662")
PGOD21_DWP_14663 <- PGOD21_by_DWP(indata = "14663")
PGOD21_DWP_22162 <- PGOD21_by_DWP(indata = "22162")
PGOD21_DWP_22591 <- PGOD21_by_DWP(indata = "22591")
PGOD21_DWP_22751 <- PGOD21_by_DWP(indata = "22751")
PGOD21_DWP_28812 <- PGOD21_by_DWP(indata = "28812")
PGOD21_DWP_22105 <- PGOD21_by_DWP(indata = "22105")
PGOD21_DWP_16132 <- PGOD21_by_DWP(indata = "16132")
PGOD21_DWP_28864 <- PGOD21_by_DWP(indata = "28864")
PGOD21_DWP_2288 <- PGOD21_by_DWP(indata = "2288")
PGOD21_DWP_22006 <- PGOD21_by_DWP(indata = "22006")
PGOD21_DWP_2232 <- PGOD21_by_DWP(indata = "2232")
PGOD21_DWP_14595 <- PGOD21_by_DWP(indata = "14595")
PGOD21_DWP_22558 <- PGOD21_by_DWP(indata = "22558")
PGOD21_DWP_14640 <- PGOD21_by_DWP(indata = "14640")
PGOD21_DWP_2234 <- PGOD21_by_DWP(indata = "2234")
PGOD21_DWP_15855 <- PGOD21_by_DWP(indata = "15855")
PGOD21_DWP_14629 <- PGOD21_by_DWP(indata = "14629")
PGOD21_DWP_14601 <- PGOD21_by_DWP(indata = "14601")
PGOD21_DWP_14641 <- PGOD21_by_DWP(indata = "14641")
PGOD21_DWP_22682 <- PGOD21_by_DWP(indata = "22682")
PGOD21_DWP_2161 <- PGOD21_by_DWP(indata = "2161")
PGOD21_DWP_14607 <- PGOD21_by_DWP(indata = "14607")
PGOD21_DWP_14570 <- PGOD21_by_DWP(indata = "14570")
PGOD21_DWP_22623 <- PGOD21_by_DWP(indata = "22623")
PGOD21_DWP_22593 <- PGOD21_by_DWP(indata = "22593")
PGOD21_DWP_2505 <- PGOD21_by_DWP(indata = "2505")
PGOD21_DWP_2129 <- PGOD21_by_DWP(indata = "2129")
PGOD21_DWP_22759 <- PGOD21_by_DWP(indata = "22759")
PGOD21_DWP_22622 <- PGOD21_by_DWP(indata = "22622")
PGOD21_DWP_22694 <- PGOD21_by_DWP(indata = "22694")
PGOD21_DWP_22464 <- PGOD21_by_DWP(indata = "22464")
PGOD21_DWP_2195 <- PGOD21_by_DWP(indata = "2195")
PGOD21_DWP_15797 <- PGOD21_by_DWP(indata = "15797")
PGOD21_DWP_22693 <- PGOD21_by_DWP(indata = "22693")
PGOD21_DWP_2123 <- PGOD21_by_DWP(indata = "2123")
PGOD21_DWP_2192 <- PGOD21_by_DWP(indata = "2192")
PGOD21_DWP_14449 <- PGOD21_by_DWP(indata = "14449")
PGOD21_DWP_2838 <- PGOD21_by_DWP(indata = "2838")
PGOD21_DWP_14448 <- PGOD21_by_DWP(indata = "14448")
PGOD21_DWP_3262 <- PGOD21_by_DWP(indata = "3262")
PGOD21_DWP_14037 <- PGOD21_by_DWP(indata = "14037")
PGOD21_DWP_14336 <- PGOD21_by_DWP(indata = "14336")
PGOD21_DWP_14354 <- PGOD21_by_DWP(indata = "14354")
PGOD21_DWP_14394 <- PGOD21_by_DWP(indata = "14394")
PGOD21_DWP_14402 <- PGOD21_by_DWP(indata = "14402")
PGOD21_DWP_16086 <- PGOD21_by_DWP(indata = "16086")
PGOD21_DWP_16097 <- PGOD21_by_DWP(indata = "16097")
PGOD21_DWP_16117 <- PGOD21_by_DWP(indata = "16117")
PGOD21_DWP_16118 <- PGOD21_by_DWP(indata = "16118")
PGOD21_DWP_16120 <- PGOD21_by_DWP(indata = "16120")
PGOD21_DWP_16144 <- PGOD21_by_DWP(indata = "16144")
PGOD21_DWP_16147 <- PGOD21_by_DWP(indata = "16147")
PGOD21_DWP_16174 <- PGOD21_by_DWP(indata = "16174")
PGOD21_DWP_14290 <- PGOD21_by_DWP(indata = "14290")
PGOD21_DWP_14307 <- PGOD21_by_DWP(indata = "14307")
PGOD21_DWP_14312 <- PGOD21_by_DWP(indata = "14312")
PGOD21_DWP_14326 <- PGOD21_by_DWP(indata = "14326")
PGOD21_DWP_14327 <- PGOD21_by_DWP(indata = "14327")
PGOD21_DWP_14330 <- PGOD21_by_DWP(indata = "14330")
PGOD21_DWP_14358 <- PGOD21_by_DWP(indata = "14358")
PGOD21_DWP_14367 <- PGOD21_by_DWP(indata = "14367")
PGOD21_DWP_14368 <- PGOD21_by_DWP(indata = "14368")
PGOD21_DWP_14398 <- PGOD21_by_DWP(indata = "14398")
PGOD21_DWP_14429 <- PGOD21_by_DWP(indata = "14429")
PGOD21_DWP_16090 <- PGOD21_by_DWP(indata = "16090")
PGOD21_DWP_16092 <- PGOD21_by_DWP(indata = "16092")
PGOD21_DWP_16095 <- PGOD21_by_DWP(indata = "16095")
PGOD21_DWP_16096 <- PGOD21_by_DWP(indata = "16096")
PGOD21_DWP_16101 <- PGOD21_by_DWP(indata = "16101")
PGOD21_DWP_16121 <- PGOD21_by_DWP(indata = "16121")
PGOD21_DWP_16122 <- PGOD21_by_DWP(indata = "16122")
PGOD21_DWP_16136 <- PGOD21_by_DWP(indata = "16136")
PGOD21_DWP_22163 <- PGOD21_by_DWP(indata = "22163")
PGOD21_DWP_22178 <- PGOD21_by_DWP(indata = "22178")
PGOD21_DWP_22257 <- PGOD21_by_DWP(indata = "22257")
PGOD21_DWP_2071 <- PGOD21_by_DWP(indata = "2071")
PGOD21_DWP_2081 <- PGOD21_by_DWP(indata = "2081")
PGOD21_DWP_2124 <- PGOD21_by_DWP(indata = "2124")
PGOD21_DWP_2125 <- PGOD21_by_DWP(indata = "2125")
PGOD21_DWP_2127 <- PGOD21_by_DWP(indata = "2127")
PGOD21_DWP_2160 <- PGOD21_by_DWP(indata = "2160")
PGOD21_DWP_2162 <- PGOD21_by_DWP(indata = "2162")
PGOD21_DWP_2193 <- PGOD21_by_DWP(indata = "2193")
PGOD21_DWP_2197 <- PGOD21_by_DWP(indata = "2197")
PGOD21_DWP_2233 <- PGOD21_by_DWP(indata = "2233")
PGOD21_DWP_2236 <- PGOD21_by_DWP(indata = "2236")
PGOD21_DWP_2508 <- PGOD21_by_DWP(indata = "2508")
PGOD21_DWP_2837 <- PGOD21_by_DWP(indata = "2837")
PGOD21_DWP_2926 <- PGOD21_by_DWP(indata = "2926")
PGOD21_DWP_2927 <- PGOD21_by_DWP(indata = "2927")
PGOD21_DWP_2930 <- PGOD21_by_DWP(indata = "2930")
PGOD21_DWP_2932 <- PGOD21_by_DWP(indata = "2932")
PGOD21_DWP_14528 <- PGOD21_by_DWP(indata = "14528")
PGOD21_DWP_14576 <- PGOD21_by_DWP(indata = "14576")
PGOD21_DWP_14603 <- PGOD21_by_DWP(indata = "14603")
PGOD21_DWP_14657 <- PGOD21_by_DWP(indata = "14657")
PGOD21_DWP_14659 <- PGOD21_by_DWP(indata = "14659")
PGOD21_DWP_14676 <- PGOD21_by_DWP(indata = "14676")
PGOD21_DWP_15801 <- PGOD21_by_DWP(indata = "15801")
PGOD21_DWP_15802 <- PGOD21_by_DWP(indata = "15802")
PGOD21_DWP_22465 <- PGOD21_by_DWP(indata = "22465")
PGOD21_DWP_22516 <- PGOD21_by_DWP(indata = "22516")
PGOD21_DWP_22601 <- PGOD21_by_DWP(indata = "22601")
PGOD21_DWP_22678 <- PGOD21_by_DWP(indata = "22678")
PGOD21_DWP_22720 <- PGOD21_by_DWP(indata = "22720")
PGOD21_DWP_22745 <- PGOD21_by_DWP(indata = "22745")
PGOD21_DWP_14408 <- PGOD21_by_DWP(indata = "14408")
PGOD21_DWP_16131 <- PGOD21_by_DWP(indata = "16131")

# break down OGSillys into individual DWPs
# NOTE: same here - need loops based on the SILLY_affected_DWPs
PERB16_affected_DWPs <- unique(PERB16.gcl$attributes$DNA_TRAY_CODE)
PGILMOUR15_affected_DWPs <- unique(PGILMOUR15.gcl$attributes$DNA_TRAY_CODE)
PGILMOUR16_affected_DWPs <- unique(PGILMOUR16.gcl$attributes$DNA_TRAY_CODE)
PGILMOUR17_affected_DWPs <- unique(PGILMOUR17.gcl$attributes$DNA_TRAY_CODE)
PGILMOUR18_affected_DWPs <- unique(PGILMOUR18.gcl$attributes$DNA_TRAY_CODE)
PPADDY16_affected_DWPs <- unique(PPADDY16.gcl$attributes$DNA_TRAY_CODE)

OGSilly_by_DWP <- function(indata1 = PERB16.gcl$attributes, indata2 = "0000014331") {
  indata1 %>% 
    dplyr::filter(DNA_TRAY_CODE == indata2)
}

PERB16_DWP_14395 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014395")
PERB16_DWP_14449 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014449")
PERB16_DWP_14448 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014448")
PERB16_DWP_14334 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014334")
PERB16_DWP_14331 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014331")
PERB16_DWP_14376 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014376")
PERB16_DWP_14297 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014297")
PERB16_DWP_14282 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014282")
PERB16_DWP_14332 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014332")
PERB16_DWP_14290 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014290")
PERB16_DWP_14307 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014307")
PERB16_DWP_14312 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014312")
PERB16_DWP_14326 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014326")
PERB16_DWP_14327 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014327")
PERB16_DWP_14330 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014330")
PERB16_DWP_14336 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014336")
PERB16_DWP_14354 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014354")
PERB16_DWP_14358 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014358")
PERB16_DWP_14367 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014367")
PERB16_DWP_14368 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014368")
PERB16_DWP_14394 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014394")
PERB16_DWP_14398 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014398")
PERB16_DWP_14402 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014402")
PERB16_DWP_14429 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000014429")
PERB16_DWP_16086 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016086")
PERB16_DWP_16090 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016090")
PERB16_DWP_16092 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016092")
PERB16_DWP_16095 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016095")
PERB16_DWP_16096 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016096")
PERB16_DWP_16097 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016097")
PERB16_DWP_16101 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016101")
PERB16_DWP_16117 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016117")
PERB16_DWP_16118 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016118")
PERB16_DWP_16120 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016120")
PERB16_DWP_16121 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016121")
PERB16_DWP_16122 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016122")
PERB16_DWP_16136 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016136")
PERB16_DWP_16144 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016144")
PERB16_DWP_16147 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016147")
PERB16_DWP_16174 <- OGSilly_by_DWP(indata1 = PERB16.gcl$attributes, indata2 = "0000016174")

PGILMOUR15_DWP_2123 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002123")
PGILMOUR15_DWP_2129 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002129")
PGILMOUR15_DWP_2161 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002161")
PGILMOUR15_DWP_2192 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002192")
PGILMOUR15_DWP_2195 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002195")
PGILMOUR15_DWP_2228 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002228")
PGILMOUR15_DWP_2232 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002232")
PGILMOUR15_DWP_2234 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002234")
PGILMOUR15_DWP_2505 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002505")
PGILMOUR15_DWP_2838 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002838")
PGILMOUR15_DWP_2071 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002071")
PGILMOUR15_DWP_2081 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002081")
PGILMOUR15_DWP_2124 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002124")
PGILMOUR15_DWP_2125 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002125")
PGILMOUR15_DWP_2127 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002127")
PGILMOUR15_DWP_2160 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002160")
PGILMOUR15_DWP_2162 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002162")
PGILMOUR15_DWP_2193 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002193")
PGILMOUR15_DWP_2197 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002197")
PGILMOUR15_DWP_2233 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002233")
PGILMOUR15_DWP_2236 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002236")
PGILMOUR15_DWP_2508 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002508")
PGILMOUR15_DWP_2837 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002837")
PGILMOUR15_DWP_2926 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002926")
PGILMOUR15_DWP_2927 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002927")
PGILMOUR15_DWP_2930 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002930")
PGILMOUR15_DWP_2932 <- OGSilly_by_DWP(indata1 = PGILMOUR15.gcl$attributes, indata2 = "0000002932")

PGILMOUR16_DWP_15797 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000015797")
PGILMOUR16_DWP_14570 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014570")
PGILMOUR16_DWP_14573 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014573")
PGILMOUR16_DWP_14662 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014662")
PGILMOUR16_DWP_14663 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014663")
PGILMOUR16_DWP_15826 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000015826")
PGILMOUR16_DWP_14641 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014641")
PGILMOUR16_DWP_14601 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014601")
PGILMOUR16_DWP_14629 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014629")
PGILMOUR16_DWP_14595 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014595")
PGILMOUR16_DWP_14640 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014640")
PGILMOUR16_DWP_15855 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000015855")
PGILMOUR16_DWP_14607 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014607")
PGILMOUR16_DWP_14528 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014528")
PGILMOUR16_DWP_14576 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014576")
PGILMOUR16_DWP_14603 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014603")
PGILMOUR16_DWP_14657 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014657")
PGILMOUR16_DWP_14659 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014659")
PGILMOUR16_DWP_14676 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000014676")
PGILMOUR16_DWP_15801 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000015801")
PGILMOUR16_DWP_15802 <- OGSilly_by_DWP(indata1 = PGILMOUR16.gcl$attributes, indata2 = "0000015802")

PGILMOUR17_DWP_22694 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022694")
PGILMOUR17_DWP_22759 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022759")
PGILMOUR17_DWP_22593 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022593")
PGILMOUR17_DWP_22569 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022569")
PGILMOUR17_DWP_22623 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022623")
PGILMOUR17_DWP_22693 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022693")
PGILMOUR17_DWP_22464 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022464")
PGILMOUR17_DWP_22558 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022558")
PGILMOUR17_DWP_22682 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022682")
PGILMOUR17_DWP_22591 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022591")
PGILMOUR17_DWP_22622 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022622")
PGILMOUR17_DWP_22595 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022595")
PGILMOUR17_DWP_22710 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022710")
PGILMOUR17_DWP_22751 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022751")
PGILMOUR17_DWP_22701 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022701")
PGILMOUR17_DWP_22465 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022465")
PGILMOUR17_DWP_22516 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022516")
PGILMOUR17_DWP_22601 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022601")
PGILMOUR17_DWP_22678 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022678")
PGILMOUR17_DWP_22720 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022720")
PGILMOUR17_DWP_22745 <- OGSilly_by_DWP(indata1 = PGILMOUR17.gcl$attributes, indata2 = "0000022745")

PGILMOUR18_DWP_28929 <- OGSilly_by_DWP(indata1 = PGILMOUR18.gcl$attributes, indata2 = "0000028929")
PGILMOUR18_DWP_28864 <- OGSilly_by_DWP(indata1 = PGILMOUR18.gcl$attributes, indata2 = "0000028864")
PGILMOUR18_DWP_28829 <- OGSilly_by_DWP(indata1 = PGILMOUR18.gcl$attributes, indata2 = "0000028829")
PGILMOUR18_DWP_28807 <- OGSilly_by_DWP(indata1 = PGILMOUR18.gcl$attributes, indata2 = "0000028807")
PGILMOUR18_DWP_28812 <- OGSilly_by_DWP(indata1 = PGILMOUR18.gcl$attributes, indata2 = "0000028812")

PPADDY16_DWP_16104 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000016104")
PPADDY16_DWP_14463 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000014463")
PPADDY16_DWP_16130 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000016130")
PPADDY16_DWP_16164 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000016164")
PPADDY16_DWP_16132 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000016132")
PPADDY16_DWP_14408 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000014408")
PPADDY16_DWP_16131 <- OGSilly_by_DWP(indata1 = PPADDY16.gcl$attributes, indata2 = "0000016131")
```

### Pull DWP fish_ids for PGOD21 and the OGSillys

```{r}
# pull fish_ids for PGOD21 DWPs
PGOD21_DWP_14331_fish_ids <- PGOD21_DWP_14331 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21941_fish_ids <- PGOD21_DWP_21941 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14376_fish_ids <- PGOD21_DWP_14376 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14334_fish_ids <- PGOD21_DWP_14334 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14332_fish_ids <- PGOD21_DWP_14332 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22174_fish_ids <- PGOD21_DWP_22174 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14395_fish_ids <- PGOD21_DWP_14395 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16104_fish_ids <- PGOD21_DWP_16104 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16164_fish_ids <- PGOD21_DWP_16164 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14463_fish_ids <- PGOD21_DWP_14463 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_28807_fish_ids <- PGOD21_DWP_28807 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21900_fish_ids <- PGOD21_DWP_21900 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14297_fish_ids <- PGOD21_DWP_14297 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22108_fish_ids <- PGOD21_DWP_22108 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22221_fish_ids <- PGOD21_DWP_22221 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22104_fish_ids <- PGOD21_DWP_22104 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2287_fish_ids <- PGOD21_DWP_2287 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22107_fish_ids <- PGOD21_DWP_22107 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14573_fish_ids <- PGOD21_DWP_14573 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21938_fish_ids <- PGOD21_DWP_21938 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_15826_fish_ids <- PGOD21_DWP_15826 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22050_fish_ids <- PGOD21_DWP_22050 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21940_fish_ids <- PGOD21_DWP_21940 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22710_fish_ids <- PGOD21_DWP_22710 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22595_fish_ids <- PGOD21_DWP_22595 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22569_fish_ids <- PGOD21_DWP_22569 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22701_fish_ids <- PGOD21_DWP_22701 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_28929_fish_ids <- PGOD21_DWP_28929 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16130_fish_ids <- PGOD21_DWP_16130 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2228_fish_ids <- PGOD21_DWP_2228 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_28829_fish_ids <- PGOD21_DWP_28829 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21937_fish_ids <- PGOD21_DWP_21937 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_21939_fish_ids <- PGOD21_DWP_21939 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22260_fish_ids <- PGOD21_DWP_22260 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14282_fish_ids <- PGOD21_DWP_14282 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22218_fish_ids <- PGOD21_DWP_22218 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14662_fish_ids <- PGOD21_DWP_14662 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14663_fish_ids <- PGOD21_DWP_14663 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22162_fish_ids <- PGOD21_DWP_22162 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22591_fish_ids <- PGOD21_DWP_22591 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22751_fish_ids <- PGOD21_DWP_22751 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_28812_fish_ids <- PGOD21_DWP_28812 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22105_fish_ids <- PGOD21_DWP_22105 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16132_fish_ids <- PGOD21_DWP_16132 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_28864_fish_ids <- PGOD21_DWP_28864 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2288_fish_ids <- PGOD21_DWP_2288 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22006_fish_ids <- PGOD21_DWP_22006 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2232_fish_ids <- PGOD21_DWP_2232 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14595_fish_ids <- PGOD21_DWP_14595 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22558_fish_ids <- PGOD21_DWP_22558 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14640_fish_ids <- PGOD21_DWP_14640 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2234_fish_ids <- PGOD21_DWP_2234 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_15855_fish_ids <- PGOD21_DWP_15855 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14629_fish_ids <- PGOD21_DWP_14629 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14601_fish_ids <- PGOD21_DWP_14601 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14641_fish_ids <- PGOD21_DWP_14641 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22682_fish_ids <- PGOD21_DWP_22682 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2161_fish_ids <- PGOD21_DWP_2161 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14607_fish_ids <- PGOD21_DWP_14607 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14570_fish_ids <- PGOD21_DWP_14570 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22623_fish_ids <- PGOD21_DWP_22623 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22593_fish_ids <- PGOD21_DWP_22593 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2505_fish_ids <- PGOD21_DWP_2505 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2129_fish_ids <- PGOD21_DWP_2129 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22759_fish_ids <- PGOD21_DWP_22759 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22622_fish_ids <- PGOD21_DWP_22622 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22694_fish_ids <- PGOD21_DWP_22694 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22464_fish_ids <- PGOD21_DWP_22464 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2195_fish_ids <- PGOD21_DWP_2195 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_15797_fish_ids <- PGOD21_DWP_15797 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22693_fish_ids <- PGOD21_DWP_22693 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2123_fish_ids <- PGOD21_DWP_2123 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2192_fish_ids <- PGOD21_DWP_2192 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14449_fish_ids <- PGOD21_DWP_14449 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2838_fish_ids <- PGOD21_DWP_2838 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14448_fish_ids <- PGOD21_DWP_14448 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_3262_fish_ids <- PGOD21_DWP_3262 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14037_fish_ids <- PGOD21_DWP_14037 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14336_fish_ids <- PGOD21_DWP_14336 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14354_fish_ids <- PGOD21_DWP_14354 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14394_fish_ids <- PGOD21_DWP_14394 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14402_fish_ids <- PGOD21_DWP_14402 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16086_fish_ids <- PGOD21_DWP_16086 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16097_fish_ids <- PGOD21_DWP_16097 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16117_fish_ids <- PGOD21_DWP_16117 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16118_fish_ids <- PGOD21_DWP_16118 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16120_fish_ids <- PGOD21_DWP_16120 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16144_fish_ids <- PGOD21_DWP_16144 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16147_fish_ids <- PGOD21_DWP_16147 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16174_fish_ids <- PGOD21_DWP_16174 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14290_fish_ids <- PGOD21_DWP_14290 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14307_fish_ids <- PGOD21_DWP_14307 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14312_fish_ids <- PGOD21_DWP_14312 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14326_fish_ids <- PGOD21_DWP_14326 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14327_fish_ids <- PGOD21_DWP_14327 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14330_fish_ids <- PGOD21_DWP_14330 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14358_fish_ids <- PGOD21_DWP_14358 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14367_fish_ids <- PGOD21_DWP_14367 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14368_fish_ids <- PGOD21_DWP_14368 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14398_fish_ids <- PGOD21_DWP_14398 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14429_fish_ids <- PGOD21_DWP_14429 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16090_fish_ids <- PGOD21_DWP_16090 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16092_fish_ids <- PGOD21_DWP_16092 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16095_fish_ids <- PGOD21_DWP_16095 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16096_fish_ids <- PGOD21_DWP_16096 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16101_fish_ids <- PGOD21_DWP_16101 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16121_fish_ids <- PGOD21_DWP_16121 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16122_fish_ids <- PGOD21_DWP_16122 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16136_fish_ids <- PGOD21_DWP_16136 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22163_fish_ids <- PGOD21_DWP_22163 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22178_fish_ids <- PGOD21_DWP_22178 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22257_fish_ids <- PGOD21_DWP_22257 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2071_fish_ids <- PGOD21_DWP_2071 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2081_fish_ids <- PGOD21_DWP_2081 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2124_fish_ids <- PGOD21_DWP_2124 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2125_fish_ids <- PGOD21_DWP_2125 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2127_fish_ids <- PGOD21_DWP_2127 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2160_fish_ids <- PGOD21_DWP_2160 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2162_fish_ids <- PGOD21_DWP_2162 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2193_fish_ids <- PGOD21_DWP_2193 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2197_fish_ids <- PGOD21_DWP_2197 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2233_fish_ids <- PGOD21_DWP_2233 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2236_fish_ids <- PGOD21_DWP_2236 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2508_fish_ids <- PGOD21_DWP_2508 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2837_fish_ids <- PGOD21_DWP_2837 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2926_fish_ids <- PGOD21_DWP_2926 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2927_fish_ids <- PGOD21_DWP_2927 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2930_fish_ids <- PGOD21_DWP_2930 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_2932_fish_ids <- PGOD21_DWP_2932 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14528_fish_ids <- PGOD21_DWP_14528 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14576_fish_ids <- PGOD21_DWP_14576 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14603_fish_ids <- PGOD21_DWP_14603 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14657_fish_ids <- PGOD21_DWP_14657 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14659_fish_ids <- PGOD21_DWP_14659 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14676_fish_ids <- PGOD21_DWP_14676 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_15801_fish_ids <- PGOD21_DWP_15801 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_15802_fish_ids <- PGOD21_DWP_15802 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22465_fish_ids <- PGOD21_DWP_22465 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22516_fish_ids <- PGOD21_DWP_22516 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22601_fish_ids <- PGOD21_DWP_22601 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22678_fish_ids <- PGOD21_DWP_22678 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22720_fish_ids <- PGOD21_DWP_22720 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_22745_fish_ids <- PGOD21_DWP_22745 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_14408_fish_ids <- PGOD21_DWP_14408 %>% pull(FK_FISH_ID.x)
PGOD21_DWP_16131_fish_ids <- PGOD21_DWP_16131 %>% pull(FK_FISH_ID.x)

# pull fish_ids for OGSilly DWPs
PERB16_DWP_14395_fish_ids <- PERB16_DWP_14395 %>% pull(FK_FISH_ID)
PERB16_DWP_14449_fish_ids <- PERB16_DWP_14449 %>% pull(FK_FISH_ID)
PERB16_DWP_14448_fish_ids <- PERB16_DWP_14448 %>% pull(FK_FISH_ID)
PERB16_DWP_14334_fish_ids <- PERB16_DWP_14334 %>% pull(FK_FISH_ID)
PERB16_DWP_14331_fish_ids <- PERB16_DWP_14331 %>% pull(FK_FISH_ID)
PERB16_DWP_14376_fish_ids <- PERB16_DWP_14376 %>% pull(FK_FISH_ID)
PERB16_DWP_14297_fish_ids <- PERB16_DWP_14297 %>% pull(FK_FISH_ID)
PERB16_DWP_14282_fish_ids <- PERB16_DWP_14282 %>% pull(FK_FISH_ID)
PERB16_DWP_14332_fish_ids <- PERB16_DWP_14332 %>% pull(FK_FISH_ID)
PERB16_DWP_14290_fish_ids <- PERB16_DWP_14290 %>% pull(FK_FISH_ID)
PERB16_DWP_14307_fish_ids <- PERB16_DWP_14307 %>% pull(FK_FISH_ID)
PERB16_DWP_14312_fish_ids <- PERB16_DWP_14312 %>% pull(FK_FISH_ID)
PERB16_DWP_14326_fish_ids <- PERB16_DWP_14326 %>% pull(FK_FISH_ID)
PERB16_DWP_14327_fish_ids <- PERB16_DWP_14327 %>% pull(FK_FISH_ID)
PERB16_DWP_14330_fish_ids <- PERB16_DWP_14330 %>% pull(FK_FISH_ID)
PERB16_DWP_14336_fish_ids <- PERB16_DWP_14336 %>% pull(FK_FISH_ID)
PERB16_DWP_14354_fish_ids <- PERB16_DWP_14354 %>% pull(FK_FISH_ID)
PERB16_DWP_14358_fish_ids <- PERB16_DWP_14358 %>% pull(FK_FISH_ID)
PERB16_DWP_14367_fish_ids <- PERB16_DWP_14367 %>% pull(FK_FISH_ID)
PERB16_DWP_14368_fish_ids <- PERB16_DWP_14368 %>% pull(FK_FISH_ID)
PERB16_DWP_14394_fish_ids <- PERB16_DWP_14394 %>% pull(FK_FISH_ID)
PERB16_DWP_14398_fish_ids <- PERB16_DWP_14398 %>% pull(FK_FISH_ID)
PERB16_DWP_14402_fish_ids <- PERB16_DWP_14402 %>% pull(FK_FISH_ID)
PERB16_DWP_14429_fish_ids <- PERB16_DWP_14429 %>% pull(FK_FISH_ID)
PERB16_DWP_16086_fish_ids <- PERB16_DWP_16086 %>% pull(FK_FISH_ID)
PERB16_DWP_16090_fish_ids <- PERB16_DWP_16090 %>% pull(FK_FISH_ID)
PERB16_DWP_16092_fish_ids <- PERB16_DWP_16092 %>% pull(FK_FISH_ID)
PERB16_DWP_16095_fish_ids <- PERB16_DWP_16095 %>% pull(FK_FISH_ID)
PERB16_DWP_16096_fish_ids <- PERB16_DWP_16096 %>% pull(FK_FISH_ID)
PERB16_DWP_16097_fish_ids <- PERB16_DWP_16097 %>% pull(FK_FISH_ID)
PERB16_DWP_16101_fish_ids <- PERB16_DWP_16101 %>% pull(FK_FISH_ID)
PERB16_DWP_16117_fish_ids <- PERB16_DWP_16117 %>% pull(FK_FISH_ID)
PERB16_DWP_16118_fish_ids <- PERB16_DWP_16118 %>% pull(FK_FISH_ID)
PERB16_DWP_16120_fish_ids <- PERB16_DWP_16120 %>% pull(FK_FISH_ID)
PERB16_DWP_16121_fish_ids <- PERB16_DWP_16121 %>% pull(FK_FISH_ID)
PERB16_DWP_16122_fish_ids <- PERB16_DWP_16122 %>% pull(FK_FISH_ID)
PERB16_DWP_16136_fish_ids <- PERB16_DWP_16136 %>% pull(FK_FISH_ID)
PERB16_DWP_16144_fish_ids <- PERB16_DWP_16144 %>% pull(FK_FISH_ID)
PERB16_DWP_16147_fish_ids <- PERB16_DWP_16147 %>% pull(FK_FISH_ID)
PERB16_DWP_16174_fish_ids <- PERB16_DWP_16174 %>% pull(FK_FISH_ID)

PGILMOUR15_DWP_2123_fish_ids <- PGILMOUR15_DWP_2123 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2129_fish_ids <- PGILMOUR15_DWP_2129 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2161_fish_ids <- PGILMOUR15_DWP_2161 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2192_fish_ids <- PGILMOUR15_DWP_2192 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2195_fish_ids <- PGILMOUR15_DWP_2195 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2228_fish_ids <- PGILMOUR15_DWP_2228 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2232_fish_ids <- PGILMOUR15_DWP_2232 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2234_fish_ids <- PGILMOUR15_DWP_2234 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2505_fish_ids <- PGILMOUR15_DWP_2505 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2838_fish_ids <- PGILMOUR15_DWP_2838 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2071_fish_ids <- PGILMOUR15_DWP_2071 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2081_fish_ids <- PGILMOUR15_DWP_2081 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2124_fish_ids <- PGILMOUR15_DWP_2124 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2125_fish_ids <- PGILMOUR15_DWP_2125 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2127_fish_ids <- PGILMOUR15_DWP_2127 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2160_fish_ids <- PGILMOUR15_DWP_2160 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2162_fish_ids <- PGILMOUR15_DWP_2162 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2193_fish_ids <- PGILMOUR15_DWP_2193 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2197_fish_ids <- PGILMOUR15_DWP_2197 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2233_fish_ids <- PGILMOUR15_DWP_2233 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2236_fish_ids <- PGILMOUR15_DWP_2236 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2508_fish_ids <- PGILMOUR15_DWP_2508 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2837_fish_ids <- PGILMOUR15_DWP_2837 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2926_fish_ids <- PGILMOUR15_DWP_2926 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2927_fish_ids <- PGILMOUR15_DWP_2927 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2930_fish_ids <- PGILMOUR15_DWP_2930 %>% pull(FK_FISH_ID)
PGILMOUR15_DWP_2932_fish_ids <- PGILMOUR15_DWP_2932 %>% pull(FK_FISH_ID)

PGILMOUR16_DWP_15797_fish_ids <- PGILMOUR16_DWP_15797 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14570_fish_ids <- PGILMOUR16_DWP_14570 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14573_fish_ids <- PGILMOUR16_DWP_14573 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14662_fish_ids <- PGILMOUR16_DWP_14662 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14663_fish_ids <- PGILMOUR16_DWP_14663 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_15826_fish_ids <- PGILMOUR16_DWP_15826 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14641_fish_ids <- PGILMOUR16_DWP_14641 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14601_fish_ids <- PGILMOUR16_DWP_14601 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14629_fish_ids <- PGILMOUR16_DWP_14629 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14595_fish_ids <- PGILMOUR16_DWP_14595 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14640_fish_ids <- PGILMOUR16_DWP_14640 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_15855_fish_ids <- PGILMOUR16_DWP_15855 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14607_fish_ids <- PGILMOUR16_DWP_14607 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14528_fish_ids <- PGILMOUR16_DWP_14528 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14576_fish_ids <- PGILMOUR16_DWP_14576 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14603_fish_ids <- PGILMOUR16_DWP_14603 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14657_fish_ids <- PGILMOUR16_DWP_14657 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14659_fish_ids <- PGILMOUR16_DWP_14659 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_14676_fish_ids <- PGILMOUR16_DWP_14676 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_15801_fish_ids <- PGILMOUR16_DWP_15801 %>% pull(FK_FISH_ID)
PGILMOUR16_DWP_15802_fish_ids <- PGILMOUR16_DWP_15802 %>% pull(FK_FISH_ID)

PGILMOUR17_DWP_22694_fish_ids <- PGILMOUR17_DWP_22694 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22759_fish_ids <- PGILMOUR17_DWP_22759 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22593_fish_ids <- PGILMOUR17_DWP_22593 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22569_fish_ids <- PGILMOUR17_DWP_22569 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22623_fish_ids <- PGILMOUR17_DWP_22623 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22693_fish_ids <- PGILMOUR17_DWP_22693 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22464_fish_ids <- PGILMOUR17_DWP_22464 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22558_fish_ids <- PGILMOUR17_DWP_22558 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22682_fish_ids <- PGILMOUR17_DWP_22682 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22591_fish_ids <- PGILMOUR17_DWP_22591 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22622_fish_ids <- PGILMOUR17_DWP_22622 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22595_fish_ids <- PGILMOUR17_DWP_22595 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22710_fish_ids <- PGILMOUR17_DWP_22710 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22751_fish_ids <- PGILMOUR17_DWP_22751 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22701_fish_ids <- PGILMOUR17_DWP_22701 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22465_fish_ids <- PGILMOUR17_DWP_22465 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22516_fish_ids <- PGILMOUR17_DWP_22516 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22601_fish_ids <- PGILMOUR17_DWP_22601 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22678_fish_ids <- PGILMOUR17_DWP_22678 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22720_fish_ids <- PGILMOUR17_DWP_22720 %>% pull(FK_FISH_ID)
PGILMOUR17_DWP_22745_fish_ids <- PGILMOUR17_DWP_22745 %>% pull(FK_FISH_ID)

PGILMOUR18_DWP_28929_fish_ids <- PGILMOUR18_DWP_28929 %>% pull(FK_FISH_ID)
PGILMOUR18_DWP_28864_fish_ids <- PGILMOUR18_DWP_28864 %>% pull(FK_FISH_ID)
PGILMOUR18_DWP_28829_fish_ids <- PGILMOUR18_DWP_28829 %>% pull(FK_FISH_ID)
PGILMOUR18_DWP_28807_fish_ids <- PGILMOUR18_DWP_28807 %>% pull(FK_FISH_ID)
PGILMOUR18_DWP_28812_fish_ids <- PGILMOUR18_DWP_28812 %>% pull(FK_FISH_ID)

PPADDY16_DWP_16104_fish_ids <- PPADDY16_DWP_16104 %>% pull(FK_FISH_ID)
PPADDY16_DWP_14463_fish_ids <- PPADDY16_DWP_14463 %>% pull(FK_FISH_ID)
PPADDY16_DWP_16130_fish_ids <- PPADDY16_DWP_16130 %>% pull(FK_FISH_ID)
PPADDY16_DWP_16164_fish_ids <- PPADDY16_DWP_16164 %>% pull(FK_FISH_ID)
PPADDY16_DWP_16132_fish_ids <- PPADDY16_DWP_16132 %>% pull(FK_FISH_ID)
PPADDY16_DWP_14408_fish_ids <- PPADDY16_DWP_14408 %>% pull(FK_FISH_ID)
PPADDY16_DWP_16131_fish_ids <- PPADDY16_DWP_16131 %>% pull(FK_FISH_ID)
```

### **Duplicate rate checks by DWP**

A total of 5 PGOD21 DWPs don't have OGSilly DWP matches, presumably because they haven't been genotyped yet, leaving 64 DWPs for matching.

* PERB16: n = 
* PGILMOUR15: n = 
* PGILMOUR16: n = 
* PGILMOUR17: n = 
* PGILMOUR18: n = 
* PPADDY16: n = 

#### ###############**PERB 16**###############

#### *1. PERB16_DWP_14395*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14395_fish_ids)), newname = "PERB16_DWP_14395")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14395_fish_ids)), newname = "PGOD21_DWP_14395")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14395 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14395",
      GODSillyIDs = list("PGOD21_DWP_14395" = rownames(PGOD21_DWP_14395.gcl$counts)),
      HeartSillys = "PERB16_DWP_14395",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14395_best_match <- dup_check_results_DWP_14395 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14395 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14395 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14395_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14395_1stbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14395_2ndbest <- dup_check_results_DWP_14395 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14395_top_2 <- rbind(dup_check_results_DWP_14395_1stbest, dup_check_results_DWP_14395_2ndbest))

ggplot(data = dup_check_results_DWP_14395_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Set cutoffs for dupe rate and dupe rate difference - suggest duplicate_rate >= 0.7 and diff >= 0.15.

```{r}
# filtered results table
(dup_check_results_DWP_14395_pass <- dup_check_results_DWP_14395_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14395_pass)
length(unique(dup_check_results_DWP_14395_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14395_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14395_pass, "dup_check_results_pass.csv")
```

#### *2. PERB16_DWP_14449*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14449_fish_ids)), newname = "PERB16_DWP_14449")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14449_fish_ids)), newname = "PGOD21_DWP_14449")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14449 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14449",
      GODSillyIDs = list("PGOD21_DWP_14449" = rownames(PGOD21_DWP_14449.gcl$counts)),
      HeartSillys = "PERB16_DWP_14449",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14449_best_match <- dup_check_results_DWP_14449 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14449 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14449_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14449 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14449_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14449 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14449_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14449_1stbest <- dup_check_results_DWP_14449 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14449_2ndbest <- dup_check_results_DWP_14449 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14449_top_2 <- rbind(dup_check_results_DWP_14449_1stbest, dup_check_results_DWP_14449_2ndbest))

ggplot(data = dup_check_results_DWP_14449_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14449_pass <- dup_check_results_DWP_14449_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14449_pass)
length(unique(dup_check_results_DWP_14449_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14449_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14449_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *3. PERB16_DWP_14448*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14448_fish_ids)), newname = "PERB16_DWP_14448")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14448_fish_ids)), newname = "PGOD21_DWP_14448")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14448 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14448",
      GODSillyIDs = list("PGOD21_DWP_14448" = rownames(PGOD21_DWP_14448.gcl$counts)),
      HeartSillys = "PERB16_DWP_14448",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14448_best_match <- dup_check_results_DWP_14448 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14448 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14448_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14448 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14448_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14448 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14448_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14448_1stbest <- dup_check_results_DWP_14448 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14448_2ndbest <- dup_check_results_DWP_14448 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14448_top_2 <- rbind(dup_check_results_DWP_14448_1stbest, dup_check_results_DWP_14448_2ndbest))

ggplot(data = dup_check_results_DWP_14448_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14448_pass <- dup_check_results_DWP_14448_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14448_pass)
length(unique(dup_check_results_DWP_14448_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14448_pass$otolith_fish_id))
```

##### Status: OK


```{r}
write.table(dup_check_results_DWP_14448_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *4. PERB16_DWP_14334*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14334_fish_ids)), newname = "PERB16_DWP_14334")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14334_fish_ids)), newname = "PGOD21_DWP_14334")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14334 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14334",
      GODSillyIDs = list("PGOD21_DWP_14334" = rownames(PGOD21_DWP_14334.gcl$counts)),
      HeartSillys = "PERB16_DWP_14334",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14334_best_match <- dup_check_results_DWP_14334 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14334 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14334_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14334 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14334_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14334 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14334_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14334_1stbest <- dup_check_results_DWP_14334 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14334_2ndbest <- dup_check_results_DWP_14334 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14334_top_2 <- rbind(dup_check_results_DWP_14334_1stbest, dup_check_results_DWP_14334_2ndbest))

ggplot(data = dup_check_results_DWP_14334_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14334_pass <- dup_check_results_DWP_14334_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14334_pass)
length(unique(dup_check_results_DWP_14334_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14334_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14334_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *5. PERB16_DWP_14331*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14331_fish_ids)), newname = "PERB16_DWP_14331")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14331_fish_ids)), newname = "PGOD21_DWP_14331")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14331 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14331",
      GODSillyIDs = list("PGOD21_DWP_14331" = rownames(PGOD21_DWP_14331.gcl$counts)),
      HeartSillys = "PERB16_DWP_14331",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14331_best_match <- dup_check_results_DWP_14331 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14331 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14331_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14331 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14331_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14331 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14331_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14331_1stbest <- dup_check_results_DWP_14331 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14331_2ndbest <- dup_check_results_DWP_14331 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14331_top_2 <- rbind(dup_check_results_DWP_14331_1stbest, dup_check_results_DWP_14331_2ndbest))

ggplot(data = dup_check_results_DWP_14331_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_14331_pass <- dup_check_results_DWP_14331_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_14331_pass)
length(unique(dup_check_results_DWP_14331_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14331_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_14331_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *6. PERB16_DWP_14376*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14376_fish_ids)), newname = "PERB16_DWP_14376")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14376_fish_ids)), newname = "PGOD21_DWP_14376")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14376 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14376",
      GODSillyIDs = list("PGOD21_DWP_14376" = rownames(PGOD21_DWP_14376.gcl$counts)),
      HeartSillys = "PERB16_DWP_14376",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14376_best_match <- dup_check_results_DWP_14376 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14376 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14376_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14376 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14376_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14376 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14376_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14376_1stbest <- dup_check_results_DWP_14376 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14376_2ndbest <- dup_check_results_DWP_14376 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14376_top_2 <- rbind(dup_check_results_DWP_14376_1stbest, dup_check_results_DWP_14376_2ndbest))

ggplot(data = dup_check_results_DWP_14376_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14376_pass <- dup_check_results_DWP_14376_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14376_pass)
length(unique(dup_check_results_DWP_14376_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14376_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14376_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *7. PERB16_DWP_14297*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14297_fish_ids)), newname = "PERB16_DWP_14297")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14297_fish_ids)), newname = "PGOD21_DWP_14297")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14297 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14297",
      GODSillyIDs = list("PGOD21_DWP_14297" = rownames(PGOD21_DWP_14297.gcl$counts)),
      HeartSillys = "PERB16_DWP_14297",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14297_best_match <- dup_check_results_DWP_14297 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14297 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14297_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14297 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14297_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14297 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14297_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14297_1stbest <- dup_check_results_DWP_14297 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14297_2ndbest <- dup_check_results_DWP_14297 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14297_top_2 <- rbind(dup_check_results_DWP_14297_1stbest, dup_check_results_DWP_14297_2ndbest))

ggplot(data = dup_check_results_DWP_14297_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14297_pass <- dup_check_results_DWP_14297_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14297_pass)
length(unique(dup_check_results_DWP_14297_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14297_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14297_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *8. PERB16_DWP_14282*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14282_fish_ids)), newname = "PERB16_DWP_14282")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14282_fish_ids)), newname = "PGOD21_DWP_14282")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14282 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14282",
      GODSillyIDs = list("PGOD21_DWP_14282" = rownames(PGOD21_DWP_14282.gcl$counts)),
      HeartSillys = "PERB16_DWP_14282",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14282_best_match <- dup_check_results_DWP_14282 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14282 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14282_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14282 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14282_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14282 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14282_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14282_1stbest <- dup_check_results_DWP_14282 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14282_2ndbest <- dup_check_results_DWP_14282 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14282_top_2 <- rbind(dup_check_results_DWP_14282_1stbest, dup_check_results_DWP_14282_2ndbest))

ggplot(data = dup_check_results_DWP_14282_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14282_pass <- dup_check_results_DWP_14282_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14282_pass)
length(unique(dup_check_results_DWP_14282_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14282_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_14282_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *9. PERB16_DWP_14332*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14332_fish_ids)), newname = "PERB16_DWP_14332")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14332_fish_ids)), newname = "PGOD21_DWP_14332")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14332 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14332",
      GODSillyIDs = list("PGOD21_DWP_14332" = rownames(PGOD21_DWP_14332.gcl$counts)),
      HeartSillys = "PERB16_DWP_14332",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14332_best_match <- dup_check_results_DWP_14332 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14332 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14332_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14332 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14332_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14332 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14332_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14332_1stbest <- dup_check_results_DWP_14332 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14332_2ndbest <- dup_check_results_DWP_14332 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14332_top_2 <- rbind(dup_check_results_DWP_14332_1stbest, dup_check_results_DWP_14332_2ndbest))

ggplot(data = dup_check_results_DWP_14332_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14332_pass <- dup_check_results_DWP_14332_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14332_pass)
length(unique(dup_check_results_DWP_14332_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14332_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_14332_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *10. PERB16_DWP_14290*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14290_fish_ids)), newname = "PERB16_DWP_14290")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14290_fish_ids)), newname = "PGOD21_DWP_14290")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14290 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14290",
      GODSillyIDs = list("PGOD21_DWP_14290" = rownames(PGOD21_DWP_14290.gcl$counts)),
      HeartSillys = "PERB16_DWP_14290",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14290_best_match <- dup_check_results_DWP_14290 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14290 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14290_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14290 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14290_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14290 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14290_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14290_1stbest <- dup_check_results_DWP_14290 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14290_2ndbest <- dup_check_results_DWP_14290 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14290_top_2 <- rbind(dup_check_results_DWP_14290_1stbest, dup_check_results_DWP_14290_2ndbest))

ggplot(data = dup_check_results_DWP_14290_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14290_pass <- dup_check_results_DWP_14290_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14290_pass)
length(unique(dup_check_results_DWP_14290_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14290_pass$otolith_fish_id))
```

##### Purge multi-matching otos (DUMMY CODE)

```{r}
# dup_check_results_DWP_2071_pass_dup <- dup_check_results_DWP_2071_pass[duplicated(dup_check_results_DWP_2071_pass$otolith_fish_id), ]
# dup_check_results_DWP_2071_pass_dup <- dup_check_results_DWP_2071_pass_dup$otolith_fish_id
# 
# (dup_check_results_DWP_2071_pass_purged <- dup_check_results_DWP_2071_pass[!(dup_check_results_DWP_2071_pass$otolith_fish_id == dup_check_results_DWP_2071_pass_dup), ])
# 
# length(unique(dup_check_results_DWP_2071_pass_purged$otolith_fish_id)) == nrow(dup_check_results_DWP_2071_pass_purged)
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14290_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *11. PERB16_DWP_14307*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14307_fish_ids)), newname = "PERB16_DWP_14307")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14307_fish_ids)), newname = "PGOD21_DWP_14307")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14307 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14307",
      GODSillyIDs = list("PGOD21_DWP_14307" = rownames(PGOD21_DWP_14307.gcl$counts)),
      HeartSillys = "PERB16_DWP_14307",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14307_best_match <- dup_check_results_DWP_14307 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14307 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14307_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14307 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14307_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14307 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14307_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14307_1stbest <- dup_check_results_DWP_14307 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14307_2ndbest <- dup_check_results_DWP_14307 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14307_top_2 <- rbind(dup_check_results_DWP_14307_1stbest, dup_check_results_DWP_14307_2ndbest))

ggplot(data = dup_check_results_DWP_14307_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15.

```{r}
# filtered results table
(dup_check_results_DWP_14307_pass <- dup_check_results_DWP_14307_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14307_pass)
length(unique(dup_check_results_DWP_14307_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14307_pass$otolith_fish_id))
```

##### Status: No otos passing; OK

```{r}
# write.table(dup_check_results_DWP_14307_pass, "dup_check_results_pass.csv")
```

#### *12. PERB16_DWP_14312*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14312_fish_ids)), newname = "PERB16_DWP_14312")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14312_fish_ids)), newname = "PGOD21_DWP_14312")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14312 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14312",
      GODSillyIDs = list("PGOD21_DWP_14312" = rownames(PGOD21_DWP_14312.gcl$counts)),
      HeartSillys = "PERB16_DWP_14312",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14312_best_match <- dup_check_results_DWP_14312 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14312 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14312_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14312 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14312_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14312 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14312_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14312_1stbest <- dup_check_results_DWP_14312 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14312_2ndbest <- dup_check_results_DWP_14312 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14312_top_2 <- rbind(dup_check_results_DWP_14312_1stbest, dup_check_results_DWP_14312_2ndbest))

ggplot(data = dup_check_results_DWP_14312_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14312_pass <- dup_check_results_DWP_14312_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14312_pass)
length(unique(dup_check_results_DWP_14312_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14312_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
# # write.table(dup_check_results_DWP_14449_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *13. PERB16_DWP_14326*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14326_fish_ids)), newname = "PERB16_DWP_14326")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14326_fish_ids)), newname = "PGOD21_DWP_14326")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14326 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14326",
      GODSillyIDs = list("PGOD21_DWP_14326" = rownames(PGOD21_DWP_14326.gcl$counts)),
      HeartSillys = "PERB16_DWP_14326",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14326_best_match <- dup_check_results_DWP_14326 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14326 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14326_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14326 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14326_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14326 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14326_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14326_1stbest <- dup_check_results_DWP_14326 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14326_2ndbest <- dup_check_results_DWP_14326 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14326_top_2 <- rbind(dup_check_results_DWP_14326_1stbest, dup_check_results_DWP_14326_2ndbest))

ggplot(data = dup_check_results_DWP_14326_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14326_pass <- dup_check_results_DWP_14326_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14326_pass)
length(unique(dup_check_results_DWP_14326_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14326_pass$otolith_fish_id))
```

##### Status: No passing otos; OK


```{r}
# write.table(dup_check_results_DWP_14326_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *14. PERB16_DWP_14327*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14327_fish_ids)), newname = "PERB16_DWP_14327")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14327_fish_ids)), newname = "PGOD21_DWP_14327")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14327 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14327",
      GODSillyIDs = list("PGOD21_DWP_14327" = rownames(PGOD21_DWP_14327.gcl$counts)),
      HeartSillys = "PERB16_DWP_14327",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14327_best_match <- dup_check_results_DWP_14327 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14327 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14327_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14327 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14327_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14327 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14327_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14327_1stbest <- dup_check_results_DWP_14327 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14327_2ndbest <- dup_check_results_DWP_14327 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14327_top_2 <- rbind(dup_check_results_DWP_14327_1stbest, dup_check_results_DWP_14327_2ndbest))

ggplot(data = dup_check_results_DWP_14327_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14327_pass <- dup_check_results_DWP_14327_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14327_pass)
length(unique(dup_check_results_DWP_14327_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14327_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14327_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *15. PERB16_DWP_14330*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14330_fish_ids)), newname = "PERB16_DWP_14330")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14330_fish_ids)), newname = "PGOD21_DWP_14330")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14330 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14330",
      GODSillyIDs = list("PGOD21_DWP_14330" = rownames(PGOD21_DWP_14330.gcl$counts)),
      HeartSillys = "PERB16_DWP_14330",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14330_best_match <- dup_check_results_DWP_14330 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14330 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14330_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14330 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14330_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14330 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14330_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14330_1stbest <- dup_check_results_DWP_14330 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14330_2ndbest <- dup_check_results_DWP_14330 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14330_top_2 <- rbind(dup_check_results_DWP_14330_1stbest, dup_check_results_DWP_14330_2ndbest))

ggplot(data = dup_check_results_DWP_14330_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14330_pass <- dup_check_results_DWP_14330_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14330_pass)
length(unique(dup_check_results_DWP_14330_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14330_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14330_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *16. PERB16_DWP_14336*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14336_fish_ids)), newname = "PERB16_DWP_14336")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14336_fish_ids)), newname = "PGOD21_DWP_14336")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14336 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14336",
      GODSillyIDs = list("PGOD21_DWP_14336" = rownames(PGOD21_DWP_14336.gcl$counts)),
      HeartSillys = "PERB16_DWP_14336",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14336_best_match <- dup_check_results_DWP_14336 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14336 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14336_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14336 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14336_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14336 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14336_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14336_1stbest <- dup_check_results_DWP_14336 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14336_2ndbest <- dup_check_results_DWP_14336 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14336_top_2 <- rbind(dup_check_results_DWP_14336_1stbest, dup_check_results_DWP_14336_2ndbest))

ggplot(data = dup_check_results_DWP_14336_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14336_pass <- dup_check_results_DWP_14336_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14336_pass)
length(unique(dup_check_results_DWP_14336_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14336_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14336_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *17. PERB16_DWP_14354*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14354_fish_ids)), newname = "PERB16_DWP_14354")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14354_fish_ids)), newname = "PGOD21_DWP_14354")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14354 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14354",
      GODSillyIDs = list("PGOD21_DWP_14354" = rownames(PGOD21_DWP_14354.gcl$counts)),
      HeartSillys = "PERB16_DWP_14354",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14354_best_match <- dup_check_results_DWP_14354 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14354 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14354_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14354 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14354_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14354 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14354_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14354_1stbest <- dup_check_results_DWP_14354 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14354_2ndbest <- dup_check_results_DWP_14354 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14354_top_2 <- rbind(dup_check_results_DWP_14354_1stbest, dup_check_results_DWP_14354_2ndbest))

ggplot(data = dup_check_results_DWP_14354_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.6 and diff >= 0.125

```{r}
# filtered results table
(dup_check_results_DWP_14354_pass <- dup_check_results_DWP_14354_1stbest %>% 
  filter(duplicate_rate >= 0.6) %>% 
  filter(diff >= 0.125))

# vector lengths
nrow(dup_check_results_DWP_14354_pass)
length(unique(dup_check_results_DWP_14354_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14354_pass$otolith_fish_id))
```

##### Purge multi-matching otos

```{r}
dup_check_results_DWP_14354_pass_dup <- dup_check_results_DWP_14354_pass[duplicated(dup_check_results_DWP_14354_pass$otolith_fish_id), ]
dup_check_results_DWP_14354_pass_dup <- dup_check_results_DWP_14354_pass_dup$otolith_fish_id

(dup_check_results_DWP_14354_pass_purged <- dup_check_results_DWP_14354_pass[!(dup_check_results_DWP_14354_pass$otolith_fish_id == dup_check_results_DWP_14354_pass_dup), ])

length(unique(dup_check_results_DWP_14354_pass_purged$otolith_fish_id)) == nrow(dup_check_results_DWP_14354_pass_purged)
```

##### Status: Changed cutoff values; purged oto 3366; OK

```{r}
# write.table(dup_check_results_DWP_14354_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *18. PERB16_DWP_14358*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14358_fish_ids)), newname = "PERB16_DWP_14358")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14358_fish_ids)), newname = "PGOD21_DWP_14358")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14358 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14358",
      GODSillyIDs = list("PGOD21_DWP_14358" = rownames(PGOD21_DWP_14358.gcl$counts)),
      HeartSillys = "PERB16_DWP_14358",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14358_best_match <- dup_check_results_DWP_14358 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14358 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14358_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14358 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14358_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14358 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14358_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14358_1stbest <- dup_check_results_DWP_14358 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14358_2ndbest <- dup_check_results_DWP_14358 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14358_top_2 <- rbind(dup_check_results_DWP_14358_1stbest, dup_check_results_DWP_14358_2ndbest))

ggplot(data = dup_check_results_DWP_14358_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14358_pass <- dup_check_results_DWP_14358_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14358_pass)
length(unique(dup_check_results_DWP_14358_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14358_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14358_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *19. PERB16_DWP_14367*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14367_fish_ids)), newname = "PERB16_DWP_14367")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14367_fish_ids)), newname = "PGOD21_DWP_14367")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14367 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14367",
      GODSillyIDs = list("PGOD21_DWP_14367" = rownames(PGOD21_DWP_14367.gcl$counts)),
      HeartSillys = "PERB16_DWP_14367",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14367_best_match <- dup_check_results_DWP_14367 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14367 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14367_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14367 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14367_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14367 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14367_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14367_1stbest <- dup_check_results_DWP_14367 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14367_2ndbest <- dup_check_results_DWP_14367 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14367_top_2 <- rbind(dup_check_results_DWP_14367_1stbest, dup_check_results_DWP_14367_2ndbest))

ggplot(data = dup_check_results_DWP_14367_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14367_pass <- dup_check_results_DWP_14367_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14367_pass)
length(unique(dup_check_results_DWP_14367_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14367_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14367_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *20. PERB16_DWP_14368*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14368_fish_ids)), newname = "PERB16_DWP_14368")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14368_fish_ids)), newname = "PGOD21_DWP_14368")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14368 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14368",
      GODSillyIDs = list("PGOD21_DWP_14368" = rownames(PGOD21_DWP_14368.gcl$counts)),
      HeartSillys = "PERB16_DWP_14368",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14368_best_match <- dup_check_results_DWP_14368 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14368 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14368_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14368 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14368_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14368 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14368_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14368_1stbest <- dup_check_results_DWP_14368 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14368_2ndbest <- dup_check_results_DWP_14368 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14368_top_2 <- rbind(dup_check_results_DWP_14368_1stbest, dup_check_results_DWP_14368_2ndbest))

ggplot(data = dup_check_results_DWP_14368_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14368_pass <- dup_check_results_DWP_14368_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14368_pass)
length(unique(dup_check_results_DWP_14368_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14368_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14368_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *21. PERB16_DWP_14394*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14394_fish_ids)), newname = "PERB16_DWP_14394")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14394_fish_ids)), newname = "PGOD21_DWP_14394")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14394 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14394",
      GODSillyIDs = list("PGOD21_DWP_14394" = rownames(PGOD21_DWP_14394.gcl$counts)),
      HeartSillys = "PERB16_DWP_14394",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14394_best_match <- dup_check_results_DWP_14394 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14394 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14394_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14394 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14394_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14394 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14394_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14394_1stbest <- dup_check_results_DWP_14394 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14394_2ndbest <- dup_check_results_DWP_14394 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14394_top_2 <- rbind(dup_check_results_DWP_14394_1stbest, dup_check_results_DWP_14394_2ndbest))

ggplot(data = dup_check_results_DWP_14394_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.8 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14394_pass <- dup_check_results_DWP_14394_1stbest %>% 
  filter(duplicate_rate >= 0.8) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14394_pass)
length(unique(dup_check_results_DWP_14394_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14394_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
# write.table(dup_check_results_DWP_14394_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *22. PERB16_DWP_14398*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14398_fish_ids)), newname = "PERB16_DWP_14398")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14398_fish_ids)), newname = "PGOD21_DWP_14398")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14398 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14398",
      GODSillyIDs = list("PGOD21_DWP_14398" = rownames(PGOD21_DWP_14398.gcl$counts)),
      HeartSillys = "PERB16_DWP_14398",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14398_best_match <- dup_check_results_DWP_14398 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14398 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14398_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14398 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14398_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14398 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14398_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14398_1stbest <- dup_check_results_DWP_14398 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14398_2ndbest <- dup_check_results_DWP_14398 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14398_top_2 <- rbind(dup_check_results_DWP_14398_1stbest, dup_check_results_DWP_14398_2ndbest))

ggplot(data = dup_check_results_DWP_14398_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14398_pass <- dup_check_results_DWP_14398_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14398_pass)
length(unique(dup_check_results_DWP_14398_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14398_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
# write.table(dup_check_results_DWP_14398_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *23. PERB16_DWP_14402*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14402_fish_ids)), newname = "PERB16_DWP_14402")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14402_fish_ids)), newname = "PGOD21_DWP_14402")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14402 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14402",
      GODSillyIDs = list("PGOD21_DWP_14402" = rownames(PGOD21_DWP_14402.gcl$counts)),
      HeartSillys = "PERB16_DWP_14402",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14402_best_match <- dup_check_results_DWP_14402 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14402 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14402_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14402 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14402_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14402 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14402_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14402_1stbest <- dup_check_results_DWP_14402 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14402_2ndbest <- dup_check_results_DWP_14402 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14402_top_2 <- rbind(dup_check_results_DWP_14402_1stbest, dup_check_results_DWP_14402_2ndbest))

ggplot(data = dup_check_results_DWP_14402_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14402_pass <- dup_check_results_DWP_14402_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14402_pass)
length(unique(dup_check_results_DWP_14402_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14402_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14402_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *24. PERB16_DWP_14429*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_14429_fish_ids)), newname = "PERB16_DWP_14429")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14429_fish_ids)), newname = "PGOD21_DWP_14429")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14429 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14429",
      GODSillyIDs = list("PGOD21_DWP_14429" = rownames(PGOD21_DWP_14429.gcl$counts)),
      HeartSillys = "PERB16_DWP_14429",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14429_best_match <- dup_check_results_DWP_14429 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14429 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14429_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14429 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14429_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14429 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14429_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14429_1stbest <- dup_check_results_DWP_14429 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14429_2ndbest <- dup_check_results_DWP_14429 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14429_top_2 <- rbind(dup_check_results_DWP_14429_1stbest, dup_check_results_DWP_14429_2ndbest))

ggplot(data = dup_check_results_DWP_14429_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14429_pass <- dup_check_results_DWP_14429_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14429_pass)
length(unique(dup_check_results_DWP_14429_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14429_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
# write.table(dup_check_results_DWP_14429_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *25. PERB16_DWP_16086*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16086_fish_ids)), newname = "PERB16_DWP_16086")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16086_fish_ids)), newname = "PGOD21_DWP_16086")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16086 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16086",
      GODSillyIDs = list("PGOD21_DWP_16086" = rownames(PGOD21_DWP_16086.gcl$counts)),
      HeartSillys = "PERB16_DWP_16086",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16086_best_match <- dup_check_results_DWP_16086 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16086 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16086_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16086 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16086_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16086 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16086_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16086_1stbest <- dup_check_results_DWP_16086 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16086_2ndbest <- dup_check_results_DWP_16086 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16086_top_2 <- rbind(dup_check_results_DWP_16086_1stbest, dup_check_results_DWP_16086_2ndbest))

ggplot(data = dup_check_results_DWP_16086_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16086_pass <- dup_check_results_DWP_16086_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16086_pass)
length(unique(dup_check_results_DWP_16086_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16086_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
# write.table(dup_check_results_DWP_16086_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *26. PERB16_DWP_16090*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16090_fish_ids)), newname = "PERB16_DWP_16090")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16090_fish_ids)), newname = "PGOD21_DWP_16090")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16090 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16090",
      GODSillyIDs = list("PGOD21_DWP_16090" = rownames(PGOD21_DWP_16090.gcl$counts)),
      HeartSillys = "PERB16_DWP_16090",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16090_best_match <- dup_check_results_DWP_16090 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16090 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16090_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16090 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16090_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16090 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16090_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16090_1stbest <- dup_check_results_DWP_16090 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16090_2ndbest <- dup_check_results_DWP_16090 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16090_top_2 <- rbind(dup_check_results_DWP_16090_1stbest, dup_check_results_DWP_16090_2ndbest))

ggplot(data = dup_check_results_DWP_16090_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16090_pass <- dup_check_results_DWP_16090_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16090_pass)
length(unique(dup_check_results_DWP_16090_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16090_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
# write.table(dup_check_results_DWP_16090_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *27. PERB16_DWP_16092*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16092_fish_ids)), newname = "PERB16_DWP_16092")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16092_fish_ids)), newname = "PGOD21_DWP_16092")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16092 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16092",
      GODSillyIDs = list("PGOD21_DWP_16092" = rownames(PGOD21_DWP_16092.gcl$counts)),
      HeartSillys = "PERB16_DWP_16092",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16092_best_match <- dup_check_results_DWP_16092 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16092 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16092_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16092 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16092_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16092 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16092_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16092_1stbest <- dup_check_results_DWP_16092 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16092_2ndbest <- dup_check_results_DWP_16092 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16092_top_2 <- rbind(dup_check_results_DWP_16092_1stbest, dup_check_results_DWP_16092_2ndbest))

ggplot(data = dup_check_results_DWP_16092_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16092_pass <- dup_check_results_DWP_16092_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16092_pass)
length(unique(dup_check_results_DWP_16092_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16092_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
# write.table(dup_check_results_DWP_16092_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *28. PERB16_DWP_16095*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16095_fish_ids)), newname = "PERB16_DWP_16095")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16095_fish_ids)), newname = "PGOD21_DWP_16095")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16095 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16095",
      GODSillyIDs = list("PGOD21_DWP_16095" = rownames(PGOD21_DWP_16095.gcl$counts)),
      HeartSillys = "PERB16_DWP_16095",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16095_best_match <- dup_check_results_DWP_16095 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16095 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16095_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16095 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16095_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16095 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16095_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16095_1stbest <- dup_check_results_DWP_16095 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16095_2ndbest <- dup_check_results_DWP_16095 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16095_top_2 <- rbind(dup_check_results_DWP_16095_1stbest, dup_check_results_DWP_16095_2ndbest))

ggplot(data = dup_check_results_DWP_16095_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16095_pass <- dup_check_results_DWP_16095_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16095_pass)
length(unique(dup_check_results_DWP_16095_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16095_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16095_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *29. PERB16_DWP_16096*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16096_fish_ids)), newname = "PERB16_DWP_16096")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16096_fish_ids)), newname = "PGOD21_DWP_16096")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16096 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16096",
      GODSillyIDs = list("PGOD21_DWP_16096" = rownames(PGOD21_DWP_16096.gcl$counts)),
      HeartSillys = "PERB16_DWP_16096",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16096_best_match <- dup_check_results_DWP_16096 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16096 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16096_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16096 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16096_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16096 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16096_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16096_1stbest <- dup_check_results_DWP_16096 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16096_2ndbest <- dup_check_results_DWP_16096 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16096_top_2 <- rbind(dup_check_results_DWP_16096_1stbest, dup_check_results_DWP_16096_2ndbest))

ggplot(data = dup_check_results_DWP_16096_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16096_pass <- dup_check_results_DWP_16096_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16096_pass)
length(unique(dup_check_results_DWP_16096_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16096_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16096_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *30. PERB16_DWP_16097*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16097_fish_ids)), newname = "PERB16_DWP_16097")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16097_fish_ids)), newname = "PGOD21_DWP_16097")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16097 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16097",
      GODSillyIDs = list("PGOD21_DWP_16097" = rownames(PGOD21_DWP_16097.gcl$counts)),
      HeartSillys = "PERB16_DWP_16097",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16097_best_match <- dup_check_results_DWP_16097 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16097 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16097_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16097 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16097_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16097 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16097_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16097_1stbest <- dup_check_results_DWP_16097 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16097_2ndbest <- dup_check_results_DWP_16097 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16097_top_2 <- rbind(dup_check_results_DWP_16097_1stbest, dup_check_results_DWP_16097_2ndbest))

ggplot(data = dup_check_results_DWP_16097_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16097_pass <- dup_check_results_DWP_16097_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16097_pass)
length(unique(dup_check_results_DWP_16097_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16097_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16097_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *31. PERB16_DWP_16101*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16101_fish_ids)), newname = "PERB16_DWP_16101")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16101_fish_ids)), newname = "PGOD21_DWP_16101")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16101 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16101",
      GODSillyIDs = list("PGOD21_DWP_16101" = rownames(PGOD21_DWP_16101.gcl$counts)),
      HeartSillys = "PERB16_DWP_16101",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16101_best_match <- dup_check_results_DWP_16101 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16101 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16101_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16101 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16101_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16101 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16101_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16101_1stbest <- dup_check_results_DWP_16101 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16101_2ndbest <- dup_check_results_DWP_16101 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16101_top_2 <- rbind(dup_check_results_DWP_16101_1stbest, dup_check_results_DWP_16101_2ndbest))

ggplot(data = dup_check_results_DWP_16101_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16101_pass <- dup_check_results_DWP_16101_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16101_pass)
length(unique(dup_check_results_DWP_16101_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16101_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16101_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *32. PERB16_DWP_16117*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16117_fish_ids)), newname = "PERB16_DWP_16117")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16117_fish_ids)), newname = "PGOD21_DWP_16117")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16117 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16117",
      GODSillyIDs = list("PGOD21_DWP_16117" = rownames(PGOD21_DWP_16117.gcl$counts)),
      HeartSillys = "PERB16_DWP_16117",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16117_best_match <- dup_check_results_DWP_16117 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16117 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16117_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16117 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16117_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16117 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16117_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16117_1stbest <- dup_check_results_DWP_16117 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16117_2ndbest <- dup_check_results_DWP_16117 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16117_top_2 <- rbind(dup_check_results_DWP_16117_1stbest, dup_check_results_DWP_16117_2ndbest))

ggplot(data = dup_check_results_DWP_16117_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16117_pass <- dup_check_results_DWP_16117_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16117_pass)
length(unique(dup_check_results_DWP_16117_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16117_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16117_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *33. PERB16_DWP_16118*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16118_fish_ids)), newname = "PERB16_DWP_16118")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16118_fish_ids)), newname = "PGOD21_DWP_16118")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16118 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16118",
      GODSillyIDs = list("PGOD21_DWP_16118" = rownames(PGOD21_DWP_16118.gcl$counts)),
      HeartSillys = "PERB16_DWP_16118",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16118_best_match <- dup_check_results_DWP_16118 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16118 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16118_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16118 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16118_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16118 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16118_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16118_1stbest <- dup_check_results_DWP_16118 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16118_2ndbest <- dup_check_results_DWP_16118 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16118_top_2 <- rbind(dup_check_results_DWP_16118_1stbest, dup_check_results_DWP_16118_2ndbest))

ggplot(data = dup_check_results_DWP_16118_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16118_pass <- dup_check_results_DWP_16118_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16118_pass)
length(unique(dup_check_results_DWP_16118_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16118_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16118_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *34. PERB16_DWP_16120*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16120_fish_ids)), newname = "PERB16_DWP_16120")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16120_fish_ids)), newname = "PGOD21_DWP_16120")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16120 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16120",
      GODSillyIDs = list("PGOD21_DWP_16120" = rownames(PGOD21_DWP_16120.gcl$counts)),
      HeartSillys = "PERB16_DWP_16120",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16120_best_match <- dup_check_results_DWP_16120 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16120 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16120_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16120 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16120_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16120 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16120_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16120_1stbest <- dup_check_results_DWP_16120 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16120_2ndbest <- dup_check_results_DWP_16120 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16120_top_2 <- rbind(dup_check_results_DWP_16120_1stbest, dup_check_results_DWP_16120_2ndbest))

ggplot(data = dup_check_results_DWP_16120_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16120_pass <- dup_check_results_DWP_16120_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16120_pass)
length(unique(dup_check_results_DWP_16120_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16120_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16120_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *35. PERB16_DWP_16121*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16121_fish_ids)), newname = "PERB16_DWP_16121")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16121_fish_ids)), newname = "PGOD21_DWP_16121")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16121 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16121",
      GODSillyIDs = list("PGOD21_DWP_16121" = rownames(PGOD21_DWP_16121.gcl$counts)),
      HeartSillys = "PERB16_DWP_16121",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16121_best_match <- dup_check_results_DWP_16121 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16121 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16121_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16121 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16121_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16121 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16121_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16121_1stbest <- dup_check_results_DWP_16121 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16121_2ndbest <- dup_check_results_DWP_16121 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16121_top_2 <- rbind(dup_check_results_DWP_16121_1stbest, dup_check_results_DWP_16121_2ndbest))

ggplot(data = dup_check_results_DWP_16121_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16121_pass <- dup_check_results_DWP_16121_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16121_pass)
length(unique(dup_check_results_DWP_16121_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16121_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
# write.table(dup_check_results_DWP_16121_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *36. PERB16_DWP_16122*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16122_fish_ids)), newname = "PERB16_DWP_16122")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16122_fish_ids)), newname = "PGOD21_DWP_16122")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16122 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16122",
      GODSillyIDs = list("PGOD21_DWP_16122" = rownames(PGOD21_DWP_16122.gcl$counts)),
      HeartSillys = "PERB16_DWP_16122",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16122_best_match <- dup_check_results_DWP_16122 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16122 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16122_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16122 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16122_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16122 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16122_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16122_1stbest <- dup_check_results_DWP_16122 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16122_2ndbest <- dup_check_results_DWP_16122 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16122_top_2 <- rbind(dup_check_results_DWP_16122_1stbest, dup_check_results_DWP_16122_2ndbest))

ggplot(data = dup_check_results_DWP_16122_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16122_pass <- dup_check_results_DWP_16122_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16122_pass)
length(unique(dup_check_results_DWP_16122_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16122_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16122_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *37. PERB16_DWP_16136*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16136_fish_ids)), newname = "PERB16_DWP_16136")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16136_fish_ids)), newname = "PGOD21_DWP_16136")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16136 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16136",
      GODSillyIDs = list("PGOD21_DWP_16136" = rownames(PGOD21_DWP_16136.gcl$counts)),
      HeartSillys = "PERB16_DWP_16136",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16136_best_match <- dup_check_results_DWP_16136 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16136 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16136_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16136 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16136_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16136 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16136_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16136_1stbest <- dup_check_results_DWP_16136 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16136_2ndbest <- dup_check_results_DWP_16136 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16136_top_2 <- rbind(dup_check_results_DWP_16136_1stbest, dup_check_results_DWP_16136_2ndbest))

ggplot(data = dup_check_results_DWP_16136_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16136_pass <- dup_check_results_DWP_16136_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16136_pass)
length(unique(dup_check_results_DWP_16136_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16136_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16136_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *38. PERB16_DWP_16144*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16144_fish_ids)), newname = "PERB16_DWP_16144")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16144_fish_ids)), newname = "PGOD21_DWP_16144")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16144 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16144",
      GODSillyIDs = list("PGOD21_DWP_16144" = rownames(PGOD21_DWP_16144.gcl$counts)),
      HeartSillys = "PERB16_DWP_16144",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16144_best_match <- dup_check_results_DWP_16144 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16144 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16144_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16144 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16144_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16144 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16144_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16144_1stbest <- dup_check_results_DWP_16144 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16144_2ndbest <- dup_check_results_DWP_16144 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16144_top_2 <- rbind(dup_check_results_DWP_16144_1stbest, dup_check_results_DWP_16144_2ndbest))

ggplot(data = dup_check_results_DWP_16144_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16144_pass <- dup_check_results_DWP_16144_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16144_pass)
length(unique(dup_check_results_DWP_16144_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16144_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16144_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *39. PERB16_DWP_16147*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16147_fish_ids)), newname = "PERB16_DWP_16147")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16147_fish_ids)), newname = "PGOD21_DWP_16147")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16147 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16147",
      GODSillyIDs = list("PGOD21_DWP_16147" = rownames(PGOD21_DWP_16147.gcl$counts)),
      HeartSillys = "PERB16_DWP_16147",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16147_best_match <- dup_check_results_DWP_16147 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16147 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16147_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16147 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16147_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16147 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16147_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16147_1stbest <- dup_check_results_DWP_16147 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16147_2ndbest <- dup_check_results_DWP_16147 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16147_top_2 <- rbind(dup_check_results_DWP_16147_1stbest, dup_check_results_DWP_16147_2ndbest))

ggplot(data = dup_check_results_DWP_16147_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16147_pass <- dup_check_results_DWP_16147_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16147_pass)
length(unique(dup_check_results_DWP_16147_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16147_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16147_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *40. PERB16_DWP_16174*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PERB16", loci = loci, IDs = list("PERB16" = as.character(PERB16_DWP_16174_fish_ids)), newname = "PERB16_DWP_16174")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16174_fish_ids)), newname = "PGOD21_DWP_16174")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16174 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16174",
      GODSillyIDs = list("PGOD21_DWP_16174" = rownames(PGOD21_DWP_16174.gcl$counts)),
      HeartSillys = "PERB16_DWP_16174",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16174_best_match <- dup_check_results_DWP_16174 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16174 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16174_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16174 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16174_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16174 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16174_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16174_1stbest <- dup_check_results_DWP_16174 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16174_2ndbest <- dup_check_results_DWP_16174 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16174_top_2 <- rbind(dup_check_results_DWP_16174_1stbest, dup_check_results_DWP_16174_2ndbest))

ggplot(data = dup_check_results_DWP_16174_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16174_pass <- dup_check_results_DWP_16174_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16174_pass)
length(unique(dup_check_results_DWP_16174_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16174_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16174_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### ###############**PGILMOUR15**###############

#### *1. PGILMOUR15_DWP_2123*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2123_fish_ids)), newname = "PGILMOUR15_DWP_2123")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2123_fish_ids)), newname = "PGOD21_DWP_2123")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2123 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2123",
      GODSillyIDs = list("PGOD21_DWP_2123" = rownames(PGOD21_DWP_2123.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2123",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2123_best_match <- dup_check_results_DWP_2123 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2123 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2123_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2123 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2123_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2123 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2123_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2123_1stbest <- dup_check_results_DWP_2123 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2123_2ndbest <- dup_check_results_DWP_2123 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2123_top_2 <- rbind(dup_check_results_DWP_2123_1stbest, dup_check_results_DWP_2123_2ndbest))

ggplot(data = dup_check_results_DWP_2123_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2123_pass <- dup_check_results_DWP_2123_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2123_pass)
length(unique(dup_check_results_DWP_2123_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2123_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2123_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *2. PGILMOUR15_DWP_2129*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2129_fish_ids)), newname = "PGILMOUR15_DWP_2129")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2129_fish_ids)), newname = "PGOD21_DWP_2129")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2129 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2129",
      GODSillyIDs = list("PGOD21_DWP_2129" = rownames(PGOD21_DWP_2129.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2129",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2129_best_match <- dup_check_results_DWP_2129 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2129 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2129_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2129 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2129_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2129 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2129_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2129_1stbest <- dup_check_results_DWP_2129 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2129_2ndbest <- dup_check_results_DWP_2129 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2129_top_2 <- rbind(dup_check_results_DWP_2129_1stbest, dup_check_results_DWP_2129_2ndbest))

ggplot(data = dup_check_results_DWP_2129_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2129_pass <- dup_check_results_DWP_2129_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2129_pass)
length(unique(dup_check_results_DWP_2129_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2129_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_2129_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *3. PGILMOUR15_DWP_2161*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2161_fish_ids)), newname = "PGILMOUR15_DWP_2161")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2161_fish_ids)), newname = "PGOD21_DWP_2161")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2161 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2161",
      GODSillyIDs = list("PGOD21_DWP_2161" = rownames(PGOD21_DWP_2161.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2161",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2161_best_match <- dup_check_results_DWP_2161 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2161 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2161_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2161 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2161_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2161 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2161_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2161_1stbest <- dup_check_results_DWP_2161 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2161_2ndbest <- dup_check_results_DWP_2161 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2161_top_2 <- rbind(dup_check_results_DWP_2161_1stbest, dup_check_results_DWP_2161_2ndbest))

ggplot(data = dup_check_results_DWP_2161_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2161_pass <- dup_check_results_DWP_2161_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2161_pass)
length(unique(dup_check_results_DWP_2161_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2161_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2161_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *4. PGILMOUR15_DWP_2192*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2192_fish_ids)), newname = "PGILMOUR15_DWP_2192")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2192_fish_ids)), newname = "PGOD21_DWP_2192")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2192 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2192",
      GODSillyIDs = list("PGOD21_DWP_2192" = rownames(PGOD21_DWP_2192.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2192",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2192_best_match <- dup_check_results_DWP_2192 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2192 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2192_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2192 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2192_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2192 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2192_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2192_1stbest <- dup_check_results_DWP_2192 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2192_2ndbest <- dup_check_results_DWP_2192 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2192_top_2 <- rbind(dup_check_results_DWP_2192_1stbest, dup_check_results_DWP_2192_2ndbest))

ggplot(data = dup_check_results_DWP_2192_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2192_pass <- dup_check_results_DWP_2192_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2192_pass)
length(unique(dup_check_results_DWP_2192_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2192_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2192_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *5. PGILMOUR15_DWP_2195*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2195_fish_ids)), newname = "PGILMOUR15_DWP_2195")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2195_fish_ids)), newname = "PGOD21_DWP_2195")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2195 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2195",
      GODSillyIDs = list("PGOD21_DWP_2195" = rownames(PGOD21_DWP_2195.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2195",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2195_best_match <- dup_check_results_DWP_2195 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2195 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2195_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2195 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2195_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2195 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2195_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2195_1stbest <- dup_check_results_DWP_2195 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2195_2ndbest <- dup_check_results_DWP_2195 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2195_top_2 <- rbind(dup_check_results_DWP_2195_1stbest, dup_check_results_DWP_2195_2ndbest))

ggplot(data = dup_check_results_DWP_2195_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_2195_pass <- dup_check_results_DWP_2195_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_2195_pass)
length(unique(dup_check_results_DWP_2195_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2195_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_2195_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *6. PGILMOUR15_DWP_2228*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2228_fish_ids)), newname = "PGILMOUR15_DWP_2228")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2228_fish_ids)), newname = "PGOD21_DWP_2228")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2228 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2228",
      GODSillyIDs = list("PGOD21_DWP_2228" = rownames(PGOD21_DWP_2228.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2228",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2228_best_match <- dup_check_results_DWP_2228 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2228 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2228_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2228 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2228_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2228 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2228_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2228_1stbest <- dup_check_results_DWP_2228 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2228_2ndbest <- dup_check_results_DWP_2228 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2228_top_2 <- rbind(dup_check_results_DWP_2228_1stbest, dup_check_results_DWP_2228_2ndbest))

ggplot(data = dup_check_results_DWP_2228_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2228_pass <- dup_check_results_DWP_2228_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2228_pass)
length(unique(dup_check_results_DWP_2228_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2228_pass$otolith_fish_id))
```

##### Status: Changed cutoffs; OK

```{r}
write.table(dup_check_results_DWP_2228_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *7. PGILMOUR15_DWP_2232*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2232_fish_ids)), newname = "PGILMOUR15_DWP_2232")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2232_fish_ids)), newname = "PGOD21_DWP_2232")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2232 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2232",
      GODSillyIDs = list("PGOD21_DWP_2232" = rownames(PGOD21_DWP_2232.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2232",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2232_best_match <- dup_check_results_DWP_2232 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2232 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2232_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2232 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2232_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2232 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2232_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2232_1stbest <- dup_check_results_DWP_2232 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2232_2ndbest <- dup_check_results_DWP_2232 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2232_top_2 <- rbind(dup_check_results_DWP_2232_1stbest, dup_check_results_DWP_2232_2ndbest))

ggplot(data = dup_check_results_DWP_2232_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2232_pass <- dup_check_results_DWP_2232_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2232_pass)
length(unique(dup_check_results_DWP_2232_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2232_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2232_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *8. PGILMOUR15_DWP_2234*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2234_fish_ids)), newname = "PGILMOUR15_DWP_2234")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2234_fish_ids)), newname = "PGOD21_DWP_2234")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2234 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2234",
      GODSillyIDs = list("PGOD21_DWP_2234" = rownames(PGOD21_DWP_2234.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2234",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2234_best_match <- dup_check_results_DWP_2234 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2234 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2234_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2234 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2234_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2234 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2234_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2234_1stbest <- dup_check_results_DWP_2234 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2234_2ndbest <- dup_check_results_DWP_2234 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2234_top_2 <- rbind(dup_check_results_DWP_2234_1stbest, dup_check_results_DWP_2234_2ndbest))

ggplot(data = dup_check_results_DWP_2234_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2234_pass <- dup_check_results_DWP_2234_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2234_pass)
length(unique(dup_check_results_DWP_2234_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2234_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2234_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *9. PGILMOUR15_DWP_2505*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2505_fish_ids)), newname = "PGILMOUR15_DWP_2505")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2505_fish_ids)), newname = "PGOD21_DWP_2505")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2505 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2505",
      GODSillyIDs = list("PGOD21_DWP_2505" = rownames(PGOD21_DWP_2505.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2505",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2505_best_match <- dup_check_results_DWP_2505 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2505 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2505_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2505 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2505_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2505 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2505_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2505_1stbest <- dup_check_results_DWP_2505 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2505_2ndbest <- dup_check_results_DWP_2505 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2505_top_2 <- rbind(dup_check_results_DWP_2505_1stbest, dup_check_results_DWP_2505_2ndbest))

ggplot(data = dup_check_results_DWP_2505_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2505_pass <- dup_check_results_DWP_2505_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2505_pass)
length(unique(dup_check_results_DWP_2505_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2505_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2505_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *10. PGILMOUR15_DWP_2838*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2838_fish_ids)), newname = "PGILMOUR15_DWP_2838")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2838_fish_ids)), newname = "PGOD21_DWP_2838")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2838 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2838",
      GODSillyIDs = list("PGOD21_DWP_2838" = rownames(PGOD21_DWP_2838.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2838",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2838_best_match <- dup_check_results_DWP_2838 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2838 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2838_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2838 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2838_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2838 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2838_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2838_1stbest <- dup_check_results_DWP_2838 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2838_2ndbest <- dup_check_results_DWP_2838 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2838_top_2 <- rbind(dup_check_results_DWP_2838_1stbest, dup_check_results_DWP_2838_2ndbest))

ggplot(data = dup_check_results_DWP_2838_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2838_pass <- dup_check_results_DWP_2838_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2838_pass)
length(unique(dup_check_results_DWP_2838_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2838_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_2838_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *11. PGILMOUR15_DWP_2071*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2071_fish_ids)), newname = "PGILMOUR15_DWP_2071")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2071_fish_ids)), newname = "PGOD21_DWP_2071")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2071 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2071",
      GODSillyIDs = list("PGOD21_DWP_2071" = rownames(PGOD21_DWP_2071.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2071",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2071_best_match <- dup_check_results_DWP_2071 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2071 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2071_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2071 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2071_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2071 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2071_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2071_1stbest <- dup_check_results_DWP_2071 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2071_2ndbest <- dup_check_results_DWP_2071 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2071_top_2 <- rbind(dup_check_results_DWP_2071_1stbest, dup_check_results_DWP_2071_2ndbest))

ggplot(data = dup_check_results_DWP_2071_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.8 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2071_pass <- dup_check_results_DWP_2071_1stbest %>% 
  filter(duplicate_rate >= 0.8) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2071_pass)
length(unique(dup_check_results_DWP_2071_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2071_pass$otolith_fish_id))
```

##### Purge multi-matching otos

```{r}
dup_check_results_DWP_2071_pass_dup <- dup_check_results_DWP_2071_pass[duplicated(dup_check_results_DWP_2071_pass$otolith_fish_id), ]
dup_check_results_DWP_2071_pass_dup <- dup_check_results_DWP_2071_pass_dup$otolith_fish_id

(dup_check_results_DWP_2071_pass_purged <- dup_check_results_DWP_2071_pass[!(dup_check_results_DWP_2071_pass$otolith_fish_id == dup_check_results_DWP_2071_pass_dup), ])

length(unique(dup_check_results_DWP_2071_pass_purged$otolith_fish_id)) == nrow(dup_check_results_DWP_2071_pass_purged)
```

##### Status: Changed cutoff values; purged oto 3424; OK

```{r}
# write.table(dup_check_results_DWP_2071_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *12. PGILMOUR15_DWP_2081*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2081_fish_ids)), newname = "PGILMOUR15_DWP_2081")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2081_fish_ids)), newname = "PGOD21_DWP_2081")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2081 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2081",
      GODSillyIDs = list("PGOD21_DWP_2081" = rownames(PGOD21_DWP_2081.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2081",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2081_best_match <- dup_check_results_DWP_2081 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2081 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2081_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2081 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2081_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2081 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2081_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2081_1stbest <- dup_check_results_DWP_2081 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2081_2ndbest <- dup_check_results_DWP_2081 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2081_top_2 <- rbind(dup_check_results_DWP_2081_1stbest, dup_check_results_DWP_2081_2ndbest))

ggplot(data = dup_check_results_DWP_2081_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2081_pass <- dup_check_results_DWP_2081_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2081_pass)
length(unique(dup_check_results_DWP_2081_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2081_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
# write.table(dup_check_results_DWP_2081_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *13. PGILMOUR15_DWP_2124*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2124_fish_ids)), newname = "PGILMOUR15_DWP_2124")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2124_fish_ids)), newname = "PGOD21_DWP_2124")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2124 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2124",
      GODSillyIDs = list("PGOD21_DWP_2124" = rownames(PGOD21_DWP_2124.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2124",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2124_best_match <- dup_check_results_DWP_2124 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2124 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2124_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2124 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2124_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2124 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2124_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2124_1stbest <- dup_check_results_DWP_2124 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2124_2ndbest <- dup_check_results_DWP_2124 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2124_top_2 <- rbind(dup_check_results_DWP_2124_1stbest, dup_check_results_DWP_2124_2ndbest))

ggplot(data = dup_check_results_DWP_2124_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2124_pass <- dup_check_results_DWP_2124_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2124_pass)
length(unique(dup_check_results_DWP_2124_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2124_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_2124_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *14. PGILMOUR15_DWP_2125*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2125_fish_ids)), newname = "PGILMOUR15_DWP_2125")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2125_fish_ids)), newname = "PGOD21_DWP_2125")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2125 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2125",
      GODSillyIDs = list("PGOD21_DWP_2125" = rownames(PGOD21_DWP_2125.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2125",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2125_best_match <- dup_check_results_DWP_2125 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2125 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2125_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2125 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2125_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2125 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2125_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2125_1stbest <- dup_check_results_DWP_2125 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2125_2ndbest <- dup_check_results_DWP_2125 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2125_top_2 <- rbind(dup_check_results_DWP_2125_1stbest, dup_check_results_DWP_2125_2ndbest))

ggplot(data = dup_check_results_DWP_2125_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2125_pass <- dup_check_results_DWP_2125_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2125_pass)
length(unique(dup_check_results_DWP_2125_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2125_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_2125_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *15. PGILMOUR15_DWP_2127*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2127_fish_ids)), newname = "PGILMOUR15_DWP_2127")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2127_fish_ids)), newname = "PGOD21_DWP_2127")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2127 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2127",
      GODSillyIDs = list("PGOD21_DWP_2127" = rownames(PGOD21_DWP_2127.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2127",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2127_best_match <- dup_check_results_DWP_2127 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2127 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2127_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2127 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2127_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2127 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2127_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2127_1stbest <- dup_check_results_DWP_2127 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2127_2ndbest <- dup_check_results_DWP_2127 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2127_top_2 <- rbind(dup_check_results_DWP_2127_1stbest, dup_check_results_DWP_2127_2ndbest))

ggplot(data = dup_check_results_DWP_2127_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2127_pass <- dup_check_results_DWP_2127_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2127_pass)
length(unique(dup_check_results_DWP_2127_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2127_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_2127_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *16. PGILMOUR15_DWP_2160*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2160_fish_ids)), newname = "PGILMOUR15_DWP_2160")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2160_fish_ids)), newname = "PGOD21_DWP_2160")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2160 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2160",
      GODSillyIDs = list("PGOD21_DWP_2160" = rownames(PGOD21_DWP_2160.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2160",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2160_best_match <- dup_check_results_DWP_2160 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2160 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2160_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2160 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2160_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2160 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2160_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2160_1stbest <- dup_check_results_DWP_2160 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2160_2ndbest <- dup_check_results_DWP_2160 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2160_top_2 <- rbind(dup_check_results_DWP_2160_1stbest, dup_check_results_DWP_2160_2ndbest))

ggplot(data = dup_check_results_DWP_2160_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2160_pass <- dup_check_results_DWP_2160_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2160_pass)
length(unique(dup_check_results_DWP_2160_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2160_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
# write.table(dup_check_results_DWP_2160_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *17. PGILMOUR15_DWP_2162*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2162_fish_ids)), newname = "PGILMOUR15_DWP_2162")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2162_fish_ids)), newname = "PGOD21_DWP_2162")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2162 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2162",
      GODSillyIDs = list("PGOD21_DWP_2162" = rownames(PGOD21_DWP_2162.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2162",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2162_best_match <- dup_check_results_DWP_2162 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2162 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2162_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2162 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2162_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2162 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2162_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2162_1stbest <- dup_check_results_DWP_2162 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2162_2ndbest <- dup_check_results_DWP_2162 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2162_top_2 <- rbind(dup_check_results_DWP_2162_1stbest, dup_check_results_DWP_2162_2ndbest))

ggplot(data = dup_check_results_DWP_2162_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2162_pass <- dup_check_results_DWP_2162_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2162_pass)
length(unique(dup_check_results_DWP_2162_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2162_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_2162_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *18. PGILMOUR15_DWP_2193*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2193_fish_ids)), newname = "PGILMOUR15_DWP_2193")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2193_fish_ids)), newname = "PGOD21_DWP_2193")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2193 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2193",
      GODSillyIDs = list("PGOD21_DWP_2193" = rownames(PGOD21_DWP_2193.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2193",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2193_best_match <- dup_check_results_DWP_2193 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2193 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2193_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2193 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2193_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2193 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2193_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2193_1stbest <- dup_check_results_DWP_2193 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2193_2ndbest <- dup_check_results_DWP_2193 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2193_top_2 <- rbind(dup_check_results_DWP_2193_1stbest, dup_check_results_DWP_2193_2ndbest))

ggplot(data = dup_check_results_DWP_2193_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.25

```{r}
# filtered results table
(dup_check_results_DWP_2193_pass <- dup_check_results_DWP_2193_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.25))

# vector lengths
nrow(dup_check_results_DWP_2193_pass)
length(unique(dup_check_results_DWP_2193_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2193_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
# write.table(dup_check_results_DWP_2193_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *19. PGILMOUR15_DWP_2197*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2197_fish_ids)), newname = "PGILMOUR15_DWP_2197")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2197_fish_ids)), newname = "PGOD21_DWP_2197")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2197 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2197",
      GODSillyIDs = list("PGOD21_DWP_2197" = rownames(PGOD21_DWP_2197.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2197",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2197_best_match <- dup_check_results_DWP_2197 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2197 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2197_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2197 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2197_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2197 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2197_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2197_1stbest <- dup_check_results_DWP_2197 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2197_2ndbest <- dup_check_results_DWP_2197 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2197_top_2 <- rbind(dup_check_results_DWP_2197_1stbest, dup_check_results_DWP_2197_2ndbest))

ggplot(data = dup_check_results_DWP_2197_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2197_pass <- dup_check_results_DWP_2197_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2197_pass)
length(unique(dup_check_results_DWP_2197_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2197_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_2197_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *20. PGILMOUR15_DWP_2233*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2233_fish_ids)), newname = "PGILMOUR15_DWP_2233")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2233_fish_ids)), newname = "PGOD21_DWP_2233")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2233 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2233",
      GODSillyIDs = list("PGOD21_DWP_2233" = rownames(PGOD21_DWP_2233.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2233",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2233_best_match <- dup_check_results_DWP_2233 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2233 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2233_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2233 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2233_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2233 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2233_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2233_1stbest <- dup_check_results_DWP_2233 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2233_2ndbest <- dup_check_results_DWP_2233 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2233_top_2 <- rbind(dup_check_results_DWP_2233_1stbest, dup_check_results_DWP_2233_2ndbest))

ggplot(data = dup_check_results_DWP_2233_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2233_pass <- dup_check_results_DWP_2233_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2233_pass)
length(unique(dup_check_results_DWP_2233_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2233_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_2233_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *21. PGILMOUR15_DWP_2236*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2236_fish_ids)), newname = "PGILMOUR15_DWP_2236")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2236_fish_ids)), newname = "PGOD21_DWP_2236")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2236 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2236",
      GODSillyIDs = list("PGOD21_DWP_2236" = rownames(PGOD21_DWP_2236.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2236",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2236_best_match <- dup_check_results_DWP_2236 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2236 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2236_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2236 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2236_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2236 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2236_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2236_1stbest <- dup_check_results_DWP_2236 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2236_2ndbest <- dup_check_results_DWP_2236 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2236_top_2 <- rbind(dup_check_results_DWP_2236_1stbest, dup_check_results_DWP_2236_2ndbest))

ggplot(data = dup_check_results_DWP_2236_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.6 and diff >= 0.1

```{r}
# filtered results table
(dup_check_results_DWP_2236_pass <- dup_check_results_DWP_2236_1stbest %>% 
  filter(duplicate_rate >= 0.6) %>% 
  filter(diff >= 0.1))

# vector lengths
nrow(dup_check_results_DWP_2236_pass)
length(unique(dup_check_results_DWP_2236_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2236_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
# write.table(dup_check_results_DWP_2236_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *22. PGILMOUR15_DWP_2508*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2508_fish_ids)), newname = "PGILMOUR15_DWP_2508")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2508_fish_ids)), newname = "PGOD21_DWP_2508")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2508 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2508",
      GODSillyIDs = list("PGOD21_DWP_2508" = rownames(PGOD21_DWP_2508.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2508",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2508_best_match <- dup_check_results_DWP_2508 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2508 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2508_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2508 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2508_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2508 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2508_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2508_1stbest <- dup_check_results_DWP_2508 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2508_2ndbest <- dup_check_results_DWP_2508 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2508_top_2 <- rbind(dup_check_results_DWP_2508_1stbest, dup_check_results_DWP_2508_2ndbest))

ggplot(data = dup_check_results_DWP_2508_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.6 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2508_pass <- dup_check_results_DWP_2508_1stbest %>% 
  filter(duplicate_rate >= 0.6) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2508_pass)
length(unique(dup_check_results_DWP_2508_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2508_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
# write.table(dup_check_results_DWP_2508_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *23. PGILMOUR15_DWP_2837*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2837_fish_ids)), newname = "PGILMOUR15_DWP_2837")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2837_fish_ids)), newname = "PGOD21_DWP_2837")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2837 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2837",
      GODSillyIDs = list("PGOD21_DWP_2837" = rownames(PGOD21_DWP_2837.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2837",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2837_best_match <- dup_check_results_DWP_2837 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2837 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2837_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2837 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2837_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2837 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2837_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2837_1stbest <- dup_check_results_DWP_2837 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2837_2ndbest <- dup_check_results_DWP_2837 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2837_top_2 <- rbind(dup_check_results_DWP_2837_1stbest, dup_check_results_DWP_2837_2ndbest))

ggplot(data = dup_check_results_DWP_2837_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2837_pass <- dup_check_results_DWP_2837_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2837_pass)
length(unique(dup_check_results_DWP_2837_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2837_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_2837_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *24. PGILMOUR15_DWP_2926*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2926_fish_ids)), newname = "PGILMOUR15_DWP_2926")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2926_fish_ids)), newname = "PGOD21_DWP_2926")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2926 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2926",
      GODSillyIDs = list("PGOD21_DWP_2926" = rownames(PGOD21_DWP_2926.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2926",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2926_best_match <- dup_check_results_DWP_2926 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2926 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2926_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2926 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2926_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Most otos match one heart really cleanly. The problem is that 3-5 hearts match more than one oto.

Investigate the relationship between duplicate rate and otolith genotyping success for each heart.
```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2926 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2926_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2926_1stbest <- dup_check_results_DWP_2926 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2926_2ndbest <- dup_check_results_DWP_2926 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2926_top_2 <- rbind(dup_check_results_DWP_2926_1stbest, dup_check_results_DWP_2926_2ndbest))

ggplot(data = dup_check_results_DWP_2926_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2926_pass <- dup_check_results_DWP_2926_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2926_pass)
length(unique(dup_check_results_DWP_2926_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2926_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
# write.table(dup_check_results_DWP_2926_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *25. PGILMOUR15_DWP_2927*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2927_fish_ids)), newname = "PGILMOUR15_DWP_2927")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2927_fish_ids)), newname = "PGOD21_DWP_2927")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2927 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2927",
      GODSillyIDs = list("PGOD21_DWP_2927" = rownames(PGOD21_DWP_2927.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2927",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2927_best_match <- dup_check_results_DWP_2927 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2927 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2927_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2927 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2927_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2927 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2927_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2927_1stbest <- dup_check_results_DWP_2927 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2927_2ndbest <- dup_check_results_DWP_2927 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2927_top_2 <- rbind(dup_check_results_DWP_2927_1stbest, dup_check_results_DWP_2927_2ndbest))

ggplot(data = dup_check_results_DWP_2927_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2927_pass <- dup_check_results_DWP_2927_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2927_pass)
length(unique(dup_check_results_DWP_2927_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2927_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_2927_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *26. PGILMOUR15_DWP_2930*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2930_fish_ids)), newname = "PGILMOUR15_DWP_2930")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2930_fish_ids)), newname = "PGOD21_DWP_2930")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2930 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2930",
      GODSillyIDs = list("PGOD21_DWP_2930" = rownames(PGOD21_DWP_2930.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2930",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2930_best_match <- dup_check_results_DWP_2930 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2930 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2930_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2930 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2930_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2930 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2930_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2930_1stbest <- dup_check_results_DWP_2930 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2930_2ndbest <- dup_check_results_DWP_2930 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2930_top_2 <- rbind(dup_check_results_DWP_2930_1stbest, dup_check_results_DWP_2930_2ndbest))

ggplot(data = dup_check_results_DWP_2930_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2930_pass <- dup_check_results_DWP_2930_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2930_pass)
length(unique(dup_check_results_DWP_2930_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2930_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_2930_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *27. PGILMOUR15_DWP_2932*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR15", loci = loci, IDs = list("PGILMOUR15" = as.character(PGILMOUR15_DWP_2932_fish_ids)), newname = "PGILMOUR15_DWP_2932")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_2932_fish_ids)), newname = "PGOD21_DWP_2932")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_2932 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_2932",
      GODSillyIDs = list("PGOD21_DWP_2932" = rownames(PGOD21_DWP_2932.gcl$counts)),
      HeartSillys = "PGILMOUR15_DWP_2932",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_2932_best_match <- dup_check_results_DWP_2932 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_2932 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2932_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_2932 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_2932_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_2932 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_2932_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_2932_1stbest <- dup_check_results_DWP_2932 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_2932_2ndbest <- dup_check_results_DWP_2932 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_2932_top_2 <- rbind(dup_check_results_DWP_2932_1stbest, dup_check_results_DWP_2932_2ndbest))

ggplot(data = dup_check_results_DWP_2932_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_2932_pass <- dup_check_results_DWP_2932_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_2932_pass)
length(unique(dup_check_results_DWP_2932_pass$heart_fish_id))
length(unique(dup_check_results_DWP_2932_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_2932_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### ###############**PGILMOUR16**###############

#### *1. PGILMOUR16_DWP_15797*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_15797_fish_ids)), newname = "PGILMOUR16_DWP_15797")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_15797_fish_ids)), newname = "PGOD21_DWP_15797")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_15797 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_15797",
      GODSillyIDs = list("PGOD21_DWP_15797" = rownames(PGOD21_DWP_15797.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_15797",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_15797_best_match <- dup_check_results_DWP_15797 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_15797 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15797_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_15797 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15797_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_15797 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_15797_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_15797_1stbest <- dup_check_results_DWP_15797 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_15797_2ndbest <- dup_check_results_DWP_15797 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_15797_top_2 <- rbind(dup_check_results_DWP_15797_1stbest, dup_check_results_DWP_15797_2ndbest))

ggplot(data = dup_check_results_DWP_15797_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_15797_pass <- dup_check_results_DWP_15797_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_15797_pass)
length(unique(dup_check_results_DWP_15797_pass$heart_fish_id))
length(unique(dup_check_results_DWP_15797_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_15797_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *2. PGILMOUR16_DWP_14570*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14570_fish_ids)), newname = "PGILMOUR16_DWP_14570")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14570_fish_ids)), newname = "PGOD21_DWP_14570")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14570 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14570",
      GODSillyIDs = list("PGOD21_DWP_14570" = rownames(PGOD21_DWP_14570.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14570",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14570_best_match <- dup_check_results_DWP_14570 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14570 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14570_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14570 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14570_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14570 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14570_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14570_1stbest <- dup_check_results_DWP_14570 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14570_2ndbest <- dup_check_results_DWP_14570 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14570_top_2 <- rbind(dup_check_results_DWP_14570_1stbest, dup_check_results_DWP_14570_2ndbest))

ggplot(data = dup_check_results_DWP_14570_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14570_pass <- dup_check_results_DWP_14570_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14570_pass)
length(unique(dup_check_results_DWP_14570_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14570_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_14570_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *3. PGILMOUR16 DWP 14573*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14573_fish_ids)), newname = "PGILMOUR16_DWP_14573")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14573_fish_ids)), newname = "PGOD21_DWP_14573")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14573 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14573",
      GODSillyIDs = list("PGOD21_DWP_14573" = rownames(PGOD21_DWP_14573.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14573",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14573_best_match <- dup_check_results_DWP_14573 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14573 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14573_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14573 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14573_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14573 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14573_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14573_1stbest <- dup_check_results_DWP_14573 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14573_2ndbest <- dup_check_results_DWP_14573 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14573_top_2 <- rbind(dup_check_results_DWP_14573_1stbest, dup_check_results_DWP_14573_2ndbest))

ggplot(data = dup_check_results_DWP_14573_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14573_pass <- dup_check_results_DWP_14573_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14573_pass)
length(unique(dup_check_results_DWP_14573_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14573_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14573_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *4. PGILMOUR16_DWP_14662* 

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14662_fish_ids)), newname = "PGILMOUR16_DWP_14662")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14662_fish_ids)), newname = "PGOD21_DWP_14662")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14662 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14662",
      GODSillyIDs = list("PGOD21_DWP_14662" = rownames(PGOD21_DWP_14662.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14662",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14662_best_match <- dup_check_results_DWP_14662 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14662 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14662_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14662 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14662_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14662 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14662_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14662_1stbest <- dup_check_results_DWP_14662 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14662_2ndbest <- dup_check_results_DWP_14662 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14662_top_2 <- rbind(dup_check_results_DWP_14662_1stbest, dup_check_results_DWP_14662_2ndbest))

ggplot(data = dup_check_results_DWP_14662_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14662_pass <- dup_check_results_DWP_14662_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14662_pass)
length(unique(dup_check_results_DWP_14662_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14662_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14662_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *5. PGILMOUR16_DWP_14663* 

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14663_fish_ids)), newname = "PGILMOUR16_DWP_14663")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14663_fish_ids)), newname = "PGOD21_DWP_14663")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14663 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14663",
      GODSillyIDs = list("PGOD21_DWP_14663" = rownames(PGOD21_DWP_14663.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14663",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14663_best_match <- dup_check_results_DWP_14663 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14663 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14663_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14663 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14663_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14663 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14663_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14663_1stbest <- dup_check_results_DWP_14663 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14663_2ndbest <- dup_check_results_DWP_14663 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14663_top_2 <- rbind(dup_check_results_DWP_14663_1stbest, dup_check_results_DWP_14663_2ndbest))

ggplot(data = dup_check_results_DWP_14663_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14663_pass <- dup_check_results_DWP_14663_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14663_pass)
length(unique(dup_check_results_DWP_14663_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14663_pass$otolith_fish_id))
```

##### Purge multi-matching otos

```{r}
dup_check_results_DWP_14663_pass_dup <- dup_check_results_DWP_14663_pass[duplicated(dup_check_results_DWP_14663_pass$otolith_fish_id), ]
dup_check_results_DWP_14663_pass_dup <- dup_check_results_DWP_14663_pass_dup$otolith_fish_id

(dup_check_results_DWP_14663_pass_purged <- dup_check_results_DWP_14663_pass[!(dup_check_results_DWP_14663_pass$otolith_fish_id == dup_check_results_DWP_14663_pass_dup), ])

length(unique(dup_check_results_DWP_14663_pass_purged$otolith_fish_id)) == nrow(dup_check_results_DWP_14663_pass_purged)
```

##### Status: Changed cutoffs, removed PGOD21_797; OK

```{r}
write.table(dup_check_results_DWP_14663_pass_purged, "dup_check_results_pass.csv", append = TRUE)
```

#### *6. PGILMOUR16_DWP_15826*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_15826_fish_ids)), newname = "PGILMOUR16_DWP_15826")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_15826_fish_ids)), newname = "PGOD21_DWP_15826")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_15826 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_15826",
      GODSillyIDs = list("PGOD21_DWP_15826" = rownames(PGOD21_DWP_15826.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_15826",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_15826_best_match <- dup_check_results_DWP_15826 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_15826 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15826_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_15826 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15826_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_15826 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_15826_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_15826_1stbest <- dup_check_results_DWP_15826 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_15826_2ndbest <- dup_check_results_DWP_15826 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_15826_top_2 <- rbind(dup_check_results_DWP_15826_1stbest, dup_check_results_DWP_15826_2ndbest))

ggplot(data = dup_check_results_DWP_15826_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_15826_pass <- dup_check_results_DWP_15826_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_15826_pass)
length(unique(dup_check_results_DWP_15826_pass$heart_fish_id))
length(unique(dup_check_results_DWP_15826_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_15826_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *7. PGILMOUR16_DWP_14641*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14641_fish_ids)), newname = "PGILMOUR16_DWP_14641")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14641_fish_ids)), newname = "PGOD21_DWP_14641")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14641 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14641",
      GODSillyIDs = list("PGOD21_DWP_14641" = rownames(PGOD21_DWP_14641.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14641",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14641_best_match <- dup_check_results_DWP_14641 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14641 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14641_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14641 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14641_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14641 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14641_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14641_1stbest <- dup_check_results_DWP_14641 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14641_2ndbest <- dup_check_results_DWP_14641 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14641_top_2 <- rbind(dup_check_results_DWP_14641_1stbest, dup_check_results_DWP_14641_2ndbest))

ggplot(data = dup_check_results_DWP_14641_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14641_pass <- dup_check_results_DWP_14641_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14641_pass)
length(unique(dup_check_results_DWP_14641_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14641_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14641_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *8. PGILMOUR16_DWP_14601*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14601_fish_ids)), newname = "PGILMOUR16_DWP_14601")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14601_fish_ids)), newname = "PGOD21_DWP_14601")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14601 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14601",
      GODSillyIDs = list("PGOD21_DWP_14601" = rownames(PGOD21_DWP_14601.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14601",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14601_best_match <- dup_check_results_DWP_14601 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14601 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14601_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14601 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14601_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14601 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14601_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14601_1stbest <- dup_check_results_DWP_14601 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14601_2ndbest <- dup_check_results_DWP_14601 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14601_top_2 <- rbind(dup_check_results_DWP_14601_1stbest, dup_check_results_DWP_14601_2ndbest))

ggplot(data = dup_check_results_DWP_14601_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14601_pass <- dup_check_results_DWP_14601_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14601_pass)
length(unique(dup_check_results_DWP_14601_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14601_pass$otolith_fish_id))
```

##### Status: Cutoff changed; OK

```{r}
write.table(dup_check_results_DWP_14601_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *9. PGILMOUR16_DWP_14629*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14629_fish_ids)), newname = "PGILMOUR16_DWP_14629")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14629_fish_ids)), newname = "PGOD21_DWP_14629")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14629 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14629",
      GODSillyIDs = list("PGOD21_DWP_14629" = rownames(PGOD21_DWP_14629.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14629",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14629_best_match <- dup_check_results_DWP_14629 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14629 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14629_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14629 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14629_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14629 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14629_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14629_1stbest <- dup_check_results_DWP_14629 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14629_2ndbest <- dup_check_results_DWP_14629 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14629_top_2 <- rbind(dup_check_results_DWP_14629_1stbest, dup_check_results_DWP_14629_2ndbest))

ggplot(data = dup_check_results_DWP_14629_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14629_pass <- dup_check_results_DWP_14629_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14629_pass)
length(unique(dup_check_results_DWP_14629_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14629_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14629_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *10. PGILMOUR16_DWP_14595*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14595_fish_ids)), newname = "PGILMOUR16_DWP_14595")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14595_fish_ids)), newname = "PGOD21_DWP_14595")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14595 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14595",
      GODSillyIDs = list("PGOD21_DWP_14595" = rownames(PGOD21_DWP_14595.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14595",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14595_best_match <- dup_check_results_DWP_14595 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14595 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14595_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14595 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14595_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14595 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14595_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14595_1stbest <- dup_check_results_DWP_14595 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14595_2ndbest <- dup_check_results_DWP_14595 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14595_top_2 <- rbind(dup_check_results_DWP_14595_1stbest, dup_check_results_DWP_14595_2ndbest))

ggplot(data = dup_check_results_DWP_14595_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14595_pass <- dup_check_results_DWP_14595_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14595_pass)
length(unique(dup_check_results_DWP_14595_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14595_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_14595_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *11. PGILMOUR16_DWP_14640*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14640_fish_ids)), newname = "PGILMOUR16_DWP_14640")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14640_fish_ids)), newname = "PGOD21_DWP_14640")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14640 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14640",
      GODSillyIDs = list("PGOD21_DWP_14640" = rownames(PGOD21_DWP_14640.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14640",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14640_best_match <- dup_check_results_DWP_14640 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14640 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14640_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14640 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14640_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14640 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14640_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14640_1stbest <- dup_check_results_DWP_14640 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14640_2ndbest <- dup_check_results_DWP_14640 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14640_top_2 <- rbind(dup_check_results_DWP_14640_1stbest, dup_check_results_DWP_14640_2ndbest))

ggplot(data = dup_check_results_DWP_14640_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14640_pass <- dup_check_results_DWP_14640_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14640_pass)
length(unique(dup_check_results_DWP_14640_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14640_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_14640_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *12. PGILMOUR16_DWP_15855*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_15855_fish_ids)), newname = "PGILMOUR16_DWP_15855")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_15855_fish_ids)), newname = "PGOD21_DWP_15855")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_15855 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_15855",
      GODSillyIDs = list("PGOD21_DWP_15855" = rownames(PGOD21_DWP_15855.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_15855",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_15855_best_match <- dup_check_results_DWP_15855 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_15855 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15855_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_15855 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15855_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_15855 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_15855_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_15855_1stbest <- dup_check_results_DWP_15855 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_15855_2ndbest <- dup_check_results_DWP_15855 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_15855_top_2 <- rbind(dup_check_results_DWP_15855_1stbest, dup_check_results_DWP_15855_2ndbest))

ggplot(data = dup_check_results_DWP_15855_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_15855_pass <- dup_check_results_DWP_15855_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_15855_pass)
length(unique(dup_check_results_DWP_15855_pass$heart_fish_id))
length(unique(dup_check_results_DWP_15855_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_15855_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *13. PGILMOUR16_DWP_14607*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14607_fish_ids)), newname = "PGILMOUR16_DWP_14607")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14607_fish_ids)), newname = "PGOD21_DWP_14607")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14607 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14607",
      GODSillyIDs = list("PGOD21_DWP_14607" = rownames(PGOD21_DWP_14607.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14607",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14607_best_match <- dup_check_results_DWP_14607 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14607 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14607_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14607 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14607_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14607 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14607_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14607_1stbest <- dup_check_results_DWP_14607 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14607_2ndbest <- dup_check_results_DWP_14607 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14607_top_2 <- rbind(dup_check_results_DWP_14607_1stbest, dup_check_results_DWP_14607_2ndbest))

ggplot(data = dup_check_results_DWP_14607_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14607_pass <- dup_check_results_DWP_14607_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14607_pass)
length(unique(dup_check_results_DWP_14607_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14607_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14607_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *14. PGILMOUR16_DWP_14528*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14528_fish_ids)), newname = "PGILMOUR16_DWP_14528")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14528_fish_ids)), newname = "PGOD21_DWP_14528")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14528 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14528",
      GODSillyIDs = list("PGOD21_DWP_14528" = rownames(PGOD21_DWP_14528.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14528",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14528_best_match <- dup_check_results_DWP_14528 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14528 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14528_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14528 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14528_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14528 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14528_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14528_1stbest <- dup_check_results_DWP_14528 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14528_2ndbest <- dup_check_results_DWP_14528 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14528_top_2 <- rbind(dup_check_results_DWP_14528_1stbest, dup_check_results_DWP_14528_2ndbest))

ggplot(data = dup_check_results_DWP_14528_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14528_pass <- dup_check_results_DWP_14528_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14528_pass)
length(unique(dup_check_results_DWP_14528_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14528_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14528_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *15. PGILMOUR16_DWP_14576*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14576_fish_ids)), newname = "PGILMOUR16_DWP_14576")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14576_fish_ids)), newname = "PGOD21_DWP_14576")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14576 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14576",
      GODSillyIDs = list("PGOD21_DWP_14576" = rownames(PGOD21_DWP_14576.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14576",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14576_best_match <- dup_check_results_DWP_14576 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14576 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14576_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14576 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14576_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14576 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14576_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14576_1stbest <- dup_check_results_DWP_14576 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14576_2ndbest <- dup_check_results_DWP_14576 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14576_top_2 <- rbind(dup_check_results_DWP_14576_1stbest, dup_check_results_DWP_14576_2ndbest))

ggplot(data = dup_check_results_DWP_14576_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14576_pass <- dup_check_results_DWP_14576_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14576_pass)
length(unique(dup_check_results_DWP_14576_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14576_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14576_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *16. PGILMOUR16_DWP_14603*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14603_fish_ids)), newname = "PGILMOUR16_DWP_14603")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14603_fish_ids)), newname = "PGOD21_DWP_14603")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14603 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14603",
      GODSillyIDs = list("PGOD21_DWP_14603" = rownames(PGOD21_DWP_14603.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14603",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14603_best_match <- dup_check_results_DWP_14603 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14603 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14603_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14603 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14603_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14603 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14603_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14603_1stbest <- dup_check_results_DWP_14603 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14603_2ndbest <- dup_check_results_DWP_14603 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14603_top_2 <- rbind(dup_check_results_DWP_14603_1stbest, dup_check_results_DWP_14603_2ndbest))

ggplot(data = dup_check_results_DWP_14603_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.6 and diff >= 0.125

```{r}
# filtered results table
(dup_check_results_DWP_14603_pass <- dup_check_results_DWP_14603_1stbest %>% 
  filter(duplicate_rate >= 0.6) %>% 
  filter(diff >= 0.125))

# vector lengths
nrow(dup_check_results_DWP_14603_pass)
length(unique(dup_check_results_DWP_14603_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14603_pass$otolith_fish_id))
```

##### Purge multi-matching otos

```{r}
dup_check_results_DWP_14603_pass_dup <- dup_check_results_DWP_14603_pass[duplicated(dup_check_results_DWP_14603_pass$otolith_fish_id), ]
dup_check_results_DWP_14603_pass_dup <- dup_check_results_DWP_14603_pass_dup$otolith_fish_id

(dup_check_results_DWP_14603_pass_purged <- dup_check_results_DWP_14603_pass[!(dup_check_results_DWP_14603_pass$otolith_fish_id == dup_check_results_DWP_14603_pass_dup), ])

length(unique(dup_check_results_DWP_14603_pass_purged$otolith_fish_id)) == nrow(dup_check_results_DWP_14603_pass_purged)
```

##### Status: Changed cutoff values; purged oto 4113; OK

```{r}
# write.table(dup_check_results_DWP_14603_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *17. PGILMOUR16_DWP_14657* 

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14657_fish_ids)), newname = "PGILMOUR16_DWP_14657")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14657_fish_ids)), newname = "PGOD21_DWP_14657")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14657 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14657",
      GODSillyIDs = list("PGOD21_DWP_14657" = rownames(PGOD21_DWP_14657.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14657",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14657_best_match <- dup_check_results_DWP_14657 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14657 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14657_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14657 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14657_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14657 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14657_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14657_1stbest <- dup_check_results_DWP_14657 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14657_2ndbest <- dup_check_results_DWP_14657 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14657_top_2 <- rbind(dup_check_results_DWP_14657_1stbest, dup_check_results_DWP_14657_2ndbest))

ggplot(data = dup_check_results_DWP_14657_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14657_pass <- dup_check_results_DWP_14657_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14657_pass)
length(unique(dup_check_results_DWP_14657_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14657_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14657_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *18. PGILMOUR16_DWP_14659* 

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14659_fish_ids)), newname = "PGILMOUR16_DWP_14659")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14659_fish_ids)), newname = "PGOD21_DWP_14659")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14659 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14659",
      GODSillyIDs = list("PGOD21_DWP_14659" = rownames(PGOD21_DWP_14659.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14659",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14659_best_match <- dup_check_results_DWP_14659 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14659 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14659_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14659 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14659_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14659 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14659_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14659_1stbest <- dup_check_results_DWP_14659 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14659_2ndbest <- dup_check_results_DWP_14659 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14659_top_2 <- rbind(dup_check_results_DWP_14659_1stbest, dup_check_results_DWP_14659_2ndbest))

ggplot(data = dup_check_results_DWP_14659_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14659_pass <- dup_check_results_DWP_14659_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14659_pass)
length(unique(dup_check_results_DWP_14659_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14659_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
# write.table(dup_check_results_DWP_14659_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *19. PGILMOUR16_DWP_14676*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_14676_fish_ids)), newname = "PGILMOUR16_DWP_14676")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14676_fish_ids)), newname = "PGOD21_DWP_14676")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14676 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14676",
      GODSillyIDs = list("PGOD21_DWP_14676" = rownames(PGOD21_DWP_14676.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_14676",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14676_best_match <- dup_check_results_DWP_14676 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14676 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14676_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14676 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14676_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14676 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14676_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14676_1stbest <- dup_check_results_DWP_14676 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14676_2ndbest <- dup_check_results_DWP_14676 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14676_top_2 <- rbind(dup_check_results_DWP_14676_1stbest, dup_check_results_DWP_14676_2ndbest))

ggplot(data = dup_check_results_DWP_14676_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14676_pass <- dup_check_results_DWP_14676_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14676_pass)
length(unique(dup_check_results_DWP_14676_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14676_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_14676_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *20. PGILMOUR16_DWP_15801*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_15801_fish_ids)), newname = "PGILMOUR16_DWP_15801")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_15801_fish_ids)), newname = "PGOD21_DWP_15801")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_15801 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_15801",
      GODSillyIDs = list("PGOD21_DWP_15801" = rownames(PGOD21_DWP_15801.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_15801",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_15801_best_match <- dup_check_results_DWP_15801 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_15801 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15801_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_15801 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15801_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_15801 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_15801_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_15801_1stbest <- dup_check_results_DWP_15801 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_15801_2ndbest <- dup_check_results_DWP_15801 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_15801_top_2 <- rbind(dup_check_results_DWP_15801_1stbest, dup_check_results_DWP_15801_2ndbest))

ggplot(data = dup_check_results_DWP_15801_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_15801_pass <- dup_check_results_DWP_15801_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_15801_pass)
length(unique(dup_check_results_DWP_15801_pass$heart_fish_id))
length(unique(dup_check_results_DWP_15801_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
# write.table(dup_check_results_DWP_15801_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *21. PGILMOUR16_DWP_15802*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR16", loci = loci, IDs = list("PGILMOUR16" = as.character(PGILMOUR16_DWP_15802_fish_ids)), newname = "PGILMOUR16_DWP_15802")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_15802_fish_ids)), newname = "PGOD21_DWP_15802")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_15802 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_15802",
      GODSillyIDs = list("PGOD21_DWP_15802" = rownames(PGOD21_DWP_15802.gcl$counts)),
      HeartSillys = "PGILMOUR16_DWP_15802",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_15802_best_match <- dup_check_results_DWP_15802 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_15802 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15802_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_15802 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_15802_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_15802 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_15802_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_15802_1stbest <- dup_check_results_DWP_15802 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_15802_2ndbest <- dup_check_results_DWP_15802 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_15802_top_2 <- rbind(dup_check_results_DWP_15802_1stbest, dup_check_results_DWP_15802_2ndbest))

ggplot(data = dup_check_results_DWP_15802_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_15802_pass <- dup_check_results_DWP_15802_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_15802_pass)
length(unique(dup_check_results_DWP_15802_pass$heart_fish_id))
length(unique(dup_check_results_DWP_15802_pass$otolith_fish_id))
```

##### Purge multi-matching otos

```{r}
dup_check_results_DWP_15802_pass_dup <- dup_check_results_DWP_15802_pass[duplicated(dup_check_results_DWP_15802_pass$otolith_fish_id), ]
dup_check_results_DWP_15802_pass_dup <- dup_check_results_DWP_15802_pass_dup$otolith_fish_id

(dup_check_results_DWP_15802_pass_purged <- dup_check_results_DWP_15802_pass[!(dup_check_results_DWP_15802_pass$otolith_fish_id == dup_check_results_DWP_15802_pass_dup), ])

length(unique(dup_check_results_DWP_15802_pass_purged$otolith_fish_id)) == nrow(dup_check_results_DWP_15802_pass_purged)
```

##### Status: Purged oto 2863; OK

```{r}
# write.table(dup_check_results_DWP_15802_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### ###############**PGILMOUR17**###############

#### *1. PGILMOUR17_DWP_22694*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22694_fish_ids)), newname = "PGILMOUR17_DWP_22694")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22694_fish_ids)), newname = "PGOD21_DWP_22694")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22694 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22694",
      GODSillyIDs = list("PGOD21_DWP_22694" = rownames(PGOD21_DWP_22694.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22694",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22694_best_match <- dup_check_results_DWP_22694 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22694 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22694_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22694 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22694_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22694 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22694_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22694_1stbest <- dup_check_results_DWP_22694 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22694_2ndbest <- dup_check_results_DWP_22694 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22694_top_2 <- rbind(dup_check_results_DWP_22694_1stbest, dup_check_results_DWP_22694_2ndbest))

ggplot(data = dup_check_results_DWP_22694_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22694_pass <- dup_check_results_DWP_22694_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22694_pass)
length(unique(dup_check_results_DWP_22694_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22694_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22694_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *2. PGILMOUR17_DWP_22759*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22759_fish_ids)), newname = "PGILMOUR17_DWP_22759")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22759_fish_ids)), newname = "PGOD21_DWP_22759")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22759 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22759",
      GODSillyIDs = list("PGOD21_DWP_22759" = rownames(PGOD21_DWP_22759.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22759",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22759_best_match <- dup_check_results_DWP_22759 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22759 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22759_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22759 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22759_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22759 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22759_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22759_1stbest <- dup_check_results_DWP_22759 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22759_2ndbest <- dup_check_results_DWP_22759 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22759_top_2 <- rbind(dup_check_results_DWP_22759_1stbest, dup_check_results_DWP_22759_2ndbest))

ggplot(data = dup_check_results_DWP_22759_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22759_pass <- dup_check_results_DWP_22759_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22759_pass)
length(unique(dup_check_results_DWP_22759_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22759_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22759_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *3. PGILMOUR17_DWP_22593*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22593_fish_ids)), newname = "PGILMOUR17_DWP_22593")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22593_fish_ids)), newname = "PGOD21_DWP_22593")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22593 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22593",
      GODSillyIDs = list("PGOD21_DWP_22593" = rownames(PGOD21_DWP_22593.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22593",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22593_best_match <- dup_check_results_DWP_22593 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22593 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22593_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22593 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22593_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22593 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22593_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22593_1stbest <- dup_check_results_DWP_22593 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22593_2ndbest <- dup_check_results_DWP_22593 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22593_top_2 <- rbind(dup_check_results_DWP_22593_1stbest, dup_check_results_DWP_22593_2ndbest))

ggplot(data = dup_check_results_DWP_22593_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22593_pass <- dup_check_results_DWP_22593_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22593_pass)
length(unique(dup_check_results_DWP_22593_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22593_pass$otolith_fish_id))
```

##### Purge multi-matching otos

```{r}
dup_check_results_DWP_22593_pass_dup <- dup_check_results_DWP_22593_pass[duplicated(dup_check_results_DWP_22593_pass$otolith_fish_id), ]
dup_check_results_DWP_22593_pass_dup <- dup_check_results_DWP_22593_pass_dup$otolith_fish_id

(dup_check_results_DWP_22593_pass_purged <- dup_check_results_DWP_22593_pass[!(dup_check_results_DWP_22593_pass$otolith_fish_id == dup_check_results_DWP_22593_pass_dup), ])

length(unique(dup_check_results_DWP_22593_pass_purged$otolith_fish_id)) == nrow(dup_check_results_DWP_22593_pass_purged)
```

##### Status: Changed cutoff, removed PGOD21_1725; OK

```{r}
write.table(dup_check_results_DWP_22593_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *4. PGILMOUR17_DWP_22569*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22569_fish_ids)), newname = "PGILMOUR17_DWP_22569")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22569_fish_ids)), newname = "PGOD21_DWP_22569")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22569 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22569",
      GODSillyIDs = list("PGOD21_DWP_22569" = rownames(PGOD21_DWP_22569.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22569",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22569_best_match <- dup_check_results_DWP_22569 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22569 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22569_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22569 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22569_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22569 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22569_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22569_1stbest <- dup_check_results_DWP_22569 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22569_2ndbest <- dup_check_results_DWP_22569 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22569_top_2 <- rbind(dup_check_results_DWP_22569_1stbest, dup_check_results_DWP_22569_2ndbest))

ggplot(data = dup_check_results_DWP_22569_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22569_pass <- dup_check_results_DWP_22569_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22569_pass)
length(unique(dup_check_results_DWP_22569_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22569_pass$otolith_fish_id))
```

##### Purge multi-matching otos

```{r}
dup_check_results_DWP_22569_pass_dup <- dup_check_results_DWP_22569_pass[duplicated(dup_check_results_DWP_22569_pass$otolith_fish_id), ]
dup_check_results_DWP_22569_pass_dup <- dup_check_results_DWP_22569_pass_dup$otolith_fish_id

(dup_check_results_DWP_22569_pass_purged <- dup_check_results_DWP_22569_pass[!(dup_check_results_DWP_22569_pass$otolith_fish_id == dup_check_results_DWP_22569_pass_dup), ])

length(unique(dup_check_results_DWP_22569_pass_purged$otolith_fish_id)) == nrow(dup_check_results_DWP_22569_pass_purged)
```

##### Status: Changed cutoff, removed PGOD21_490; OK

```{r}
write.table(dup_check_results_DWP_22569_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *5. PGILMOUR17_DWP_22623*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22623_fish_ids)), newname = "PGILMOUR17_DWP_22623")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22623_fish_ids)), newname = "PGOD21_DWP_22623")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22623 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22623",
      GODSillyIDs = list("PGOD21_DWP_22623" = rownames(PGOD21_DWP_22623.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22623",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22623_best_match <- dup_check_results_DWP_22623 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22623 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22623_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22623 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22623_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22623 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22623_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22623_1stbest <- dup_check_results_DWP_22623 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22623_2ndbest <- dup_check_results_DWP_22623 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22623_top_2 <- rbind(dup_check_results_DWP_22623_1stbest, dup_check_results_DWP_22623_2ndbest))

ggplot(data = dup_check_results_DWP_22623_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22623_pass <- dup_check_results_DWP_22623_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22623_pass)
length(unique(dup_check_results_DWP_22623_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22623_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_22623_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *6. PGILMOUR17_DWP_22693*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22693_fish_ids)), newname = "PGILMOUR17_DWP_22693")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22693_fish_ids)), newname = "PGOD21_DWP_22693")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22693 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22693",
      GODSillyIDs = list("PGOD21_DWP_22693" = rownames(PGOD21_DWP_22693.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22693",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22693_best_match <- dup_check_results_DWP_22693 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22693 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22693_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22693 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22693_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22693 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22693_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22693_1stbest <- dup_check_results_DWP_22693 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22693_2ndbest <- dup_check_results_DWP_22693 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22693_top_2 <- rbind(dup_check_results_DWP_22693_1stbest, dup_check_results_DWP_22693_2ndbest))

ggplot(data = dup_check_results_DWP_22693_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22693_pass <- dup_check_results_DWP_22693_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22693_pass)
length(unique(dup_check_results_DWP_22693_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22693_pass$otolith_fish_id))
```

##### Status: No passing otos; OK

```{r}
write.table(dup_check_results_DWP_22693_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *7. PGILMOUR17_DWP_22464*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22464_fish_ids)), newname = "PGILMOUR17_DWP_22464")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22464_fish_ids)), newname = "PGOD21_DWP_22464")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22464 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22464",
      GODSillyIDs = list("PGOD21_DWP_22464" = rownames(PGOD21_DWP_22464.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22464",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22464_best_match <- dup_check_results_DWP_22464 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22464 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22464_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22464 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22464_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22464 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22464_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22464_1stbest <- dup_check_results_DWP_22464 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22464_2ndbest <- dup_check_results_DWP_22464 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22464_top_2 <- rbind(dup_check_results_DWP_22464_1stbest, dup_check_results_DWP_22464_2ndbest))

ggplot(data = dup_check_results_DWP_22464_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22464_pass <- dup_check_results_DWP_22464_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22464_pass)
length(unique(dup_check_results_DWP_22464_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22464_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22464_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *8. PGILMOUR17_DWP_22558*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22558_fish_ids)), newname = "PGILMOUR17_DWP_22558")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22558_fish_ids)), newname = "PGOD21_DWP_22558")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22558 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22558",
      GODSillyIDs = list("PGOD21_DWP_22558" = rownames(PGOD21_DWP_22558.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22558",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22558_best_match <- dup_check_results_DWP_22558 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22558 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22558_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22558 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22558_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22558 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22558_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22558_1stbest <- dup_check_results_DWP_22558 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22558_2ndbest <- dup_check_results_DWP_22558 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22558_top_2 <- rbind(dup_check_results_DWP_22558_1stbest, dup_check_results_DWP_22558_2ndbest))

ggplot(data = dup_check_results_DWP_22558_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22558_pass <- dup_check_results_DWP_22558_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22558_pass)
length(unique(dup_check_results_DWP_22558_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22558_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22558_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *9. PGILMOUR17_DWP_22682*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22682_fish_ids)), newname = "PGILMOUR17_DWP_22682")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22682_fish_ids)), newname = "PGOD21_DWP_22682")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22682 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22682",
      GODSillyIDs = list("PGOD21_DWP_22682" = rownames(PGOD21_DWP_22682.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22682",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22682_best_match <- dup_check_results_DWP_22682 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22682 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22682_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22682 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22682_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22682 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22682_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22682_1stbest <- dup_check_results_DWP_22682 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22682_2ndbest <- dup_check_results_DWP_22682 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22682_top_2 <- rbind(dup_check_results_DWP_22682_1stbest, dup_check_results_DWP_22682_2ndbest))

ggplot(data = dup_check_results_DWP_22682_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22682_pass <- dup_check_results_DWP_22682_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22682_pass)
length(unique(dup_check_results_DWP_22682_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22682_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22682_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *10. PGILMOUR17_DWP_22591*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22591_fish_ids)), newname = "PGILMOUR17_DWP_22591")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22591_fish_ids)), newname = "PGOD21_DWP_22591")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22591 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22591",
      GODSillyIDs = list("PGOD21_DWP_22591" = rownames(PGOD21_DWP_22591.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22591",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22591_best_match <- dup_check_results_DWP_22591 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22591 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22591_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22591 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22591_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22591 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22591_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22591_1stbest <- dup_check_results_DWP_22591 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22591_2ndbest <- dup_check_results_DWP_22591 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22591_top_2 <- rbind(dup_check_results_DWP_22591_1stbest, dup_check_results_DWP_22591_2ndbest))

ggplot(data = dup_check_results_DWP_22591_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.75 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22591_pass <- dup_check_results_DWP_22591_1stbest %>% 
  filter(duplicate_rate >= 0.75) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22591_pass)
length(unique(dup_check_results_DWP_22591_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22591_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_22591_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *11. PGILMOUR17_DWP_22622*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22622_fish_ids)), newname = "PGILMOUR17_DWP_22622")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22622_fish_ids)), newname = "PGOD21_DWP_22622")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22622 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22622",
      GODSillyIDs = list("PGOD21_DWP_22622" = rownames(PGOD21_DWP_22622.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22622",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22622_best_match <- dup_check_results_DWP_22622 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22622 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22622_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22622 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22622_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22622 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22622_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22622_1stbest <- dup_check_results_DWP_22622 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22622_2ndbest <- dup_check_results_DWP_22622 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22622_top_2 <- rbind(dup_check_results_DWP_22622_1stbest, dup_check_results_DWP_22622_2ndbest))

ggplot(data = dup_check_results_DWP_22622_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22622_pass <- dup_check_results_DWP_22622_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22622_pass)
length(unique(dup_check_results_DWP_22622_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22622_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22622_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *12. PGILMOUR17_DWP_22595*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22595_fish_ids)), newname = "PGILMOUR17_DWP_22595")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22595_fish_ids)), newname = "PGOD21_DWP_22595")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22595 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22595",
      GODSillyIDs = list("PGOD21_DWP_22595" = rownames(PGOD21_DWP_22595.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22595",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22595_best_match <- dup_check_results_DWP_22595 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22595 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22595_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22595 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22595_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22595 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22595_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22595_1stbest <- dup_check_results_DWP_22595 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22595_2ndbest <- dup_check_results_DWP_22595 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22595_top_2 <- rbind(dup_check_results_DWP_22595_1stbest, dup_check_results_DWP_22595_2ndbest))

ggplot(data = dup_check_results_DWP_22595_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22595_pass <- dup_check_results_DWP_22595_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22595_pass)
length(unique(dup_check_results_DWP_22595_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22595_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22595_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *13. PGILMOUR17_DWP_22710*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22710_fish_ids)), newname = "PGILMOUR17_DWP_22710")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22710_fish_ids)), newname = "PGOD21_DWP_22710")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22710 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22710",
      GODSillyIDs = list("PGOD21_DWP_22710" = rownames(PGOD21_DWP_22710.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22710",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22710_best_match <- dup_check_results_DWP_22710 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22710 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22710_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22710 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22710_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22710 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22710_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22710_1stbest <- dup_check_results_DWP_22710 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22710_2ndbest <- dup_check_results_DWP_22710 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22710_top_2 <- rbind(dup_check_results_DWP_22710_1stbest, dup_check_results_DWP_22710_2ndbest))

ggplot(data = dup_check_results_DWP_22710_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22710_pass <- dup_check_results_DWP_22710_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22710_pass)
length(unique(dup_check_results_DWP_22710_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22710_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_22710_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *14. PGILMOUR17_DWP_22751*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22751_fish_ids)), newname = "PGILMOUR17_DWP_22751")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22751_fish_ids)), newname = "PGOD21_DWP_22751")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22751 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22751",
      GODSillyIDs = list("PGOD21_DWP_22751" = rownames(PGOD21_DWP_22751.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22751",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22751_best_match <- dup_check_results_DWP_22751 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22751 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22751_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22751 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22751_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22751 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22751_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22751_1stbest <- dup_check_results_DWP_22751 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22751_2ndbest <- dup_check_results_DWP_22751 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22751_top_2 <- rbind(dup_check_results_DWP_22751_1stbest, dup_check_results_DWP_22751_2ndbest))

ggplot(data = dup_check_results_DWP_22751_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22751_pass <- dup_check_results_DWP_22751_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22751_pass)
length(unique(dup_check_results_DWP_22751_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22751_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22751_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *15. PGILMOUR17_DWP_22701*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22701_fish_ids)), newname = "PGILMOUR17_DWP_22701")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22701_fish_ids)), newname = "PGOD21_DWP_22701")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22701 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22701",
      GODSillyIDs = list("PGOD21_DWP_22701" = rownames(PGOD21_DWP_22701.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22701",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22701_best_match <- dup_check_results_DWP_22701 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22701 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22701_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22701 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22701_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22701 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22701_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22701_1stbest <- dup_check_results_DWP_22701 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22701_2ndbest <- dup_check_results_DWP_22701 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22701_top_2 <- rbind(dup_check_results_DWP_22701_1stbest, dup_check_results_DWP_22701_2ndbest))

ggplot(data = dup_check_results_DWP_22701_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22701_pass <- dup_check_results_DWP_22701_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22701_pass)
length(unique(dup_check_results_DWP_22701_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22701_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_22701_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *16. PGILMOUR17_DWP_22465*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22465_fish_ids)), newname = "PGILMOUR17_DWP_22465")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22465_fish_ids)), newname = "PGOD21_DWP_22465")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22465 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22465",
      GODSillyIDs = list("PGOD21_DWP_22465" = rownames(PGOD21_DWP_22465.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22465",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22465_best_match <- dup_check_results_DWP_22465 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22465 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22465_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22465 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22465_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22465 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22465_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22465_1stbest <- dup_check_results_DWP_22465 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22465_2ndbest <- dup_check_results_DWP_22465 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22465_top_2 <- rbind(dup_check_results_DWP_22465_1stbest, dup_check_results_DWP_22465_2ndbest))

ggplot(data = dup_check_results_DWP_22465_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22465_pass <- dup_check_results_DWP_22465_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22465_pass)
length(unique(dup_check_results_DWP_22465_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22465_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_22465_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *17. PGILMOUR17_DWP_22516*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22516_fish_ids)), newname = "PGILMOUR17_DWP_22516")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22516_fish_ids)), newname = "PGOD21_DWP_22516")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22516 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22516",
      GODSillyIDs = list("PGOD21_DWP_22516" = rownames(PGOD21_DWP_22516.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22516",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22516_best_match <- dup_check_results_DWP_22516 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22516 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22516_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22516 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22516_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22516 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22516_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22516_1stbest <- dup_check_results_DWP_22516 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22516_2ndbest <- dup_check_results_DWP_22516 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22516_top_2 <- rbind(dup_check_results_DWP_22516_1stbest, dup_check_results_DWP_22516_2ndbest))

ggplot(data = dup_check_results_DWP_22516_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22516_pass <- dup_check_results_DWP_22516_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22516_pass)
length(unique(dup_check_results_DWP_22516_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22516_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_22516_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *18. PGILMOUR17_DWP_22601*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22601_fish_ids)), newname = "PGILMOUR17_DWP_22601")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22601_fish_ids)), newname = "PGOD21_DWP_22601")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22601 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22601",
      GODSillyIDs = list("PGOD21_DWP_22601" = rownames(PGOD21_DWP_22601.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22601",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22601_best_match <- dup_check_results_DWP_22601 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22601 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22601_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22601 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22601_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22601 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22601_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22601_1stbest <- dup_check_results_DWP_22601 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22601_2ndbest <- dup_check_results_DWP_22601 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22601_top_2 <- rbind(dup_check_results_DWP_22601_1stbest, dup_check_results_DWP_22601_2ndbest))

ggplot(data = dup_check_results_DWP_22601_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.1

```{r}
# filtered results table
(dup_check_results_DWP_22601_pass <- dup_check_results_DWP_22601_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.1))

# vector lengths
nrow(dup_check_results_DWP_22601_pass)
length(unique(dup_check_results_DWP_22601_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22601_pass$otolith_fish_id))
```

##### Purge multi-matching otos

```{r}
dup_check_results_DWP_22601_pass_dup <- dup_check_results_DWP_22601_pass[duplicated(dup_check_results_DWP_22601_pass$otolith_fish_id), ]
dup_check_results_DWP_22601_pass_dup <- dup_check_results_DWP_22601_pass_dup$otolith_fish_id

(dup_check_results_DWP_22601_pass_purged <- dup_check_results_DWP_22601_pass[!(dup_check_results_DWP_22601_pass$otolith_fish_id == dup_check_results_DWP_22601_pass_dup), ])

length(unique(dup_check_results_DWP_22601_pass_purged$otolith_fish_id)) == nrow(dup_check_results_DWP_22601_pass_purged)
```

##### Status: Changed cutoff values; purged oto 3557; OK

```{r}
# write.table(dup_check_results_DWP_22601_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *19. PGILMOUR17_DWP_22678*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22678_fish_ids)), newname = "PGILMOUR17_DWP_22678")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22678_fish_ids)), newname = "PGOD21_DWP_22678")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22678 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22678",
      GODSillyIDs = list("PGOD21_DWP_22678" = rownames(PGOD21_DWP_22678.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22678",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22678_best_match <- dup_check_results_DWP_22678 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22678 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22678_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22678 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22678_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22678 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22678_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22678_1stbest <- dup_check_results_DWP_22678 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22678_2ndbest <- dup_check_results_DWP_22678 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22678_top_2 <- rbind(dup_check_results_DWP_22678_1stbest, dup_check_results_DWP_22678_2ndbest))

ggplot(data = dup_check_results_DWP_22678_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22678_pass <- dup_check_results_DWP_22678_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22678_pass)
length(unique(dup_check_results_DWP_22678_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22678_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_22678_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *20. PGILMOUR17_DWP_22720*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22720_fish_ids)), newname = "PGILMOUR17_DWP_22720")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22720_fish_ids)), newname = "PGOD21_DWP_22720")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22720 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22720",
      GODSillyIDs = list("PGOD21_DWP_22720" = rownames(PGOD21_DWP_22720.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22720",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22720_best_match <- dup_check_results_DWP_22720 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22720 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22720_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22720 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22720_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22720 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22720_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22720_1stbest <- dup_check_results_DWP_22720 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22720_2ndbest <- dup_check_results_DWP_22720 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22720_top_2 <- rbind(dup_check_results_DWP_22720_1stbest, dup_check_results_DWP_22720_2ndbest))

ggplot(data = dup_check_results_DWP_22720_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.75 and diff >= 0.25

```{r}
# filtered results table
(dup_check_results_DWP_22720_pass <- dup_check_results_DWP_22720_1stbest %>% 
  filter(duplicate_rate >= 0.75) %>% 
  filter(diff >= 0.25))

# vector lengths
nrow(dup_check_results_DWP_22720_pass)
length(unique(dup_check_results_DWP_22720_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22720_pass$otolith_fish_id))
```

##### Status: Changed cutoff vlaues; OK

```{r}
# write.table(dup_check_results_DWP_22720_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *21. PGILMOUR17_DWP_22745*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR17", loci = loci, IDs = list("PGILMOUR17" = as.character(PGILMOUR17_DWP_22745_fish_ids)), newname = "PGILMOUR17_DWP_22745")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_22745_fish_ids)), newname = "PGOD21_DWP_22745")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_22745 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_22745",
      GODSillyIDs = list("PGOD21_DWP_22745" = rownames(PGOD21_DWP_22745.gcl$counts)),
      HeartSillys = "PGILMOUR17_DWP_22745",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_22745_best_match <- dup_check_results_DWP_22745 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_22745 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22745_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_22745 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_22745_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_22745 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_22745_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_22745_1stbest <- dup_check_results_DWP_22745 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_22745_2ndbest <- dup_check_results_DWP_22745 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_22745_top_2 <- rbind(dup_check_results_DWP_22745_1stbest, dup_check_results_DWP_22745_2ndbest))

ggplot(data = dup_check_results_DWP_22745_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_22745_pass <- dup_check_results_DWP_22745_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_22745_pass)
length(unique(dup_check_results_DWP_22745_pass$heart_fish_id))
length(unique(dup_check_results_DWP_22745_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_22745_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### ###############**PGILMOUR18**###############

#### *1. PGILMOUR18_DWP_28929*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR18", loci = loci, IDs = list("PGILMOUR18" = as.character(PGILMOUR18_DWP_28929_fish_ids)), newname = "PGILMOUR18_DWP_28929")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_28929_fish_ids)), newname = "PGOD21_DWP_28929")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_28929 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_28929",
      GODSillyIDs = list("PGOD21_DWP_28929" = rownames(PGOD21_DWP_28929.gcl$counts)),
      HeartSillys = "PGILMOUR18_DWP_28929",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_28929_best_match <- dup_check_results_DWP_28929 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_28929 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28929_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_28929 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28929_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_28929 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_28929_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_28929_1stbest <- dup_check_results_DWP_28929 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_28929_2ndbest <- dup_check_results_DWP_28929 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_28929_top_2 <- rbind(dup_check_results_DWP_28929_1stbest, dup_check_results_DWP_28929_2ndbest))

ggplot(data = dup_check_results_DWP_28929_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_28929_pass <- dup_check_results_DWP_28929_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_28929_pass)
length(unique(dup_check_results_DWP_28929_pass$heart_fish_id))
length(unique(dup_check_results_DWP_28929_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_28929_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *2. PGILMOUR18_DWP_28864*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR18", loci = loci, IDs = list("PGILMOUR18" = as.character(PGILMOUR18_DWP_28864_fish_ids)), newname = "PGILMOUR18_DWP_28864")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_28864_fish_ids)), newname = "PGOD21_DWP_28864")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_28864 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_28864",
      GODSillyIDs = list("PGOD21_DWP_28864" = rownames(PGOD21_DWP_28864.gcl$counts)),
      HeartSillys = "PGILMOUR18_DWP_28864",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_28864_best_match <- dup_check_results_DWP_28864 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_28864 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28864_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_28864 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28864_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_28864 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_28864_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_28864_1stbest <- dup_check_results_DWP_28864 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_28864_2ndbest <- dup_check_results_DWP_28864 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_28864_top_2 <- rbind(dup_check_results_DWP_28864_1stbest, dup_check_results_DWP_28864_2ndbest))

ggplot(data = dup_check_results_DWP_28864_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_28864_pass <- dup_check_results_DWP_28864_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_28864_pass)
length(unique(dup_check_results_DWP_28864_pass$heart_fish_id))
length(unique(dup_check_results_DWP_28864_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_28864_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *3. PGILMOUR18_DWP_28829

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR18", loci = loci, IDs = list("PGILMOUR18" = as.character(PGILMOUR18_DWP_28829_fish_ids)), newname = "PGILMOUR18_DWP_28829")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_28829_fish_ids)), newname = "PGOD21_DWP_28829")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_28829 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_28829",
      GODSillyIDs = list("PGOD21_DWP_28829" = rownames(PGOD21_DWP_28829.gcl$counts)),
      HeartSillys = "PGILMOUR18_DWP_28829",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_28829_best_match <- dup_check_results_DWP_28829 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_28829 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28829_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_28829 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28829_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_28829 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_28829_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_28829_1stbest <- dup_check_results_DWP_28829 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_28829_2ndbest <- dup_check_results_DWP_28829 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_28829_top_2 <- rbind(dup_check_results_DWP_28829_1stbest, dup_check_results_DWP_28829_2ndbest))

ggplot(data = dup_check_results_DWP_28829_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.2

```{r}
# filtered results table
(dup_check_results_DWP_28829_pass <- dup_check_results_DWP_28829_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.2))

# vector lengths
nrow(dup_check_results_DWP_28829_pass)
length(unique(dup_check_results_DWP_28829_pass$heart_fish_id))
length(unique(dup_check_results_DWP_28829_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_28829_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *4. PGILMOUR18_DWP_28807*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR18", loci = loci, IDs = list("PGILMOUR18" = as.character(PGILMOUR18_DWP_28807_fish_ids)), newname = "PGILMOUR18_DWP_28807")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_28807_fish_ids)), newname = "PGOD21_DWP_28807")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_28807 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_28807",
      GODSillyIDs = list("PGOD21_DWP_28807" = rownames(PGOD21_DWP_28807.gcl$counts)),
      HeartSillys = "PGILMOUR18_DWP_28807",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_28807_best_match <- dup_check_results_DWP_28807 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_28807 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28807_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_28807 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28807_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_28807 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_28807_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_28807_1stbest <- dup_check_results_DWP_28807 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_28807_2ndbest <- dup_check_results_DWP_28807 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_28807_top_2 <- rbind(dup_check_results_DWP_28807_1stbest, dup_check_results_DWP_28807_2ndbest))

ggplot(data = dup_check_results_DWP_28807_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_28807_pass <- dup_check_results_DWP_28807_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_28807_pass)
length(unique(dup_check_results_DWP_28807_pass$heart_fish_id))
length(unique(dup_check_results_DWP_28807_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_28807_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *5. PGILMOUR18_DWP_28812*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PGILMOUR18", loci = loci, IDs = list("PGILMOUR18" = as.character(PGILMOUR18_DWP_28812_fish_ids)), newname = "PGILMOUR18_DWP_28812")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_28812_fish_ids)), newname = "PGOD21_DWP_28812")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_28812 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_28812",
      GODSillyIDs = list("PGOD21_DWP_28812" = rownames(PGOD21_DWP_28812.gcl$counts)),
      HeartSillys = "PGILMOUR18_DWP_28812",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_28812_best_match <- dup_check_results_DWP_28812 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_28812 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28812_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_28812 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_28812_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_28812 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_28812_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_28812_1stbest <- dup_check_results_DWP_28812 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_28812_2ndbest <- dup_check_results_DWP_28812 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_28812_top_2 <- rbind(dup_check_results_DWP_28812_1stbest, dup_check_results_DWP_28812_2ndbest))

ggplot(data = dup_check_results_DWP_28812_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.8 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_28812_pass <- dup_check_results_DWP_28812_1stbest %>% 
  filter(duplicate_rate >= 0.8) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_28812_pass)
length(unique(dup_check_results_DWP_28812_pass$heart_fish_id))
length(unique(dup_check_results_DWP_28812_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_28812_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### ###############**PPADDY16**###############

#### *1. PPADDY16_DWP_16104*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_16104_fish_ids)), newname = "PPADDY16_DWP_16104")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16104_fish_ids)), newname = "PGOD21_DWP_16104")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16104 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16104",
      GODSillyIDs = list("PGOD21_DWP_16104" = rownames(PGOD21_DWP_16104.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_16104",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16104_best_match <- dup_check_results_DWP_16104 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16104 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16104_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16104 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16104_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16104 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16104_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16104_1stbest <- dup_check_results_DWP_16104 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16104_2ndbest <- dup_check_results_DWP_16104 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16104_top_2 <- rbind(dup_check_results_DWP_16104_1stbest, dup_check_results_DWP_16104_2ndbest))

ggplot(data = dup_check_results_DWP_16104_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16104_pass <- dup_check_results_DWP_16104_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16104_pass)
length(unique(dup_check_results_DWP_16104_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16104_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16104_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *2. PPADDY16_DWP_14463*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_14463_fish_ids)), newname = "PPADDY16_DWP_14463")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14463_fish_ids)), newname = "PGOD21_DWP_14463")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14463 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14463",
      GODSillyIDs = list("PGOD21_DWP_14463" = rownames(PGOD21_DWP_14463.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_14463",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14463_best_match <- dup_check_results_DWP_14463 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14463 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14463_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14463 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14463_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14463 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14463_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14463_1stbest <- dup_check_results_DWP_14463 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14463_2ndbest <- dup_check_results_DWP_14463 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14463_top_2 <- rbind(dup_check_results_DWP_14463_1stbest, dup_check_results_DWP_14463_2ndbest))

ggplot(data = dup_check_results_DWP_14463_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14463_pass <- dup_check_results_DWP_14463_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14463_pass)
length(unique(dup_check_results_DWP_14463_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14463_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_14463_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *3. PPADDY16_DWP_16130*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_16130_fish_ids)), newname = "PPADDY16_DWP_16130")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16130_fish_ids)), newname = "PGOD21_DWP_16130")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16130 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16130",
      GODSillyIDs = list("PGOD21_DWP_16130" = rownames(PGOD21_DWP_16130.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_16130",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16130_best_match <- dup_check_results_DWP_16130 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16130 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16130_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16130 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16130_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16130 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16130_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16130_1stbest <- dup_check_results_DWP_16130 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16130_2ndbest <- dup_check_results_DWP_16130 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16130_top_2 <- rbind(dup_check_results_DWP_16130_1stbest, dup_check_results_DWP_16130_2ndbest))

ggplot(data = dup_check_results_DWP_16130_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.8 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16130_pass <- dup_check_results_DWP_16130_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16130_pass)
length(unique(dup_check_results_DWP_16130_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16130_pass$otolith_fish_id))
```

##### Status: Changed cutoff; OK

```{r}
write.table(dup_check_results_DWP_16130_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *4. PPADDY16_DWP_16164*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_16164_fish_ids)), newname = "PPADDY16_DWP_16164")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16164_fish_ids)), newname = "PGOD21_DWP_16164")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16164 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16164",
      GODSillyIDs = list("PGOD21_DWP_16164" = rownames(PGOD21_DWP_16164.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_16164",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16164_best_match <- dup_check_results_DWP_16164 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16164 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16164_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16164 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16164_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16164 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16164_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16164_1stbest <- dup_check_results_DWP_16164 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16164_2ndbest <- dup_check_results_DWP_16164 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16164_top_2 <- rbind(dup_check_results_DWP_16164_1stbest, dup_check_results_DWP_16164_2ndbest))

ggplot(data = dup_check_results_DWP_16164_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16164_pass <- dup_check_results_DWP_16164_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16164_pass)
length(unique(dup_check_results_DWP_16164_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16164_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16164_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *5. PPADDY16_DWP_16132*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_16132_fish_ids)), newname = "PPADDY16_DWP_16132")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16132_fish_ids)), newname = "PGOD21_DWP_16132")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16132 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16132",
      GODSillyIDs = list("PGOD21_DWP_16132" = rownames(PGOD21_DWP_16132.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_16132",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16132_best_match <- dup_check_results_DWP_16132 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16132 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16132_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16132 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16132_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16132 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16132_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16132_1stbest <- dup_check_results_DWP_16132 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16132_2ndbest <- dup_check_results_DWP_16132 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16132_top_2 <- rbind(dup_check_results_DWP_16132_1stbest, dup_check_results_DWP_16132_2ndbest))

ggplot(data = dup_check_results_DWP_16132_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16132_pass <- dup_check_results_DWP_16132_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16132_pass)
length(unique(dup_check_results_DWP_16132_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16132_pass$otolith_fish_id))
```

##### Status: OK

```{r}
write.table(dup_check_results_DWP_16132_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *6. PPADDY16_DWP_14408*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_14408_fish_ids)), newname = "PPADDY16_DWP_14408")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_14408_fish_ids)), newname = "PGOD21_DWP_14408")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_14408 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_14408",
      GODSillyIDs = list("PGOD21_DWP_14408" = rownames(PGOD21_DWP_14408.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_14408",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_14408_best_match <- dup_check_results_DWP_14408 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_14408 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14408_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_14408 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_14408_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_14408 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_14408_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_14408_1stbest <- dup_check_results_DWP_14408 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_14408_2ndbest <- dup_check_results_DWP_14408 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_14408_top_2 <- rbind(dup_check_results_DWP_14408_1stbest, dup_check_results_DWP_14408_2ndbest))

ggplot(data = dup_check_results_DWP_14408_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.65 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_14408_pass <- dup_check_results_DWP_14408_1stbest %>% 
  filter(duplicate_rate >= 0.65) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_14408_pass)
length(unique(dup_check_results_DWP_14408_pass$heart_fish_id))
length(unique(dup_check_results_DWP_14408_pass$otolith_fish_id))
```

##### Status: Changed cutoff values; OK

```{r}
# write.table(dup_check_results_DWP_14408_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### *7. PPADDY16_DWP_16131*

```{r}
# create *.gcl objects for comparison according to *._fish_ids
PoolCollections.GCL(collections = "PPADDY16", loci = loci, IDs = list("PPADDY16" = as.character(PPADDY16_DWP_16131_fish_ids)), newname = "PPADDY16_DWP_16131")
PoolCollections.GCL(collections = "PGOD21", loci = loci, IDs = list("PGOD21" = as.character(PGOD21_DWP_16131_fish_ids)), newname = "PGOD21_DWP_16131")
```

```{r}
# generate a tibble of all pairwise duplicate rates
(dup_check_results_DWP_16131 <- DupCheckBetweenSillys_GOD.GCL(
      GODSillys = "PGOD21_DWP_16131",
      GODSillyIDs = list("PGOD21_DWP_16131" = rownames(PGOD21_DWP_16131.gcl$counts)),
      HeartSillys = "PPADDY16_DWP_16131",
      loci = loci,
      threshold = 0.9))
```

```{r fig.width=10, fig.height=15}
# select the row with the highest match rate
(dup_check_results_DWP_16131_best_match <- dup_check_results_DWP_16131 %>% 
  group_by(otolith_fish_id) %>% 
  slice_max(duplicate_rate, n = 1))

# facet by oto ID
dup_check_results_DWP_16131 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16131_best_match, aes(x = duplicate_rate, y = 5, label = heart_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(otolith_fish_id)) +
  theme_bw()

# facet by heart ID
dup_check_results_DWP_16131 %>% 
  ggplot(aes(x = duplicate_rate)) +
  geom_histogram(binwidth = 0.05) +
  geom_text(data = dup_check_results_DWP_16131_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

Investigate the relationship between duplicate rate and otolith genotyping success for each heart

```{r fig.width=10, fig.height=15}
# facet by heart ID
dup_check_results_DWP_16131 %>% 
  mutate(oto_geno_success = 1 - (missing_loci_otolith / 298)) %>% 
  ggplot(aes(x = duplicate_rate, y = oto_geno_success)) +
  geom_point() +
  geom_vline(xintercept = 0.7, colour = "red") + 
  scale_y_continuous(limits = c(0, 1)) +
  # geom_text(data = dup_check_results_DWP_16131_best_match, aes(x = duplicate_rate, y = 5, label = otolith_fish_id, colour = "red", angle = 90, hjust = 0)) +
  facet_wrap(facets = vars(heart_fish_id)) +
  theme_bw()
```

##### Top pairwise duplicate rate comparisons

```{r}
dup_check_results_DWP_16131_1stbest <- dup_check_results_DWP_16131 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_max(duplicate_rate, n = 1) %>% 
  add_column(rank = 1:1) %>% 
  ungroup()

dup_check_results_DWP_16131_2ndbest <- dup_check_results_DWP_16131 %>% 
  group_by(heart_fish_id) %>% 
  dplyr::slice_max(duplicate_rate, n = 2) %>% 
  mutate(diff = max(duplicate_rate) - min(duplicate_rate)) %>% 
  slice_min(duplicate_rate, n = 1) %>% 
  add_column(rank = 2:2) %>% 
  ungroup()

(dup_check_results_DWP_16131_top_2 <- rbind(dup_check_results_DWP_16131_1stbest, dup_check_results_DWP_16131_2ndbest))

ggplot(data = dup_check_results_DWP_16131_top_2, aes(x = diff, y = duplicate_rate, color = rank)) +
  geom_point() +
  theme_bw()
```

Duplicate_rate >= 0.7 and diff >= 0.15

```{r}
# filtered results table
(dup_check_results_DWP_16131_pass <- dup_check_results_DWP_16131_1stbest %>% 
  filter(duplicate_rate >= 0.7) %>% 
  filter(diff >= 0.15))

# vector lengths
nrow(dup_check_results_DWP_16131_pass)
length(unique(dup_check_results_DWP_16131_pass$heart_fish_id))
length(unique(dup_check_results_DWP_16131_pass$otolith_fish_id))
```

##### Status: OK

```{r}
# write.table(dup_check_results_DWP_16131_pass, "dup_check_results_pass.csv", append = TRUE)
```

#### All passing

```{r}
# read in passing data, if all objects are not in your environment
# modify appended dup_check_results_pass.csv with text to columns, remove column 1 and extra headings
# save as new csv with descriptive name
# dup_check_results_pass <- read_csv("dup_check_results_pass.csv")

# alternatively, use if all objects are available
dup_check_results_pass <- bind_rows(
  dup_check_results_DWP_14395_pass,
  dup_check_results_DWP_14449_pass,
  dup_check_results_DWP_14448_pass,
  dup_check_results_DWP_14334_pass,
  dup_check_results_DWP_14331_pass,
  dup_check_results_DWP_14376_pass,
  dup_check_results_DWP_14297_pass,
  dup_check_results_DWP_14282_pass,
  dup_check_results_DWP_14332_pass,
  dup_check_results_DWP_2123_pass,
  dup_check_results_DWP_2129_pass,
  dup_check_results_DWP_2161_pass,
  dup_check_results_DWP_2192_pass,
  dup_check_results_DWP_2195_pass,
  dup_check_results_DWP_2228_pass,
  dup_check_results_DWP_2232_pass,
  dup_check_results_DWP_2234_pass,
  dup_check_results_DWP_2505_pass,
  dup_check_results_DWP_2838_pass,
  dup_check_results_DWP_15797_pass,
  dup_check_results_DWP_14570_pass,
  dup_check_results_DWP_14573_pass,
  dup_check_results_DWP_14662_pass,
  dup_check_results_DWP_14663_pass_purged,
  dup_check_results_DWP_15826_pass,
  dup_check_results_DWP_14641_pass,
  dup_check_results_DWP_14601_pass,
  dup_check_results_DWP_14629_pass,
  dup_check_results_DWP_14595_pass,
  dup_check_results_DWP_14640_pass,
  dup_check_results_DWP_15855_pass,
  dup_check_results_DWP_14607_pass,
  dup_check_results_DWP_22694_pass,
  dup_check_results_DWP_22759_pass,
  dup_check_results_DWP_22593_pass_purged,
  dup_check_results_DWP_22569_pass_purged,
  dup_check_results_DWP_22623_pass,
  dup_check_results_DWP_22693_pass,
  dup_check_results_DWP_22464_pass,
  dup_check_results_DWP_22558_pass,
  dup_check_results_DWP_22682_pass,
  dup_check_results_DWP_22591_pass,
  dup_check_results_DWP_22622_pass,
  dup_check_results_DWP_22595_pass,
  dup_check_results_DWP_22710_pass,
  dup_check_results_DWP_22751_pass,
  dup_check_results_DWP_22701_pass,
  dup_check_results_DWP_28929_pass,
  dup_check_results_DWP_28864_pass,
  dup_check_results_DWP_28829_pass,
  dup_check_results_DWP_28807_pass,
  dup_check_results_DWP_28812_pass,
  dup_check_results_DWP_16104_pass,
  dup_check_results_DWP_14463_pass,
  dup_check_results_DWP_16130_pass,
  dup_check_results_DWP_16164_pass,
  dup_check_results_DWP_16132_pass,
  dup_check_results_DWP_14290_pass,
  dup_check_results_DWP_14307_pass,
  dup_check_results_DWP_14312_pass,
  dup_check_results_DWP_14326_pass,
  dup_check_results_DWP_14327_pass,
  dup_check_results_DWP_14330_pass,
  dup_check_results_DWP_14336_pass,
  dup_check_results_DWP_14354_pass_purged,
  dup_check_results_DWP_14358_pass,
  dup_check_results_DWP_14367_pass,
  dup_check_results_DWP_14368_pass,
  dup_check_results_DWP_14394_pass,
  dup_check_results_DWP_14398_pass,
  dup_check_results_DWP_14402_pass,
  dup_check_results_DWP_14429_pass,
  dup_check_results_DWP_16086_pass,
  dup_check_results_DWP_16090_pass,
  dup_check_results_DWP_16092_pass,
  dup_check_results_DWP_16095_pass,
  dup_check_results_DWP_16096_pass,
  dup_check_results_DWP_16097_pass,
  dup_check_results_DWP_16101_pass,
  dup_check_results_DWP_16117_pass,
  dup_check_results_DWP_16118_pass,
  dup_check_results_DWP_16120_pass,
  dup_check_results_DWP_16121_pass,
  dup_check_results_DWP_16122_pass,
  dup_check_results_DWP_16136_pass,
  dup_check_results_DWP_16144_pass,
  dup_check_results_DWP_16147_pass,
  dup_check_results_DWP_16174_pass,
  dup_check_results_DWP_2071_pass_purged,
  dup_check_results_DWP_2081_pass,
  dup_check_results_DWP_2124_pass,
  dup_check_results_DWP_2125_pass,
  dup_check_results_DWP_2127_pass,
  dup_check_results_DWP_2160_pass,
  dup_check_results_DWP_2162_pass,
  dup_check_results_DWP_2193_pass,
  dup_check_results_DWP_2197_pass,
  dup_check_results_DWP_2233_pass,
  dup_check_results_DWP_2236_pass,
  dup_check_results_DWP_2508_pass,
  dup_check_results_DWP_2837_pass,
  dup_check_results_DWP_2926_pass,
  dup_check_results_DWP_2927_pass,
  dup_check_results_DWP_2930_pass,
  dup_check_results_DWP_2932_pass,
  dup_check_results_DWP_14528_pass,
  dup_check_results_DWP_14576_pass,
  dup_check_results_DWP_14603_pass_purged,
  dup_check_results_DWP_14657_pass,
  dup_check_results_DWP_14659_pass,
  dup_check_results_DWP_14676_pass,
  dup_check_results_DWP_15801_pass,
  dup_check_results_DWP_15802_pass_purged,
  dup_check_results_DWP_22465_pass,
  dup_check_results_DWP_22516_pass,
  dup_check_results_DWP_22601_pass_purged,
  dup_check_results_DWP_22678_pass,
  dup_check_results_DWP_22720_pass,
  dup_check_results_DWP_22745_pass,
  dup_check_results_DWP_14408_pass,
  dup_check_results_DWP_16131_pass
  )

write_csv(dup_check_results_pass, "dup_check_results_all_pass.csv")
```

```{r}
# read in the tray position and well code key
well_location_key <- read_csv("../../GOD/KEY_WELL_CODE_tray_posn_by_col.csv")

# join with original and jumbled DWP well info
oceanak_affected_DWP_wells <- oceanak_affected_DWPs %>% 
  select(c(SILLY_CODE, FISH_ID, DNA_TRAY_CODE, DNA_TRAY_WELL_CODE)) 
oceanak_affected_DWP_wells$heart_fish_id <- paste0(oceanak_affected_DWP_wells$SILLY_CODE, "_", oceanak_affected_DWP_wells$FISH_ID)

dup_check_results_pass_with_wells <- attributes_and_xfer_PGOD21 %>% 
  mutate(otolith_fish_id = SillySource) %>% 
  right_join(dup_check_results_pass, by = "otolith_fish_id") %>% 
  select(c(otolith_fish_id, `48_DWP_tray_barcode`, `48_DWP_tray_position`, heart_fish_id)) %>% 
  right_join(oceanak_affected_DWP_wells, by = "heart_fish_id") %>% 
  select(-c(SILLY_CODE, FISH_ID, DNA_TRAY_CODE)) %>% 
  inner_join(well_location_key, by = "DNA_TRAY_WELL_CODE") %>% 
  select(`48_DWP_tray_barcode`, heart_fish_id, OG_48_DWP_tray_position, otolith_fish_id, `48_DWP_tray_position`)

write_csv(dup_check_results_pass_with_wells, "dup_check_results_P066-P067_pass_with_wells.csv")
```



