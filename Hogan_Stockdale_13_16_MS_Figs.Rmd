---
title: "Figures for Hogan-Stockdale 13-16 MS"
output:
  html_notebook:
    theme: united
    toc: yes
editor_options: 
  chunk_output_type: inline
---

The purpose of this notebook is to create figures for the manuscript focused on RRS from Hogan and Stockdale for years 2013-2016.

```{r setup, include=FALSE}
library(coin)
library(MASS)
library(scales)
library(tidyverse)
# library(leaflet)
library(lubridate)
library(PBSmapping)
library(grid)
library(ggthemes)
library(mapproj) 
library(gridExtra)
# Load
```

# Figure 1: Map of study area

Try PBSmapping, clunky, but great basemap for AK coastlines. Got the idea from Ben Williams GitHub [link](https://ben-williams.github.io/updated_ggplot_figures.html). Still used the idea from Quantitative Palaeoecology [link](https://quantpalaeo.wordpress.com/2016/06/05/ggplot2-maps-with-inset/)

```{r map of study area, message=FALSE, warning=FALSE}
# Load data
dat <- read_csv("map_data.csv")

dat <- dat %>%
  mutate(Legend = case_when(type == "Hogan" ~ "Hogan Bay",
                            type == "Fitness Stream" & name == "Stockdale" ~ "Stockdale Creek",
                            type == "Fitness Stream" & name != "Stockdale"~ "Other fitness streams",
                            type == "Hatchery" & name != "VFDA" ~ "PWSAC hatchery",
                            name == "VFDA" ~ "VFDA hatchery")) %>% 
  mutate(Legend = factor(x = Legend, levels = c("Hogan Bay", "Stockdale Creek", "Other fitness streams", "VFDA hatchery", "PWSAC hatchery"))) %>% 
  mutate(type = case_when(type == "Hogan" ~ "Current study",
                          name == "Stockdale" ~ "Current study",
                          TRUE ~ type)) %>% 
  mutate(abbr = case_when(name == "AFK" ~ "AFK",
                          name == "WHN" ~ "WN",
                          name == "Cannery Creek" ~ "CC",
                          name == "VFDA" ~ "SG"))

x_lim <- range(dat$long) + c(-0.1, 0.1)
y_lim <- range(dat$lat) + c(-0.2, 0.2)

dat <- dat %>%
  filter(type != "City")

# Plot map with PBS mapping
data("nepacLLhigh")
ak <- nepacLLhigh %>% 
  dplyr::select(group = PID, POS = POS,long = X, lat = Y)

maptheme <- theme(
  panel.grid = element_blank(),
  panel.border = element_rect(fill = NA, colour = "black"),
  panel.background = element_blank()
)

# PWS map
pws_map <- ggplot() + 
  geom_polygon(data = ak, aes(long, lat, group = group), fill = "grey90", color = "black", lwd = 0.3) +
  geom_point(data = dat, aes(x = long, y = lat, fill = Legend, shape = Legend, size = Legend), stroke = 1.5) +  # shape = 21, colour = "black",
  scale_shape_manual(values = c(21, 21, 24, 22, 22)) +
  scale_size_manual(values = c(5, 5, 3, 5, 5)) +
  geom_label(data = filter(dat, type == "Hatchery"), aes(long, lat, label = abbr), hjust = 0, nudge_x = 0.1) +
  geom_segment(aes(x = -148.7, xend = -148.7, y = 59.85, yend = 60.02), lineend = "butt", linejoin = "round", size = 2, arrow = arrow(length = unit(0.2, "inches"))) +
  annotate("text", label = "Prince\nWilliam\nSound", x = -147, y = 60.6, size = 5, colour = "black") +
  theme(panel.background = element_rect(fill = 'white')) +
  scale_y_continuous(breaks = c(60.0, 60.5, 61.0)) +
  xlab(expression(paste(Longitude^o, ~'W'))) +
  ylab(expression(paste(Latitude^o, ~'N'))) +
  coord_map(xlim = x_lim, ylim = y_lim) +
  maptheme

# north2(pws_map, symbol = 12, 0.18, 0.20)  # couldn't get this to work with the inset

# Inset map
ak_map <- ggplot() + 
  geom_polygon(data = ak, aes(long, lat, group = group), fill = "grey90", color = "black", lwd = 0.3) +
  borders("world", xlim = c(-170, -130, ylim = c(20, 50)), lwd = 1) +
  geom_rect(data = data.frame(), aes(xmin = x_lim[1], xmax = x_lim[2], ymin = y_lim[1], ymax = y_lim[2]), colour = "red", fill = NA, lwd = 1) +
  annotate("text", label = "Alaska", x = -150.5, y = 63.5, size = 5, colour = "black") +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank()) +
  coord_map(xlim = c(-170, -130), ylim = c(53, 65))

# Create map with inset and North arrow
grid.newpage()
vp_b <- viewport(width = 1, height = 1, x = 0.5, y = 0.5)  # the larger map
vp_a <- viewport(width = 0.22, height = 0.342, x = 0.58, y = 0.233)  # the inset in lower left
print(pws_map, vp = vp_b)
print(ak_map + maptheme, vp = vp_a)
```

This is the code used to actually save the map as a .png file
```{r save_map}
png(filename = "C:/Users/krshedd/Desktop/Local_RRS_Revisions/Figures/Figure1_map.png", width = 6.5, height = 6.5, units = "in", res = 300)
grid.newpage()
vp_b <- viewport(width = 1, height = 1, x = 0.5, y = 0.5)  # the larger map
vp_a <- viewport(width = 0.23, height = 0.35, x = 0.58, y = 0.33)  # the inset in lower left
print(pws_map, vp = vp_b)
print(ak_map + maptheme, vp = vp_a)
dev.off()
```

```{r save_map_pdf}
pdf(file = "C:/Users/krshedd/Desktop/Local_RRS_Revisions/Figures/Figure_1.pdf", width = 6.5, height = 6.5)
grid.newpage()
vp_b <- viewport(width = 1, height = 1, x = 0.5, y = 0.5)  # the larger map
vp_a <- viewport(width = 0.23, height = 0.35, x = 0.585, y = 0.32)  # the inset in lower left
print(pws_map, vp = vp_b)
print(ak_map + maptheme, vp = vp_a)
dev.off()
```

# Figure 2: Sample sizes throughout run

```{r sample sizes throughout run}
hogan_paired_13_15_filter <- read_csv("Hogan/hogan_paired_13_15_filter.csv") %>% 
  mutate(origin = factor(x = origin, levels = c("Natural", "Hatchery")))

hogan_paired_14_16_filter <- read_csv("Hogan/hogan_paired_14_16_filter.csv") %>% 
  mutate(origin = factor(x = origin, levels = c("Natural", "Hatchery")))

stock_paired_13_15_filter <- read_csv("Stockdale/stock_paired_13_15_filter.csv") %>% 
  mutate(origin = factor(x = origin, levels = c("Natural", "Hatchery")))

stock_paired_14_16_filter <- read_csv("Stockdale/stock_paired_14_16_filter.csv") %>% 
  mutate(origin = factor(x = origin, levels = c("Natural", "Hatchery")))

ymax <- max(c(
  hogan_paired_13_15_filter %>% count(date) %>% top_n(n = 1) %>% pull(n),
  hogan_paired_14_16_filter %>% count(date) %>% top_n(n = 1) %>% pull(n),
  stock_paired_13_15_filter %>% count(date) %>% top_n(n = 1) %>% pull(n),
  stock_paired_14_16_filter %>% count(date) %>% top_n(n = 1) %>% pull(n)
))

xmin <- min(c(
  min(hogan_paired_13_15_filter$DOY),
  min(hogan_paired_14_16_filter$DOY),
  min(hogan_paired_13_15_filter$DOY),
  min(hogan_paired_13_15_filter$DOY)
))

xmax <- max(c(
  max(hogan_paired_13_15_filter$DOY),
  max(hogan_paired_14_16_filter$DOY),
  max(hogan_paired_13_15_filter$DOY),
  max(hogan_paired_13_15_filter$DOY)
))

#Stacked
Hogan_Odd <- hogan_paired_13_15_filter %>% 
  ggplot(aes(x= DOY)) +
  geom_bar(aes(fill=origin)) +
  theme_bw(base_size = 14) +
  theme(legend.position = c(0.85, 0.75),
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 10),
        legend.key.size = unit(1, "line"),
        panel.grid = element_blank(),
        axis.title.x = element_blank()) +
  scale_y_continuous(limits = c(0, ymax), breaks = seq(0, 800, by = 200)) +
  scale_x_continuous(limits = c(xmin, xmax), breaks = seq(220, 270, by = 10), labels = format(x = (as.Date("2012-12-31") + seq(220, 270, by = 10)), "%b %d")) +
  facet_grid(`Sample Year` ~ .) +
  labs(title = "Hogan", y = "Number of Samples", fill = "Origin") +
  ylab(expression(atop("Odd", paste("Number of Samples"))))

Hogan_Even <- hogan_paired_14_16_filter %>% 
  ggplot(aes(x= DOY)) +
  geom_bar(aes(fill=origin)) +
  theme_bw(base_size = 14) +
  theme(legend.position = 'none',
        panel.grid = element_blank()) +
  scale_y_continuous(limits = c(0, ymax), breaks = seq(0, 800, by = 200)) +
  scale_x_continuous(limits = c(xmin, xmax), breaks = seq(220, 270, by = 10), labels = format(x = (as.Date("2012-12-31") + seq(220, 270, by = 10)), "%b %d")) +
  facet_grid(`Sample Year` ~ .) +
  labs(y = "Number of Samples", x = "Sample Date") +
  ylab(expression(atop("Even", paste("Number of Samples"))))

Stock_Odd <- stock_paired_13_15_filter %>% 
  ggplot(aes(x=DOY)) +
  geom_bar(aes(fill=origin)) +
  theme_bw(base_size = 14) +
  scale_y_continuous(limits = c(0, ymax), breaks = seq(0, 800, by = 200)) +
  scale_x_continuous(limits = c(xmin, xmax), breaks = seq(220, 270, by = 10), labels = format(x = (as.Date("2012-12-31") + seq(220, 270, by = 10)), "%b %d")) +
  theme(legend.position = 'none',
        panel.grid = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_blank()) +
  facet_grid(`Sample Year` ~ .) +
  labs(title = "Stockdale")

Stock_Even <- stock_paired_14_16_filter %>% 
  ggplot(aes(x=DOY)) +
  geom_bar(aes(fill=origin)) +
  theme_bw(base_size = 14) +
  scale_y_continuous(limits = c(0, ymax), breaks = seq(0, 800, by = 200)) +
  scale_x_continuous(limits = c(xmin, xmax), breaks = seq(220, 270, by = 10), labels = format(x = (as.Date("2012-12-31") + seq(220, 270, by = 10)), "%b %d")) +
  theme(legend.position = 'none',
        panel.grid = element_blank(),
        axis.title.y = element_blank()) +
  facet_grid(`Sample Year` ~ .) +
  labs(x = "Sample Date")

Figure_2 <- 
  grid.arrange(Hogan_Odd, Stock_Odd, Hogan_Even, Stock_Even, nrow = 2, widths = c(1.10, 1))  # added width argument to get plot area equal


ggsave("Figure_2.pdf", plot = Figure_2, path = "V:/Documents/5_Coastwide/Multispecies/AHRP/Manuscripts/02.Hogan_Stockdale_EA/0002.Figures&Tables/Figures", height = 6, width = 12)
```

# Figure 3: Reproductive success

```{r Plot RS}
hogan_paired_13_15_filter_parents <- read_csv("Hogan/hogan_paired_13_15_filter_parents.csv") %>% 
  mutate(origin = factor(x = origin, levels = c("Natural", "Hatchery"))) %>% 
  mutate(SEX = case_when(SEX == "M" ~ "Male",
                         SEX == "F" ~ "Female"))

paired_14_16_filter_parents <- read_csv("Hogan/paired_14_16_filter_parents.csv") %>% 
  mutate(origin = factor(x = origin, levels = c("Natural", "Hatchery"))) %>% 
  mutate(SEX = case_when(SEX == "M" ~ "Male",
                         SEX == "F" ~ "Female"))

stock_paired_13_15_filter_parents <- read_csv("Stockdale/stock_paired_13_15_filter_parents.csv")%>% 
  mutate(origin = factor(x = origin, levels = c("Natural", "Hatchery"))) %>% 
  mutate(SEX = case_when(SEX == "M" ~ "Male",
                         SEX == "F" ~ "Female"))

stock_paired_14_16_filter_parents <- read_csv("Stockdale/stock_paired_14_16_filter_parents.csv") %>% 
  mutate(origin = factor(x = origin, levels = c("Natural", "Hatchery"))) %>% 
  mutate(SEX = case_when(SEX == "M" ~ "Male",
                         SEX == "F" ~ "Female"))

# make x-max
# xmax <- max(c(
#   max(hogan_paired_13_15_filter_parents$n),
#   max(paired_14_16_filter_parents$n),
#   max(stock_paired_13_15_filter_parents$n),
#   max(stock_paired_14_16_filter_parents$n)
# )) + 0.5

Hogan_Odd_RS <- hogan_paired_13_15_filter_parents %>% 
  count(SEX, origin, n) %>% 
  group_by(SEX, origin) %>% 
  mutate(p = nn / sum(nn)) %>% 
  filter(n < 20) %>% 
  ggplot(aes(x = n, y = p, fill = origin)) +
  geom_col(position = position_dodge2(preserve="single")) +
  theme_bw(base_size = 14) +
  theme(legend.position = c(0.85, 0.75),
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 10),
        legend.key.size = unit(1, "line"),
        panel.grid = element_blank()) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1, by = 0.1)) +
  scale_x_continuous(limits = c(-0.5, max(stock_paired_14_16_filter_parents$n) + 0.5), breaks = seq(0,20, by = 2)) +
  facet_grid(~ SEX, labeller = labeller(F = "Female", M = "Male")) +
  labs(title="Hogan",
       fill = "Parent origin") +
  ylab(expression(atop("Odd", paste("Proportion of Parents")))) +
  xlab(" ")

Hogan_Even_RS <- paired_14_16_filter_parents %>% 
  count(SEX, origin, n) %>% 
  group_by(SEX, origin) %>% 
  mutate(p = nn / sum(nn)) %>% 
  ggplot(aes(x = n, y = p, fill = origin)) +
  geom_col(position = position_dodge2(preserve="single")) +
  theme_bw(base_size = 14) +
  theme(legend.position = 'none',
        panel.grid = element_blank()) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1, by = 0.1)) +
  scale_x_continuous(limits = c(-0.5, max(stock_paired_14_16_filter_parents$n) + 0.5), breaks = seq(0,20, by = 2)) +
  facet_grid(~ SEX) +
  labs(fill = "Parent origin") +
  xlab("Number of Offspring (RS)")+
  ylab(expression(atop("Even", paste("Proportion of Parents")))) 

Stockdale_Odd_RS <- stock_paired_13_15_filter_parents %>% 
  count(SEX, origin, n) %>% 
  group_by(SEX, origin) %>% 
  mutate(p = nn / sum(nn)) %>% 
  ggplot(aes(x = n, y = p, fill = origin)) +
  geom_col(position = position_dodge2(preserve="single")) +
  theme_bw(base_size = 14) +
  theme(legend.position = 'none',
        panel.grid = element_blank()) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1, by = 0.1)) +
  scale_x_continuous(limits = c(-0.5, max(stock_paired_14_16_filter_parents$n) + 0.5), breaks = seq(0,20, by = 2)) +
  facet_grid(~ SEX, labeller = labeller(F = "Female", M = "Male")) +
  labs(title="Stockdale",
       fill = "Parent origin") +
  ylab(" ") +
  xlab (" ")

Stockdale_Even_RS <- stock_paired_14_16_filter_parents %>% 
  count(SEX, origin, n) %>% 
  group_by(SEX, origin) %>% 
  mutate(p = nn / sum(nn)) %>% 
  ggplot(aes(x = n, y = p, fill = origin)) +
  geom_col(position = position_dodge2(preserve="single")) +
  theme_bw(base_size = 14) +
  theme(legend.position = 'none',
        panel.grid = element_blank()) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1, by = 0.1)) +
  scale_x_continuous(limits = c(-0.5, max(stock_paired_14_16_filter_parents$n) + 0.5), breaks = seq(0,20, by = 2)) +
  facet_grid(~ SEX, labeller = labeller(F = "Female", M = "Male")) +
  labs(fill = "Parent origin") +
  xlab("Number of Offspring (RS)") +
  ylab(" ")

Figure_3 <- 
  grid.arrange(Hogan_Odd_RS, Stockdale_Odd_RS, Hogan_Even_RS, Stockdale_Even_RS, nrow = 2, widths = c(1.05, 1))


ggsave("Figure_3.pdf", plot = Figure_3, path = "V:/Documents/5_Coastwide/Multispecies/AHRP/Manuscripts/02.Hogan_Stockdale_EA/0002.Figures&Tables/Figures", height = 6, width = 12)

```

# Figure 4: RS by date
```{r Plot RS by Date}
Hogan_Even_Date <- paired_14_16_filter_parents %>% 
  ggplot(aes(x = `Sample Date`, y = n, color = origin)) +
  geom_jitter(height = 0, alpha = 0.5, size = 3) +
  geom_smooth(method = "loess", se = TRUE, level = 0.95) +
  theme_bw(base_size = 14) +
  theme(legend.position = c(0.85, 0.90),
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 10),
        legend.key.size = unit(1, "line"),
        panel.grid = element_blank()) +
  scale_y_continuous(limits = c(-2,20), breaks = seq(0,20, by = 5)) +
  facet_grid(SEX ~ .)+
  labs(title = "Hogan",  colour = "Parent origin") +
  xlab("Parent Sample Date") +
  ylab("Number of Offspring (RS)")

Stockdale_Even_Date <- stock_paired_14_16_filter_parents %>% 
  ggplot(aes(x = `Sample Date`, y = n, color = origin)) +
  geom_jitter(height = 0, alpha = 0.5, size = 3) +
  geom_smooth(method = "loess", se = TRUE, level = 0.95) +
  theme_bw(base_size = 14) +
  theme(legend.position = 'none',
        panel.grid = element_blank()) +
  scale_y_continuous(limits = c(-2,20), breaks = seq(0,20, by = 5)) +
  facet_grid(SEX ~ .)+
  labs(title = "Stockdale",  colour = "Parent origin") +
  xlab("Parent Sample Date") +
  ylab(" ")

Figure_4 <- grid.arrange(Hogan_Even_Date, Stockdale_Even_Date, nrow = 1, widths = c(1, 1))

ggsave("Figure_4.pdf", plot = Figure_4, path = "V:/Documents/5_Coastwide/Multispecies/AHRP/Manuscripts/02.Hogan_Stockdale_EA/0002.Figures&Tables/Figures", height = 6, width = 12)

```

# Figure 5: RS by location
``` {r Plot RS by Location}
riverdist_parentage_hogan <-
  read_csv("Hogan/riverdist_parentage_hogan.csv") %>% 
  mutate(origin = factor(x = origin, levels = c("Natural", "Hatchery"))) %>%
  mutate(SEX = case_when(SEX == "M" ~ "Male",
                         SEX == "F" ~ "Female"))

riverdist_parentage_stock <-
  read_csv("Stockdale/riverdist_parentage_stock.csv") %>% 
  mutate(origin = factor(x = origin, levels = c("Natural", "Hatchery"))) %>%
  mutate(SEX = case_when(SEX == "M" ~ "Male",
                         SEX == "F" ~ "Female"))

Hogan_Location <- riverdist_parentage_hogan %>% 
  ggplot(aes(x = Distance, y = n, color = origin)) +
  geom_vline(aes(xintercept = hitide), color = "black", lwd = 1.5) +
  geom_jitter(height = 0, alpha = 0.5, size = 3) +
  geom_smooth(method = "loess", se = TRUE, level = 0.95) +
  theme_bw(base_size = 14) +
  theme(legend.position = c(0.85, 0.90),
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 10),
        legend.key.size = unit(1, "line"),
        panel.grid = element_blank()) +
  # scale_x_continuous(limits = c(0, 1500), breaks = seq(0, 1500, by = 250)) +
  scale_y_continuous(limits = c(-2,20), breaks = seq(0,20, by = 5)) +
  facet_grid(SEX ~ .)+
  labs(title = "Hogan",  colour = "Parent origin") +
  xlab("Distance from Stream Mouth (m)") +
  ylab("Number of Offspring (RS)")


Stockdale_Location <- riverdist_parentage_stock %>% 
  ggplot(aes(x = Distance, y = n, color = origin)) +
  geom_vline(aes(xintercept = tidedist), color = "black", lwd = 1.5) +
  geom_jitter(height = 0, alpha = 0.5, size = 3) +
  geom_smooth(method = "loess", se = TRUE, level = 0.95) +
  theme_bw(base_size = 14) +
  theme(legend.position = "none",
        panel.grid = element_blank()) +
  # scale_x_continuous(limits = c(0, 1500), breaks = seq(0, 1500, by = 250)) +
  scale_y_continuous(limits = c(-2,20), breaks = seq(0,20, by = 5)) +
  facet_grid(SEX ~ .)+
  labs(title = "Stockdale") +
  xlab("Distance from Stream Mouth (m)") +
  ylab("")


Figure_5 <- grid.arrange(Hogan_Location, Stockdale_Location, nrow = 1, widths = c(1, 1))

ggsave("Figure_5.pdf", plot = Figure_5, path = "V:/Documents/5_Coastwide/Multispecies/AHRP/Manuscripts/02.Hogan_Stockdale_EA/0002.Figures&Tables/Figures", height = 6, width = 12)

```

# Figure 6: RS by length
```{r Plot RS by Length}
Hogan_Even_Length <- paired_14_16_filter_parents %>% 
  filter(`Length Mm` > 300) %>% 
  ggplot(aes(x = `Length Mm`, y = n, color = origin)) +
  geom_jitter(height = 0, alpha = 0.5, size = 3) +
  geom_smooth(method = "loess", se = TRUE, level = 0.95) +
  theme_bw(base_size = 14) +
  theme(legend.position = c(0.85, 0.90),
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 10),
        legend.key.size = unit(1, "line"),
        panel.grid = element_blank()) +
  # scale_x_continuous(limits = c(325, 500), breaks = seq(325, 500, by = 25)) +
  scale_y_continuous(limits = c(-2,20), breaks = seq(0,20, by = 5)) +
  facet_grid(SEX ~ .)+
  labs(title = "Hogan",  colour = "Parent origin") +
  xlab("Parent Length (mm)") +
  ylab("Number of Offspring (RS)")

Stockdale_Even_Length <- stock_paired_14_16_filter_parents %>% 
  filter(`Length Mm` > 300) %>% 
  ggplot(aes(x = `Length Mm`, y = n, color = origin)) +
  geom_jitter(height = 0, alpha = 0.5, size = 3) +
  geom_smooth(method = "loess", se = TRUE, level = 0.95) +
  theme_bw(base_size = 14) +
  theme(legend.position = 'none',
        panel.grid = element_blank()) +
  # scale_x_continuous(limits = c(325, 500), breaks = seq(325, 500, by = 25)) +
  scale_y_continuous(limits = c(-2,20), breaks = seq(0,20, by = 5)) +
  facet_grid(SEX ~ .)+
  labs(title = "Stockdale",  colour = "Parent origin") +
  xlab("Parent Length (mm)") +
  ylab(" ")


Figure_6 <- grid.arrange(Hogan_Even_Length, Stockdale_Even_Length, nrow = 1, widths = c(1, 1))

ggsave("Figure_6.pdf", plot = Figure_6, path = "V:/Documents/5_Coastwide/Multispecies/AHRP/Manuscripts/02.Hogan_Stockdale_EA/0002.Figures&Tables/Figures", height = 6, width = 12)
```

# Figure S1: Study design schematic

# Figure S2: Heterozygosity distribution
```{r Plot Het}
Hogan_even_het_tibble <- dget("../Objects/Hogan_13_14_15_16/het_tibble.txt") %>% 
  filter(lineage == "even")
Stockdale_even_het_tibble <- dget("../Objects/Stockdale_13_14_15_16//het_tibble.txt") %>% 
  filter(lineage == "even")
Hogan_odd_het_tibble <- dget("../Objects/Hogan_13_15/het_tibble.txt")
Stockdale_odd_het_tibble <- dget("../Objects/Stockdale_13_15/het_tibble.txt")

Hogan_het_tibble <- bind_rows(Hogan_even_het_tibble, Hogan_odd_het_tibble)
Stockdale_het_tibble <- bind_rows(Stockdale_even_het_tibble, Stockdale_odd_het_tibble)


# IQR
Hogan_low_box_het <- Hogan_het_tibble %>% 
  dplyr::group_by(lineage) %>% 
  dplyr::summarise(het = quantile(het, probs = 0.25) - 1.5 * diff(quantile(het, probs = c(0.25, 0.75))))

Hogan_high_box_het <- Hogan_het_tibble %>% 
  dplyr::group_by(lineage) %>% 
  dplyr::summarise(het = quantile(het, probs = 0.75) + 1.5 * diff(quantile(het, probs = c(0.25, 0.75))))

Stockdale_low_box_het <- Stockdale_het_tibble %>% 
  dplyr::group_by(lineage) %>% 
  dplyr::summarise(het = quantile(het, probs = 0.25) - 1.5 * diff(quantile(het, probs = c(0.25, 0.75))))

Stockdale_high_box_het <- Stockdale_het_tibble %>% 
  dplyr::group_by(lineage) %>% 
  dplyr::summarise(het = quantile(het, probs = 0.75) + 1.5 * diff(quantile(het, probs = c(0.25, 0.75))))

# 3SD
Hogan_low_sd_het <- Hogan_het_tibble %>% 
  dplyr::group_by(lineage) %>% 
  dplyr::summarise(het = mean(het) - (3 * sd(het)))

Hogan_high_sd_het <- Hogan_het_tibble %>% 
  dplyr::group_by(lineage) %>% 
  dplyr::summarise(het = mean(het) + (3 * sd(het)))

Stockdale_low_sd_het <- Stockdale_het_tibble %>% 
  dplyr::group_by(lineage) %>% 
  dplyr::summarise(het = mean(het) - (3 * sd(het)))

Stockdale_high_sd_het <- Stockdale_het_tibble %>% 
  dplyr::group_by(lineage) %>% 
  dplyr::summarise(het = mean(het) + (3 * sd(het)))



Hogan_odd_het <- Hogan_het_tibble %>% 
  filter(lineage == "odd") %>% 
  ggplot(aes(x = het)) +
  geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1/303) +
  geom_vline(aes(xintercept = het, color = "1.5 IQR"), filter(Hogan_low_box_het, lineage == "odd")) +
  geom_vline(aes(xintercept = het, color = "1.5 IQR"), filter(Hogan_high_box_het, lineage == "odd")) +
  geom_vline(aes(xintercept = het, color = "3 SD"), filter(Hogan_low_sd_het, lineage == "odd")) +
  geom_vline(aes(xintercept = het, color = "3 SD"), filter(Hogan_high_sd_het, lineage == "odd")) +
  theme_bw(base_size = 14) +
  theme(legend.position = c(0.85, 0.75),
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 10),
        legend.key.size = unit(1, "line"),
        panel.grid = element_blank()) +
  xlim(0.15, 0.85) +
  ylim(0, 0.05) +
  xlab("") +
  labs(title = "Hogan", color = "Cutoff") +
  ylab(expression(atop("Odd", paste("Frequency"))))


Hogan_even_het <- Hogan_het_tibble %>% 
  filter(lineage == "even") %>% 
  ggplot(aes(x = het)) +
  geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1/303) +
  geom_vline(aes(xintercept = het, color = "1.5 IQR"), filter(Hogan_low_box_het, lineage == "even")) +
  geom_vline(aes(xintercept = het, color = "1.5 IQR"), filter(Hogan_high_box_het, lineage == "even")) +
  geom_vline(aes(xintercept = het, color = "3 SD"), filter(Hogan_low_sd_het, lineage == "even")) +
  geom_vline(aes(xintercept = het, color = "3 SD"), filter(Hogan_high_sd_het, lineage == "even")) +
  theme_bw(base_size = 14) +
  theme(legend.position = 'none',
        panel.grid = element_blank()) +
  xlim(0.15, 0.85) +
  ylim(0, 0.05) +
  xlab("Individual Heterozygosity") +
  ylab(expression(atop("Even", paste("Frequency"))))

Stockdale_odd_het <- Stockdale_het_tibble %>% 
  filter(lineage == "odd") %>% 
  ggplot(aes(x = het)) +
  geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1/303) +
  geom_vline(aes(xintercept = het, color = "1.5 IQR"), filter(Stockdale_low_box_het, lineage == "odd")) +
  geom_vline(aes(xintercept = het, color = "1.5 IQR"), filter(Stockdale_high_box_het, lineage == "odd")) +
  geom_vline(aes(xintercept = het, color = "3 SD"), filter(Stockdale_low_sd_het, lineage == "odd")) +
  geom_vline(aes(xintercept = het, color = "3 SD"), filter(Stockdale_high_sd_het, lineage == "odd")) +
  theme_bw(base_size = 14) +
  theme(legend.position = 'none',
        panel.grid = element_blank()) +
  xlim(0.15, 0.85) +
  ylim(0, 0.05) +
  xlab("") +
  ylab("") +
  ggtitle("Stockdale")

Stockdale_even_het <- Stockdale_het_tibble %>% 
  filter(lineage == "even") %>% 
  ggplot(aes(x = het)) +
  geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1/303) +
  geom_vline(aes(xintercept = het, color = "1.5 IQR"), filter(Stockdale_low_box_het, lineage == "even")) +
  geom_vline(aes(xintercept = het, color = "1.5 IQR"), filter(Stockdale_high_box_het, lineage == "even")) +
  geom_vline(aes(xintercept = het, color = "3 SD"), filter(Stockdale_low_sd_het, lineage == "even")) +
  geom_vline(aes(xintercept = het, color = "3 SD"), filter(Stockdale_high_sd_het, lineage == "even")) +
  theme_bw(base_size = 14) +
  theme(legend.position = 'none',
        panel.grid = element_blank()) +
  xlim(0.15, 0.85) +
  ylim(0, 0.05) +
  xlab("Individual Heterozygosity") +
  ylab("")


Figure_S2 <- 
  grid.arrange(Hogan_odd_het, Stockdale_odd_het, Hogan_even_het, Stockdale_even_het, nrow = 2, widths = c(1.10, 1))  # added width argument to get plot area equal


ggsave("Figure_S2.pdf", plot = Figure_S2, path = "V:/Documents/5_Coastwide/Multispecies/AHRP/Manuscripts/02.Hogan_Stockdale_EA/0002.Figures&Tables/Figures", height = 6, width = 12)
```

# Figure S3: CKMRSim plot
This figure is created in a separate notebook "Hogan_Stockdale_13_16_MS_CKMRSIM.Rmd".

# Figure S4: RS by cross type
``` {r Plot Cross Type}
Hogan_parents_paired_14_16_cross <- read_csv("Hogan/parents_paired_14_16_cross.csv") %>% 
  mutate(cross = factor(x = cross, levels = c("NN", "NH", "HN", "HH"))) 

Stockdale_parents_paired_14_16_cross <- read_csv("Stockdale/stock_parents_paired_14_16_cross.csv") %>% 
  mutate(cross = factor(x = cross, levels = c("NN", "NH", "HN", "HH"))) 

Hogan_n <- Hogan_parents_paired_14_16_cross %>% 
  count(cross, `Fish ID`, `Fish ID.par1`) %>% 
  rename(nn = n) %>% 
  count(cross) %>% 
  rename(samp = n)

Hogan_Cross_Type <- Hogan_parents_paired_14_16_cross %>% 
  count(cross, `Fish ID`, `Fish ID.par1`) %>% 
  count(cross, n) %>% 
  complete(cross, n, fill = list(nn = 0)) %>% 
  group_by(cross) %>% 
  mutate(p = nn / sum(nn)) %>% 
  left_join(Hogan_n, by = "cross") %>% 
  mutate(cross_n = paste0(cross, " (n = ", samp, ")")) %>% 
  ggplot(aes(x = n, y = p, fill = cross_n))+
  geom_col(position = position_dodge2(preserve = "single"), width = 0.5) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1, by = 0.1)) +
  scale_x_continuous(limits = c(0,5), breaks = seq(0, 5, by = 1)) +
  labs(title = "Hogan",
       fill = "Cross Type") +
  xlab("Number of Offspring (RS)")+
  ylab("Proportion of Families of Each Cross Type") +
  theme_bw() +
  theme(text = element_text(size = 20),
        legend.position = c(0.7, 0.75),
        panel.grid = element_blank())

Stockdale_n <- Stockdale_parents_paired_14_16_cross %>% 
  count(cross, `Fish ID`, `Fish ID.par1`) %>% 
  rename(nn = n) %>% 
  count(cross) %>% 
  rename(samp = n)

Stockdale_Cross_Type <- Stockdale_parents_paired_14_16_cross %>% 
  count(cross, `Fish ID`, `Fish ID.par1`) %>% 
  count(cross, n) %>% 
  complete(cross, n, fill = list(nn = 0)) %>% 
  group_by(cross) %>% 
  mutate(p = nn / sum(nn)) %>% 
  left_join(Stockdale_n, by = "cross") %>% 
  mutate(cross_n = paste0(cross, " (n = ", samp, ")")) %>% 
  ggplot(aes(x = n, y = p, fill = cross_n))+
  geom_col(position = position_dodge2(preserve = "single"), width = 0.5) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1, by = 0.1)) +
  scale_x_continuous(limits = c(0,5), breaks = seq(0, 5, by = 1)) +
  labs(title = "Stockdale",
       fill = "Cross Type") +
  xlab("Number of Offspring (RS)")+
  ylab(" ") +
  theme_bw() +
  theme(text = element_text(size = 20),
        legend.position = c(0.7, 0.75),
        panel.grid = element_blank())

Figure_S4 <- grid.arrange(Hogan_Cross_Type, Stockdale_Cross_Type, nrow = 1)

ggsave("Figure_S4.pdf", plot = Figure_S4, path = "V:/Documents/5_Coastwide/Multispecies/AHRP/Manuscripts/02.Hogan_Stockdale_EA/0002.Figures&Tables/Figures", height = 6, width = 12)

```

# ANOVAs for Covariates

## Read data

### OceanAK Data

```{r}
og_names <- suppressMessages(names(read_csv(file = "../OceanAK/PedigreeData_AHRP - Salmon Biological Data 2_PWS_2013-2018_no_otoliths.csv", progress = FALSE)))
oceanak <- read_csv(file = "../OceanAK/AHRP Salmon Biological Data 20191119_1053.csv")
names(oceanak) <- og_names

# add otolith_read logical, stream as factor, and year
oceanak_mod <- oceanak  %>% 
  unite(SillySource, `Silly Code`, `Fish ID`, sep = "_", remove = FALSE) %>% 
  unite(TrayCodeID, `DNA Tray Code`, `DNA Tray Well Code`, sep = "_", remove = FALSE) %>% 
  mutate(otolith_read = !is.na(`Otolith Mark Status Code`) & `Otolith Mark Status Code` != "n") %>% 
  mutate(stream = factor(x = `Location Code`, levels = c("Gilmour Creek", "Paddy Creek", "Erb Creek", "Hogan Creek", "Stockdale Creek"))) %>% 
  rename(year = `Sample Year`) %>% 
  mutate(origin = case_when(`Otolith Mark Present` == "NO" ~ "natural",
                            `Otolith Mark Present` == "YES" ~ "hatchery")) %>% 
  mutate(origin = factor(origin, levels = c("natural", "hatchery"))) %>% 
  mutate(date = dmy(`Sample Date`))
```

### Filter for Stockdale and Hogan

```{r}
(oceanak_mod <- oceanak_mod %>% 
   filter(stream %in% c("Stockdale Creek", "Hogan Creek")))
```

### riverdist Data

```{r}
(stockdale_riverdist <- read_csv("../GIS/R/stockdale/stockdale_distances.csv") %>% 
   mutate(Intertidal = case_when(dist2tide > 0 ~ "Upstream",
                                 dist2tide <= 0 ~ "Intertidal")) %>% 
   rename(Distance = mouthdist, Segment = seg))
```

```{r}
(hogan_riverdist <- read_csv("../GIS/R/hogan/hogan_distances.csv") %>% 
   mutate(Intertidal = case_when(dist2tide > 0 ~ "Upstream",
                                 dist2tide <= 0 ~ "Intertidal")) %>% 
   rename(Distance = mouthdist, Segment = seg, tidedist = hitide))
```

```{r}
riverdist <- bind_rows(stockdale_riverdist, hogan_riverdist)
```

### Join

```{r}
(join <- oceanak_mod %>% 
   mutate(dna_tray_code = str_pad(string = `DNA Tray Code`, width = 10, side = "left", pad = "0")) %>% 
   unite(Sample, c(dna_tray_code, `DNA Tray Well Code`)) %>% 
   inner_join(riverdist, by = "Sample") %>% 
   mutate(DOY = yday(date))
)
```

### Filter for genotyped fish

Get genotyped fish from the paired data created when we create *FRANz* files.
```{r}
stock_odd <- read_csv("Franz/stockdale_13_15_postQA_OceanAK_paired_2013_2015_STOCK.csv") %>% 
  filter(`Sample Year` == 2013) %>% 
  mutate(dna_tray_code = str_pad(string = `DNA Tray Code`, width = 10, side = "left", pad = "0")) %>% 
  unite(col = "Sample", c("dna_tray_code", "DNA Tray Well Code")) %>%
  pull(Sample)
stock_even <- read_csv("Franz/stockdale_postQA_OceanAK_paired_2014_2016_STOCK.csv") %>% 
  filter(`Sample Year` == 2014) %>% 
  mutate(dna_tray_code = str_pad(string = `DNA Tray Code`, width = 10, side = "left", pad = "0")) %>% 
  unite(col = "Sample", c("dna_tray_code", "DNA Tray Well Code")) %>%
  pull(Sample)
hogan_odd <- read_csv("Franz/hogan_13_15_postQA_OceanAK_paired_2013_2015_HOGAN.csv") %>% 
  filter(`Sample Year` == 2013) %>% 
  mutate(dna_tray_code = str_pad(string = `DNA Tray Code`, width = 10, side = "left", pad = "0")) %>% 
  unite(col = "Sample", c("dna_tray_code", "DNA Tray Well Code")) %>%
  pull(Sample)
hogan_even <- read_csv("Franz/hogan_postQA_OceanAK_paired_2014_2016_HOGAN.csv") %>% 
  filter(`Sample Year` == 2014) %>% 
  mutate(dna_tray_code = str_pad(string = `DNA Tray Code`, width = 10, side = "left", pad = "0")) %>% 
  unite(col = "Sample", c("dna_tray_code", "DNA Tray Well Code")) %>%
  pull(Sample)
```

Verify that all samples are in the Riverdist data.
```{r}
all(c(stock_odd, stock_even, hogan_odd, hogan_even) %in% join$Sample)
```

Compare with Table 1 sample sizes
```{r}
ANOVA <- join %>% 
  filter(Sample %in% c(stock_odd, stock_even, hogan_odd, hogan_even)) %>% 
  mutate(sex = factor(x = Sex, levels = c("M", "F")))

ANOVA %>% 
  count(year, stream) %>% 
  spread(year, n)
```


Got this from [link](https://kieranhealy.org/blog/archives/2018/11/06/spreading-multiple-values/)
```{r}
multi_spread <- function(df, key, value) {
    # quote key
    keyq <- rlang::enquo(key)
    # break value vector into quotes
    valueq <- rlang::enquo(value)
    s <- rlang::quos(!!valueq)
    df %>% gather(variable, value, !!!s) %>%
        unite(temp, !!keyq, variable) %>%
        spread(temp, value)
}
```

```{r}
ANOVA %>% 
  filter(`Length Mm` > 300) %>% 
  group_by(stream, sex, year, origin) %>% 
  summarise(length_mean = mean(`Length Mm`, na.rm = TRUE),
            length_sd = sd(`Length Mm`, na.rm = TRUE),
            date_sd = sd(date, na.rm = TRUE),
            distance_mean = mean(Distance, na.rm = TRUE),
            distance_sd = sd(Distance, na.rm = TRUE)) %>% 
  multi_spread(origin, c(length_mean, length_sd, date_sd, distance_mean, distance_sd)) %>% 
  write_csv("V:/Documents/5_Coastwide/Multispecies/AHRP/Manuscripts/02.Hogan_Stockdale_EA/0002.Figures&Tables/Tables/anova_means.csv")

ANOVA %>% 
  filter(`Length Mm` > 300) %>% 
  group_by(stream, sex, year, origin) %>% 
  summarise(date_mean = mean(date, na.rm = TRUE)) %>% 
  multi_spread(origin, c(date_mean)) %>% 
  write_csv("V:/Documents/5_Coastwide/Multispecies/AHRP/Manuscripts/02.Hogan_Stockdale_EA/0002.Figures&Tables/Tables/anova_means_date.csv")
```


Means and standard devaitions
```{r}
stockdale_ANOVA %>% 
  filter(`Length Mm` > 300) %>% 
  group_by(year, Sex, origin) %>% 
  summarise(count = n(),
            mean = mean(`Length Mm`, na.rm = TRUE),
            sd = sd(`Length Mm`, na.rm = TRUE))
```


## Length

Visualize density plots to see if there are outliers
```{r}
mu_hogan_length <- ANOVA %>% 
  filter(stream == "Hogan Creek") %>% 
  group_by(origin, year, sex) %>% 
  summarise(length = mean(`Length Mm`, na.rm = TRUE))

ANOVA %>% 
  filter(stream == "Hogan Creek") %>% 
  ggplot(aes(x = `Length Mm`, fill = origin)) +
  geom_density(alpha = 0.5) +
  geom_vline(data = mu_hogan_length, aes(xintercept = length, colour = origin), size = 1) +
  xlim(c(300, 550)) +
  facet_grid(year ~ sex) +
  theme_bw() +
  ggtitle("Hogan Creek")

mu_stockdale_length <- ANOVA %>% 
  filter(stream == "Stockdale Creek") %>% 
  group_by(origin, year, sex) %>% 
  summarise(length = mean(`Length Mm`, na.rm = TRUE))

ANOVA %>% 
  filter(stream == "Stockdale Creek") %>% 
  ggplot(aes(x = `Length Mm`, fill = origin)) +
  geom_density(alpha = 0.5) +
  geom_vline(data = mu_stockdale_length, aes(xintercept = length, colour = origin), size = 1) +
  xlim(c(300, 550)) +
  facet_grid(year ~ sex) +
  theme_bw() +
  ggtitle("Stockdale Creek")
```

### t-tests

```{r}
t.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
t.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN14" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
t.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
t.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN14" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
t.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PSTOCK13" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
t.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PSTOCK14" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
t.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PSTOCK13" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
t.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PSTOCK14" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
```

## Date

Visualize density plots to see if there are outliers
```{r}
mu_hogan_date <- ANOVA %>% 
  filter(stream == "Hogan Creek") %>% 
  group_by(origin, year, sex) %>% 
  summarise(date = mean(DOY, na.rm = TRUE))

ANOVA %>% 
  filter(stream == "Hogan Creek") %>% 
  ggplot(aes(x = DOY, fill = origin)) +
  geom_density(alpha = 0.5) +
  geom_vline(data = mu_hogan_date, aes(xintercept = date, colour = origin), size = 1) +
  facet_grid(year ~ sex) +
  theme_bw() +
  ggtitle("Hogan Creek")

mu_stockdale_date <- ANOVA %>% 
  filter(stream == "Stockdale Creek") %>% 
  group_by(origin, year, sex) %>% 
  summarise(date = mean(DOY, na.rm = TRUE))

ANOVA %>% 
  filter(stream == "Stockdale Creek") %>% 
  ggplot(aes(x = DOY, fill = origin)) +
  geom_density(alpha = 0.5) +
  geom_vline(data = mu_stockdale_date, aes(xintercept = date, colour = origin), size = 1) +
  facet_grid(year ~ sex) +
  theme_bw() +
  ggtitle("Stockdale Creek")
```

### Wilcoxon tests

```{r}
wilcox.test(DOY ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(DOY ~ origin, data = filter(`Silly Code` == "PHOGAN14" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(DOY ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(DOY ~ origin, data = filter(`Silly Code` == "PHOGAN14" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(DOY ~ origin, data = filter(`Silly Code` == "PSTOCK13" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(DOY ~ origin, data = filter(`Silly Code` == "PSTOCK14" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(DOY ~ origin, data = filter(`Silly Code` == "PSTOCK13" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(DOY ~ origin, data = filter(`Silly Code` == "PSTOCK14" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
```

## Distance

Visualize density plots to see if there are outliers
```{r}
mu_hogan_distance <- ANOVA %>% 
  filter(stream == "Hogan Creek") %>% 
  group_by(origin, year, sex) %>% 
  summarise(distance = mean(Distance, na.rm = TRUE))

ANOVA %>% 
  filter(stream == "Hogan Creek") %>% 
  ggplot(aes(x = Distance, fill = origin)) +
  geom_density(alpha = 0.5) +
  geom_vline(data = mu_hogan_distance, aes(xintercept = distance, colour = origin), size = 1) +
  facet_grid(year ~ sex) +
  theme_bw() +
  ggtitle("Hogan Creek")

mu_stockdale_distance <- ANOVA %>% 
  filter(stream == "Stockdale Creek") %>% 
  group_by(origin, year, sex) %>% 
  summarise(distance = mean(Distance, na.rm = TRUE))

ANOVA %>% 
  filter(stream == "Stockdale Creek") %>% 
  ggplot(aes(x = Distance, fill = origin)) +
  geom_density(alpha = 0.5) +
  geom_vline(data = mu_stockdale_distance, aes(xintercept = distance, colour = origin), size = 1) +
  facet_grid(year ~ sex) +
  theme_bw() +
  ggtitle("Stockdale Creek")
```

### Wilcoxon tests

```{r}
wilcox.test(Distance ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(Distance ~ origin, data = filter(`Silly Code` == "PHOGAN14" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(Distance ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(Distance ~ origin, data = filter(`Silly Code` == "PHOGAN14" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(Distance ~ origin, data = filter(`Silly Code` == "PSTOCK13" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(Distance ~ origin, data = filter(`Silly Code` == "PSTOCK14" & sex == "M", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(Distance ~ origin, data = filter(`Silly Code` == "PSTOCK13" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
wilcox.test(Distance ~ origin, data = filter(`Silly Code` == "PSTOCK14" & sex == "F", .data = ANOVA), alternative = "two.sided")$p.value < 0.05
```





### ANOVAs - abandoned
```{r}
hogan_odd_male_length_fit <- aov(formula = `Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "M", .data = ANOVA))
summary(hogan_odd_length_fit)
```

```{r}
shapiro.test(
  ANOVA %>% 
    filter(`Silly Code` == "PHOGAN13" & sex == "M" & origin == "natural") %>% 
    drop_na(`Length Mm`) %>% 
    pull(`Length Mm`)
)

shapiro.test(
  ANOVA %>% 
    filter(`Silly Code` == "PHOGAN13" & sex == "M" & origin == "hatchery") %>% 
    drop_na(`Length Mm`) %>% 
    pull(`Length Mm`)
)
```

```{r}
var.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "M", .data = ANOVA))
```

```{r}
t.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "M", .data = ANOVA))
t.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "M", .data = ANOVA), var.equal = TRUE)
t.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "M", .data = ANOVA), var.equal = FALSE)
```

```{r}
wilcox.test(`Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "M", .data = ANOVA))
```




```{r}
hogan_odd_female_length_fit <- aov(formula = `Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN13" & sex == "F", .data = ANOVA))
summary(hogan_odd_female_length_fit)
```

```{r}
hogan_even_male_length_fit <- aov(formula = `Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN14" & sex == "M", .data = ANOVA))
summary(hogan_even_male_length_fit)
```

```{r}
hogan_even_female_length_fit <- aov(formula = `Length Mm` ~ origin, data = filter(`Silly Code` == "PHOGAN14" & sex == "F", .data = ANOVA))
summary(hogan_even_female_length_fit)
```

### Date

Visualize density plots to see if there are outliers
```{r}
mu_hogan_date <- ANOVA %>% 
  filter(stream == "Hogan Creek") %>% 
  group_by(origin, year, sex) %>% 
  summarise(date = mean(DOY, na.rm = TRUE))

ANOVA %>% 
  filter(stream == "Hogan Creek") %>% 
  ggplot(aes(x = DOY, fill = origin)) +
  geom_density(alpha = 0.5) +
  geom_vline(data = mu_hogan_date, aes(xintercept = date, colour = origin), size = 1) +
  facet_grid(year ~ sex) +
  theme_bw() +
  ggtitle("Hogan Creek")
```

```{r}
hogan_odd_date_fit <- aov(formula = DOY ~ Sex + origin, data = filter(`Silly Code` == "PHOGAN13", .data = ANOVA))
summary(hogan_odd_date_fit)
```

```{r}
hogan_even_date_fit <- aov(formula = DOY ~ Sex + origin, data = filter(`Silly Code` == "PHOGAN14", .data = ANOVA))
summary(hogan_even_date_fit)
```

### Distance

Visualize density plots to see if there are outliers
```{r}
mu_hogan_distance <- ANOVA %>% 
  filter(stream == "Hogan Creek") %>% 
  group_by(origin, year, sex) %>% 
  summarise(distance = mean(Distance, na.rm = TRUE))

ANOVA %>% 
  filter(stream == "Hogan Creek") %>% 
  ggplot(aes(x = Distance, fill = origin)) +
  geom_density(alpha = 0.5) +
  geom_vline(data = mu_hogan_distance, aes(xintercept = distance, colour = origin), size = 1) +
  facet_grid(year ~ sex) +
  theme_bw() +
  ggtitle("Hogan Creek")
```

```{r}
hogan_odd_distance_fit <- aov(formula = Distance ~ Sex + origin, data = filter(`Silly Code` == "PHOGAN13", .data = ANOVA))
summary(hogan_odd_distance_fit)
```

```{r}
hogan_even_distance_fit <- aov(formula = Distance ~ Sex + origin, data = filter(`Silly Code` == "PHOGAN14", .data = ANOVA))
summary(hogan_even_distance_fit)
```














# Extra ANOVA Assumption Checking

```{r}
plot(stock_odd_length_fit, 1)
```

```{r}
plot(stock_odd_length_fit, 2)
```

```{r}
car::leveneTest(`Length Mm` ~ Sex * origin, data = filter(year == 2013, .data = stockdale_ANOVA))
```


Visualize density plots to see if there are outliers
```{r}
mu_male <- ANOVA %>% 
  filter(sex == "M") %>% 
  group_by(origin, stream, year) %>% 
  summarise(length = mean(`Length Mm`, na.rm = TRUE))

ANOVA %>% 
  filter(sex == "M") %>% 
  ggplot(aes(x = `Length Mm`, fill = origin)) +
  geom_density(alpha = 0.5) +
  geom_vline(data = mu_male, aes(xintercept = length, colour = origin), size = 1) +
  xlim(c(300, 550)) +
  facet_grid(year ~ stream) +
  theme_bw() +
  ggtitle("Male")

mu_female <- ANOVA %>% 
  filter(sex == "F") %>% 
  group_by(origin, stream, year) %>% 
  summarise(length = mean(`Length Mm`, na.rm = TRUE))

ANOVA %>% 
  filter(sex == "F") %>% 
  ggplot(aes(x = `Length Mm`, fill = origin)) +
  geom_density(alpha = 0.5) +
  xlim(c(300, 550)) +
  geom_vline(data = mu_male, aes(xintercept = length, colour = origin), size = 1) +
  facet_grid(year ~ stream) +
  theme_bw() +
  ggtitle("Female")
```

# Table S3: Field Sample Sizes

I did this from my local version, so the paths are weird
```{r}
oceanak <- read_csv(file = "../../Desktop/Local_PWS_pinks/OceanAK/AHRP Salmon Biological Data 20191119_1053_names.csv")

oceanak_mod <- oceanak  %>%
  unite(SillySource,
        `Silly Code`,
        `Fish ID`,
        sep = "_",
        remove = FALSE) %>%
  unite(TrayCodeID,
        `DNA Tray Code`,
        `DNA Tray Well Code`,
        sep = "_",
        remove = FALSE) %>%
  mutate(otolith_read = !is.na(`Otolith Mark Status Code`) &
           `Otolith Mark Status Code` != "n") %>%
  mutate(stream = factor(
    x = `Location Code`,
    levels = c(
      "Gilmour Creek",
      "Paddy Creek",
      "Erb Creek",
      "Hogan Creek",
      "Stockdale Creek"
    )
  )) %>%
  rename(year = `Sample Year`) %>%
  mutate(
    origin = case_when(
      `Otolith Mark Present` == "NO" ~ "natural",
      `Otolith Mark Present` == "YES" ~ "hatchery"
    )
  ) %>%
  mutate(origin = factor(origin, levels = c("natural", "hatchery"))) %>%
  mutate(date = dmy(`Sample Date`))

x <-
  oceanak_mod %>% filter(stream %in% c("Hogan Creek", "Stockdale Creek") &
                           year %in% 2013:2016)

x
```

Total fish collected
```{r}
x %>% count(stream)
```

Fish by stream and year
```{r}
x %>% count(stream, year)
```

Otoliths read by stream
```{r}
x %>% filter(!is.na(origin)) %>% count(stream)
```


Otoliths read by stream and year
```{r}
x %>% filter(!is.na(origin)) %>% count(stream, year)
```

Hatchery by stream
```{r}
x %>% filter(origin == "hatchery") %>% count(stream)
```

Hatchery by stream and year
```{r}
x %>% filter(origin == "hatchery") %>% count(stream, year)
```

Natural by stream
```{r}
x %>% filter(origin == "natural") %>% count(stream)
```

Natural by stream and year
```{r}
x %>% filter(origin == "natural") %>% count(stream, year)
```

Hatchery by stream and facility
```{r}
x %>%
  filter(origin == "hatchery") %>%
  mutate(otolith_mark_ID = str_sub(
    string = `Otolith Mark ID`,
    start = 1,
    end = 3
  )) %>%
  mutate(otolith_mark_ID = factor(x = otolith_mark_ID, levels = c("AFK", "CCH", "WNH", "SGH"))) %>%
  count(stream, otolith_mark_ID) %>% 
  spread(otolith_mark_ID, n, fill = 0)
```

Hatchery by stream, year, and facility
```{r}
x %>%
  filter(origin == "hatchery") %>%
  mutate(otolith_mark_ID = str_sub(
    string = `Otolith Mark ID`,
    start = 1,
    end = 3
  )) %>%
  mutate(otolith_mark_ID = factor(x = otolith_mark_ID, levels = c("AFK", "CCH", "WNH", "SGH"))) %>%
  count(stream, year, otolith_mark_ID) %>% 
  spread(otolith_mark_ID, n, fill = 0)
```